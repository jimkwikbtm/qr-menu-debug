<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luna Dine - Restaurant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== UBER EATS INSPIRED DESIGN SYSTEM ===== */
        
        /* ===== CORE DESIGN TOKENS ===== */
        :root {
            /* Uber Eats Color Palette */
            --uber-black: #000000;
            --uber-white: #FFFFFF;
            --uber-green: #06C167;
            --uber-green-light: #7FDD9C;
            --uber-green-dark: #05A654;
            --uber-gray-100: #F5F5F5;
            --uber-gray-200: #E0E0E0;
            --uber-gray-300: #BDBDBD;
            --uber-gray-400: #9E9E9E;
            --uber-gray-500: #757575;
            --uber-gray-600: #616161;
            --uber-gray-700: #424242;
            --uber-gray-800: #212121;
            --uber-gray-900: #000000;
            --uber-yellow: #FFC300;
            --uber-red: #FF4136;
            --uber-blue: #0074E4;
            
            /* Premium Color Variations */
            --premium-green-light: #E8F5F1;
            --premium-green-medium: #4CAF50;
            --premium-green-dark: #2E7D32;
            --premium-gray-50: #FAFAFA;
            --premium-gray-100: #F5F5F5;
            --premium-gray-200: #EEEEEE;
            --premium-gray-300: #E0E0E0;
            --premium-gray-400: #BDBDBD;
            --premium-gray-500: #9E9E9E;
            --premium-gray-600: #757575;
            --premium-gray-700: #616161;
            --premium-gray-800: #424242;
            --premium-gray-900: #212121;
            --premium-shadow: rgba(0, 0, 0, 0.08);
            --premium-shadow-hover: rgba(0, 0, 0, 0.12);
            --premium-shadow-active: rgba(0, 0, 0, 0.16);
            
            /* Typography Scale */
            --font-size-12: 0.75rem;   /* 12px */
            --font-size-14: 0.875rem;  /* 14px */
            --font-size-16: 1rem;      /* 16px */
            --font-size-18: 1.125rem;  /* 18px */
            --font-size-20: 1.25rem;   /* 20px */
            --font-size-24: 1.5rem;    /* 24px */
            --font-size-28: 1.75rem;   /* 28px */
            --font-size-32: 2rem;      /* 32px */
            --font-size-36: 2.25rem;   /* 36px */
            --font-size-40: 2.5rem;    /* 40px */
            --font-size-48: 3rem;      /* 48px */
            
            /* Spacing Scale */
            --spacing-4: 0.25rem;      /* 4px */
            --spacing-8: 0.5rem;       /* 8px */
            --spacing-12: 0.75rem;     /* 12px */
            --spacing-16: 1rem;        /* 16px */
            --spacing-20: 1.25rem;     /* 20px */
            --spacing-24: 1.5rem;      /* 24px */
            --spacing-28: 1.75rem;     /* 28px */
            --spacing-32: 2rem;        /* 32px */
            --spacing-36: 2.25rem;     /* 36px */
            --spacing-40: 2.5rem;      /* 40px */
            --spacing-48: 3rem;        /* 48px */
            --spacing-64: 4rem;        /* 64px */
            
            /* Border Radius */
            --radius-4: 4px;
            --radius-8: 8px;
            --radius-12: 12px;
            --radius-16: 16px;
            --radius-20: 20px;
            --radius-24: 24px;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-1: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --shadow-2: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
            --shadow-3: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
            --shadow-4: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
            --shadow-5: 0 19px 38px rgba(0,0,0,0.30), 0 15px 12px rgba(0,0,0,0.22);
            
            /* Additional shadows for common patterns */
            --shadow-green: 0 4px 12px rgba(6, 193, 103, 0.3);
            --shadow-green-hover: 0 4px 15px rgba(6, 193, 103, 0.4);
            --shadow-green-strong: 0 6px 20px rgba(6, 193, 103, 0.6);
            --shadow-subtle: 0 2px 12px rgba(0, 0, 0, 0.04);
            --shadow-mild: 0 -4px 20px rgba(0, 0, 0, 0.1);
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 300ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Common transforms */
            --transform-scale-up: scale(1.1);
            --transform-slide-up: translateY(-2px);
            --transform-slide-down: translateY(2px);
            --transform-slide-up-small: translateY(-1px);
            --transform-center-y: translateY(-50%);
            
            /* Common gradients */
            --gradient-primary: linear-gradient(135deg, var(--uber-green), var(--uber-green-dark));
            --gradient-primary-light: linear-gradient(135deg, var(--uber-green), var(--uber-green-light));
            --gradient-primary-reverse: linear-gradient(135deg, var(--uber-green-light), var(--uber-green));
            --gradient-primary-strong: linear-gradient(135deg, var(--uber-green), #05a654);
            --gradient-triple: linear-gradient(135deg, var(--uber-green), var(--uber-green-light), #7FDD9C);
        }
        
        /* ===== UTILITY CLASSES ===== */
        .flex {
            display: flex;
        }
        
        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .flex-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .flex-col {
            display: flex;
            flex-direction: column;
        }
        
        .flex-wrap {
            display: flex;
            flex-wrap: wrap;
        }
        
        .hidden {
            display: none;
        }
        
        .block {
            display: block;
        }
        
        .inline-block {
            display: inline-block;
        }
        
        .relative {
            position: relative;
        }
        
        .absolute {
            position: absolute;
        }
        
        .sticky {
            position: sticky;
        }
        
        .text-center {
            text-align: center;
        }
        
        .w-full {
            width: 100%;
        }
        
        .h-full {
            height: 100%;
        }
        
        .rounded-full {
            border-radius: var(--radius-full);
        }
        
        .rounded-lg {
            border-radius: var(--radius-8);
        }
        
        .rounded-xl {
            border-radius: var(--radius-12);
        }
        
        .rounded-2xl {
            border-radius: var(--radius-16);
        }
        
        .transition-fast {
            transition: var(--transition-fast);
        }
        
        .transition-normal {
            transition: var(--transition-normal);
        }
        
        .transition-all {
            transition: all var(--transition-normal);
        }
        
        .hover-lift:hover {
            transform: var(--transform-slide-up);
        }
        
        .hover-lift-small:hover {
            transform: var(--transform-slide-up-small);
        }
        
        .hover-scale:hover {
            transform: var(--transform-scale-up);
        }
        
        .hover-bg-gray:hover {
            background-color: var(--uber-gray-100);
        }
        
        .hover-text-green:hover {
            color: var(--uber-green);
        }
        
        .hover-bg-green:hover {
            background-color: var(--uber-green);
        }
        
        .text-green {
            color: var(--uber-green);
        }
        
        .text-white {
            color: var(--uber-white);
        }
        
        .text-gray-700 {
            color: var(--uber-gray-700);
        }
        
        .text-gray-300 {
            color: var(--uber-gray-300);
        }
        
        .text-gray-400 {
            color: var(--uber-gray-400);
        }
        
        .bg-white {
            background-color: var(--uber-white);
        }
        
        .bg-gray-100 {
            background-color: var(--uber-gray-100);
        }
        
        .bg-gray-800 {
            background-color: var(--uber-gray-800);
        }
        
        .bg-gray-900 {
            background-color: var(--uber-gray-900);
        }
        
        .bg-green {
            background-color: var(--uber-green);
        }
        
        .bg-gradient-primary {
            background: var(--gradient-primary);
        }
        
        .bg-gradient-primary-light {
            background: var(--gradient-primary-light);
        }
        
        .bg-gradient-primary-reverse {
            background: var(--gradient-primary-reverse);
        }
        
        .bg-gradient-primary-strong {
            background: var(--gradient-primary-strong);
        }
        
        .bg-gradient-triple {
            background: var(--gradient-triple);
        }
        
        .shadow-1 {
            box-shadow: var(--shadow-1);
        }
        
        .shadow-2 {
            box-shadow: var(--shadow-2);
        }
        
        .shadow-green {
            box-shadow: var(--shadow-green);
        }
        
        .shadow-green-hover {
            box-shadow: var(--shadow-green-hover);
        }
        
        .shadow-green-strong {
            box-shadow: var(--shadow-green-strong);
        }
        
        .shadow-subtle {
            box-shadow: var(--shadow-subtle);
        }
        
        .shadow-mild {
            box-shadow: var(--shadow-mild);
        }
        
        .cursor-pointer {
            cursor: pointer;
        }
        
        .no-margin {
            margin: 0;
        }
        
        .mb-0 {
            margin-bottom: 0;
        }
        
        .mb-8 {
            margin-bottom: var(--spacing-8);
        }
        
        .mb-16 {
            margin-bottom: var(--spacing-16);
        }
        
        .gap-8 {
            gap: var(--spacing-8);
        }
        
        .gap-16 {
            gap: var(--spacing-16);
        }
        
        .gap-24 {
            gap: var(--spacing-24);
        }
        
        .gap-40 {
            gap: var(--spacing-40);
        }
        
        .p-12 {
            padding: var(--spacing-12);
        }
        
        .p-24 {
            padding: var(--spacing-24);
        }
        
        .p-48 {
            padding: var(--spacing-48);
        }
        
        .px-16 {
            padding-left: var(--spacing-16);
            padding-right: var(--spacing-16);
        }
        
        .py-8 {
            padding-top: var(--spacing-8);
            padding-bottom: var(--spacing-8);
        }
        
        .py-24 {
            padding-top: var(--spacing-24);
            padding-bottom: var(--spacing-24);
        }
        
        .z-10 {
            z-index: 10;
        }
        
        .z-1000 {
            z-index: 1000;
        }
        
        .overflow-hidden {
            overflow: hidden;
        }
        
        /* ===== SHARED COMPONENT STYLES ===== */
        
        /* Common Card Styles */
        .card {
            background: var(--uber-white);
            border-radius: var(--radius-12);
            box-shadow: var(--shadow-1);
            transition: var(--transition-normal);
        }
        
        .card:hover {
            transform: var(--transform-slide-up);
            box-shadow: var(--shadow-2);
        }
        
        /* Common Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-12) var(--spacing-24);
            border-radius: var(--radius-8);
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            border: none;
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: var(--uber-white);
            box-shadow: var(--shadow-green-hover);
        }
        
        .btn-primary:hover {
            transform: var(--transform-slide-up);
            box-shadow: var(--shadow-green-strong);
            background: var(--gradient-primary-strong);
        }
        
        .btn-secondary {
            background: var(--uber-white);
            color: var(--uber-gray-700);
            border: 1px solid var(--uber-gray-300);
            box-shadow: var(--shadow-1);
        }
        
        .btn-secondary:hover {
            background: var(--uber-gray-100);
            border-color: var(--uber-green);
            color: var(--uber-green);
            transform: var(--transform-slide-up);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--uber-green);
            border: 2px solid var(--uber-green);
        }
        
        .btn-outline:hover {
            background: var(--uber-green);
            color: var(--uber-white);
            transform: var(--transform-slide-up);
        }
        
        .btn-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
            position: relative;
        }
        
        .btn-icon:hover {
            background: var(--uber-gray-100);
            color: var(--uber-green);
        }
        
        /* Common Badge Styles */
        .badge {
            display: inline-block;
            padding: var(--spacing-4) var(--spacing-12);
            border-radius: var(--radius-full);
            font-size: var(--font-size-12);
            font-weight: 600;
        }
        
        .badge-green {
            background: var(--uber-green);
            color: var(--uber-white);
        }
        
        .badge-gray {
            background: var(--uber-gray-300);
            color: var(--uber-gray-700);
        }
        
        /* Common Input Styles */
        .input {
            width: 100%;
            padding: var(--spacing-12) var(--spacing-16);
            border: 1px solid var(--uber-gray-300);
            border-radius: var(--radius-8);
            font-size: var(--font-size-16);
            background: var(--uber-white);
            transition: var(--transition-normal);
        }
        
        .input:focus {
            outline: none;
            border-color: var(--uber-green);
            box-shadow: 0 0 0 3px rgba(6, 193, 103, 0.1);
        }
        
        /* Common Hover Effects */
        .hover-card {
            transition: var(--transition-normal);
        }
        
        .hover-card:hover {
            transform: var(--transform-slide-up);
            box-shadow: var(--shadow-2);
        }
        
        .hover-scale-effect {
            transition: var(--transition-normal);
        }
        
        .hover-scale-effect:hover {
            transform: var(--transform-scale-up);
        }
        
        /* Common Animation Classes */
        .fade-in {
            animation: fadeIn var(--transition-normal);
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        /* Common Layout Patterns */
        .section-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-16);
        }
        
        .grid-responsive {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-24);
        }
        
        .flex-responsive {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-16);
        }
        
        /* ===== SHARED INTERACTION STYLES ===== */
        
        /* Interactive Elements */
        .interactive {
            cursor: pointer;
            transition: var(--transition-normal);
        }
        
        .interactive:hover {
            transform: var(--transform-slide-up);
        }
        
        /* Focus Styles */
        .focus-ring:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(6, 193, 103, 0.2);
        }
        
        /* Loading States */
        .loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--uber-gray-300);
            border-top-color: var(--uber-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Shared Animations */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translateY(10px); }
            10%, 40% { opacity: 1; transform: translateY(0); }
            50%, 90% { opacity: 0; transform: translateY(-10px); }
        }
        
        /* Common Animation Patterns */
        .animate-fade-in-out {
            animation: fadeInOut 7s infinite;
        }
        
        .animate-fade-in-out-delayed {
            animation: fadeInOut 7s infinite 3.5s;
        }
        
        .animate-fade-in-up {
            animation: fadeInUp 1s ease-out;
        }
        
        .animate-fade-in-up-delay-1 {
            animation: fadeInUp 1s ease-out 0.2s both;
        }
        
        .animate-fade-in-up-delay-2 {
            animation: fadeInUp 1s ease-out 0.4s both;
        }
        
        .animate-fade-in-up-delay-3 {
            animation: fadeInUp 1s ease-out 0.6s both;
        }
        
        .animate-fade-in-up-delay-4 {
            animation: fadeInUp 1s ease-out 0.8s both;
        }
        
        /* Common Transition Patterns */
        .transition-smooth {
            transition: all 0.3s ease-in-out;
        }
        
        /* Common Box-shadow Patterns */
        .shadow-green-hover-light {
            box-shadow: 0 4px 20px rgba(6, 193, 103, 0.15);
        }
        
        .shadow-green-hover-medium {
            box-shadow: 0 6px 20px rgba(6, 193, 103, 0.15);
        }
        
        /* ===== GLOBAL STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            font-size: var(--font-size-16);
            line-height: 1.5;
            color: var(--uber-gray-900);
            background-color: var(--uber-gray-100);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-16);
        }
        
        /* ===== TYPOGRAPHY ===== */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            line-height: 1.2;
            margin-bottom: var(--spacing-8);
        }
        
        h1 {
            font-size: var(--font-size-40);
        }
        
        h2 {
            font-size: var(--font-size-32);
        }
        
        h3 {
            font-size: var(--font-size-24);
        }
        
        h4 {
            font-size: var(--font-size-20);
        }
        
        h5 {
            font-size: var(--font-size-18);
        }
        
        h6 {
            font-size: var(--font-size-16);
        }
        
        p {
            margin-bottom: var(--spacing-16);
        }
        
        /* ===== HEADER ===== */
        .header {
            background-color: var(--uber-white);
            box-shadow: var(--shadow-1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 64px;
        }
        
        .logo {
            font-size: var(--font-size-24);
            font-weight: 700;
            color: var(--uber-green);
            text-decoration: none;
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: var(--spacing-8);
        }
        
        .nav {
            display: flex;
            gap: var(--spacing-24);
        }
        
        .nav-link {
            color: var(--uber-gray-700);
            text-decoration: none;
            font-weight: 500;
            font-size: var(--font-size-16);
            padding: var(--spacing-8) 0;
            position: relative;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
        }
        
        .nav-link:hover {
            color: var(--uber-green);
        }
        
        .nav-link.active {
            color: var(--uber-green);
        }
        
        .nav-link.active i {
            color: var(--uber-green);
        }
        
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--uber-green);
        }
        
        .nav-link i {
            margin-right: var(--spacing-8);
            font-size: var(--font-size-18);
            transition: var(--transition-fast);
        }
        
        .nav-link:hover i {
            color: var(--uber-green);
            transform: var(--transform-scale-up);
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-16);
        }
        
        /* Mobile-specific header actions */
        .mobile-header-actions {
            display: none;
            align-items: center;
            gap: var(--spacing-8);
        }
        
        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--uber-gray-700);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-full);
            transition: var(--transition-fast);
            position: relative;
        }
        
        .btn-icon:hover {
            background-color: var(--uber-gray-100);
            color: var(--uber-green);
        }
        
        .cart-toggle .cart-count {
            position: absolute;
            top: -2px;
            right: -2px;
            background-color: var(--uber-green);
            color: var(--uber-white);
            border-radius: var(--radius-full);
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-12);
            font-weight: 700;
            padding: 0 var(--spacing-4);
        }
        
        /* ===== MAIN CONTENT ===== */
        #main-content {
            min-height: calc(100vh - 64px);
            padding-bottom: 80px;
        }
        
        /* ===== FOOTER ===== */
        .footer {
            background-color: var(--uber-gray-900);
            color: var(--uber-white);
            padding: var(--spacing-48) 0 var(--spacing-32);
            margin-top: auto;
            position: relative;
            overflow: hidden;
        }
        
        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--uber-green), var(--uber-green-light), var(--uber-green));
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-40);
            margin-bottom: var(--spacing-32);
            position: relative;
            z-index: 1;
        }
        
        .footer-section {
            background: rgba(255, 255, 255, 0.02);
            border-radius: var(--radius-12);
            padding: var(--spacing-24);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition-normal);
        }
        
        .footer-section:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--uber-green);
            transform: var(--transform-slide-up);
        }
        
        .footer-section h3 {
            color: var(--uber-green);
            font-size: var(--font-size-20);
            margin-bottom: var(--spacing-16);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
        }
        
        .footer-section h3 i {
            font-size: var(--font-size-18);
        }
        
        .footer-section p,
        .footer-section li {
            color: var(--uber-gray-300);
            line-height: 1.6;
            margin-bottom: var(--spacing-8);
        }
        
        .footer-section ul {
            list-style: none;
            padding: 0;
        }
        
        .footer-section ul li {
            margin-bottom: var(--spacing-8);
            position: relative;
            padding-left: var(--spacing-16);
        }
        
        .footer-section ul li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--uber-green);
            font-weight: bold;
        }
        
        .footer-section a {
            color: var(--uber-gray-300);
            text-decoration: none;
            transition: var(--transition-fast);
            display: inline-block;
            position: relative;
        }
        
        .footer-section a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 1px;
            background-color: var(--uber-green);
            transition: var(--transition-normal);
        }
        
        .footer-section a:hover {
            color: var(--uber-green);
        }
        
        .footer-section a:hover::after {
            width: 100%;
        }
        
        .footer-bottom {
            border-top: 1px solid var(--uber-gray-700);
            padding-top: var(--spacing-24);
            text-align: center;
            color: var(--uber-gray-400);
            position: relative;
            z-index: 1;
        }
        
        .footer-bottom p {
            margin-bottom: 0;
            font-size: var(--font-size-14);
        }
        
        .social-links {
            display: flex;
            gap: var(--spacing-16);
            margin-top: var(--spacing-16);
            justify-content: flex-start;
        }
        
        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: var(--uber-gray-800);
            color: var(--uber-gray-300);
            border-radius: var(--radius-full);
            transition: var(--transition-normal);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .social-links a:hover {
            background-color: var(--uber-green);
            color: var(--uber-white);
            transform: var(--transform-slide-up);
            box-shadow: var(--shadow-green);
        }
        
        .business-hours {
            margin-top: var(--spacing-16);
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-8);
            padding: var(--spacing-12);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .business-hours .day {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-4);
            font-size: var(--font-size-14);
            padding: var(--spacing-4) 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .business-hours .day:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .business-hours .day .hours {
            color: var(--uber-green);
            font-weight: 500;
        }
        
        .business-hours .day.today {
            background: rgba(6, 193, 103, 0.1);
            margin: 0 calc(-1 * var(--spacing-12));
            padding: var(--spacing-4) var(--spacing-12);
            border-radius: var(--radius-4);
        }
        
        .footer-contact-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
            margin-bottom: var(--spacing-12);
            color: var(--uber-gray-300);
        }
        
        .footer-contact-item i {
            color: var(--uber-green);
            width: 20px;
            text-align: center;
        }
        
        .footer-badge {
            display: inline-block;
            background: var(--gradient-primary-light);
            color: var(--uber-white);
            padding: var(--spacing-4) var(--spacing-12);
            border-radius: var(--radius-full);
            font-size: var(--font-size-12);
            font-weight: 600;
            margin-top: var(--spacing-8);
        }
        
        .view {
            display: none;
            animation: fadeIn var(--transition-normal);
        }
        
        .view.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* ===== HERO SECTION ===== */
        .hero {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80');
            background-size: cover;
            background-position: center;
            color: var(--uber-white);
            padding: var(--spacing-80) 0 var(--spacing-64);
            text-align: center;
            margin-bottom: var(--spacing-48);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 50%, rgba(6, 193, 103, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .hero-content {
            position: relative;
            z-index: 2;
        }
        
        .hero h1 {
            font-size: var(--font-size-48);
            margin-bottom: var(--spacing-16);
            font-weight: 700;
            color: var(--uber-white);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            animation: fadeInUp 1s ease-out;
        }
        
        .hero-subtitle {
            font-size: var(--font-size-20);
            margin-bottom: var(--spacing-24);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            font-weight: 400;
            line-height: 1.6;
            animation: fadeInUp 1s ease-out 0.2s both;
        }
        
        .hero-dynamic-content {
            min-height: 60px;
            margin-bottom: var(--spacing-32);
            animation: fadeInUp 1s ease-out 0.4s both;
        }
        
        .dynamic-tagline {
            font-size: var(--font-size-24);
            font-weight: 600;
            color: var(--uber-green);
            margin-bottom: var(--spacing-8);
            opacity: 0;
            animation: fadeInOut 7s infinite;
        }
        
        .featured-dish {
            font-size: var(--font-size-18);
            color: var(--uber-white);
            opacity: 0.9;
            font-style: italic;
            opacity: 0;
            animation: fadeInOut 7s infinite 3.5s;
        }
        
        .hero-social-proof {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--spacing-32);
            margin-bottom: var(--spacing-32);
            flex-wrap: wrap;
            animation: fadeInUp 1s ease-out 0.6s both;
        }
        
        .social-proof-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: var(--spacing-12) var(--spacing-20);
            border-radius: var(--radius-24);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .social-proof-item i {
            color: var(--uber-green);
            font-size: var(--font-size-20);
        }
        
        .social-proof-text {
            font-size: var(--font-size-16);
            font-weight: 500;
        }
        
        .social-proof-number {
            font-size: var(--font-size-18);
            font-weight: 700;
            color: var(--uber-green);
        }
        
        .hero-cta {
            animation: fadeInUp 1s ease-out 0.8s both;
        }
        
        .hero .btn {
            background: var(--gradient-primary);
            box-shadow: var(--shadow-green-hover);
            padding: var(--spacing-16) var(--spacing-32);
            font-size: var(--font-size-18);
            min-height: 56px;
            transition: all var(--transition-normal);
        }
        
        .hero .btn:hover {
            transform: var(--transform-slide-up);
            box-shadow: var(--shadow-green-strong);
            background: var(--gradient-primary-strong);
        }
        
        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translateY(10px); }
            10%, 40% { opacity: 1; transform: translateY(0); }
            50%, 90% { opacity: 0; transform: translateY(-10px); }
        }
        
        /* ===== CONTENT SECTIONS ===== */
        .content-section {
            position: relative;
            z-index: 2;
            background-color: var(--uber-gray-100);
            border-radius: var(--radius-12);
            padding: var(--spacing-48) var(--spacing-24);
            margin-top: calc(-1 * var(--spacing-24));
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }
        
        /* ===== BUTTONS ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: var(--uber-green);
            color: var(--uber-white);
            padding: var(--spacing-12) var(--spacing-24);
            border-radius: var(--radius-8);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition-fast);
            border: none;
            cursor: pointer;
            font-size: var(--font-size-16);
            min-height: 48px;
            white-space: nowrap;
        }
        
        .btn:hover {
            background-color: var(--uber-green-dark);
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-secondary {
            background-color: var(--uber-gray-200);
            color: var(--uber-gray-800);
        }
        
        .btn-secondary:hover {
            background-color: var(--uber-gray-300);
        }
        
        .btn-outline {
            background-color: transparent;
            color: var(--uber-green);
            border: 1px solid var(--uber-green);
        }
        
        .btn-outline:hover {
            background-color: rgba(6, 193, 103, 0.1);
        }
        
        .btn-icon-text {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-8);
        }
        
        .btn-icon-text i {
            font-size: var(--font-size-18);
        }
        
        /* ===== SECTION TITLES ===== */
        .section-title {
            font-size: var(--font-size-32);
            margin-bottom: var(--spacing-32);
            text-align: center;
            position: relative;
            font-weight: 700;
        }
        
        /* ===== FEATURED BRANCH COVER SECTION ===== */
        .branch-cover-section {
            position: relative;
            margin: -40px 0 40px 0;
            z-index: 10;
            animation: slideDown 0.6s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .branch-cover-container {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            transition: all var(--transition-normal);
        }
        
        .branch-cover-container:hover {
            transform: translateY(-2px);
        }
        
        .branch-cover-container.skeleton {
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--radius-12) var(--radius-12) 0 0;
            height: 300px;
        }
        
        .branch-cover-container.skeleton .branch-cover-image {
            display: none;
        }
        
        .branch-cover-wrapper {
            position: relative;
            margin-bottom: 40px; /* Space for hanging logo */
        }
        
        .branch-cover-image {
            position: relative;
            height: 300px;
            border-radius: var(--radius-16);
            overflow: hidden;
            background-size: cover;
            background-position: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all var(--transition-normal);
            z-index: 1;
        }
        
        .branch-cover-image:hover {
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            transform: scale(1.02);
        }
        
        .branch-cover-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.4));
            z-index: 2;
        }
        
        .branch-logo-container {
            position: absolute;
            bottom: -70px;
            left: 50%;
                        right: 50%;
            transform: translateX(-50%);
            z-index: 10;
            animation: slideUp 0.8s ease-out 0.4s both;
            pointer-events: none; /* Allow clicks to pass through to container */
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        
        .branch-logo-container.skeleton .branch-logo {
            background: var(--uber-gray-200);
            border-color: var(--uber-gray-200);
        }
        
        .branch-logo {
            width: 150px;
            height: 150px;
            background: var(--uber-white);
            border-radius: 50%;
            padding: 8px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            transition: all var(--transition-normal);
            animation: gentleFloat 3s ease-in-out infinite;
            cursor: pointer;
            pointer-events: auto; /* Re-enable pointer events for the logo */
        }
        
        .branch-logo:hover {
            transform: translateX(-50%) translateY(-4px) scale(1.05);
            box-shadow: 0 12px 35px rgba(0,0,0,0.4);
            animation-play-state: paused;
        }
        
        @keyframes gentleFloat {
            0%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            50% {
                transform: translateX(-50%) translateY(-2px);
            }
        }
        
        .branch-logo-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            transition: all var(--transition-normal);
        }
        
        .branch-info {
            text-align: center;
            margin-top: 20px; /* Reduced from 60px since wrapper has margin-bottom */
            padding: 40px 20px 0px;
            animation: fadeIn 0.8s ease-out 0.6s both;
            position: relative;
            z-index: 5;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .branch-name {
            font-size: var(--font-size-28);
            font-weight: 700;
                        color: var(--uber-green);
            margin-bottom: var(--spacing-8);
            transition: color var(--transition-normal);
        }
        
        .branch-cover-container:hover .branch-name {
            color: var(--uber-gray-800);
        }
        
        .branch-description {
            font-size: var(--font-size-16);
            color: var(--uber-gray-600);
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
            transition: color var(--transition-normal);
        }
        
        .branch-cover-container:hover .branch-description {
            color: var(--uber-gray-700);
        }
        
        /* Skeleton text styling */
        .skeleton-text {
            display: inline-block;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--radius-4);
            color: transparent;
        }
        
        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }
        
        /* ===== BRANCH CARDS ===== */
        .branches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-24);
            margin-bottom: var(--spacing-48);
        }
        
        .branch-card {
            background-color: var(--uber-white);
            border-radius: var(--radius-16);
            overflow: hidden;
            box-shadow: var(--shadow-2);
            transition: all var(--transition-normal);
            display: flex;
            flex-direction: column;
            position: relative;
            cursor: pointer;
        }
        
        .branch-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-4);
        }
        
        .branch-image-container {
            position: relative;
            overflow: hidden;
            aspect-ratio: 16 / 10;
        }
        
        .branch-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-normal);
        }
        
        .branch-card:hover .branch-image {
            transform: var(--transform-scale-up);
        }
        
        .branch-status-badge {
            position: absolute;
            top: var(--spacing-12);
            right: var(--spacing-12);
            padding: var(--spacing-6) var(--spacing-12);
            border-radius: var(--radius-full);
            font-size: var(--font-size-12);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 2;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .status-open {
            background-color: rgba(6, 193, 103, 0.9);
            color: var(--uber-white);
        }
        
        .status-closing-soon {
            background-color: rgba(255, 195, 0, 0.9);
            color: var(--uber-white);
        }
        
        .status-busy {
            background-color: rgba(255, 65, 54, 0.9);
            color: var(--uber-white);
        }
        
        .status-closed {
            background-color: rgba(108, 117, 125, 0.9);
            color: var(--uber-white);
        }
        
        .branch-content {
            padding: var(--spacing-24);
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .branch-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-12);
        }
        
        
        
        .branch-rating {
            display: flex;
            align-items: center;
            gap: var(--spacing-4);
            background-color: var(--uber-gray-100);
            padding: var(--spacing-4) var(--spacing-8);
            border-radius: var(--radius-8);
            margin-left: var(--spacing-8);
        }
        
        .branch-rating i {
            color: #ffc107;
            font-size: var(--font-size-14);
        }
        
        .branch-rating span {
            font-size: var(--font-size-14);
            font-weight: 600;
            color: var(--uber-gray-700);
        }
        
        .branch-address {
            color: var(--uber-gray-600);
            margin-bottom: var(--spacing-16);
            font-size: var(--font-size-14);
            line-height: 1.5;
            flex: 1;
        }
        
        .branch-stats {
            display: flex;
            gap: var(--spacing-16);
            margin-bottom: var(--spacing-20);
            flex-wrap: wrap;
        }
        
        .branch-stat {
            display: flex;
            align-items: center;
            gap: var(--spacing-6);
            font-size: var(--font-size-13);
            color: var(--uber-gray-600);
        }
        
        .branch-stat i {
            color: var(--uber-green);
            font-size: var(--font-size-14);
        }
        
        /* ===== MENU VIEW ===== */
        .menu-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: var(--spacing-24);
        }
        
        /* ===== CATEGORIES SIDEBAR ===== */
        .categories-sidebar {
            background-color: var(--uber-white);
            border-radius: var(--radius-12);
            padding: var(--spacing-16);
            box-shadow: var(--shadow-1);
            height: fit-content;
            position: sticky;
            top: 80px;
        }
        
        .category-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: var(--spacing-12) var(--spacing-16);
            margin-bottom: var(--spacing-4);
            background: none;
            border: none;
            cursor: pointer;
            border-radius: var(--radius-8);
            transition: var(--transition-fast);
            font-weight: 500;
            font-size: var(--font-size-16);
            color: var(--uber-gray-700);
        }
        
        .category-btn:hover {
            background-color: var(--uber-gray-100);
        }
        
        .category-btn.active {
            background-color: var(--uber-green);
            color: var(--uber-white);
        }
        
        /* ===== MENU SEARCH ===== */
        .menu-search {
            margin-bottom: var(--spacing-24);
            position: relative;
        }
        
        .menu-search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, var(--uber-white), #fafafa);
            border: 2px solid rgba(0, 0, 0, 0.08);
            border-radius: var(--radius-24);
            padding: var(--spacing-4);
            transition: all var(--transition-fast);
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
        }
        
        .menu-search-input-wrapper:focus-within {
            border-color: var(--uber-green);
            box-shadow: var(--shadow-green-hover-light);
            transform: var(--transform-slide-up-small);
        }
        
        .menu-search input {
            width: 100%;
            padding: var(--spacing-12) var(--spacing-16) var(--spacing-12) var(--spacing-48);
            border: none;
            border-radius: var(--radius-20);
            font-size: var(--font-size-16);
            font-weight: 500;
            background: transparent;
            color: var(--uber-gray-900);
            transition: var(--transition-fast);
            outline: none;
        }
        
        .menu-search input::placeholder {
            color: var(--uber-gray-500);
            font-weight: 400;
        }
        
        .menu-search-icon {
            position: absolute;
            left: var(--spacing-16);
            top: 50%;
            transform: translateY(-50%);
            color: var(--uber-gray-500);
            font-size: var(--font-size-16);
            transition: var(--transition-fast);
            pointer-events: none;
        }
        
        .menu-search-input-wrapper:focus-within .menu-search-icon {
            color: var(--uber-green);
        }
        
        .menu-search-clear {
            position: absolute;
            right: var(--spacing-12);
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            background: var(--uber-gray-200);
            border: none;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-fast);
            opacity: 0;
            pointer-events: none;
            color: var(--uber-gray-600);
            font-size: var(--font-size-12);
        }
        
        .menu-search-clear.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .menu-search-clear:hover {
            background: var(--uber-gray-300);
            color: var(--uber-gray-900);
        }
        
        .menu-search-input-wrapper:focus-within .menu-search-clear {
            background: var(--uber-green);
            color: var(--uber-white);
        }
        
        .menu-search-input-wrapper:focus-within .menu-search-clear:hover {
            background: var(--uber-green-dark);
        }
        
        /* ===== MENU SEARCH RESPONSIVE STYLES ===== */
        
        /* Large Desktop (1025px and above) */
        @media (min-width: 1025px) {
            .menu-search {
                margin-bottom: var(--spacing-32);
            }
            
            .menu-search-input-wrapper {
                max-width: 600px;
                margin: 0 auto;
            }
            
            .menu-search input {
                padding: var(--spacing-16) var(--spacing-20) var(--spacing-16) var(--spacing-56);
                font-size: var(--font-size-18);
            }
            
            .menu-search-icon {
                left: var(--spacing-20);
                font-size: var(--font-size-18);
            }
            
            .menu-search-clear {
                width: 28px;
                height: 28px;
                right: var(--spacing-16);
                font-size: var(--font-size-14);
            }
        }
        
        /* Desktop (769px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .menu-search {
                margin-bottom: var(--spacing-28);
            }
            
            .menu-search-input-wrapper {
                max-width: 500px;
                margin: 0 auto;
            }
            
            .menu-search input {
                padding: var(--spacing-14) var(--spacing-18) var(--spacing-14) var(--spacing-52);
                font-size: var(--font-size-17);
            }
            
            .menu-search-icon {
                left: var(--spacing-18);
                font-size: var(--font-size-17);
            }
            
            .menu-search-clear {
                width: 26px;
                height: 26px;
                right: var(--spacing-14);
                font-size: var(--font-size-13);
            }
            
            /* Featured Branch Cover Section - Tablet Responsive */
            .branch-cover-section {
                margin: -35px 0 0px 0;
            }
            
            .branch-cover-wrapper {
                margin-bottom: 35px; /* Space for hanging logo */
            }
            
            .branch-cover-image {
                height: 250px;
            }
            
            .branch-logo-container {
                bottom: -70px;
            }
            
            .branch-logo {
                width: 150px;
                height: 150px;
                padding: 7px;
            }
            
            .branch-info {
                margin-top: 18px;
            }
            
            .branch-name {
                font-size: var(--font-size-26);
            }
            
            .branch-description {
                font-size: var(--font-size-15);
            }
            
            .branch-logo:hover {
                transform: translateX(-50%) translateY(-3px) scale(1.05);
            }
        }
        
        /* Tablet (577px - 768px) */
        @media (min-width: 577px) and (max-width: 768px) {
            .menu-search {
                margin-bottom: var(--spacing-24);
            }
            
            .menu-search-input-wrapper {
                max-width: 100%;
            }
            
            .menu-search input {
                padding: var(--spacing-12) var(--spacing-16) var(--spacing-12) var(--spacing-44);
                font-size: var(--font-size-16);
            }
            
            .menu-search-icon {
                left: var(--spacing-16);
                font-size: var(--font-size-16);
            }
            
            .menu-search-clear {
                width: 24px;
                height: 24px;
                right: var(--spacing-12);
                font-size: var(--font-size-12);
            }
        }
        
        /* Mobile (576px and below) */
        @media (max-width: 576px) {
                    
                        .menu-item-image-container {
        height: 300px;
    }
                .item-image-section {
                height: 300px;
            }
            .menu-search {
                margin-bottom: var(--spacing-20);
            }
            
            .menu-search-input-wrapper {
                padding: var(--spacing-2);
            }
            
            .menu-search input {
                padding: var(--spacing-10) var(--spacing-12) var(--spacing-10) var(--spacing-40);
                font-size: var(--font-size-14);
            }
            
            .menu-search-icon {
                left: var(--spacing-12);
                font-size: var(--font-size-14);
            }
            
            .menu-search-clear {
                width: 20px;
                height: 20px;
                right: var(--spacing-8);
                font-size: var(--font-size-10);
            }
            
            /* Featured Branch Cover Section - Mobile Responsive */
            .branch-cover-section {
                margin: -30px 0 30px 0;
            }
            
            .branch-cover-wrapper {
                margin-bottom: 30px; /* Space for hanging logo */
            }
            
            .branch-cover-image {
                height: 200px;
                border-radius: var(--radius-12);
            }
            
            .branch-logo-container {
                bottom: -45px;
                                left: 50%;
            }
                        
            .branch-logo {
                width: 100px;
                height: 100px;
                padding: 6px;
                box-shadow: 0 6px 20px rgba(0,0,0,0.25);
            }
            
            .branch-info {
                margin-top: 15px;
                padding: 0 15px;
            }
            
            .branch-name {
                            padding-top: 15px;
                font-size: var(--font-size-24);
                margin-bottom: var(--spacing-6);
            }
            
            .branch-description {
                font-size: var(--font-size-14);
                line-height: 1.5;
            }
            
            /* Adjust animations for mobile */
            @keyframes gentleFloat {
                0%, 100% {
                    transform: translateX(-50%) translateY(0);
                }
                50% {
                    transform: translateX(-50%) translateY(-1px);
                }
            }
            
            .branch-logo:hover {
                transform: translateX(-50%) translateY(-2px) scale(1.05);
            }
        }
        
        /* Extra Small Mobile (480px and below) */
        @media (max-width: 480px) {
            .menu-search {
                margin-bottom: var(--spacing-16);
            }
            
            .menu-search-input-wrapper {
                padding: var(--spacing-2);
                border-radius: var(--radius-20);
            }
            
            .menu-search input {
                padding: var(--spacing-8) var(--spacing-10) var(--spacing-8) var(--spacing-36);
                font-size: var(--font-size-13);
                border-radius: var(--radius-16);
            }
            
            .menu-search-icon {
                left: var(--spacing-10);
                font-size: var(--font-size-13);
            }
            
            .menu-search-clear {
                width: 18px;
                height: 18px;
                right: var(--spacing-6);
                font-size: var(--font-size-9);
            }
        }
        
        /* ===== GOOGLE-INSPIRED SEARCH BAR STYLES ===== */
        .menu-search-advanced {
                    padding-bottom: 10px;
            margin-bottom: 0;
            position: relative;
        }
        
        .menu-search-advanced .menu-search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            background: #ffffff;
            border: 1px solid #dfe1e5;
            border-radius: 24px;
            padding: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 1px 6px rgba(32, 33, 36, 0.28);
            height: 48px;
            overflow: hidden;
            width: 100%;
        }
        
        .menu-search-advanced .menu-search-input-wrapper:hover {
            box-shadow: 0 1px 6px rgba(32, 33, 36, 0.28);
            border-color: #c1c7d0;
        }
        
        .menu-search-advanced .menu-search-input-wrapper:focus-within {
            box-shadow: 0 1px 6px rgba(32, 33, 36, 0.28);
            border-color: #4285f4;
        }
        
        .menu-search-advanced .menu-search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #9aa0a6;
            font-size: 16px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            z-index: 3;
            opacity: 0.9;
            line-height: 1;
        }
        
        .menu-search-advanced .menu-search-input-wrapper:focus-within .menu-search-icon {
            color: #4285f4;
            opacity: 1;
        }
        
        .menu-search-advanced input.menu-search {
            flex: 1;
            height: 100%;
            padding: 35px 80px 12px 48px;
            border: none;
            border-radius: 24px;
            font-size: 16px;
            font-weight: 400;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: transparent;
            color: #202124;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            outline: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            box-sizing: border-box;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
            line-height: 24px;
        }
        
        .menu-search-advanced input.menu-search:focus {
            color: #202124;
        }
        
        .menu-search-advanced input.menu-search::placeholder {
            color: #9aa0a6;
            font-weight: 400;
            opacity: 1;
        }
        
        .menu-search-advanced input.menu-search::-webkit-input-placeholder {
            color: #9aa0a6;
            font-weight: 400;
            opacity: 1;
        }
        
        .menu-search-advanced input.menu-search::-moz-placeholder {
            color: #9aa0a6;
            font-weight: 400;
            opacity: 1;
        }
        
        .menu-search-advanced input.menu-search:-ms-input-placeholder {
            color: #9aa0a6;
            font-weight: 400;
            opacity: 1;
        }
        
        .menu-search-advanced input.menu-search::-ms-input-placeholder {
            color: #9aa0a6;
            font-weight: 400;
            opacity: 1;
        }
        
        .menu-search-advanced .menu-search-clear {
            position: absolute;
            right: 60px;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            background: transparent;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0;
            pointer-events: none;
            color: #5f6368;
            font-size: 14px;
            z-index: 2;
        }
        
        .menu-search-advanced .menu-search-clear.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .menu-search-advanced .menu-search-clear:hover {
            background: #f1f3f4;
            color: #202124;
        }
        
        .menu-search-advanced .menu-search-input-wrapper:focus-within .menu-search-clear:hover {
            background: #e8eaed;
        }
        
        /* Google-style Filter Button */
        .menu-search-filter-toggle {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            background: transparent;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #5f6368;
            font-size: 14px;
            z-index: 2;
        }
        
        .menu-search-filter-toggle:hover {
            background: #f1f3f4;
            color: #202124;
        }
        
        .menu-search-filter-toggle.active {
            background: #e8f0fe;
            color: #1967d2;
        }
        
        .menu-search-filter-toggle.active:hover {
            background: #d2e3fc;
        }
        
        /* Voice search button style (Google-inspired) */
        .menu-search-voice-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            background: transparent;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #5f6368;
            font-size: 14px;
            z-index: 2;
        }
        
        .menu-search-voice-btn:hover {
            background: #f1f3f4;
            color: #202124;
        }
        
        .menu-search-voice-btn.recording {
            background: #f8f9fa;
            color: #ea4335;
        }
        
        .menu-search-voice-btn.recording:hover {
            background: #f1f3f4;
        }
        
        /* Mobile Responsive Styles for Google Search Bar */
        @media (max-width: 768px) {
            .menu-search-advanced .menu-search-input-wrapper {
                height: 44px;
                border-radius: 22px;
            }
            
            .menu-search-advanced .menu-search-icon {
                left: 14px;
                font-size: 14px;
            }
            
            .menu-search-advanced input.menu-search {
                flex: 1;
                height: 100%;
                padding: 30px 70px 10px 42px;
                font-size: 14px;
                line-height: 24px;
            }
            
            .menu-search-advanced input.menu-search::placeholder,
            .menu-search-advanced input.menu-search::-webkit-input-placeholder,
            .menu-search-advanced input.menu-search::-moz-placeholder,
            .menu-search-advanced input.menu-search:-ms-input-placeholder,
            .menu-search-advanced input.menu-search::-ms-input-placeholder {
                font-size: 14px;
                line-height: 24px;
            }
            
            .menu-search-advanced .menu-search-clear {
                right: 50px;
                width: 20px;
                height: 20px;
                font-size: 12px;
            }
            
            .menu-search-advanced .menu-search-filter-toggle {
                right: 6px;
                width: 28px;
                height: 28px;
                font-size: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .menu-search-advanced .menu-search-input-wrapper {
                height: 40px;
                border-radius: 20px;
            }
            
            .menu-search-advanced .menu-search-icon {
                left: 12px;
                font-size: 12px;
            }
            
            .menu-search-advanced input.menu-search {
                flex: 1;
                height: 100%;
                padding: 20px 62px 8px 36px;
                font-size: 13px;
                line-height: 24px;
            }
            
            .menu-search-advanced input.menu-search::placeholder,
            .menu-search-advanced input.menu-search::-webkit-input-placeholder,
            .menu-search-advanced input.menu-search::-moz-placeholder,
            .menu-search-advanced input.menu-search:-ms-input-placeholder,
            .menu-search-advanced input.menu-search::-ms-input-placeholder {
                font-size: 13px;
                line-height: 24px;
            }
            
            .menu-search-advanced .menu-search-clear {
                right: 42px;
                width: 18px;
                height: 18px;
                font-size: 11px;
            }
            
            .menu-search-advanced .menu-search-filter-toggle {
                right: 4px;
                width: 24px;
                height: 24px;
                font-size: 11px;
            }
        }
        
        /* Premium Filters Panel */
        .menu-search-filters-panel {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.98) 0%, 
                rgba(248, 249, 250, 0.95) 50%, 
                rgba(255, 255, 255, 0.98) 100%);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(6, 193, 103, 0.2);
            border-radius: var(--radius-16);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.15),
                0 10px 30px rgba(0, 0, 0, 0.1),
                0 5px 15px rgba(0, 0, 0, 0.05),
                0 2px 6px rgba(0, 0, 0, 0.02),
                inset 0 1px 3px rgba(255, 255, 255, 0.9),
                inset 0 -1px 3px rgba(0, 0, 0, 0.02);
            margin-top: var(--spacing-8);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-12px) scale(0.98);
            transition: all var(--transition-normal);
            z-index: 200;
            max-height: 0;
            overflow: hidden;
        }
        
        .menu-search-filters-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                transparent 0%, 
                rgba(6, 193, 103, 0.02) 50%, 
                transparent 100%);
            border-radius: var(--radius-16);
            pointer-events: none;
        }
        
        .menu-search-filters-panel.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
            max-height: 500px;
            overflow-y: auto;
        }
        
        .menu-search-filters-panel.active::before {
            background: linear-gradient(135deg, 
                transparent 0%, 
                rgba(6, 193, 103, 0.05) 50%, 
                transparent 100%);
        }
        
        .filters-container {
            padding: var(--spacing-16) var(--spacing-20);
        }
        
        /* Premium Filter Groups */
        .filter-group.compact {
            margin-bottom: var(--spacing-16);
            padding-bottom: var(--spacing-16);
            border-bottom: 1px solid rgba(6, 193, 103, 0.1);
        }
        
        .filter-group.compact:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .filter-row {
            display: flex;
            gap: var(--spacing-16);
            margin-bottom: var(--spacing-16);
        }
        
        .filter-group.half {
            flex: 1;
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .filter-label {
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
            font-weight: 600;
            font-size: var(--font-size-13);
            color: var(--uber-gray-800);
            margin-bottom: var(--spacing-10);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.9;
        }
        
        .filter-label i {
            color: var(--uber-green);
            font-size: var(--font-size-14);
        }
        
        /* Premium Price Range */
        .price-range-compact .price-inputs-row {
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
            margin-bottom: var(--spacing-12);
        }
        
        .price-inputs-row input {
            flex: 1;
            padding: var(--spacing-10) var(--spacing-12);
            border: 1px solid rgba(6, 193, 103, 0.15);
            border-radius: var(--radius-10);
            font-size: var(--font-size-14);
            font-weight: 500;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.9) 0%, 
                rgba(248, 249, 250, 0.8) 50%, 
                rgba(255, 255, 255, 0.9) 100%);
            transition: all var(--transition-normal);
            text-align: center;
            letter-spacing: 0.2px;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.05),
                0 1px 3px rgba(0, 0, 0, 0.02),
                inset 0 1px 2px rgba(255, 255, 255, 0.8);
        }
        
        .price-inputs-row input:focus {
            outline: none;
            border-color: var(--uber-green);
            box-shadow: 
                0 4px 16px rgba(6, 193, 103, 0.15),
                0 2px 8px rgba(6, 193, 103, 0.1),
                0 1px 4px rgba(6, 193, 103, 0.05),
                inset 0 1px 2px rgba(255, 255, 255, 0.9);
        }
        
        .price-separator {
            color: var(--uber-gray-600);
            font-weight: 600;
            font-size: var(--font-size-16);
        }
        
        .currency-symbol {
            color: var(--uber-gray-700);
            font-weight: 700;
            font-size: var(--font-size-14);
            margin-left: var(--spacing-6);
        }
        
        .price-presets-compact {
            display: flex;
            gap: var(--spacing-8);
            flex-wrap: wrap;
        }
        
        .price-preset {
            padding: var(--spacing-8) var(--spacing-12);
            border: 1px solid rgba(6, 193, 103, 0.15);
            border-radius: var(--radius-20);
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.9) 0%, 
                rgba(248, 249, 250, 0.8) 50%, 
                rgba(255, 255, 255, 0.9) 100%);
            font-size: var(--font-size-12);
            font-weight: 600;
            color: var(--uber-gray-700);
            cursor: pointer;
            transition: all var(--transition-normal);
            white-space: nowrap;
            letter-spacing: 0.2px;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.05),
                0 1px 3px rgba(0, 0, 0, 0.02),
                inset 0 1px 2px rgba(255, 255, 255, 0.8);
        }
        
        .price-preset::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                transparent 0%, 
                rgba(6, 193, 103, 0.05) 50%, 
                transparent 100%);
            border-radius: var(--radius-20);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }
        
        .price-preset:hover::before {
            opacity: 1;
        }
        
        .price-preset:hover {
            border-color: var(--uber-green);
            background: linear-gradient(135deg, 
                rgba(6, 193, 103, 0.95) 0%, 
                rgba(5, 166, 84, 0.9) 50%, 
                rgba(6, 193, 103, 0.95) 100%);
            color: var(--uber-white);
            transform: var(--transform-slide-up);
            box-shadow: 
                0 8px 24px rgba(6, 193, 103, 0.25),
                0 4px 12px rgba(6, 193, 103, 0.15),
                0 2px 6px rgba(6, 193, 103, 0.08);
        }
        
        .price-preset.active {
            background: linear-gradient(135deg, 
                rgba(6, 193, 103, 0.95) 0%, 
                rgba(5, 166, 84, 0.9) 50%, 
                rgba(6, 193, 103, 0.95) 100%);
            border-color: var(--uber-green);
            color: var(--uber-white);
            box-shadow: 
                0 8px 24px rgba(6, 193, 103, 0.25),
                0 4px 12px rgba(6, 193, 103, 0.15),
                0 2px 6px rgba(6, 193, 103, 0.08);
        }
        
        .price-preset.active::before {
            opacity: 1;
            background: linear-gradient(135deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.2) 50%, 
                transparent 100%);
        }
        
        /* Premium Rating Filter */
        .rating-compact {
            display: flex;
            gap: var(--spacing-8);
            flex-wrap: wrap;
        }
        
        .rating-compact .rating-option {
            display: flex;
            align-items: center;
            gap: var(--spacing-6);
            padding: var(--spacing-8) var(--spacing-12);
            border: 1px solid rgba(6, 193, 103, 0.15);
            border-radius: var(--radius-20);
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.9) 0%, 
                rgba(248, 249, 250, 0.8) 50%, 
                rgba(255, 255, 255, 0.9) 100%);
            cursor: pointer;
            transition: all var(--transition-normal);
            font-size: var(--font-size-12);
            font-weight: 600;
            color: var(--uber-gray-700);
            letter-spacing: 0.2px;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.05),
                0 1px 3px rgba(0, 0, 0, 0.02),
                inset 0 1px 2px rgba(255, 255, 255, 0.8);
        }
        
        .rating-compact .rating-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                transparent 0%, 
                rgba(6, 193, 103, 0.05) 50%, 
                transparent 100%);
            border-radius: var(--radius-20);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }
        
        .rating-compact .rating-option:hover::before {
            opacity: 1;
        }
        
        .rating-compact .rating-option:hover {
            border-color: var(--uber-green);
            background: rgba(6, 193, 103, 0.08);
            transform: var(--transform-slide-up);
            box-shadow: 
                0 6px 20px rgba(6, 193, 103, 0.15),
                0 3px 10px rgba(6, 193, 103, 0.08);
        }
        
        .rating-compact .rating-option.active {
            border-color: var(--uber-green);
            background: rgba(6, 193, 103, 0.12);
            color: var(--uber-green);
            box-shadow: 
                0 6px 20px rgba(6, 193, 103, 0.15),
                0 3px 10px rgba(6, 193, 103, 0.08);
        }
        
        .rating-compact .rating-option.active::before {
            opacity: 1;
            background: linear-gradient(135deg, 
                transparent 0%, 
                rgba(6, 193, 103, 0.1) 50%, 
                transparent 100%);
        }
        
        .rating-compact .rating-option i {
            color: #FFD700;
            font-size: var(--font-size-11);
        }
        
        /* Premium Spice Filter */
        .spice-compact {
            display: flex;
            gap: var(--spacing-8);
            flex-wrap: wrap;
        }
        
        .spice-compact .spice-option {
            display: flex;
            align-items: center;
            gap: var(--spacing-6);
            padding: var(--spacing-8) var(--spacing-12);
            border: 1px solid rgba(6, 193, 103, 0.15);
            border-radius: var(--radius-20);
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.9) 0%, 
                rgba(248, 249, 250, 0.8) 50%, 
                rgba(255, 255, 255, 0.9) 100%);
            cursor: pointer;
            transition: all var(--transition-normal);
            font-size: var(--font-size-12);
            font-weight: 600;
            color: var(--uber-gray-700);
            letter-spacing: 0.2px;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.05),
                0 1px 3px rgba(0, 0, 0, 0.02),
                inset 0 1px 2px rgba(255, 255, 255, 0.8);
        }
        
        .spice-compact .spice-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                transparent 0%, 
                rgba(6, 193, 103, 0.05) 50%, 
                transparent 100%);
            border-radius: var(--radius-20);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }
        
        .spice-compact .spice-option:hover::before {
            opacity: 1;
        }
        
        .spice-compact .spice-option:hover {
            border-color: var(--uber-green);
            background: rgba(6, 193, 103, 0.08);
            transform: var(--transform-slide-up);
            box-shadow: 
                0 6px 20px rgba(6, 193, 103, 0.15),
                0 3px 10px rgba(6, 193, 103, 0.08);
        }
        
        .spice-compact .spice-option.active {
            border-color: var(--uber-green);
            background: rgba(6, 193, 103, 0.12);
            color: var(--uber-green);
            box-shadow: 
                0 6px 20px rgba(6, 193, 103, 0.15),
                0 3px 10px rgba(6, 193, 103, 0.08);
        }
        
        .spice-compact .spice-option.active::before {
            opacity: 1;
            background: linear-gradient(135deg, 
                transparent 0%, 
                rgba(6, 193, 103, 0.1) 50%, 
                transparent 100%);
        }
        
        /* Premium Dietary Filter */
        .dietary-compact {
            display: flex;
            gap: var(--spacing-8);
            flex-wrap: wrap;
        }
        
        .dietary-compact .dietary-option {
            display: flex;
            align-items: center;
            gap: var(--spacing-6);
            padding: var(--spacing-8) var(--spacing-12);
            border: 1px solid rgba(6, 193, 103, 0.15);
            border-radius: var(--radius-20);
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.9) 0%, 
                rgba(248, 249, 250, 0.8) 50%, 
                rgba(255, 255, 255, 0.9) 100%);
            cursor: pointer;
            transition: all var(--transition-normal);
            font-size: var(--font-size-12);
            font-weight: 600;
            color: var(--uber-gray-700);
            letter-spacing: 0.2px;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.05),
                0 1px 3px rgba(0, 0, 0, 0.02),
                inset 0 1px 2px rgba(255, 255, 255, 0.8);
        }
        
        .dietary-compact .dietary-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                transparent 0%, 
                rgba(6, 193, 103, 0.05) 50%, 
                transparent 100%);
            border-radius: var(--radius-20);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }
        
        .dietary-compact .dietary-option:hover::before {
            opacity: 1;
        }
        
        .dietary-compact .dietary-option:hover {
            border-color: var(--uber-green);
            background: rgba(6, 193, 103, 0.08);
            transform: var(--transform-slide-up);
            box-shadow: 
                0 6px 20px rgba(6, 193, 103, 0.15),
                0 3px 10px rgba(6, 193, 103, 0.08);
        }
        
        .dietary-compact .dietary-option input[type="checkbox"] {
            width: 14px;
            height: 14px;
            accent-color: var(--uber-green);
            cursor: pointer;
            margin: 0;
        }
        
        .dietary-compact .dietary-option input[type="checkbox"]:checked + i {
            color: var(--uber-green);
        }
        
        .dietary-compact .dietary-option i {
            color: var(--uber-gray-500);
            font-size: var(--font-size-12);
            transition: var(--transition-normal);
        }
        
        .dietary-compact .dietary-option span {
            font-size: var(--font-size-12);
            color: var(--uber-gray-700);
            font-weight: 600;
        }
        
        /* Premium Filter Actions */
        .filter-actions-compact {
            display: flex;
            gap: var(--spacing-12);
            margin-top: var(--spacing-16);
            padding-top: var(--spacing-16);
            border-top: 1px solid rgba(6, 193, 103, 0.15);
        }
        
        .btn-apply-filters {
            flex: 1;
            background: linear-gradient(135deg, 
                var(--uber-green) 0%, 
                var(--uber-green-dark) 50%, 
                var(--uber-green) 100%);
            color: var(--uber-white);
            border: 1px solid rgba(6, 193, 103, 0.3);
            padding: var(--spacing-12) var(--spacing-16);
            border-radius: var(--radius-12);
            font-weight: 600;
            font-size: var(--font-size-13);
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-8);
            box-shadow: 
                0 8px 24px rgba(6, 193, 103, 0.25),
                0 4px 12px rgba(6, 193, 103, 0.15),
                0 2px 6px rgba(6, 193, 103, 0.08),
                inset 0 1px 2px rgba(255, 255, 255, 0.3);
            letter-spacing: 0.3px;
        }
        
        .btn-apply-filters::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.2) 50%, 
                transparent 100%);
            border-radius: var(--radius-12);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }
        
        .btn-apply-filters:hover::before {
            opacity: 1;
        }
        
        .btn-apply-filters:hover {
            background: linear-gradient(135deg, 
                var(--uber-green-dark) 0%, 
                #058a47 50%, 
                var(--uber-green-dark) 100%);
            transform: var(--transform-slide-up);
            box-shadow: 
                0 12px 32px rgba(6, 193, 103, 0.35),
                0 6px 16px rgba(6, 193, 103, 0.2),
                0 3px 8px rgba(6, 193, 103, 0.1),
                inset 0 1px 2px rgba(255, 255, 255, 0.4);
        }
        
        .btn-clear-filters {
            flex: 1;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.9) 0%, 
                rgba(248, 249, 250, 0.8) 50%, 
                rgba(255, 255, 255, 0.9) 100%);
            color: var(--uber-gray-700);
            border: 1px solid rgba(6, 193, 103, 0.2);
            padding: var(--spacing-12) var(--spacing-16);
            border-radius: var(--radius-12);
            font-weight: 600;
            font-size: var(--font-size-13);
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-8);
            letter-spacing: 0.3px;
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.08),
                0 2px 8px rgba(0, 0, 0, 0.04),
                0 1px 3px rgba(0, 0, 0, 0.02),
                inset 0 1px 2px rgba(255, 255, 255, 0.8);
        }
        
        .btn-clear-filters::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                transparent 0%, 
                rgba(6, 193, 103, 0.05) 50%, 
                transparent 100%);
            border-radius: var(--radius-12);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }
        
        .btn-clear-filters:hover::before {
            opacity: 1;
        }
        
        .btn-clear-filters:hover {
            background: linear-gradient(135deg, 
                rgba(248, 249, 250, 0.95) 0%, 
                rgba(240, 241, 242, 0.85) 50%, 
                rgba(248, 249, 250, 0.95) 100%);
            border-color: var(--uber-green);
            transform: var(--transform-slide-up);
            color: var(--uber-gray-800);
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.12),
                0 4px 12px rgba(0, 0, 0, 0.06),
                0 2px 6px rgba(0, 0, 0, 0.03);
        }
        
        /* Premium Active Filters Display */
        .active-filters {
            display: flex;
            gap: var(--spacing-8);
            margin-bottom: var(--spacing-16);
            flex-wrap: wrap;
            min-height: 28px;
        }
        
        .active-filter-pill {
            display: flex;
            align-items: center;
            gap: var(--spacing-6);
            padding: var(--spacing-6) var(--spacing-10);
            background: linear-gradient(135deg, 
                rgba(6, 193, 103, 0.12) 0%, 
                rgba(6, 193, 103, 0.08) 50%, 
                rgba(6, 193, 103, 0.12) 100%);
            border: 1px solid rgba(6, 193, 103, 0.25);
            border-radius: var(--radius-16);
            font-size: var(--font-size-12);
            font-weight: 600;
            color: var(--uber-green);
            transition: all var(--transition-normal);
            letter-spacing: 0.2px;
            box-shadow: 
                0 2px 8px rgba(6, 193, 103, 0.15),
                0 1px 3px rgba(6, 193, 103, 0.08);
        }
        
        .active-filter-pill::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.2) 50%, 
                transparent 100%);
            border-radius: var(--radius-16);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }
        
        .active-filter-pill:hover::before {
            opacity: 1;
        }
        
        .active-filter-pill:hover {
            background: linear-gradient(135deg, 
                rgba(6, 193, 103, 0.18) 0%, 
                rgba(6, 193, 103, 0.12) 50%, 
                rgba(6, 193, 103, 0.18) 100%);
            border-color: var(--uber-green);
            transform: var(--transform-slide-up-small);
            box-shadow: 
                0 4px 12px rgba(6, 193, 103, 0.25),
                0 2px 6px rgba(6, 193, 103, 0.15);
        }
        
        .active-filter-pill button {
            background: none;
            border: none;
            color: var(--uber-green);
            cursor: pointer;
            font-size: var(--font-size-10);
            padding: 3px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-normal);
            width: 16px;
            height: 16px;
        }
        
        .active-filter-pill button:hover {
            background: var(--uber-green);
            color: var(--uber-white);
            transform: var(--transform-scale-up);
        }
        
        /* ===== COMPACT PROMOTIONS SECTION ===== */
        .compact-promotions {
            margin-bottom: var(--spacing-4);
            position: relative;
        }
        
        .compact-promotions-slider {
            display: flex;
            gap: var(--spacing-16);
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: var(--spacing-8) 0;
            scroll-behavior: smooth;
        }
        
        .compact-promotions-slider::-webkit-scrollbar {
            display: none;
        }
        
        .compact-promotion-card {
            flex-shrink: 0;
            width: 350px;
            background: var(--uber-white);
            border: 1px solid var(--premium-gray-200);
            border-radius: var(--radius-12);
            padding: var(--spacing-8) var(--spacing-12);
            box-shadow: 0 2px 8px var(--premium-shadow);
            transition: all var(--transition-normal);
            cursor: pointer;
            position: relative;
            overflow: visible;
            min-height: 44px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .compact-promotion-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 0;
            background: var(--uber-green);
            border-radius: var(--radius-full);
            transition: all var(--transition-normal);
            opacity: 0;
        }
        
        .compact-promotion-card:hover {
            background: var(--uber-white);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px var(--premium-shadow-hover);
            border-color: var(--uber-green);
        }
        
        .compact-promotion-card:hover::before {
            height: 70%;
            opacity: 1;
        }
        
        .compact-promotion-header {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            margin-bottom: var(--spacing-4);
            padding-left: 0;
            position: relative;
            flex: 1;
            min-width: 0;
        }
        
        .compact-promotion-title {
            font-size: var(--font-size-13);
            font-weight: 600;
            color: var(--premium-gray-900);
            display: flex;
            align-items: center;
            gap: var(--spacing-4);
            flex: 1;
            min-width: 0;
        }
        
        .compact-promotion-title .promo-icon {
            color: var(--uber-green);
            font-size: var(--font-size-14);
        }
        
        .compact-promotion-badge {
            position: absolute;
            top: var(--spacing-8);
            right: var(--spacing-8);
            background-color: var(--uber-green);
            color: var(--uber-white);
            padding: var(--spacing-4) var(--spacing-8);
            border-radius: var(--radius-4);
            font-size: var(--font-size-12);
            font-weight: 600;
            text-transform: uppercase;
            z-index: 10;
        }
        
        .compact-promotion-description {
            font-size: var(--font-size-11);
            color: var(--premium-gray-600);
            line-height: 1.3;
            margin-bottom: var(--spacing-4);
            padding-left: 0;
            flex: 1;
            min-width: 0;
        }
        
        .compact-promotion-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-left: 0;
            flex: 1;
            min-width: 0;
        }
        
        .compact-promotion-code {
            background: var(--premium-gray-100);
            color: var(--premium-gray-700);
            font-size: var(--font-size-10);
            font-weight: 600;
            padding: var(--spacing-2) var(--spacing-6);
            border-radius: var(--radius-4);
            font-family: 'Courier New', monospace;
            letter-spacing: 0.3px;
        }
        
        .compact-promotion-validity {
            font-size: var(--font-size-10);
            color: var(--premium-gray-500);
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }
        
        .compact-promotion-validity .validity-icon {
            font-size: var(--font-size-9);
        }
        
        .compact-promotions-empty {
            text-align: center;
            padding: var(--spacing-16);
            color: var(--uber-gray-500);
            font-size: var(--font-size-14);
        }
        
        .compact-promotions-empty i {
            font-size: var(--font-size-24);
            color: var(--uber-gray-300);
            margin-bottom: var(--spacing-8);
            display: block;
        }
        
        .compact-promotions-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--uber-white), #fafafa);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            z-index: 2;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            font-size: var(--font-size-12);
            color: var(--uber-gray-600);
        }
        
        .compact-promotions-nav:hover {
            background: linear-gradient(135deg, var(--uber-green), #05a654);
            border-color: var(--uber-green);
            color: var(--uber-white);
            transform: translateY(-50%) var(--transform-scale-up);
        }
        
        .compact-promotions-nav.prev {
            left: var(--spacing-8);
        }
        
        .compact-promotions-nav.next {
            right: var(--spacing-8);
        }
        
        .compact-promotions-nav.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateY(-50%) scale(0.8);
        }
        
  
        
        /* ===== MODERN CARD-BASED CATEGORY TABS ===== */
        /* Category Tabs Container */
        .category-tabs-container {
            width: 100%;
            margin: 0 auto;
            margin-bottom: var(--spacing-16);
            position: sticky;
            top: 80px;
            z-index: 100;
            background: var(--uber-white);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            padding: 1px;
            border-radius: var(--radius-16);
            box-shadow: 0 2px 8px var(--premium-shadow);
            transition: all var(--transition-normal);
            display: block !important;
            overflow: visible;
            border: 1px solid var(--premium-gray-200);
        }
        
        .category-tabs-container.sticky {
            background: var(--uber-white);
            box-shadow: 0 4px 16px var(--premium-shadow-hover);
            top: 64px;
            border-color: var(--premium-gray-300);
        }
        
        .category-tabs-wrapper {
            position: relative;
            overflow: visible;
            padding: var(--spacing-8) var(--spacing-16);
            border-radius: var(--radius-16);
            background: var(--uber-white);
            border: 1px solid var(--premium-gray-100);
            min-height: auto;
            height: auto;
        }
        
        /* Add scroll indicators */
        .category-tabs-wrapper::before,
        .category-tabs-wrapper::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: var(--spacing-24);
            z-index: 2;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .category-tabs-wrapper::before {
            left: 0;
            background: linear-gradient(90deg, 
                var(--uber-white) 0%, 
                transparent 100%);
        }
        
        .category-tabs-wrapper::after {
            right: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                var(--uber-white) 100%);
        }
        
        /* Hide indicators when not needed */
        .category-tabs-wrapper.no-scroll-left::before {
            opacity: 0;
        }
        
        .category-tabs-wrapper.no-scroll-right::after {
            opacity: 0;
        }
        
        /* Category Tabs */
        .category-tabs {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            overflow-y: visible;
            gap: var(--spacing-12);
            padding: var(--spacing-10) 0;
            scrollbar-width: none;
            scrollbar-color: transparent transparent;
            position: relative;
            z-index: 1;
            /* Smooth scrolling */
            scroll-behavior: smooth;
            /* Hide scrollbar */
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .category-tabs::-webkit-scrollbar {
            display: none;
        }
        
        /* Add subtle scroll animation hint */
        @keyframes scrollHint {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(-5px); }
        }
        
        .category-tabs.scroll-hint {
            animation: scrollHint 2s ease-in-out infinite;
        }
        
        /* Modern Card-Based Tab Buttons - Clean & Premium */
        button.category-tab {
            background: var(--uber-white) !important;
            border: 1px solid var(--premium-gray-200) !important;
            border-radius: var(--radius-12) !important;
            padding: var(--spacing-12) var(--spacing-16) !important;
            cursor: pointer;
            font-size: var(--font-size-14) !important;
            font-weight: 500;
            color: var(--premium-gray-700) !important;
            transition: all var(--transition-normal) !important;
            white-space: nowrap;
            position: relative;
            flex-shrink: 0;
            min-height: 56px !important;
            min-width: 90px !important;
            max-height: none !important;
            display: inline-flex !important;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-4);
            box-shadow: 0 1px 3px var(--premium-shadow) !important;
            overflow: visible !important;
        }
        
        button.category-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.6);
            border-radius: var(--radius-12);
            opacity: 0;
            transition: opacity var(--transition-normal);
            pointer-events: none;
        }
        
        button.category-tab:hover {
            background: var(--premium-gray-50) !important;
            border-color: var(--uber-green) !important;
            color: var(--premium-gray-900) !important;
            box-shadow: 0 2px 6px var(--premium-shadow-hover) !important;
        }
        
        /* Clean Active State for Category Tabs */
        button.category-tab.active {
            background: var(--uber-green) !important;
            border-color: var(--uber-green) !important;
            color: var(--uber-white) !important;
            font-weight: 600;
            box-shadow: 0 2px 8px var(--premium-shadow-active) !important;
        }
        

        
        /* Category Icon - Clean and Simple */
        button.category-tab .category-icon {
            font-size: var(--font-size-18) !important;
            margin-right: 0 !important;
            opacity: 0.7;
            transition: all var(--transition-normal) !important;
            color: var(--premium-gray-600);
            line-height: 1;
        }
        
        button.category-tab:hover .category-icon {
            opacity: 1;
            color: var(--uber-green);
        }
        
        button.category-tab.active .category-icon {
            opacity: 1;
            color: var(--uber-white);
        }
        
        /* Category Text - Clean and Readable */
        button.category-tab .tab-text {
            font-size: var(--font-size-12);
            font-weight: 500;
            text-align: center;
            line-height: 1.3;
            transition: all var(--transition-normal);
        }
        
        button.category-tab:hover .tab-text {
            color: var(--premium-gray-900);
        }
        
        button.category-tab.active .tab-text {
            color: var(--uber-white);
        }
        
        /* Item Count Badge - Clean and Simple */
        button.category-tab .item-count {
            position: absolute;
            top: 6px;
            right: 6px;
            background: var(--premium-gray-300);
            color: var(--premium-gray-800);
            padding: 0 var(--spacing-6);
            border-radius: var(--radius-full);
            font-size: var(--font-size-10);
            font-weight: 600;
            transition: all var(--transition-normal);
            border: 2px solid var(--uber-white);
            box-shadow: 0 1px 3px var(--premium-shadow);
            min-width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        button.category-tab:hover .item-count {
            background: var(--uber-green);
            color: var(--uber-white);
        }
        
        button.category-tab.active .item-count {
            background: var(--uber-white);
            color: var(--uber-green);
        }
        
        /* New Badge - Clean */
        button.category-tab.new::after {
            content: 'New';
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--uber-red);
            color: var(--uber-white);
            padding: 2px 6px;
            border-radius: var(--radius-full);
            font-size: var(--font-size-9);
            font-weight: 600;
            z-index: 11;
        }
        
        /* Special positioning for active + new */
        button.category-tab.active.new::after {
            top: -10px;
            right: -10px;
            background: var(--uber-red);
        }
        
        /* Tab Content */
        .tab-content {
            position: relative;
        }
        
        .tab-pane {
            display: none;
            animation: fadeIn var(--transition-normal);
        }
        
        .tab-pane.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ===== MAIN CONTENT AREA ===== */
        .menu-content-area {
            min-height: 400px;
            display: block !important;
        }
        
        .menu-section {
            margin-bottom: var(--spacing-48);
        }
        
        .menu-section:last-child {
            margin-bottom: 0;
        }
        
        .menu-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-24);
            padding-bottom: var(--spacing-12);
            border-bottom: 2px solid var(--uber-gray-200);
        }
        
        .menu-section-title {
            font-size: var(--font-size-24);
            font-weight: 600;
            color: var(--uber-gray-900);
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
        }
        
        .menu-section-title .section-icon {
            color: var(--uber-green);
            font-size: var(--font-size-20);
        }
        
        .menu-section-subtitle {
            color: var(--uber-gray-600);
            font-size: var(--font-size-14);
            font-weight: 400;
        }
        
        .menu-section-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--spacing-24);
        }
        
        .menu-section-empty {
            text-align: center;
            padding: var(--spacing-48) var(--spacing-24);
            color: var(--uber-gray-500);
        }
        
        .menu-section-empty i {
            font-size: var(--font-size-48);
            color: var(--uber-gray-300);
            margin-bottom: var(--spacing-16);
        }
        
        .menu-section-empty h3 {
            font-size: var(--font-size-20);
            margin-bottom: var(--spacing-8);
            color: var(--uber-gray-600);
        }
        
        .menu-section-empty p {
            font-size: var(--font-size-16);
            margin-bottom: var(--spacing-16);
        }
        
        .menu-section-empty .btn {
            margin-top: var(--spacing-8);
        }
        
        /* ===== MENU ITEMS GRID ===== */
        .menu-items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--spacing-24);
        }
        
        /* ===== MENU ITEM CARD (UBER EATS STYLE) ===== */
        .menu-item-card {
            background-color: var(--uber-white);
            border-radius: var(--radius-12);
            overflow: hidden;
            box-shadow: var(--shadow-2);
            transition: var(--transition-normal);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .menu-item-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-3);
        }
        
        .menu-item-image-container {
            position: relative;
            height: 345px;
            overflow: hidden;
        }
        
        .menu-item-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition-normal);
        }
        
        .menu-item-card:hover .menu-item-image {
            transform: scale(1.05);
        }
        
        .menu-item-badge {
            position: absolute;
            top: var(--spacing-12);
            right: var(--spacing-12);
            background-color: var(--uber-yellow);
            color: var(--uber-gray-900);
            padding: var(--spacing-4) var(--spacing-8);
            border-radius: var(--radius-4);
            font-size: var(--font-size-12);
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .menu-item-content {
            padding: var(--spacing-16);
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .menu-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-8);
        }
        
        .menu-item-name {
            font-size: var(--font-size-18);
            font-weight: 600;
            color: var(--uber-gray-900);
            flex: 1;
            margin-right: var(--spacing-8);
        }
        
        .menu-item-price {
            color: var(--uber-green);
            font-weight: 600;
            font-size: var(--font-size-18);
            white-space: nowrap;
        }
        
        .menu-item-desc {
            color: var(--uber-gray-600);
            margin-bottom: var(--spacing-16);
            font-size: var(--font-size-14);
            line-height: 1.4;
            flex: 1;
        }
        
        .menu-item-footer {
            display: flex;
            justify-content: flex-start;
            align-items: center;
        }
        
        .prep-time-with-favorite {
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
        }
        
        .item-actions {
            display: flex;
            gap: var(--spacing-8);
        }
        
        .btn-add-to-cart {
            background-color: var(--uber-green);
            color: var(--uber-white);
            border: none;
            border-radius: var(--radius-full);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-fast);
            font-size: var(--font-size-14);
        }
        
        .btn-add-to-cart:hover {
            background-color: var(--uber-green-dark);
            transform: var(--transform-scale-up);
        }
        
        .btn-add-to-cart i {
            margin: 0;
        }
        
        .prep-time {
            color: var(--uber-gray-500);
            font-size: var(--font-size-14);
            display: flex;
            align-items: center;
        }
        
        .prep-time i {
            margin-right: var(--spacing-4);
            font-size: var(--font-size-14);
        }
        
        .btn-favorite {
            background: none;
            border: none;
            color: var(--uber-gray-400);
            cursor: pointer;
            font-size: var(--font-size-20);
            transition: var(--transition-fast);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-full);
        }
        
        .btn-favorite:hover {
            background-color: var(--uber-gray-100);
            color: var(--uber-gray-600);
        }
        
        .btn-favorite.active {
            color: var(--uber-red);
        }
        
        /* ===== PROMOTIONS ===== */
        .promotions-container {
            margin-bottom: var(--spacing-32);
        }
        
        .promotions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--spacing-16);
            margin-bottom: var(--spacing-24);
        }
        
        .promotion-card {
            background-color: var(--uber-white);
            border-radius: var(--radius-12);
            overflow: hidden;
            box-shadow: var(--shadow-2);
            transition: var(--transition-normal);
        }
        
        .promotion-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-3);
        }
        
        .promotion-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .promotion-content {
            padding: var(--spacing-16);
        }
        
        .promotion-title {
            font-size: var(--font-size-18);
            font-weight: 600;
            margin-bottom: var(--spacing-8);
            color: var(--uber-gray-900);
        }
        
        .promotion-description {
            font-size: var(--font-size-14);
            color: var(--uber-gray-600);
            line-height: 1.4;
            margin-bottom: var(--spacing-8);
        }
        
        .promotion-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-12);
        }
        
        .promo-code-container {
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
            background-color: var(--uber-gray-100);
            padding: var(--spacing-6) var(--spacing-12);
            border-radius: var(--radius-8);
        }
        
        .promo-code {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: var(--uber-green);
            font-size: var(--font-size-14);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .copy-code-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--uber-gray-600);
            padding: var(--spacing-4);
            border-radius: var(--radius-4);
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .copy-code-btn:hover {
            background-color: var(--uber-gray-200);
            color: var(--uber-green);
        }
        
        .promo-condition {
            font-size: var(--font-size-12);
            color: var(--uber-gray-500);
            font-style: italic;
            margin-top: var(--spacing-4);
        }
        
        /* ===== CART VIEW ===== */
        .cart-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--uber-white);
            border-radius: var(--radius-12);
            padding: var(--spacing-24);
            box-shadow: var(--shadow-2);
        }
        
        .cart-item {
            display: flex;
            flex-wrap: wrap;
            border-bottom: 1px solid var(--uber-gray-200);
            padding: var(--spacing-16) 0;
            align-items: flex-start;
        }
        
        .cart-item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: var(--radius-8);
            margin-right: var(--spacing-16);
        }
        
        .cart-item-details {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .cart-item-name {
            font-weight: 600;
            margin-bottom: var(--spacing-4);
            font-size: var(--font-size-16);
            color: var(--uber-gray-900);
        }
        
        .cart-item-customizations {
            font-size: var(--font-size-14);
            color: var(--uber-gray-600);
            margin-bottom: var(--spacing-8);
        }
        
        .cart-item-price-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-8);
        }
        
        .cart-item-price-breakdown {
            padding: var(--spacing-8) 0;
        }
        
        .cart-item-price-total {
            padding: var(--spacing-8) 0;
        }
        
        .cart-item-price-breakdown .price-breakdown {
            font-size: var(--font-size-14);
            color: var(--uber-gray-600);
            font-weight: normal;
        }
        
        .cart-item-price-total .price-total {
            font-weight: 600;
            color: var(--uber-gray-900);
            font-size: var(--font-size-16);
        }
        
        .cart-item-actions {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: var(--spacing-12);
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            border: 1px solid var(--uber-gray-300);
            border-radius: var(--radius-24);
            overflow: hidden;
        }
        
        .quantity-btn {
            background: none;
            border: none;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: var(--font-size-18);
            color: var(--uber-gray-700);
            transition: var(--transition-fast);
        }
        
        .quantity-btn:hover {
            background-color: var(--uber-gray-100);
        }
        
        .quantity-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .quantity-input {
            width: 40px;
            height: 36px;
            border: none;
            text-align: center;
            font-size: var(--font-size-16);
            font-weight: 600;
        }
        
        .btn-remove {
            color: var(--uber-red);
            background: none;
            border: none;
            cursor: pointer;
            font-size: var(--font-size-18);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-full);
            transition: var(--transition-fast);
        }
        
        .btn-remove:hover {
            background-color: rgba(255, 65, 54, 0.1);
        }
        
        .cart-summary {
            margin-top: var(--spacing-24);
            padding-top: var(--spacing-16);
            border-top: 2px solid var(--uber-gray-200);
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-8);
            font-size: var(--font-size-16);
        }
        
        .summary-total {
            font-weight: 700;
            font-size: var(--font-size-20);
            color: var(--uber-green);
            margin-top: var(--spacing-8);
            padding-top: var(--spacing-8);
            border-top: 1px solid var(--uber-gray-200);
        }
        
        /* ===== CHECKOUT VIEW ===== */
        .checkout-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--uber-white);
            border-radius: var(--radius-12);
            padding: var(--spacing-24);
            box-shadow: var(--shadow-2);
        }
        
        .checkout-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-40);
            position: relative;
        }
        
        .checkout-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--uber-gray-300);
            z-index: 1;
        }
        
        .step {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            background-color: var(--uber-white);
            border: 2px solid var(--uber-gray-300);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            position: relative;
            z-index: 2;
            font-size: var(--font-size-18);
            color: var(--uber-gray-500);
        }
        
        .step.active {
            background-color: var(--uber-green);
            border-color: var(--uber-green);
            color: var(--uber-white);
        }
        
        .step.completed {
            background-color: var(--uber-green);
            border-color: var(--uber-green);
            color: var(--uber-white);
        }
        
        .step.completed::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
        }
        
        .step-label {
            position: absolute;
            top: 48px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: var(--font-size-14);
            font-weight: 500;
            color: var(--uber-gray-600);
        }
        
        .checkout-form {
            margin-bottom: var(--spacing-24);
        }
        
        .form-group {
            margin-bottom: var(--spacing-20);
        }
        
        .form-label {
            display: block;
            margin-bottom: var(--spacing-8);
            font-weight: 600;
            font-size: var(--font-size-16);
            color: var(--uber-gray-800);
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: var(--spacing-12) var(--spacing-16);
            border: 1px solid var(--uber-gray-300);
            border-radius: var(--radius-8);
            font-size: var(--font-size-16);
            transition: var(--transition-fast);
            background-color: var(--uber-white);
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--uber-green);
            box-shadow: 0 0 0 3px rgba(6, 193, 103, 0.2);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .order-type-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-16);
            margin-bottom: var(--spacing-32);
        }
        
        .order-type-btn {
            padding: var(--spacing-16);
            border: 2px solid var(--uber-gray-300);
            border-radius: var(--radius-12);
            text-align: center;
            cursor: pointer;
            transition: var(--transition-fast);
            background-color: var(--uber-white);
        }
        
        .order-type-btn:hover {
            border-color: var(--uber-green);
        }
        
        .order-type-btn.active {
            border-color: var(--uber-green);
            background-color: rgba(6, 193, 103, 0.1);
        }
        
        .order-type-icon {
            font-size: var(--font-size-28);
            margin-bottom: var(--spacing-8);
            color: var(--uber-gray-500);
        }
        
        .order-type-btn.active .order-type-icon {
            color: var(--uber-green);
        }
        
        /* ===== FLOATING ACTION BUTTONS ===== */
        .fab-container {
            position: fixed;
            bottom: var(--spacing-24);
            right: var(--spacing-24);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-16);
            z-index: 900;
        }
        
        .fab {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-full);
            background-color: var(--uber-green);
            color: var(--uber-white);
            border: none;
            box-shadow: var(--shadow-4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-24);
            transition: var(--transition-fast);
            position: relative;
        }
        
        .fab:hover {
            transform: scale(1.05);
            background-color: var(--uber-green-dark);
        }
        
        .cart-fab .cart-count {
            position: absolute;
            top: -2px;
            right: -2px;
            background-color: var(--uber-yellow);
            color: var(--uber-gray-900);
            border-radius: var(--radius-full);
            min-width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-12);
            font-weight: 700;
            padding: 0 var(--spacing-4);
        }
        
        /* ===== MODALS ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: var(--spacing-16);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-normal);
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background-color: var(--uber-white);
            border-radius: var(--radius-16);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-5);
            transform: translateY(20px);
            transition: var(--transition-normal);
        }
        
        .modal-overlay.active .modal {
                border-radius: var(--radius-16) !important;
            transform: translateY(0);
        }
        
        .modal-header {
            padding: var(--spacing-20);
            border-bottom: 1px solid var(--uber-gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: var(--font-size-24);
            font-weight: 600;
            color: var(--uber-gray-900);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: var(--font-size-20);
            cursor: pointer;
            color: var(--uber-gray-500);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-full);
            transition: var(--transition-fast);
        }
        
        .modal-close:hover {
            background-color: var(--uber-gray-100);
            color: var(--uber-gray-700);
        }
        
        .modal-body {
            padding: var(--spacing-20);
        }
        
        .modal-footer {
            padding: var(--spacing-20);
            border-top: 1px solid var(--uber-gray-200);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-12);
        }
        
        .conflict-details {
            background-color: var(--uber-gray-100);
            padding: var(--spacing-16);
            border-radius: var(--radius-8);
            margin: var(--spacing-16) 0;
        }
        
        .conflict-details p {
            margin: var(--spacing-4) 0;
            font-size: var(--font-size-14);
        }
        
        .conflict-details strong {
            color: var(--uber-gray-800);
        }
        
        .conflict-details span {
            color: var(--uber-green);
            font-weight: 500;
        }
        
        /* ===== ITEM DETAIL MODAL ===== */
        .item-detail-container {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-20);
        }
        
        .item-image-section {
            position: relative;
            height: 460px;
            border-radius: var(--radius-12);
            overflow: hidden;
        }
        
        .item-detail-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .item-badge {
            position: absolute;
            top: var(--spacing-12);
            right: var(--spacing-12);
            background-color: var(--uber-yellow);
            color: var(--uber-gray-900);
            padding: var(--spacing-4) var(--spacing-8);
            border-radius: var(--radius-4);
            font-size: var(--font-size-12);
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .item-info-section {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-12);
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .item-name {
            font-size: var(--font-size-28);
            font-weight: 700;
            color: var(--uber-gray-900);
            flex: 1;
        }
        
        .item-price {
            font-size: var(--font-size-24);
            font-weight: 700;
            color: var(--uber-green);
        }
        
        .item-description {
            font-size: var(--font-size-16);
            color: var(--uber-gray-600);
            line-height: 1.6;
        }
        
        .item-meta {
            display: flex;
            gap: var(--spacing-24);
            color: var(--uber-gray-500);
            font-size: var(--font-size-14);
        }
        
        .item-meta span {
            display: flex;
            align-items: center;
            gap: var(--spacing-4);
        }
        
        /* ===== CUSTOMIZATION MODAL ===== */
        .customization-group {
            margin-bottom: var(--spacing-24);
        }
        
        .customization-group-title {
            font-weight: 600;
            margin-bottom: var(--spacing-12);
            font-size: var(--font-size-18);
            color: var(--uber-gray-900);
        }
        
        .customization-options-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-8);
        }
        
        .customization-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-12) var(--spacing-16);
            border: 1px solid var(--uber-gray-300);
            border-radius: var(--radius-8);
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .customization-option:hover {
            border-color: var(--uber-green);
        }
        
        .customization-option.selected {
            border-color: var(--uber-green);
            background-color: rgba(6, 193, 103, 0.1);
        }
        
        .customization-option-label {
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
        }
        
        .customization-option input[type="radio"],
        .customization-option input[type="checkbox"] {
            margin: 0;
        }
        
        .customization-price {
            color: var(--uber-green);
            font-weight: 600;
            font-size: var(--font-size-16);
        }
        
        .quantity-selector {
            display: flex;
            align-items: center;
            gap: var(--spacing-16);
            margin-top: var(--spacing-20);
            padding-top: var(--spacing-20);
            border-top: 1px solid var(--uber-gray-200);
        }
        
        .quantity-label {
            font-weight: 600;
            color: var(--uber-gray-800);
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            border: 1px solid var(--uber-gray-300);
            border-radius: var(--radius-24);
            overflow: hidden;
        }
        
        .quantity-controls button {
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: var(--font-size-18);
            color: var(--uber-gray-700);
            transition: var(--transition-fast);
        }
        
        .quantity-controls button:hover {
            background-color: var(--uber-gray-100);
        }
        
        .quantity-controls input {
            width: 60px;
            height: 40px;
            border: none;
            text-align: center;
            font-size: var(--font-size-16);
            font-weight: 600;
        }
        
        /* ===== MENU CARD QUANTITY CONTROLLER ===== */
        .menu-item-quantity-controller {
            position: absolute;
            bottom: var(--spacing-12);
            right: var(--spacing-12);
            z-index: 10;
            /* Ensure the quantity controller is always visible */
            opacity: 1 !important;
            visibility: visible !important;
            transform: none !important;
            display: block !important;
        }
        
        /* Ensure quantity controller is visible on menu item cards */
        .menu-item-card .menu-item-quantity-controller {
            opacity: 1 !important;
            visibility: visible !important;
            display: block !important;
        }
        
        /* Ensure quantity controller is visible even on menu item card hover */
        .menu-item-card:hover .menu-item-quantity-controller {
            opacity: 1 !important;
            visibility: visible !important;
            display: block !important;
        }
        
        .btn-add-to-cart-menu {
            background: var(--uber-green);
            color: var(--uber-white);
            border: none;
            border-radius: var(--radius-full);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: var(--font-size-18);
            font-weight: 600;
            transition: all var(--transition-normal);
            box-shadow: 0 2px 8px rgba(6, 193, 103, 0.3);
            /* Ensure the button is always visible */
            opacity: 1 !important;
            visibility: visible !important;
            display: flex !important;
        }
        
        .btn-add-to-cart-menu:hover {
            background: var(--uber-green-dark);
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(6, 193, 103, 0.4);
        }
        
        .quantity-controls-menu {
            display: flex !important;
            align-items: center;
            background: var(--uber-white);
            border: 2px solid var(--uber-green);
            border-radius: var(--radius-24);
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(6, 193, 103, 0.2);
            /* Ensure the quantity controls are always visible */
            opacity: 1 !important;
            visibility: visible !important;
        }
        
        .quantity-controls-menu button {
            background: none;
            border: none;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: var(--font-size-16);
            font-weight: 600;
            color: var(--uber-green);
            transition: all var(--transition-fast);
        }
        
        .quantity-controls-menu button:hover:not(:disabled) {
            background: var(--uber-green);
            color: var(--uber-white);
        }
        
        .quantity-controls-menu button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .quantity-controls-menu input {
            width: 40px;
            height: 32px;
            border: none;
            text-align: center;
            font-size: var(--font-size-14);
            font-weight: 600;
            color: var(--uber-gray-900);
            background: transparent;
        }
        
        .quantity-controls-menu .quantity-separator {
            width: 1px;
            height: 20px;
            background: var(--uber-green);
            margin: 0 var(--spacing-2);
        }
        
        /* ===== LOADING OVERLAY ===== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-normal);
        }
        
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--uber-gray-300);
            border-top: 4px solid var(--uber-green);
            border-radius: var(--radius-full);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .category-tab.skeleton {
            pointer-events: none;
            background: var(--uber-gray-100) !important;
            border-color: var(--uber-gray-200) !important;
            position: relative;
            overflow: hidden;
        }
        
        .category-tab.skeleton .skeleton-text {
            height: 16px;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-4);
            margin: 0 var(--spacing-8);
        }
        
        .category-tab.skeleton .skeleton-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 20px;
            height: 20px;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-full);
        }
        
        .category-tab.skeleton .category-icon {
            display: none;
        }
        
        .menu-section-header .skeleton-text.section-title {
            height: 24px;
            width: 150px;
            margin-bottom: var(--spacing-16);
        }
        
        /* ===== SKELETON LOADING STATES ===== */
        .skeleton {
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-4);
        }
        
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Branch Card Skeleton */
        .branch-card.skeleton {
            background: var(--uber-white);
            border-radius: var(--radius-16);
            overflow: hidden;
            box-shadow: var(--shadow-1);
        }
        
        .branch-card.skeleton .branch-image-container {
            position: relative;
            overflow: hidden;
            aspect-ratio: 16 / 10;
        }
        
        .branch-card.skeleton .skeleton-image {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        
        .branch-card.skeleton .branch-content {
            padding: var(--spacing-20);
        }
        
        .branch-card.skeleton .skeleton-text {
            height: 20px;
            margin-bottom: var(--spacing-8);
            border-radius: var(--radius-4);
        }
        
        .branch-card.skeleton .skeleton-text.title {
            width: 70%;
            height: 24px;
        }
        
        .branch-card.skeleton .skeleton-text.subtitle {
            width: 50%;
            height: 16px;
        }
        
        .branch-card.skeleton .skeleton-text.small {
            width: 30%;
            height: 14px;
        }
        
        /* Menu Item Card Skeleton */
        .menu-item-card.skeleton {
            background: var(--uber-white);
            border-radius: var(--radius-12);
            overflow: hidden;
            box-shadow: var(--shadow-1);
        }
        
        .menu-item-card.skeleton .menu-item-image-container {
            position: relative;
            height: 180px;
            overflow: hidden;
        }
        
        .menu-item-card.skeleton .skeleton-image {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        
        .menu-item-card.skeleton .menu-item-content {
            padding: var(--spacing-16);
        }
        
        .menu-item-card.skeleton .skeleton-text {
            height: 16px;
            margin-bottom: var(--spacing-8);
            border-radius: var(--radius-4);
        }
        
        .menu-item-card.skeleton .skeleton-text.title {
            width: 80%;
            height: 20px;
        }
        
        .menu-item-card.skeleton .skeleton-text.price {
            width: 40%;
            height: 18px;
        }
        
        .menu-item-card.skeleton .skeleton-text.description {
            width: 90%;
            height: 14px;
        }
        
        /* Promotion Card Skeleton */
        .promotion-card.skeleton {
            background: var(--uber-white);
            border-radius: var(--radius-12);
            overflow: hidden;
            box-shadow: var(--shadow-1);
        }
        
        .promotion-card.skeleton .promotion-image {
            width: 100%;
            height: 150px;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        
        .promotion-card.skeleton .promotion-content {
            padding: var(--spacing-16);
        }
        
        .promotion-card.skeleton .skeleton-text {
            height: 16px;
            margin-bottom: var(--spacing-8);
            border-radius: var(--radius-4);
        }
        
        .promotion-card.skeleton .skeleton-text.title {
            width: 70%;
            height: 20px;
        }
        
        .promotion-card.skeleton .skeleton-text.description {
            width: 85%;
            height: 14px;
        }
        
        /* ===== EMPTY STATES ===== */
        .empty-cart, .empty-state {
            text-align: center;
            padding: var(--spacing-48) var(--spacing-24);
        }
        
        .empty-cart i, .empty-state i {
            font-size: 64px;
            color: var(--uber-gray-300);
            margin-bottom: var(--spacing-16);
        }
        
        .empty-cart h3, .empty-state h3 {
            font-size: var(--font-size-24);
            margin-bottom: var(--spacing-8);
            color: var(--uber-gray-700);
        }
        
        .empty-cart p, .empty-state p {
            color: var(--uber-gray-500);
            margin-bottom: var(--spacing-24);
        }
        
        /* ===== MODAL SKELETON STATES ===== */
        .modal.skeleton .modal-header {
            padding-bottom: var(--spacing-16);
            border-bottom: 1px solid var(--uber-gray-200);
        }
        
        .modal.skeleton .modal-title {
            height: 28px;
            width: 60%;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-4);
            margin-bottom: var(--spacing-8);
        }
        
        .modal.skeleton .modal-body {
            padding: var(--spacing-20) 0;
        }
        
        .modal.skeleton .skeleton-row {
            display: flex;
            margin-bottom: var(--spacing-16);
            gap: var(--spacing-16);
        }
        
        .modal.skeleton .skeleton-col {
            flex: 1;
        }
        
        .modal.skeleton .skeleton-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-8);
            margin-bottom: var(--spacing-16);
        }
        
        .modal.skeleton .skeleton-text {
            height: 16px;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-4);
            margin-bottom: var(--spacing-12);
        }
        
        .modal.skeleton .skeleton-text.large {
            height: 24px;
            width: 80%;
        }
        
        .modal.skeleton .skeleton-text.medium {
            height: 20px;
            width: 60%;
        }
        
        .modal.skeleton .skeleton-text.small {
            height: 14px;
            width: 40%;
        }
        
        .modal.skeleton .skeleton-button {
            height: 44px;
            width: 120px;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-8);
            margin-right: var(--spacing-12);
        }
        
        .modal.skeleton .skeleton-form-group {
            margin-bottom: var(--spacing-20);
        }
        
        .modal.skeleton .skeleton-input {
            height: 44px;
            width: 100%;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-8);
        }
        
        .modal.skeleton .skeleton-textarea {
            height: 80px;
            width: 100%;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-8);
        }
        
        .modal.skeleton .skeleton-select {
            height: 44px;
            width: 100%;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-8);
        }
        
        .modal.skeleton .modal-footer {
            padding-top: var(--spacing-16);
            border-top: 1px solid var(--uber-gray-200);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-12);
        }
        
        /* ===== PAGE SKELETON STATES ===== */
        .view.skeleton .page-header {
            margin-bottom: var(--spacing-32);
        }
        
        .view.skeleton .skeleton-page-title {
            height: 40px;
            width: 50%;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-4);
            margin-bottom: var(--spacing-16);
        }
        
        .view.skeleton .skeleton-page-subtitle {
            height: 20px;
            width: 70%;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-4);
            margin-bottom: var(--spacing-24);
        }
        
        .view.skeleton .skeleton-content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-24);
        }
        
        .view.skeleton .skeleton-content-card {
            background: var(--uber-white);
            border-radius: var(--radius-12);
            padding: var(--spacing-20);
            box-shadow: var(--shadow-1);
        }
        
        .view.skeleton .skeleton-list-item {
            background: var(--uber-white);
            border-radius: var(--radius-8);
            padding: var(--spacing-16);
            margin-bottom: var(--spacing-12);
            box-shadow: var(--shadow-1);
        }
        
        .view.skeleton .skeleton-list-item .skeleton-list-content {
            display: flex;
            align-items: center;
            gap: var(--spacing-16);
        }
        
        .view.skeleton .skeleton-list-item .skeleton-list-image {
            width: 60px;
            height: 60px;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-8);
            flex-shrink: 0;
        }
        
        .view.skeleton .skeleton-list-item .skeleton-list-details {
            flex: 1;
        }
        
        .view.skeleton .skeleton-list-item .skeleton-list-title {
            height: 18px;
            width: 70%;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-4);
            margin-bottom: var(--spacing-8);
        }
        
        .view.skeleton .skeleton-list-item .skeleton-list-subtitle {
            height: 14px;
            width: 50%;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-4);
        }
        
        /* ===== TOAST NOTIFICATIONS ===== */
        .toast {
            position: fixed;
            bottom: var(--spacing-32);
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--uber-gray-900);
            color: var(--uber-white);
            padding: var(--spacing-16) var(--spacing-24);
            border-radius: var(--radius-24);
            box-shadow: var(--shadow-4);
            display: flex;
            align-items: center;
            gap: var(--spacing-12);
            z-index: 2000;
            animation: slideUp var(--transition-normal);
        }
        
        .toast.success {
            background-color: var(--uber-green);
        }
        
        .toast.error {
            background-color: var(--uber-red);
        }
        
        .toast i {
            font-size: var(--font-size-20);
        }
        
        @keyframes slideUp {
            from { 
                transform: translate(-50%, 100px);
                opacity: 0;
            }
            to { 
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }
        
        /* ===== ORDER TRACKING ===== */
        .order-tracking-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .order-type-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-12);
            margin-bottom: var(--spacing-24);
            padding: var(--spacing-20);
            border-radius: var(--radius-12);
            background: linear-gradient(135deg, var(--premium-gray-50), var(--uber-white));
            border: 1px solid var(--premium-gray-200);
        }
        
        .order-type-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-12);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-24);
            color: var(--uber-white);
            font-weight: bold;
        }
        
        .order-type-icon.dine-in {
            background: linear-gradient(135deg, #8B5CF6, #7C3AED);
        }
        
        .order-type-icon.takeaway {
            background: linear-gradient(135deg, #F97316, #EA580C);
        }
        
        .order-type-icon.delivery {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
        }
        
        .order-type-info h3 {
            margin: 0;
            font-size: var(--font-size-20);
            font-weight: 600;
            color: var(--uber-gray-900);
        }
        
        .order-type-info p {
            margin: 0;
            font-size: var(--font-size-14);
            color: var(--uber-gray-600);
        }
        
        .order-status {
            margin-bottom: var(--spacing-24);
        }
        
        .order-status h3 {
            font-size: var(--font-size-24);
            margin-bottom: var(--spacing-24);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
        }
        
        .order-status .order-number {
            color: var(--uber-green);
            font-weight: 700;
        }
        
        .status-progress {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: var(--spacing-40);
            padding: 0 var(--spacing-8);
        }
        
        .status-progress::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            height: 3px;
            background: linear-gradient(90deg, var(--uber-gray-300), var(--uber-gray-200));
            z-index: 1;
            border-radius: var(--radius-2);
        }
        
        .status-progress.dine-in::before {
            background: linear-gradient(90deg, #8B5CF6, #7C3AED, #8B5CF6);
        }
        
        .status-progress.takeaway::before {
            background: linear-gradient(90deg, #F97316, #EA580C, #F97316);
        }
        
        .status-progress.delivery::before {
            background: linear-gradient(90deg, #3B82F6, #2563EB, #3B82F6);
        }
        
        .status-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            min-width: 60px;
        }
        
        .status-step-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            background-color: var(--uber-white);
            border: 3px solid var(--uber-gray-300);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-16);
            color: var(--uber-gray-500);
            transition: var(--transition-normal);
            margin-bottom: var(--spacing-8);
        }
        
        .status-step.active .status-step-icon {
            transform: scale(1.1);
            box-shadow: var(--shadow-2);
        }
        
        .status-step.completed .status-step-icon {
            background-color: var(--uber-green);
            border-color: var(--uber-green);
            color: var(--uber-white);
        }
        
        .status-step.active .status-step-icon {
            color: var(--uber-white);
        }
        
        .status-step.dine-in .status-step-icon.active {
            background-color: #8B5CF6;
            border-color: #8B5CF6;
        }
        
        .status-step.takeaway .status-step-icon.active {
            background-color: #F97316;
            border-color: #F97316;
        }
        
        .status-step.delivery .status-step-icon.active {
            background-color: #3B82F6;
            border-color: #3B82F6;
        }
        
        .status-step.completed .status-step-icon::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
        }
        
        .step-label {
            font-size: var(--font-size-12);
            font-weight: 600;
            text-align: center;
            color: var(--uber-gray-600);
            max-width: 80px;
            line-height: 1.2;
        }
        
        .status-step.active .step-label {
            color: var(--uber-gray-900);
            font-weight: 700;
        }
        
        .status-step.completed .step-label {
            color: var(--uber-green);
        }
        
        .status-description {
            background-color: var(--premium-gray-50);
            border-radius: var(--radius-8);
            padding: var(--spacing-12) var(--spacing-16);
            margin-bottom: var(--spacing-24);
            border-left: 4px solid var(--uber-green);
        }
        
        .status-description h4 {
            margin: 0 0 var(--spacing-4) 0;
            font-size: var(--font-size-16);
            font-weight: 600;
            color: var(--uber-gray-900);
        }
        
        .status-description p {
            margin: 0;
            font-size: var(--font-size-14);
            color: var(--uber-gray-600);
        }
        
        .order-details {
            background-color: var(--uber-white);
            border-radius: var(--radius-12);
            padding: var(--spacing-24);
            box-shadow: var(--shadow-2);
            margin-bottom: var(--spacing-24);
        }
        
        .order-details h4 {
            font-size: var(--font-size-20);
            margin-bottom: var(--spacing-16);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
        }
        
        .order-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-16);
            margin-bottom: var(--spacing-20);
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-4);
        }
        
        .detail-label {
            font-size: var(--font-size-12);
            font-weight: 600;
            color: var(--uber-gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .detail-value {
            font-size: var(--font-size-16);
            color: var(--uber-gray-900);
            font-weight: 500;
        }
        
        .order-type-specific {
            background-color: var(--premium-gray-50);
            border-radius: var(--radius-12);
            padding: var(--spacing-20);
            margin-bottom: var(--spacing-24);
            border: 1px solid var(--premium-gray-200);
        }
        
        .order-type-specific h4 {
            margin: 0 0 var(--spacing-16) 0;
            font-size: var(--font-size-18);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
        }
        
        .specific-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-16);
        }
        
        .action-buttons {
            display: flex;
            gap: var(--spacing-12);
            flex-wrap: wrap;
            margin-top: var(--spacing-16);
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
            padding: var(--spacing-12) var(--spacing-16);
            border-radius: var(--radius-8);
            border: 1px solid var(--uber-gray-300);
            background-color: var(--uber-white);
            color: var(--uber-gray-700);
            font-size: var(--font-size-14);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-normal);
            text-decoration: none;
        }
        
        .action-btn:hover {
            background-color: var(--uber-gray-100);
            border-color: var(--uber-green);
            color: var(--uber-green);
            transform: var(--transform-slide-up);
        }
        
        .action-btn.primary {
            background-color: var(--uber-green);
            color: var(--uber-white);
            border-color: var(--uber-green);
        }
        
        .action-btn.primary:hover {
            background-color: var(--uber-green-dark);
            border-color: var(--uber-green-dark);
        }
        
        .action-btn.danger {
            background-color: var(--uber-red);
            color: var(--uber-white);
            border-color: var(--uber-red);
        }
        
        .action-btn.danger:hover {
            background-color: #DC2626;
            border-color: #DC2626;
        }
        
        .timeline {
            position: relative;
            margin-top: var(--spacing-24);
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: var(--uber-gray-300);
        }
        
        .timeline-item {
            position: relative;
            padding-left: var(--spacing-48);
            margin-bottom: var(--spacing-20);
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 14px;
            top: 6px;
            width: 14px;
            height: 14px;
            border-radius: var(--radius-full);
            background-color: var(--uber-white);
            border: 2px solid var(--uber-gray-300);
        }
        
        .timeline-item.completed::before {
            background-color: var(--uber-green);
            border-color: var(--uber-green);
        }
        
        .timeline-content {
            background-color: var(--uber-white);
            padding: var(--spacing-12) var(--spacing-16);
            border-radius: var(--radius-8);
            border: 1px solid var(--uber-gray-200);
        }
        
        .timeline-time {
            font-size: var(--font-size-12);
            color: var(--uber-gray-500);
            margin-bottom: var(--spacing-4);
        }
        
        .timeline-text {
            font-size: var(--font-size-14);
            color: var(--uber-gray-700);
        }
        
        /* Enhanced status badges */
        .status-badge {
            padding: var(--spacing-6) var(--spacing-12);
            border-radius: var(--radius-24);
            font-size: var(--font-size-12);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-6);
        }
        
        .status-badge.pending {
            background-color: var(--uber-gray-200);
            color: var(--uber-gray-700);
        }
        
        .status-badge.confirmed {
            background-color: var(--uber-blue);
            color: var(--uber-white);
        }
        
        .status-badge.preparing {
            background-color: var(--uber-yellow);
            color: var(--uber-gray-900);
        }
        
        .status-badge.ready {
            background-color: var(--uber-green);
            color: var(--uber-white);
        }
        
        .status-badge.ready_for_pickup {
            background-color: var(--uber-green);
            color: var(--uber-white);
        }
        
        .status-badge.ready_for_delivery {
            background-color: var(--uber-green);
            color: var(--uber-white);
        }
        
        .status-badge.served {
            background-color: #8B5CF6;
            color: var(--uber-white);
        }
        
        .status-badge.picked_up {
            background-color: #F97316;
            color: var(--uber-white);
        }
        
        .status-badge.out_for_delivery {
            background-color: #3B82F6;
            color: var(--uber-white);
        }
        
        .status-badge.delivered {
            background-color: #059669;
            color: var(--uber-white);
        }
        
        .status-badge.completed {
            background-color: var(--uber-green-dark);
            color: var(--uber-white);
        }
        
        .status-badge.cancelled {
            background-color: var(--uber-red);
            color: var(--uber-white);
        }
        
        /* Loading skeleton for order tracking */
        .skeleton-order-type {
            height: 80px;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--radius-12);
            margin-bottom: var(--spacing-24);
        }
        
        .skeleton-status-progress {
            height: 100px;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--radius-12);
            margin-bottom: var(--spacing-24);
        }
        
        .skeleton-order-details {
            height: 200px;
            background: linear-gradient(90deg, var(--uber-gray-200) 25%, var(--uber-gray-100) 50%, var(--uber-gray-200) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--radius-12);
            margin-bottom: var(--spacing-24);
        }
        
        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }
        
        /* ===== ORDER HISTORY ===== */
        .order-history-container {
            margin-top: var(--spacing-24);
        }
        
        .order-history-card {
            background-color: var(--uber-white);
            border-radius: var(--radius-12);
            padding: var(--spacing-20);
            margin-bottom: var(--spacing-16);
            box-shadow: var(--shadow-1);
        }
        
        .order-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-12);
        }
        
        .order-history-header h3 {
            margin: 0;
            font-size: var(--font-size-18);
        }
        
        .order-date {
            color: var(--uber-gray-500);
            font-size: var(--font-size-14);
        }
        
        .order-history-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-16);
        }
        
        .status-badge {
            padding: var(--spacing-4) var(--spacing-12);
            border-radius: var(--radius-24);
            font-size: var(--font-size-12);
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-badge.pending {
            background-color: var(--uber-gray-200);
            color: var(--uber-gray-700);
        }
        
        .status-badge.confirmed {
            background-color: var(--uber-blue);
            color: var(--uber-white);
        }
        
        .status-badge.preparing {
            background-color: var(--uber-yellow);
            color: var(--uber-gray-900);
        }
        
        .status-badge.ready {
            background-color: var(--uber-green);
            color: var(--uber-white);
        }
        
        .status-badge.completed {
            background-color: var(--uber-green-dark);
            color: var(--uber-white);
        }
        
        .status-badge.cancelled {
            background-color: var(--uber-red);
            color: var(--uber-white);
        }
        
        .order-total {
            font-weight: 600;
            font-size: var(--font-size-18);
            color: var(--uber-green);
        }
        
        .order-history-actions {
            display: flex;
            gap: var(--spacing-12);
        }
        
        /* Order Items */
        .order-items {
            margin: var(--spacing-16) 0;
        }
        
        .order-item {
            padding: var(--spacing-12) 0;
            border-bottom: 1px solid var(--uber-gray-200);
        }
        
        .order-item:last-child {
            border-bottom: none;
        }
        
        .order-history-card .order-item-name {
            font-weight: 600;
            margin-bottom: var(--spacing-8);
        }
        
        .order-history-card .order-item-customizations {
            font-size: var(--font-size-14);
            color: var(--uber-gray-600);
            margin-bottom: var(--spacing-8);
        }
        
        .order-item-price-qty {
            display: flex;
            justify-content: space-between;
            font-size: var(--font-size-14);
            flex-direction: column;
            gap: var(--spacing-4);
        }
        
        .order-item-price-qty .price-breakdown {
            color: var(--uber-gray-600);
            font-size: var(--font-size-12);
        }
        
        .order-item-price-qty .price-total {
            display: flex;
            justify-content: space-between;
            font-weight: 600;
            color: var(--uber-gray-900);
        }
        
        .order-summary {
            margin-top: var(--spacing-16);
            padding-top: var(--spacing-16);
            border-top: 1px solid var(--uber-gray-200);
        }
        
        .promo-code-section {
            margin-bottom: var(--spacing-20);
            padding: var(--spacing-16);
            background-color: var(--uber-gray-50);
            border-radius: var(--radius-8);
            border: 1px solid var(--uber-gray-200);
        }
        
        .promo-code-input-group {
            display: flex;
            gap: var(--spacing-8);
            margin-bottom: var(--spacing-12);
        }
        
        .promo-code-input {
            flex: 1;
            padding: var(--spacing-12) var(--spacing-16);
            border: 1px solid var(--uber-gray-300);
            border-radius: var(--radius-8);
            font-size: var(--font-size-16);
            transition: var(--transition-fast);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .promo-code-input:focus {
            outline: none;
            border-color: var(--uber-green);
            box-shadow: 0 0 0 3px rgba(6, 193, 103, 0.2);
        }
        
        .apply-promo-btn {
            padding: var(--spacing-12) var(--spacing-20);
            background-color: var(--uber-green);
            color: var(--uber-white);
            border: none;
            border-radius: var(--radius-8);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            white-space: nowrap;
        }
        
        .apply-promo-btn:hover {
            background-color: var(--uber-green-dark);
        }
        
        .apply-promo-btn:disabled {
            background-color: var(--uber-gray-300);
            cursor: not-allowed;
        }
        
        .promo-code-status {
            font-size: var(--font-size-14);
            padding: var(--spacing-8) var(--spacing-12);
            border-radius: var(--radius-6);
            margin-top: var(--spacing-8);
        }
        
        .promo-code-status.success {
            background-color: rgba(6, 193, 103, 0.1);
            color: var(--uber-green);
            border: 1px solid rgba(6, 193, 103, 0.3);
        }
        
        .promo-code-status.error {
            background-color: rgba(255, 65, 54, 0.1);
            color: var(--uber-red);
            border: 1px solid rgba(255, 65, 54, 0.3);
        }
        
        .applied-promo-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-12) var(--spacing-16);
            background-color: rgba(6, 193, 103, 0.1);
            border: 1px solid rgba(6, 193, 103, 0.3);
            border-radius: var(--radius-8);
            margin-bottom: var(--spacing-12);
        }
        
        .applied-promo-code {
            font-weight: 600;
            color: var(--uber-green);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .remove-promo-btn {
            background: none;
            border: none;
            color: var(--uber-red);
            cursor: pointer;
            font-size: var(--font-size-14);
            padding: var(--spacing-4);
            border-radius: var(--radius-4);
            transition: var(--transition-fast);
        }
        
        .remove-promo-btn:hover {
            background-color: rgba(255, 65, 54, 0.1);
        }
        
        .discount-row {
            color: var(--uber-green);
            font-weight: 600;
        }
        
        /* Order Info */
        .order-info {
            margin-bottom: var(--spacing-16);
        }
        
        .order-info p {
            margin-bottom: var(--spacing-8);
        }
        
        /* ===== ORDER TRACKING ===== */
        .order-items-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-16);
            margin-bottom: var(--spacing-24);
        }
        
        .no-items {
            text-align: center;
            color: var(--uber-gray-600);
            font-style: italic;
            padding: var(--spacing-16);
        }
        
        .order-item-card {
            display: flex;
            background-color: var(--uber-white);
            border-radius: var(--radius-12);
            overflow: hidden;
            box-shadow: var(--shadow-1);
            transition: var(--transition-normal);
        }
        
        .order-item-card:hover {
            box-shadow: var(--shadow-2);
        }
        
        .order-item-image {
            width: 100px;
            height: 100px;
            flex-shrink: 0;
        }
        
        .order-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
                        border-radius: var(--radius-12);
        }
        
        .order-item-content {
            flex: 1;
            padding: var(--spacing-16);
            display: flex;
            flex-direction: column;
        }
        
        .order-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-8);
        }
        
        .order-item-card .order-item-name {
            font-size: var(--font-size-16);
            font-weight: 600;
            color: var(--uber-gray-900);
            margin: 0;
            flex: 1;
        }
        
        .order-item-quantity {
            margin-left: var(--spacing-8);
        }
        
        .quantity-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: var(--uber-green);
            color: var(--uber-white);
            font-size: var(--font-size-12);
            font-weight: 600;
            padding: var(--spacing-4) var(--spacing-8);
            border-radius: var(--radius-full);
            min-width: 24px;
            height: 24px;
        }
        
        .order-item-customizations {
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
            margin-bottom: var(--spacing-12);
            font-size: var(--font-size-14);
            color: var(--uber-gray-600);
        }
        
        .order-item-customizations i {
            color: var(--uber-gray-400);
            font-size: var(--font-size-12);
        }
        
        .order-item-footer {
            margin-top: auto;
        }
        
        .order-item-price {
            font-size: var(--font-size-14);
            color: var(--uber-gray-700);
            font-weight: 500;
        }
        
        .order-actions {
            margin-top: var(--spacing-16);
            text-align: center;
        }
        
        .btn-danger {
            background-color: var(--uber-red);
            color: var(--uber-white);
        }
        
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        
        /* ===== FEEDBACK ===== */
        .feedback-section {
            margin-top: var(--spacing-32);
            padding: var(--spacing-24);
            background-color: var(--uber-white);
            border-radius: var(--radius-12);
            box-shadow: var(--shadow-1);
        }
        
        .rating-stars {
            display: flex;
            gap: var(--spacing-8);
            margin-bottom: var(--spacing-16);
        }
        
        .rating-stars i {
            font-size: var(--font-size-24);
            color: var(--uber-gray-300);
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .rating-stars i.fas {
            color: var(--uber-yellow);
        }
        
        /* ===== QR SCANNER ===== */
        .qr-scanner-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-normal);
        }
        
        .qr-scanner-container.active {
            opacity: 1;
            visibility: visible;
        }
        
        .qr-scanner-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: var(--spacing-16);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .qr-scanner-title {
            color: var(--uber-white);
            font-size: var(--font-size-20);
            font-weight: 600;
        }
        
        .qr-scanner-close {
            background: none;
            border: none;
            color: var(--uber-white);
            font-size: var(--font-size-24);
            cursor: pointer;
        }
        
        .qr-scanner {
            width: 100%;
            max-width: 400px;
            height: 400px;
            background-color: var(--uber-white);
            border-radius: var(--radius-12);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .qr-scanner-placeholder {
            text-align: center;
            padding: var(--spacing-24);
        }
        
        .qr-scanner-placeholder i {
            font-size: var(--font-size-48);
            color: var(--uber-gray-400);
            margin-bottom: var(--spacing-16);
        }
        
        .qr-scanner-placeholder p {
            color: var(--uber-gray-600);
            margin-bottom: var(--spacing-16);
        }
        
        .qr-input-container {
            width: 100%;
            padding: var(--spacing-16);
        }
        
        .qr-input {
            width: 100%;
            padding: var(--spacing-12) var(--spacing-16);
            border: 1px solid var(--uber-gray-300);
            border-radius: var(--radius-8);
            font-size: var(--font-size-16);
        }
        
        /* ===== LANGUAGE SELECTOR ===== */
        .language-selector {
            position: relative;
            display: inline-block;
        }
        
        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--uber-white);
            border: 1px solid var(--uber-gray-300);
            border-radius: var(--radius-8);
            box-shadow: var(--shadow-2);
            min-width: 150px;
            z-index: 1000;
            display: none;
        }
        
        .language-dropdown.show {
            display: block;
        }
        
        .language-option {
            padding: var(--spacing-12) var(--spacing-16);
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-8);
        }
        
        .language-option:hover {
            background-color: var(--uber-gray-100);
        }
        
        .language-option.active {
            background-color: var(--uber-green);
            color: var(--uber-white);
        }
        
        /* ===== MOBILE MENU ===== */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--uber-gray-700);
            width: 48px;
            height: 48px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: var(--radius-8);
            transition: var(--transition-fast);
            position: relative;
            z-index: 1001;
            padding: 0;
        }
        
        .mobile-menu-toggle:hover {
            background-color: var(--uber-gray-100);
            color: var(--uber-green);
        }
        
        .mobile-menu-toggle.active {
            color: var(--uber-green);
        }
        
        .mobile-menu-toggle span {
            display: block;
            width: 24px;
            height: 3px;
            background-color: currentColor;
            margin: 2px 0;
            transition: var(--transition-normal);
            position: relative;
            border-radius: 2px;
        }
        
        .mobile-menu-toggle.active span:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }
        
        .mobile-menu-toggle.active span:nth-child(2) {
            opacity: 0;
            transform: scale(0);
        }
        
        .mobile-menu-toggle.active span:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }
        
        .mobile-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-normal);
        }
        
        .mobile-menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .mobile-menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100vh;
            background-color: var(--uber-white);
            box-shadow: var(--shadow-4);
            z-index: 1000;
            transition: var(--transition-normal);
            overflow-y: auto;
        }
        
        .mobile-menu.active {
            left: 0;
        }
        
        .mobile-menu-header {
            padding: var(--spacing-16);
            border-bottom: 1px solid var(--uber-gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mobile-menu-logo {
            font-size: var(--font-size-20);
            font-weight: 700;
            color: var(--uber-green);
            text-decoration: none;
            display: flex;
            align-items: center;
        }
        
        .mobile-menu-logo i {
            margin-right: var(--spacing-8);
        }
        
        .mobile-menu-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--uber-gray-700);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-8);
            transition: var(--transition-fast);
        }
        
        .mobile-menu-close:hover {
            background-color: var(--uber-gray-100);
            color: var(--uber-green);
        }
        
        .mobile-nav {
            padding: var(--spacing-16) 0;
        }
        
        .mobile-nav-link {
            display: flex;
            align-items: center;
            padding: var(--spacing-16) var(--spacing-20);
            color: var(--uber-gray-700);
            text-decoration: none;
            font-weight: 500;
            font-size: var(--font-size-16);
            transition: var(--transition-fast);
            border-left: 3px solid transparent;
        }
        
        .mobile-nav-link:hover {
            background-color: var(--uber-gray-50);
            color: var(--uber-green);
            border-left-color: var(--uber-green);
        }
        
        .mobile-nav-link.active {
            background-color: var(--uber-gray-50);
            color: var(--uber-green);
            border-left-color: var(--uber-green);
        }
        
        .mobile-nav-link i {
            margin-right: var(--spacing-12);
            font-size: var(--font-size-18);
            width: 24px;
            text-align: center;
        }
        
        .mobile-menu-actions {
            padding: var(--spacing-16);
            border-top: 1px solid var(--uber-gray-200);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-12);
        }
        
        .mobile-language-selector {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-8);
        }
        
        .mobile-language-option {
            display: flex;
            align-items: center;
            padding: var(--spacing-12) var(--spacing-16);
            background-color: var(--uber-gray-50);
            border-radius: var(--radius-8);
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .mobile-language-option:hover {
            background-color: var(--uber-gray-100);
        }
        
        .mobile-language-option.active {
            background-color: var(--uber-green);
            color: var(--uber-white);
        }
        
        .mobile-language-option i {
            margin-right: var(--spacing-12);
            font-size: var(--font-size-16);
        }
        
        /* ===== RESPONSIVE DESIGN ===== */
        
        /* Mobile First - Base Styles */
        @media (max-width: 576px) {
            /* Container & Layout */
            .container {
                padding: 0 var(--spacing-12);
            }
            
            /* ===== MODERN CARD-BASED CATEGORY TABS MOBILE STYLES ===== */
            .category-tabs-container {
                margin-bottom: var(--spacing-16);
                padding: 1px;
                top: 70px;
            }
            
            .category-tabs-container.sticky {
                top: 60px;
            }
            
            .category-tabs {
                gap: var(--spacing-16); /* Increased spacing between buttons */
                padding: var(--spacing-12) 0; /* Added vertical padding for better spacing */
            }
            
            .category-tabs-wrapper {
                padding: var(--spacing-12) var(--spacing-12); /* Increased padding for better spacing */
            }
            
            /* Adjust scroll indicators for mobile */
            .category-tabs-wrapper::before,
            .category-tabs-wrapper::after {
                width: var(--spacing-24);
            }
            
            button.category-tab {
                min-height: auto !important; /* Allow auto height based on content */
                min-width: 90px !important; /* Slightly increased minimum width */
                max-height: none !important; /* Remove max-height constraint */
                padding: var(--spacing-12) var(--spacing-14) !important; /* Increased padding for better spacing */
                overflow: visible !important;
                height: auto !important; /* Allow height to adjust automatically */
            }
            
            button.category-tab .category-icon {
                font-size: var(--font-size-18) !important;
            }
            
            button.category-tab .tab-text {
                font-size: var(--font-size-11);
            }
            
            button.category-tab .item-count {
                min-width: 20px;
                height: 20px;
                font-size: var(--font-size-9);
                top: 8px;
                right: -8px;
                padding: 0 var(--spacing-6);
                border-width: 1.5px;
            }
            
            button.category-tab.active .item-count {
                top: -10px;
                right: -10px;
                min-width: 22px;
                height: 22px;
            }
            
            button.category-tab.new::after {
                top: -8px;
                left: -8px;
                font-size: var(--font-size-8);
                padding: 2px var(--spacing-6);
                border-width: 1.5px;
            }
            
            button.category-tab.active.new::after {
                top: -10px;
                left: -10px;
                padding: 3px var(--spacing-8);
            }
            
            /* Header Styles */
            .header .container {
                height: 56px;
            }
            
            .mobile-menu-toggle {
                display: flex;
            }
            
            .nav {
                display: none;
            }
            
            .header-actions {
                gap: var(--spacing-8);
            }
            
            .mobile-header-actions {
                display: flex;
            }
            
            .btn-icon {
                width: 44px;
                height: 44px;
            }
            
            .cart-toggle .cart-count {
                min-width: 18px;
                height: 18px;
                font-size: var(--font-size-11);
                top: -1px;
                right: -1px;
            }
            
            .logo {
                font-size: var(--font-size-18);
            }
            
            .logo i {
                font-size: var(--font-size-20);
            }
            
            /* Hero Section */
            .hero {
                padding: var(--spacing-40) 0 var(--spacing-32);
                background-attachment: scroll;
                background-position: center center;
            }
            
            .hero h1 {
                font-size: var(--font-size-28);
                line-height: 1.2;
                margin-bottom: var(--spacing-12);
            }
            
            .hero-subtitle {
                font-size: var(--font-size-16);
                line-height: 1.5;
                margin-bottom: var(--spacing-16);
                max-width: 100%;
            }
            
            .hero-dynamic-content {
                min-height: 45px;
                margin-bottom: var(--spacing-20);
            }
            
            .dynamic-tagline {
                font-size: var(--font-size-18);
                margin-bottom: var(--spacing-6);
            }
            
            .featured-dish {
                font-size: var(--font-size-14);
                line-height: 1.4;
            }
            
            .hero-social-proof {
                flex-direction: column;
                gap: var(--spacing-12);
                margin-bottom: var(--spacing-20);
                align-items: center;
            }
            
            .social-proof-item {
                padding: var(--spacing-12) var(--spacing-16);
                min-width: 200px;
                width: 100%;
                max-width: 280px;
                justify-content: center;
            }
            
            .social-proof-text {
                font-size: var(--font-size-14);
            }
            
            .social-proof-number {
                font-size: var(--font-size-16);
            }
            
            .hero-cta {
                width: 100%;
            }
            
            .hero .btn {
                width: 100%;
                padding: var(--spacing-14) var(--spacing-24);
                font-size: var(--font-size-16);
                min-height: 48px;
                border-radius: var(--radius-12);
            }
            
            /* Content Section */
            .content-section {
                padding: var(--spacing-24) var(--spacing-16);
                margin-top: calc(-1 * var(--spacing-12));
                border-radius: var(--radius-8);
            }
            
            .section-title {
                font-size: var(--font-size-24);
                text-align: center;
                margin-bottom: var(--spacing-20);
            }
            
            /* Branches Section */
            .branches-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-16);
            }
            
            .branch-card {
                border-radius: var(--radius-12);
                overflow: hidden;
            }
            
            .branch-image-container {
                aspect-ratio: 4 / 3;
                height: auto;
            }
            
            .branch-content {
                padding: var(--spacing-16);
            }
            
            .branch-header {
                flex-direction: column;
                gap: var(--spacing-8);
                align-items: flex-start;
            }
            
            .branch-title {
                font-size: var(--font-size-18);
            }
            
            .branch-rating {
                margin-left: 0;
                align-self: flex-start;
            }
            
            .branch-stats {
                flex-direction: column;
                gap: var(--spacing-8);
            }
            
            .branch-stat {
                font-size: var(--font-size-14);
            }
            
            .branch-status-badge {
                top: var(--spacing-8);
                right: var(--spacing-8);
                padding: var(--spacing-4) var(--spacing-8);
                font-size: var(--font-size-11);
            }
            
            /* Footer Styles */
            .footer {
                padding: var(--spacing-32) 0 var(--spacing-24);
                background: linear-gradient(180deg, var(--uber-gray-900) 0%, #1a1a1a 100%);
            }
            
            .footer::before {
                height: 3px;
                background: linear-gradient(90deg, var(--uber-green), var(--uber-green-light), var(--uber-green));
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: var(--spacing-20);
                margin-bottom: var(--spacing-24);
            }
            
            .footer-section {
                background: rgba(255, 255, 255, 0.03);
                border-radius: var(--radius-12);
                padding: var(--spacing-20);
                border: 1px solid rgba(255, 255, 255, 0.08);
                backdrop-filter: blur(10px);
            }
            
            .footer-section:hover {
                background: rgba(255, 255, 255, 0.06);
                border-color: var(--uber-green);
                transform: var(--transform-slide-up-small);
            }
            
            .footer-section h3 {
                font-size: var(--font-size-18);
                margin-bottom: var(--spacing-12);
                padding-bottom: var(--spacing-8);
                border-bottom: 1px solid rgba(6, 193, 103, 0.3);
            }
            
            .footer-section h3 i {
                font-size: var(--font-size-16);
            }
            
            .footer-section p,
            .footer-section li {
                font-size: var(--font-size-14);
                line-height: 1.5;
                margin-bottom: var(--spacing-6);
            }
            
            .footer-section ul li {
                margin-bottom: var(--spacing-6);
                padding-left: var(--spacing-12);
            }
            
            .footer-section ul li::before {
                left: 0;
                font-size: var(--font-size-12);
            }
            
            .footer-section a {
                padding: var(--spacing-2) 0;
            }
            
            .social-links {
                justify-content: center;
                gap: var(--spacing-12);
                margin-top: var(--spacing-12);
            }
            
            .social-links a {
                width: 36px;
                height: 36px;
                font-size: var(--font-size-16);
                background: rgba(255, 255, 255, 0.05);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .social-links a:hover {
                background: var(--uber-green);
                transform: var(--transform-slide-up-small);
                box-shadow: 0 2px 8px rgba(6, 193, 103, 0.4);
            }
            
            .business-hours {
                margin-top: var(--spacing-12);
                background: rgba(255, 255, 255, 0.02);
                border-radius: var(--radius-8);
                padding: var(--spacing-10);
                border: 1px solid rgba(255, 255, 255, 0.05);
            }
            
            .business-hours .day {
                font-size: var(--font-size-12);
                margin-bottom: var(--spacing-2);
                padding: var(--spacing-2) 0;
            }
            
            .business-hours .day:last-child {
                margin-bottom: 0;
            }
            
            .business-hours .day .hours {
                font-size: var(--font-size-12);
            }
            
            .business-hours .day.today {
                background: rgba(6, 193, 103, 0.08);
                margin: 0 calc(-1 * var(--spacing-10));
                padding: var(--spacing-2) var(--spacing-10);
            }
            
            .footer-contact-item {
                margin-bottom: var(--spacing-8);
                font-size: var(--font-size-13);
            }
            
            .footer-contact-item i {
                font-size: var(--font-size-14);
            }
            
            .footer-badge {
                font-size: var(--font-size-11);
                padding: var(--spacing-3) var(--spacing-10);
            }
            
            .footer-bottom {
                padding-top: var(--spacing-16);
                font-size: var(--font-size-12);
                background: rgba(0, 0, 0, 0.2);
                margin: 0 calc(-1 * var(--spacing-12));
                padding: var(--spacing-16) var(--spacing-12);
            }
            
            .footer-bottom p {
                line-height: 1.4;
            }
            
            /* Mobile footer animations */
            .footer-section {
                animation: slideUp 0.6s ease-out forwards;
                opacity: 0;
            }
            
            .footer-section:nth-child(1) { animation-delay: 0.1s; }
            .footer-section:nth-child(2) { animation-delay: 0.2s; }
            .footer-section:nth-child(3) { animation-delay: 0.3s; }
            .footer-section:nth-child(4) { animation-delay: 0.4s; }
            
            @keyframes slideUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            /* Mobile footer touch optimization */
            .footer-section:active {
                transform: scale(0.98);
            }
            
            .social-links a:active {
                transform: scale(0.95);
            }
            
            /* Mobile footer divider */
            .footer-section::after {
                content: '';
                display: block;
                height: 1px;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
                margin: var(--spacing-16) 0;
            }
            
            .footer-section:last-child::after {
                display: none;
            }
            
            /* Touch Optimizations */
            .btn-icon:active {
                transform: scale(0.95);
            }
            
            .nav-link:active {
                transform: scale(0.98);
            }
            
            .branch-card:active {
                transform: scale(0.98);
            }
            
            /* Performance Optimizations */
            * {
                -webkit-tap-highlight-color: transparent;
            }
            
            body {
                -webkit-text-size-adjust: 100%;
                -ms-text-size-adjust: 100%;
            }
        }
        
        /* Tablet Styles */
        @media (min-width: 577px) and (max-width: 768px) {
            /* Container & Layout */
            .container {
                padding: 0 var(--spacing-16);
            }
            
            /* Header Styles */
            .header .container {
                height: 60px;
            }
            
            .mobile-menu-toggle {
                display: flex;
            }
            
            .nav {
                display: none;
            }
            
            .mobile-header-actions {
                display: flex;
            }
            
            .logo {
                font-size: var(--font-size-20);
            }
            
            /* Hero Section */
            .hero {
                padding: var(--spacing-60) 0 var(--spacing-48);
            }
            
            .hero h1 {
                font-size: var(--font-size-36);
            }
            
            .hero-subtitle {
                font-size: var(--font-size-18);
                margin-bottom: var(--spacing-20);
            }
            
            .hero-dynamic-content {
                min-height: 50px;
                margin-bottom: var(--spacing-24);
            }
            
            .dynamic-tagline {
                font-size: var(--font-size-22);
            }
            
            .featured-dish {
                font-size: var(--font-size-16);
            }
            
            .hero-social-proof {
                gap: var(--spacing-16);
                margin-bottom: var(--spacing-24);
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .social-proof-item {
                padding: var(--spacing-12) var(--spacing-20);
                min-width: 160px;
            }
            
            .social-proof-text {
                font-size: var(--font-size-14);
            }
            
            .social-proof-number {
                font-size: var(--font-size-18);
            }
            
            .hero .btn {
                padding: var(--spacing-14) var(--spacing-28);
                font-size: var(--font-size-17);
                min-height: 50px;
            }
            
            /* Content Section */
            .content-section {
                padding: var(--spacing-32) var(--spacing-20);
            }
            
            .section-title {
                font-size: var(--font-size-28);
            }
            
            /* Branches Section */
            .branches-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: var(--spacing-20);
            }
            
            /* Footer Styles */
            .footer {
                padding: var(--spacing-40) 0 var(--spacing-32);
            }
            
            .footer-content {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--spacing-32);
            }
            
            .footer-section h3 {
                font-size: var(--font-size-19);
            }
            
            .footer-section p,
            .footer-section li {
                font-size: var(--font-size-15);
            }
            
            .social-links {
                gap: var(--spacing-14);
            }
            
            .business-hours .day {
                font-size: var(--font-size-13);
            }
        }
        
        /* Desktop Styles */
        @media (min-width: 769px) and (max-width: 1024px) {
            /* Header Styles */
            .mobile-menu-toggle {
                display: none;
            }
            
            .nav {
                display: flex;
                gap: var(--spacing-16);
            }
            
            .nav-link {
                font-size: var(--font-size-15);
                padding: var(--spacing-6) 0;
            }
            
            .nav-link i {
                font-size: var(--font-size-16);
                margin-right: var(--spacing-6);
            }
            
            /* Hero Section */
            .hero {
                padding: var(--spacing-80) 0 var(--spacing-64);
            }
            
            .hero h1 {
                font-size: var(--font-size-42);
            }
            
            .hero-subtitle {
                font-size: var(--font-size-19);
            }
            
            .hero-dynamic-content {
                min-height: 55px;
            }
            
            .dynamic-tagline {
                font-size: var(--font-size-26);
            }
            
            .featured-dish {
                font-size: var(--font-size-17);
            }
            
            .hero-social-proof {
                gap: var(--spacing-24);
            }
            
            .social-proof-item {
                padding: var(--spacing-14) var(--spacing-24);
            }
            
            /* Branches Section */
            .branches-grid {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
                gap: var(--spacing-24);
            }
            
            /* Footer Styles */
            .footer-content {
                grid-template-columns: repeat(3, 1fr);
                gap: var(--spacing-36);
            }
        }
        
        /* Large Desktop Styles */
        @media (min-width: 1025px) {
            /* Header Styles */
            .mobile-menu-toggle {
                display: none;
            }
            
            .nav {
                display: flex;
                gap: var(--spacing-24);
            }
            
            /* Hero Section */
            .hero {
                padding: var(--spacing-80) 0 var(--spacing-64);
            }
            
            .hero h1 {
                font-size: var(--font-size-48);
            }
            
            .hero-subtitle {
                font-size: var(--font-size-20);
            }
            
            .hero-dynamic-content {
                min-height: 60px;
            }
            
            .dynamic-tagline {
                font-size: var(--font-size-24);
            }
            
            .featured-dish {
                font-size: var(--font-size-18);
            }
            
            .hero-social-proof {
                gap: var(--spacing-32);
            }
            
            .social-proof-item {
                padding: var(--spacing-12) var(--spacing-20);
            }
            
            /* Footer Styles */
            .footer-content {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: var(--spacing-40);
            }
        }
        
        /* High DPI/Retina Displays */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .hero {
                background-image: url('https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2940&q=80');
            }
        }
        
        /* Landscape Mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            .hero {
                padding: var(--spacing-32) 0 var(--spacing-24);
            }
            
            .hero h1 {
                font-size: var(--font-size-24);
            }
            
            .hero-subtitle {
                font-size: var(--font-size-14);
                margin-bottom: var(--spacing-12);
            }
            
            .hero-dynamic-content {
                min-height: 35px;
                margin-bottom: var(--spacing-16);
            }
            
            .dynamic-tagline {
                font-size: var(--font-size-16);
            }
            
            .featured-dish {
                font-size: var(--font-size-12);
            }
            
            .hero-social-proof {
                gap: var(--spacing-8);
                margin-bottom: var(--spacing-16);
            }
            
            .social-proof-item {
                padding: var(--spacing-6) var(--spacing-12);
                min-width: 100px;
            }
            
            .social-proof-text {
                font-size: var(--font-size-12);
            }
            
            .social-proof-number {
                font-size: var(--font-size-14);
            }
            
            .hero .btn {
                padding: var(--spacing-10) var(--spacing-20);
                font-size: var(--font-size-14);
                min-height: 40px;
            }
        }
        
        /* Enhanced Existing Styles */
        @media (max-width: 768px) {
            .menu-container {
                grid-template-columns: 1fr;
            }
            
            .categories-sidebar {
                position: static;
                margin-bottom: var(--spacing-16);
                padding: var(--spacing-12);
            }
            
            .menu-items-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: var(--spacing-16);
            }
            
            .menu-item-image-container {
                height: 340px;
            }
            
            .order-type-selector {
                grid-template-columns: repeat(3, 1fr);
                gap: var(--spacing-8);
            }
            
            .order-type-btn {
                padding: var(--spacing-8) var(--spacing-4);
                border-radius: var(--radius-8);
            }
            
            .order-type-icon {
                font-size: var(--font-size-20);
                margin-bottom: var(--spacing-4);
            }
            
            .order-type-btn div:last-child {
                font-size: var(--font-size-12);
            }
            
            .fab {
                width: 48px;
                height: 48px;
                font-size: var(--font-size-20);
            }
            
            .branch-card:hover {
                transform: translateY(-4px) scale(1.01);
            }
            
            .cart-item {
                flex-direction: row;
                align-items: flex-start;
                flex-wrap: wrap;
            }
            
            .cart-item-image {
                width: 60px;
                height: 60px;
                margin-right: var(--spacing-12);
                margin-bottom: 0;
            }
            
            .cart-item-details {
                flex: 1;
                display: flex;
                flex-direction: column;
            }
            
            .cart-item-name {
                font-size: var(--font-size-14);
                margin-bottom: var(--spacing-2);
            }
            
            .cart-item-customizations {
                font-size: var(--font-size-12);
                margin-bottom: var(--spacing-6);
            }
            
            .cart-item-price-section {
                gap: var(--spacing-6);
            }
            
            .cart-item-price-breakdown {
                padding: var(--spacing-6) 0;
            }
            
            .cart-item-price-total {
                padding: var(--spacing-6) 0;
            }
            
            .cart-item-price-breakdown .price-breakdown {
                font-size: var(--font-size-12);
            }
            
            .cart-item-price-total .price-total {
                font-size: var(--font-size-14);
            }
            
            .cart-item-actions {
                flex-direction: column;
                justify-content: flex-start;
                align-items: flex-end;
                gap: var(--spacing-8);
                width: auto;
            }
            
            .modal {
                max-width: 100%;
                border-radius: 0;
                height: 100vh;
            }
            
            .modal-header, .modal-body, .modal-footer {
                padding: var(--spacing-16);
            }
            
            .item-image-section {
                height: 250px;
            }
            
            .item-name {
                font-size: var(--font-size-24);
            }
            
            .item-price {
                font-size: var(--font-size-20);
            }
            
            .promotions-grid {
                grid-template-columns: 1fr;
            }
        }
                        
                        
        @media (max-width: 480px) {
                    .menu-item-image-container {
        height: 260px;
    }       
                .item-image-section {
                height: 280px;
            }
                
            .menu-items-grid {
                grid-template-columns: 1fr;
            }
            
            /* ===== MODERN CARD-BASED CATEGORY TABS RESPONSIVE STYLES ===== */
            .category-tabs-container {
                margin-bottom: var(--spacing-16);
                padding: 1px;
                top: 70px;
            }
            
            .category-tabs-container.sticky {
                top: 60px;
            }
            
            .category-tabs {
                gap: var(--spacing-16); /* Increased spacing between buttons */
                
            }
            
            .category-tabs-wrapper {
                padding: var(--spacing-10) var(--spacing-10); /* Increased padding for better spacing */
            }
            
            /* Adjust scroll indicators for responsive */
            .category-tabs-wrapper::before,
            .category-tabs-wrapper::after {
                width: var(--spacing-20);
            }
            
            button.category-tab {
                min-height: auto !important; /* Allow auto height based on content */
                min-width: 85px !important; /* Slightly increased minimum width */
                max-height: none !important; /* Remove max-height constraint */
                padding: var(--spacing-10) var(--spacing-12) !important; /* Increased padding for better spacing */
                overflow: visible !important;
                height: auto !important; /* Allow height to adjust automatically */
            }
            
            button.category-tab .category-icon {
                font-size: var(--font-size-16) !important;
            }
            
            button.category-tab .tab-text {
                font-size: var(--font-size-10);
            }
            
            button.category-tab .item-count {
                min-width: 18px;
                height: 18px;
                font-size: var(--font-size-8);
                top: 10px;
                right: -6px;
                padding: 0 var(--spacing-6);
                border-width: 1.5px;
            }
            
            button.category-tab.active .item-count {
                top: -12px;
                right: -12px;
                min-width: 20px;
                height: 20px;
            }
            
            button.category-tab.new::after {
                top: -10px;
                left: -10px;
                font-size: var(--font-size-7);
                padding: 2px var(--spacing-6);
                border-width: 1.5px;
            }
            
            button.category-tab.active.new::after {
                top: -12px;
                left: -12px;
                padding: 3px var(--spacing-8);
            }
            
            .compact-promotions {
                margin-bottom: var(--spacing-20);
            }
            
            .compact-promotion-card {
                width: 300 px;
                padding: var(--spacing-6) var(--spacing-10);
                min-height: 40px;
            }
            
            .compact-promotion-title {
                font-size: var(--font-size-12);
            }
            
            .compact-promotion-title .promo-icon {
                font-size: var(--font-size-12);
            }
            
            .compact-promotion-description {
                font-size: var(--font-size-10);
                margin-bottom: var(--spacing-2);
            }
            
            .compact-promotion-code {
                font-size: var(--font-size-10);
                padding: var(--spacing-2) var(--spacing-6);
            }
            
            .compact-promotion-validity {
                font-size: var(--font-size-10);
            }
            
            .compact-promotions-nav {
                width: 28px;
                height: 28px;
                font-size: var(--font-size-11);
            }
            
            .menu-search-input-wrapper {
                padding: var(--spacing-2);
            }
            
            .menu-search input {
                padding: var(--spacing-10) var(--spacing-12) var(--spacing-10) var(--spacing-40);
                font-size: var(--font-size-14);
            }
            
            .menu-search-icon {
                left: var(--spacing-12);
                font-size: var(--font-size-14);
            }
            
            .menu-search-clear {
                width: 20px;
                height: 20px;
                right: var(--spacing-8);
                font-size: var(--font-size-10);
            }
            
            .menu-section {
                margin-bottom: var(--spacing-32);
            }
            
            .menu-section-header {
                margin-bottom: var(--spacing-16);
                padding-bottom: var(--spacing-8);
            }
            
            .menu-section-title {
                font-size: var(--font-size-20);
            }
            
            .menu-section-title .section-icon {
                font-size: var(--font-size-16);
            }
            
            .menu-section-subtitle {
                font-size: var(--font-size-12);
            }
            
            .menu-section-items {
                grid-template-columns: 1fr;
                gap: var(--spacing-16);
            }
            
            .menu-section-empty {
                padding: var(--spacing-32) var(--spacing-16);
            }
            
            .menu-section-empty i {
                font-size: var(--font-size-36);
                margin-bottom: var(--spacing-12);
            }
            
            .menu-section-empty h3 {
                font-size: var(--font-size-18);
                margin-bottom: var(--spacing-6);
            }
            
            .menu-section-empty p {
                font-size: var(--font-size-14);
                margin-bottom: var(--spacing-12);
            }
        }
        
        @media (max-width: 768px) {
            .menu-section-items {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: var(--spacing-16);
            }
            
            .category-tab {
                padding: var(--spacing-10) var(--spacing-16);
                font-size: var(--font-size-13);
                min-height: 68px !important;
                max-height: none !important;
                overflow: visible !important;
            }
            
            .menu-mention-content {
                flex-direction: row;
                text-align: left;
            }
        }
        
        @media (max-width: 480px) {
            button.category-tab {
                min-height: 44px !important;
                min-width: 70px !important;
                max-height: 44px !important;
                padding: var(--spacing-4) var(--spacing-8) !important;
                overflow: visible !important;
            }
            
            button.category-tab .category-icon {
                font-size: var(--font-size-14) !important;
            }
            
            button.category-tab .tab-text {
                font-size: var(--font-size-9);
                letter-spacing: 0;
            }
            
            button.category-tab .item-count {
                min-width: 16px;
                height: 16px;
                font-size: var(--font-size-7);
                top: 8px;
                right: -4px;
                padding: 0 var(--spacing-4);
                border-width: 1px;
            }
            
            button.category-tab.active .item-count {
                top: 10px;
                right: -6px;
                min-width: 18px;
                height: 18px;
            }
            
            button.category-tab.new::after {
                top: -8px;
                left: -8px;
                font-size: var(--font-size-7);
                padding: 2px var(--spacing-4);
                border-width: 1px;
            }
            
            button.category-tab.active.new::after {
                top: -10px;
                left: -10px;
                padding: 3px var(--spacing-6);
            }
            
            .category-tabs {
                gap: var(--spacing-16);
            }
            
            .category-tabs-wrapper {
                padding: 0 var(--spacing-6);
            }
            
            /* Adjust scroll indicators for mobile */
            .category-tabs-wrapper::before,
            .category-tabs-wrapper::after {
                width: var(--spacing-16);
            }
        }
        
        @media (max-width: 1024px) {
            .category-tabs-container {
                top: 75px;
            }
            
            .category-tabs-container.sticky {
                top: 64px;
            }
        }
    </style>
</head>
<body>
    <!-- App Container -->
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <a href="#home" class="logo">
                    <i class="fas fa-moon"></i>
                    <span data-translate="app_name">Luna Dine</span>
                </a>
                <nav class="nav">
                    <a href="#home" class="nav-link" data-view="home">
                        <i class="fas fa-home"></i>
                        <span data-translate="nav_home">Home</span>
                    </a>
                    <a href="#menu" class="nav-link" data-view="menu">
                        <i class="fas fa-utensils"></i>
                        <span data-translate="nav_menu">Menu</span>
                    </a>
                    <a href="#favorites" class="nav-link" data-view="favorites">
                        <i class="fas fa-heart"></i>
                        <span data-translate="nav_favorites">Favorites</span>
                    </a>
                    <a href="#orders" class="nav-link" data-view="orders">
                        <i class="fas fa-receipt"></i>
                        <span data-translate="nav_orders">My Orders</span>
                    </a>
                </nav>
                <div class="header-actions">
                    <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    <div class="mobile-header-actions">
                        <button id="mobile-favorites-toggle" class="btn-icon" title="Favorites">
                            <i class="fas fa-heart"></i>
                        </button>
                        <button id="mobile-orders-toggle" class="btn-icon" title="Order History">
                            <i class="fas fa-receipt"></i>
                        </button>
                    </div>
                    <div class="language-selector">
                        <button id="language-toggle" class="btn-icon">
                            <i class="fas fa-globe"></i>
                        </button>
                        <div class="language-dropdown" id="language-dropdown">
                            <div class="language-option active" data-lang="en-US">
                                <i class="fas fa-flag-usa"></i>
                                <span>English</span>
                            </div>
                            <div class="language-option" data-lang="bn-BD">
                                <i class="fas fa-flag"></i>
                                <span>বাংলা</span>
                            </div>
                        </div>
                    </div>
                    <button id="cart-toggle" class="btn-icon cart-toggle">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count">0</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Mobile Menu -->
        <div class="mobile-menu-overlay" id="mobile-menu-overlay"></div>
        <nav class="mobile-menu" id="mobile-menu">
            <div class="mobile-menu-header">
                <a href="#home" class="mobile-menu-logo">
                    <i class="fas fa-moon"></i>
                    <span data-translate="app_name">Luna Dine</span>
                </a>
                <button class="mobile-menu-close" id="mobile-menu-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mobile-nav">
                <a href="#home" class="mobile-nav-link" data-view="home">
                    <i class="fas fa-home"></i>
                    <span data-translate="nav_home">Home</span>
                </a>
                <a href="#menu" class="mobile-nav-link" data-view="menu">
                    <i class="fas fa-utensils"></i>
                    <span data-translate="nav_menu">Menu</span>
                </a>
                <a href="#favorites" class="mobile-nav-link" data-view="favorites">
                    <i class="fas fa-heart"></i>
                    <span data-translate="nav_favorites">Favorites</span>
                </a>
                <a href="#orders" class="mobile-nav-link" data-view="orders">
                    <i class="fas fa-receipt"></i>
                    <span data-translate="nav_orders">My Orders</span>
                </a>
            </div>
            <div class="mobile-menu-actions">
                <div class="mobile-language-selector">
                    <div class="mobile-language-option active" data-lang="en-US">
                        <i class="fas fa-flag-usa"></i>
                        <span>English</span>
                    </div>
                    <div class="mobile-language-option" data-lang="bn-BD">
                        <i class="fas fa-flag"></i>
                        <span>বাংলা</span>
                    </div>
                </div>
            </div>
        </nav>
        <!-- Main Content Area -->
        <main id="main-content">
            <!-- Home View -->
            <section id="home-view" class="view">
                <div class="hero">
                    <div class="container hero-content">
                        <h1 data-translate="welcome">Welcome to Luna Dine</h1>
                        <p class="hero-subtitle" data-translate="hero_subtitle">Experience culinary excellence under the moonlight. Enjoy carefully crafted dishes that blend tradition and innovation.</p>
                        
                        <div class="hero-dynamic-content">
                            <div class="dynamic-tagline" id="dynamic-tagline">Taste the Moonlight Magic</div>
                            <div class="featured-dish" id="featured-dish">Chef's Special: Grilled Salmon with Herbs</div>
                        </div>
                        
                        <div class="hero-social-proof">
                            <div class="social-proof-item">
                                <i class="fas fa-users"></i>
                                <div>
                                    <div class="social-proof-number">1000+</div>
                                    <div class="social-proof-text">Happy Customers</div>
                                </div>
                            </div>
                            <div class="social-proof-item">
                                <i class="fas fa-star"></i>
                                <div>
                                    <div class="social-proof-number">4.8</div>
                                    <div class="social-proof-text">Customer Rating</div>
                                </div>
                            </div>
                            <div class="social-proof-item">
                                <i class="fas fa-utensils"></i>
                                <div>
                                    <div class="social-proof-number">50+</div>
                                    <div class="social-proof-text">Signature Dishes</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="hero-cta">
                            <a href="#menu" class="btn">
                                <span data-translate="view_menu">View Menu</span>
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="container content-section">
                    <h2 class="section-title" data-translate="our_branches">Our Branches</h2>
                    <div class="branches-grid" id="branches-container">
                        <!-- Branches will be dynamically loaded here -->
                    </div>
                </div>
            </section>
            <!-- Menu View -->
            <section id="menu-view" class="view">
                <!-- Featured Branch Cover Section -->
                <div class="branch-cover-section" id="featured-branch-section">
                    <div class="branch-cover-container skeleton" id="branch-cover-container">
                        <div class="branch-cover-wrapper">
                            <div class="branch-cover-image" id="featured-branch-cover">
                            </div>
                            <div class="branch-logo-container skeleton" id="featured-branch-logo-container">
                                <div class="branch-logo" id="featured-branch-logo">
                                    <img src="" alt="Branch Logo" class="branch-logo-img" id="featured-branch-logo-img">
                                </div>
                            </div>
                        </div>
                        <div class="branch-info">
                            <h3 class="branch-name" id="featured-branch-name">
                                <span class="skeleton-text">Loading featured branch...</span>
                            </h3>
                            <p class="branch-description" id="featured-branch-description">
                                <span class="skeleton-text">Discover our signature dishes and exceptional service</span>
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="container">
                    <div class="menu-items-container">
                        <!-- Compact Promotions Section -->
                        <div class="compact-promotions" id="compact-promotions">
                            <!-- Promotions will be dynamically loaded here -->
                        </div>
                        
                        <div class="menu-search-advanced">
                            <div class="menu-search-input-wrapper">
                                <i class="fas fa-search menu-search-icon"></i>
                                <input type="text" id="menu-search" class="menu-search" data-translate-placeholder="search_menu" placeholder="Search menu items...">
                                <button class="menu-search-clear" id="menu-search-clear" type="button">
                                    <i class="fas fa-times"></i>
                                </button>
                                <button class="menu-search-filter-toggle" id="menu-search-filter-toggle" type="button">
                                    <i class="fas fa-sliders-h"></i>
                                </button>
                            </div>
                            
                            <!-- Compact Advanced Filters Panel -->
                            <div class="menu-search-filters-panel" id="menu-search-filters-panel">
                                <div class="filters-container">
                                    <!-- Price Range Filter -->
                                    <div class="filter-group compact">
                                        <label class="filter-label">
                                            <i class="fas fa-money-bill-wave"></i>
                                            <span data-translate="price_range">Price Range</span>
                                        </label>
                                        <div class="price-range-compact">
                                            <div class="price-inputs-row">
                                                <input type="number" id="price-min" placeholder="Min" min="0" step="10">
                                                <span class="price-separator">-</span>
                                                <input type="number" id="price-max" placeholder="Max" min="0" step="10">
                                                <span class="currency-symbol">৳</span>
                                            </div>
                                            <div class="price-presets-compact">
                                                <button class="price-preset" data-min="0" data-max="150">৳0-150</button>
                                                <button class="price-preset" data-min="150" data-max="300">৳150-300</button>
                                                <button class="price-preset" data-min="300" data-max="500">৳300-500</button>
                                                <button class="price-preset" data-min="500" data-max="9999">৳500+</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Rating & Spice Row -->
                                    <div class="filter-row">
                                        <!-- Rating Filter -->
                                        <div class="filter-group compact half">
                                            <label class="filter-label">
                                                <i class="fas fa-star"></i>
                                                <span data-translate="rating">Rating</span>
                                            </label>
                                            <div class="rating-compact">
                                                <button class="rating-option" data-rating="0">
                                                    <span>All</span>
                                                </button>
                                                <button class="rating-option" data-rating="4">
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <span>4+</span>
                                                </button>
                                                <button class="rating-option" data-rating="3">
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <span>3+</span>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- Spice Level Filter -->
                                        <div class="filter-group compact half">
                                            <label class="filter-label">
                                                <i class="fas fa-pepper-hot"></i>
                                                <span data-translate="spice_level">Spice</span>
                                            </label>
                                            <div class="spice-compact">
                                                <button class="spice-option" data-spice="0">
                                                    <span>Any</span>
                                                </button>
                                                <button class="spice-option" data-spice="1">
                                                    <span style="color: #90EE90;">●</span>
                                                    <span>Mild</span>
                                                </button>
                                                <button class="spice-option" data-spice="2">
                                                    <span style="color: #FFD700;">●</span>
                                                    <span>Medium</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Dietary Preferences Filter -->
                                    <div class="filter-group compact">
                                        <label class="filter-label">
                                            <i class="fas fa-leaf"></i>
                                            <span data-translate="dietary">Dietary</span>
                                        </label>
                                        <div class="dietary-compact">
                                            <label class="dietary-option">
                                                <input type="checkbox" value="vegetarian">
                                                <i class="fas fa-leaf"></i>
                                                <span data-translate="vegetarian">Veg</span>
                                            </label>
                                            <label class="dietary-option">
                                                <input type="checkbox" value="vegan">
                                                <i class="fas fa-seedling"></i>
                                                <span data-translate="vegan">Vegan</span>
                                            </label>
                                            <label class="dietary-option">
                                                <input type="checkbox" value="gluten-free">
                                                <i class="fas fa-bread-slice"></i>
                                                <span data-translate="gluten_free">GF</span>
                                            </label>
                                            <label class="dietary-option">
                                                <input type="checkbox" value="dairy-free">
                                                <i class="fas fa-cheese"></i>
                                                <span data-translate="dairy_free">DF</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <!-- Filter Actions -->
                                    <div class="filter-actions-compact">
                                        <button class="btn btn-apply-filters" id="apply-filters">
                                            <i class="fas fa-check"></i>
                                            <span data-translate="apply_filters">Apply</span>
                                        </button>
                                        <button class="btn btn-clear-filters" id="clear-filters">
                                            <i class="fas fa-times"></i>
                                            <span data-translate="clear_all">Clear</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        
                        <!-- Sticky Category Tabs Section -->
                        <div class="category-tabs-container" id="category-tabs-container">
                            <div class="category-tabs-wrapper">
                                <div class="category-tabs" id="category-tabs">
                                    <!-- Category tabs will be dynamically loaded here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Main Content Area -->
                        <div class="menu-content-area" id="menu-content-area">
                            <!-- Menu sections will be dynamically loaded here -->
                        </div>
                        
                        <!-- Keep existing promotions container -->
                        <div class="promotions-container" id="promotions-container" style="display: none;">
                            <h3 data-translate="special_offers">Special Offers</h3>
                            <div class="promotions-grid" id="promotions-grid">
                                <!-- Promotions will be dynamically loaded here -->
                            </div>
                        </div>
                        
                        <!-- Keep existing menu items grid as fallback -->
                        <div class="menu-items-grid" id="menu-items-container" style="display: none;">
                            <!-- Menu items will be dynamically loaded here -->
                        </div>
                    </div>
                </div>
            </section>
            <!-- Cart View -->
            <section id="cart-view" class="view">
                <div class="container">
                    <h2 class="section-title" id="cart-branch-name" data-translate="your_cart">Your Cart</h2>
                    
                    <div class="cart-container" id="cart-container">
                        <!-- Cart items will be dynamically loaded here -->
                    </div>
                </div>
            </section>
            <!-- Checkout View -->
            <section id="checkout-view" class="view">
                <div class="container">
                    <h2 class="section-title" id="checkout-branch-name" data-translate="checkout">Checkout</h2>
                    
                    <div class="checkout-container">
                        <div class="checkout-steps">
                            <div class="step active" data-step="1">
                                <span>1</span>
                                <div class="step-label" data-translate="order_type">Order Type</div>
                            </div>
                            <div class="step" data-step="2">
                                <span>2</span>
                                <div class="step-label" data-translate="details">Details</div>
                            </div>
                            <div class="step" data-step="3">
                                <span>3</span>
                                <div class="step-label" data-translate="payment">Payment</div>
                            </div>
                        </div>
                        
                        <div class="checkout-form" id="checkout-form">
                            <!-- Checkout form will be dynamically loaded here -->
                        </div>
                        
                        <!-- Order Summary -->
                        <div class="order-summary" id="checkout-order-summary">
                            <!-- Order summary will be dynamically loaded here -->
                        </div>
                    </div>
                </div>
            </section>
            <!-- Order Tracking View -->
            <section id="order-tracking-view" class="view">
                <div class="container">
                    <h2 class="section-title" data-translate="order_tracking">Order Tracking</h2>
                    
                    <div class="order-tracking-container" id="order-tracking-container">
                        <!-- Order tracking will be dynamically loaded here -->
                    </div>
                </div>
            </section>
            <!-- Orders View -->
            <section id="orders-view" class="view">
                <div class="container">
                    <h2 class="section-title" data-translate="order_history">Order History</h2>
                    
                    <div class="order-history-container" id="order-history-container">
                        <!-- Order history will be dynamically loaded here -->
                    </div>
                </div>
            </section>
            <!-- Favorites View -->
            <section id="favorites-view" class="view">
                <div class="container">
                    <h2 class="section-title" data-translate="your_favorites">Your Favorites</h2>
                    
                    <div class="favorites-container" id="favorites-container">
                        <!-- Favorites will be dynamically loaded here -->
                    </div>
                </div>
            </section>
        </main>
        
        <!-- Footer Section -->
        <footer class="footer" id="footer">
            <div class="container">
                <div class="footer-content" id="footer-content">
                    <!-- Footer content will be dynamically loaded here -->
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2024 <span id="footer-restaurant-name">Luna Dine</span>. All rights reserved.</p>
                </div>
            </div>
        </footer>
        
        <!-- Floating Action Buttons -->
        <div class="fab-container">
            <button id="qr-scanner-btn" class="fab">
                <i class="fas fa-qrcode"></i>
            </button>
            <button id="service-request-btn" class="fab">
                <i class="fas fa-concierge-bell"></i>
            </button>
            <button id="cart-fab" class="fab cart-fab">
                <i class="fas fa-shopping-cart"></i>
                <span class="cart-count">0</span>
            </button>
        </div>
        <!-- Item Detail Modal -->
        <div class="modal-overlay" id="item-detail-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title" data-translate="item_details">Item Details</h3>
                    <button class="modal-close" data-modal="item-detail-modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="item-detail-content">
                    <!-- Item details will be dynamically loaded here -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" id="add-to-cart-detail-btn" data-translate="add_to_cart">Add to Cart</button>
                </div>
            </div>
        </div>
        <!-- Service Modal -->
        <div class="modal-overlay" id="service-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title" data-translate="request_service">Request Service</h3>
                    <button class="modal-close" data-modal="service-modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label" data-translate="request_type">Request Type</label>
                        <select class="form-select" id="request-type">
                            <option value="CALL_WAITER" data-translate="call_waiter">Call Waiter</option>
                            <option value="REQUEST_BILL" data-translate="request_bill">Request Bill</option>
                            <option value="CLEANING_ASSISTANCE" data-translate="cleaning_assistance">Cleaning Assistance</option>
                            <option value="OTHER" data-translate="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group" id="other-request-container" style="display: none;">
                        <label class="form-label" data-translate="please_specify">Please specify</label>
                        <input type="text" class="form-input" id="other-request" data-translate-placeholder="specify_request" placeholder="Please specify your request">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn" id="submit-request-btn" data-translate="submit_request">Submit Request</button>
                </div>
            </div>
        </div>
        <!-- QR Scanner Modal -->
        <div class="qr-scanner-container" id="qr-scanner-container">
            <div class="qr-scanner-header">
                <h3 class="qr-scanner-title" data-translate="scan_table_qr">Scan Table QR Code</h3>
                <button class="qr-scanner-close" id="qr-scanner-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="qr-scanner">
                <div class="qr-scanner-placeholder">
                    <i class="fas fa-qrcode"></i>
                    <p data-translate="scan_qr_instruction">Point your camera at the QR code on your table</p>
                    <div class="qr-input-container">
                        <input type="text" class="qr-input" id="qr-code-input" data-translate-placeholder="enter_qr_code" placeholder="Or enter QR code manually">
                        <button class="btn" id="qr-code-submit" data-translate="submit">Submit</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Confirmation Modal -->
        <div class="modal-overlay" id="confirmation-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title" data-translate="confirm_action">Confirm Action</h3>
                    <button class="modal-close" data-modal="confirmation-modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="confirmation-message"></p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" id="confirmation-cancel-btn" data-translate="cancel">Cancel</button>
                    <button class="btn btn-danger" id="confirmation-confirm-btn" data-translate="confirm">Confirm</button>
                </div>
            </div>
        </div>
        
        <!-- Branch Conflict Alert Modal -->
        <div class="modal-overlay" id="branch-conflict-modal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title" data-translate="branch_conflict">Branch Conflict</h3>
                    <button class="modal-close" data-modal="branch-conflict-modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="branch-conflict-message" data-translate="branch_conflict_message">You have items in the cart from another branch. Adding this item will clear the existing items in the cart.</p>
                    <div class="conflict-details">
                        <p><strong data-translate="current_cart_branch">Current Cart Branch:</strong> <span id="current-branch-name"></span></p>
                        <p><strong data-translate="new_item_branch">New Item Branch:</strong> <span id="new-branch-name"></span></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" id="branch-conflict-cancel-btn" data-translate="cancel">Cancel</button>
                    <button class="btn btn-danger" id="branch-conflict-confirm-btn" data-translate="clear_and_add">Clear & Add</button>
                </div>
            </div>
        </div>
        
        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loading-overlay">
            <div class="spinner"></div>
        </div>
    </div>
    <script>
        // Main application module
        const LunaDineApp = (() => {
            // State management
            const state = {
                currentView: 'home',
                currentBranch: null,
                currentTable: null,
                cart: [],
                branchCarts: {}, // Store separate carts for different branches
                favorites: [],
                orderHistory: [],
                language: 'en-US',
                userInfo: null,
                serviceRequests: [],
                menuData: null,
                branches: [],
                categories: [],
                promotions: [],
                currentOrder: null,
                currentItem: null,
                currentQuantity: 1,
                currentCustomizations: {},
                currentRating: 0,
                appliedPromo: null, // { code, type, value, discount_amount }
                restaurantDetails: null, // Restaurant details for footer
                pendingCartItem: null, // For branch conflict resolution
                translations: {
                    'en-US': {
                        'app_name': 'Luna Dine',
                        'nav_home': 'Home',
                        'nav_menu': 'Menu',
                        'nav_favorites': 'Favorites',
                        'nav_orders': 'My Orders',
                        'welcome': 'Welcome to Luna Dine',
                        'hero_subtitle': 'Experience culinary excellence under the moonlight. Enjoy carefully crafted dishes that blend tradition and innovation.',
                        'view_menu': 'View Menu',
                        'our_branches': 'Our Branches',
                        'menu': 'Menu',
                        'your_cart': 'Your Cart',
                        'checkout': 'Checkout',
                        'your_favorites': 'Your Favorites',
                        'order_tracking': 'Order Tracking',
                        'order_history': 'Order History',
                        'add_to_cart': 'Add to Cart',
                        'proceed_to_checkout': 'Proceed to Checkout',
                        'place_order': 'Place Order',
                        'promo_code': 'Promo Code',
                        'apply_promo': 'Apply',
                        'remove': 'Remove',
                        'promo_applied': 'Promo code applied successfully!',
                        'promo_invalid': 'Invalid promo code',
                        'promo_expired': 'Promo code has expired',
                        'promo_usage_limit': 'Promo code usage limit exceeded',
                        'promo_not_active': 'Promo code is not yet active',
                        'min_order_not_met': 'Minimum order value not met',
                        'please_select_branch': 'Please select a branch first',
                        'discount': 'Discount',
                        'order_summary': 'Order Summary',
                        'empty_cart': 'Your cart is empty',
                        'empty_favorites': 'Your favorites will appear here',
                        'remove_from_favorites': 'Remove from favorites',
                        'browse_menu': 'Browse Menu',
                        'item_added': 'Item added to cart',
                        'language_changed': 'Language changed to English',
                        'item_details': 'Item Details',
                        'request_service': 'Request Service',
                        'request_type': 'Request Type',
                        'call_waiter': 'Call Waiter',
                        'request_bill': 'Request Bill',
                        'cleaning_assistance': 'Cleaning Assistance',
                        'other': 'Other',
                        'please_specify': 'Please specify',
                        'specify_request': 'Please specify your request',
                        'submit_request': 'Submit Request',
                        'order_type': 'Order Type',
                        'details': 'Details',
                        'payment': 'Payment',
                        'branch': 'Branch',
                        'dine_in': 'Dine In',
                        'takeaway': 'Takeaway',
                        'delivery': 'Delivery',
                        'table_number': 'Table Number',
                        'select_table': 'Select a table',
                        'guests_count': 'Number of Guests',
                        'pickup_time': 'Pickup Time',
                        'your_name': 'Your Name',
                        'phone_number': 'Phone Number',
                        'delivery_address': 'Delivery Address',
                        'payment_method': 'Payment Method',
                        'cash': 'Cash',
                        'card': 'Card',
                        'mobile_payment': 'Mobile Payment',
                        'special_instructions': 'Special Instructions',
                        'any_requests': 'Any special requests?',
                        'search_menu': 'Search menu items...',
                        'order_not_found': 'Order Not Found',
                        'order_not_found_message': 'The order you are looking for could not be found.',
                        'view_order_history': 'View Order History',
                        'no_orders': 'No Orders Yet',
                        'no_orders_message': 'You haven\'t placed any orders yet.',
                        'placed_at': 'Placed At',
                        'order_items': 'Order Items',
                        'view_details': 'View Details',
                        'cancel_order': 'Cancel Order',
                        'confirm_action': 'Confirm Action',
                        'confirm': 'Confirm',
                        'cancel': 'Cancel',
                        'delivery_charge': 'Delivery Charge',
                        'pending': 'Pending',
                        'confirmed': 'Confirmed',
                        'preparing': 'Preparing',
                        'ready': 'Ready',
                        'completed': 'Completed',
                        'cancelled': 'Cancelled',
                        'add_some_delicious_items': 'Add some delicious items to your cart.',
                        'delicious_menu_item': 'Delicious menu item',
                        'delicious_menu_item_description': 'A delicious menu item prepared with care.',
                        'start_adding_favorites': 'Start adding your favorite items to see them here.',
                        'about_us': 'About Us',
                        'contact_us': 'Contact Us',
                        'business_hours': 'Business Hours',
                        'quick_links': 'Quick Links',
                        'privacy_policy': 'Privacy Policy',
                        'terms_of_service': 'Terms of Service',
                        'footer_default_description': 'Experience culinary excellence under the moonlight. Luna Dine offers a unique dining experience with carefully crafted dishes that blend tradition and innovation.',
                        'footer_default_tagline': 'Dine Under the Stars',
                        'footer_default_address': 'House 15, Road 7, Dhanmondi, Dhaka-1205, Bangladesh',
                        'footer_default_phone': '+8801234567890',
                        'footer_default_email': 'hello@lunadine.com',
                        'monday': 'Monday',
                        'tuesday': 'Tuesday',
                        'wednesday': 'Wednesday',
                        'thursday': 'Thursday',
                        'friday': 'Friday',
                        'saturday': 'Saturday',
                        'sunday': 'Sunday',
                        'branch_conflict': 'Branch Conflict',
                        'branch_conflict_message': 'You have items in the cart from another branch. Adding this item will clear the existing items in the cart.',
                        'current_cart_branch': 'Current Cart Branch:',
                        'new_item_branch': 'New Item Branch:',
                        'clear_and_add': 'Clear & Add',
                        'item_branch_not_available': 'Item branch information not available',
                        'branch_not_found': 'Branch not found for this item',
                        'order_placed_success': 'Order placed successfully!',
                        'order_failed': 'Failed to place order. Please try again.',
                        'service_request_submitted': 'Service request submitted successfully.',
                        'customized': 'Customized',
                        'confirm_cancel_order': 'Are you sure you want to cancel this order?',
                        'order_cancelled_success': 'Order cancelled successfully',
                        'cancel_order_failed': 'Failed to cancel order. Please try again.',
                        'mins': 'mins',
                        'table': 'Table',
                        'special_offers': 'Special Offers',
                        'scan_table_qr': 'Scan Table QR Code',
                        'scan_qr_instruction': 'Point your camera at the QR code on your table',
                        'enter_qr_code': 'Or enter QR code manually',
                        'submit': 'Submit',
                        'invalid_qr_code': 'Invalid QR code. Please try again.',
                        'table_selected': 'Table selected: {table}',
                        'rate_your_experience': 'Rate Your Experience',
                        'share_your_experience': 'Share your experience with us',
                        'submit_feedback': 'Submit Feedback',
                        'please_select_rating': 'Please select a rating',
                        'feedback_submitted': 'Feedback submitted successfully',
                        'feedback_submission_failed': 'Failed to submit feedback. Please try again.',
                        'service_quality': 'Service Quality',
                        'food_quality': 'Food Quality',
                        'ambiance': 'Ambiance',
                        'value_for_money': 'Value for Money',
                        'would_recommend': 'Would you recommend us to others?',
                        'yes': 'Yes',
                        'no': 'No',
                        'branch_settings': 'Branch Settings',
                        'vat_percentage': 'VAT Percentage',
                        'service_charge_percentage': 'Service Charge Percentage',
                        'loading_branches': 'Loading branches...',
                        'loading_menu': 'Loading menu...',
                        'loading_promotions': 'Loading promotions...',
                        'loading_order': 'Loading order...',
                        'loading_tables': 'Loading tables...',
                        'loading_feedback': 'Loading feedback...',
                        'unknown_branch': 'Unknown Branch',
                        'all_items': 'All Items',
                        'no_items_found': 'No items found',
                        'try_different_category': 'Try selecting a different category',
                        'view_all_items': 'View All Items',
                        // Enhanced Order Tracking Translations
                        'current_status': 'Current Status',
                        'estimated_time': 'Estimated Time',
                        'served': 'Served',
                        'ready_for_pickup': 'Ready for Pickup',
                        'picked_up': 'Picked Up',
                        'ready_for_delivery': 'Ready for Delivery',
                        'out_for_delivery': 'Out for Delivery',
                        'delivered': 'Delivered',
                        'server': 'Server',
                        'dining_duration': 'Dining Duration',
                        'served_at': 'Served At',
                        'pickup_counter': 'Pickup Counter',
                        'picked_up_at': 'Picked Up At',
                        'pickup_instructions': 'Pickup Instructions',
                        'driver': 'Driver',
                        'driver_phone': 'Driver Phone',
                        'estimated_delivery': 'Estimated Delivery',
                        'delivered_at': 'Delivered At',
                        'delivery_instructions': 'Delivery Instructions',
                        'request_assistance': 'Request Assistance',
                        'add_items': 'Add Items',
                        'update_pickup_time': 'Update Pickup Time',
                        'notify_ready': 'Notify When Ready',
                        'contact_driver': 'Contact Driver',
                        'track_delivery': 'Track Delivery',
                        'update_address': 'Update Address',
                        'order_timeline': 'Order Timeline',
                        'select_rating': 'Select Rating',
                        'select': 'Select'
                    },
                    'bn-BD': {
                        'app_name': 'লুনা ডাইন',
                        'nav_home': 'হোম',
                        'nav_menu': 'মেনু',
                        'nav_favorites': 'পছন্দসমূহ',
                        'nav_orders': 'আমার অর্ডারসমূহ',
                        'welcome': 'লুনা ডাইনেতে স্বাগতম',
                        'hero_subtitle': 'চাঁদের আলোয় রন্ধন শৈলীর অভিজ্ঞতা উপভোগ করুন। ঐতিহ্য এবং উদ্ভাবনার মিশ্রণে তৈরি সাবধানভাবে প্রস্তুত খাবার উপভোগ করুন।',
                        'view_menu': 'মেনু দেখুন',
                        'our_branches': 'আমাদের শাখাসমূহ',
                        'menu': 'মেনু',
                        'your_cart': 'আপনার কার্ট',
                        'checkout': 'চেকআউট',
                        'your_favorites': 'আপনার পছন্দসমূহ',
                        'order_tracking': 'অর্ডার ট্র্যাকিং',
                        'order_history': 'অর্ডার ইতিহাস',
                        'add_to_cart': 'কার্টে যোগ করুন',
                        'proceed_to_checkout': 'চেকআউট করতে এগিয়ান',
                        'place_order': 'অর্ডার দিন',
                        'promo_code': 'প্রমো কোড',
                        'apply_promo': 'প্রয়োগ করুন',
                        'remove': 'সরান',
                        'promo_applied': 'প্রমো কোড সফলভাবে প্রয়োগ করা হয়েছে!',
                        'promo_invalid': 'অবৈধ প্রমো কোড',
                        'promo_expired': 'প্রমো কোডের মেয়াদ শেষ হয়েছে',
                        'promo_usage_limit': 'প্রমো কোড ব্যবহারের সীমা অতিক্রান্ত হয়েছে',
                        'promo_not_active': 'প্রমো কোড এখনও সক্রিয় নয়',
                        'min_order_not_met': 'ন্যূনতম অর্ডার মান পূরণ হয়নি',
                        'please_select_branch': 'অনুগ্রহ করে প্রথমে একটি শাখা নির্বাচন করুন',
                        'discount': 'ছাড়',
                        'order_summary': 'অর্ডার সারাংশ',
                        'empty_cart': 'আপনার কার্ট খালি',
                        'empty_favorites': 'আপনার পছন্দসমূহ এখানে প্রদর্শিত হবে',
                        'remove_from_favorites': 'পছন্দ তালিকা থেকে সরান',
                        'browse_menu': 'মেনু ব্রাউজ করুন',
                        'item_added': 'আইটেম কার্টে যোগ করা হয়েছে',
                        'language_changed': 'ভাষা বাংলায় পরিবর্তন করা হয়েছে',
                        'item_details': 'আইটেমের বিবরণ',
                        'request_service': 'পরিষেবা অনুরোধ করুন',
                        'request_type': 'অনুরোধের ধরণ',
                        'call_waiter': 'ওয়েটার ডাকুন',
                        'request_bill': 'বিল চাই',
                        'cleaning_assistance': 'পরিষ্কার সহায়তা',
                        'other': 'অন্যান্য',
                        'please_specify': 'অনুগ্রহ করে উল্লেখ করুন',
                        'specify_request': 'আপনার অনুরোধটি অনুগ্রহ করে উল্লেখ করুন',
                        'submit_request': 'অনুরোধ জমা দিন',
                        'order_type': 'অর্ডারের ধরণ',
                        'details': 'বিবরণ',
                        'payment': 'পেমেন্ট',
                        'branch': 'শাখা',
                        'dine_in': 'ডাইন ইন',
                        'takeaway': 'টেকঅওয়ে',
                        'delivery': 'ডেলিভারি',
                        'table_number': 'টেবিল নম্বর',
                        'select_table': 'একটি টেবিল নির্বাচন করুন',
                        'guests_count': 'অতিথির সংখ্যা',
                        'pickup_time': 'পিকআপ সময়',
                        'your_name': 'আপনার নাম',
                        'phone_number': 'ফোন নম্বর',
                        'delivery_address': 'ডেলিভারি ঠিকানা',
                        'payment_method': 'পেমেন্ট পদ্ধতি',
                        'cash': 'নগদ',
                        'card': 'কার্ড',
                        'mobile_payment': 'মোবাইল পেমেন্ট',
                        'special_instructions': 'বিশেষ নির্দেশাবলী',
                        'any_requests': 'কোনো বিশেষ অনুরোধ?',
                        'search_menu': 'মেনু আইটেম খুঁজুন...',
                        'order_not_found': 'অর্ডার পাওয়া যায়নি',
                        'order_not_found_message': 'আপনি যে অর্ডারটি খুঁজছেন তা পাওয়া যায়নি।',
                        'view_order_history': 'অর্ডার ইতিহাস দেখুন',
                        'no_orders': 'এখনও কোনো অর্ডার নেই',
                        'no_orders_message': 'আপনি এখনও কোনো অর্ডার করেননি।',
                        'placed_at': 'স্থাপন করা হয়েছে',
                        'order_items': 'অর্ডার আইটেম',
                        'view_details': 'বিবরণ দেখুন',
                        'cancel_order': 'অর্ডার বাতিল করুন',
                        'confirm_action': 'ক্রিয়া নিশ্চিত করুন',
                        'confirm': 'নিশ্চিত করুন',
                        'cancel': 'বাতিল করুন',
                        'delivery_charge': 'ডেলিভারি চার্জ',
                        'pending': 'মুলতুবি',
                        'confirmed': 'নিশ্চিত',
                        'preparing': 'প্রস্তুত হচ্ছে',
                        'ready': 'প্রস্তুত',
                        'completed': 'সম্পন্ন',
                        'cancelled': 'বাতিল',
                        'add_some_delicious_items': 'আপনার কার্টে কিছু সুস্বাদু আইটেম যোগ করুন।',
                        'delicious_menu_item': 'সুস্বাদু মেনু আইটেম',
                        'delicious_menu_item_description': 'যত্ন সহকারে প্রস্তুত একটি সুস্বাদু মেনু আইটেম।',
                        'start_adding_favorites': 'আপনার পছন্দের আইটেমগুলি এখানে দেখতে শুরু করুন।',
                        'about_us': 'আমাদের সম্পর্কে',
                        'contact_us': 'যোগাযোগ করুন',
                        'business_hours': 'ব্যবসায়িক সময়',
                        'quick_links': 'দ্রুত লিঙ্ক',
                        'privacy_policy': 'গোপনীয়তা নীতি',
                        'terms_of_service': 'সেবার শর্তাবলী',
                        'footer_default_description': 'চাঁদের আলোয় রন্ধন শৈলীর অভিজ্ঞতা উপভোগ করুন। লুনা ডাইন ঐতিহ্য এবং উদ্ভাবনার মিশ্রণে তৈরি সাবধানভাবে প্রস্তুত খাবারের অনন্য ডাইনিং অভিজ্ঞতা অফার করে।',
                        'footer_default_tagline': 'নক্ষত্রের নিচে ডাইন করুন',
                        'footer_default_address': 'বাড়ি ১৫, রোড ৭, ধানমন্ডি, ঢাকা-১২০৫, বাংলাদেশ',
                        'footer_default_phone': '+৮৮০১২৩৪৫৬৭৮৯০',
                        'footer_default_email': 'hello@lunadine.com',
                        'monday': 'সোমবার',
                        'tuesday': 'মঙ্গলবার',
                        'wednesday': 'বুধবার',
                        'thursday': 'বৃহস্পতিবার',
                        'friday': 'শুক্রবার',
                        'saturday': 'শনিবার',
                        'sunday': 'রবিবার',
                        'branch_conflict': 'শাখা দ্বন্দ্ব',
                        'branch_conflict_message': 'আপনার কার্টে অন্য শাখা থেকে আইটেম রয়েছে। এই আইটেমটি যোগ করলে বিদ্যমান আইটেমগুলি কার্ট থেকে সরানো হবে।',
                        'current_cart_branch': 'বর্তমান কার্ট শাখা:',
                        'new_item_branch': 'নতুন আইটেম শাখা:',
                        'clear_and_add': 'সাফ করে যোগ করুন',
                        'item_branch_not_available': 'আইটেম শাখার তথ্য পাওয়া যায়নি',
                        'branch_not_found': 'এই আইটেমের শাখা পাওয়া যায়নি',
                        'order_placed_success': 'অর্ডার সফলভাবে স্থাপন করা হয়েছে!',
                        'order_failed': 'অর্ডার স্থাপন করতে ব্যর্থ হয়েছে। আবার চেষ্টা করুন।',
                        'service_request_submitted': 'পরিষেবা অনুরোধ সফলভাবে জমা দেওয়া হয়েছে।',
                        'customized': 'কাস্টমাইজড',
                        'confirm_cancel_order': 'আপনি কি নিশ্চিত যে আপনি এই অর্ডারটি বাতিল করতে চান?',
                        'order_cancelled_success': 'অর্ডার সফলভাবে বাতিল করা হয়েছে',
                        'cancel_order_failed': 'অর্ডার বাতিল করতে ব্যর্থ হয়েছে। আবার চেষ্টা করুন।',
                        'mins': 'মিনিট',
                        'table': 'টেবিল',
                        'special_offers': 'বিশেষ অফার',
                        'scan_table_qr': 'টেবিল QR কোড স্ক্যান করুন',
                        'scan_qr_instruction': 'আপনার টেবিলে QR কোডে ক্যামেরা নির্দেশ করুন',
                        'enter_qr_code': 'অথবা QR কোড ম্যানুয়ালি লিখুন',
                        'submit': 'জমা দিন',
                        'invalid_qr_code': 'অবৈধ QR কোড। আবার চেষ্টা করুন।',
                        'table_selected': 'টেবিল নির্বাচিত: {table}',
                        'rate_your_experience': 'আপনার অভিজ্ঞতা রেটিং দিন',
                        'share_your_experience': 'আমাদের সাথে আপনার অভিজ্ঞতা শেয়ার করুন',
                        'submit_feedback': 'মতামত জমা দিন',
                        'please_select_rating': 'অনুগ্রহ করে একটি রেটিং নির্বাচন করুন',
                        'feedback_submitted': 'মতামত সফলভাবে জমা দেওয়া হয়েছে',
                        'feedback_submission_failed': 'মতামত জমা দিতে ব্যর্থ হয়েছে। আবার চেষ্টা করুন।',
                        'service_quality': 'পরিষেবার গুণমান',
                        'food_quality': 'খাবারের গুণমান',
                        'ambiance': 'পরিবেশ',
                        'value_for_money': 'মূল্যের জন্য মান',
                        'would_recommend': 'আপনি কি অন্যদের আমাদের কাছে সুপারিশ করবেন?',
                        'yes': 'হ্যাঁ',
                        'no': 'না',
                        'branch_settings': 'শাখা সেটিংস',
                        'vat_percentage': 'ভ্যাট শতাংশ',
                        'service_charge_percentage': 'সার্ভিস চার্জ শতাংশ',
                        'loading_branches': 'শাখাগুলি লোড হচ্ছে...',
                        'loading_menu': 'মেনু লোড হচ্ছে...',
                        'loading_promotions': 'প্রচারগুলি লোড হচ্ছে...',
                        'loading_order': 'অর্ডার লোড হচ্ছে...',
                        'loading_tables': 'টেবিলগুলি লোড হচ্ছে...',
                        'loading_feedback': 'মতামত লোড হচ্ছে...',
                        'unknown_branch': 'অজানা শাখা',
                        'all_items': 'সমস্ত আইটেম',
                        'no_items_found': 'কোন আইটেম পাওয়া যায়নি',
                        'try_different_category': 'অন্য ক্যাটাগরি নির্বাচন করুন',
                        'view_all_items': 'সমস্ত আইটেম দেখুন',
                        // Enhanced Order Tracking Translations
                        'current_status': 'বর্তমান অবস্থা',
                        'estimated_time': 'আনুমানিক সময়',
                        'served': 'পরিবেশন করা হয়েছে',
                        'ready_for_pickup': 'পিকআপের জন্য প্রস্তুত',
                        'picked_up': 'সংগ্রহ করা হয়েছে',
                        'ready_for_delivery': 'ডেলিভারির জন্য প্রস্তুত',
                        'out_for_delivery': 'ডেলিভারিতে বের হয়েছে',
                        'delivered': 'ডেলিভার করা হয়েছে',
                        'server': 'সার্ভার',
                        'dining_duration': 'ডাইনিং সময়কাল',
                        'served_at': 'পরিবেশন করা হয়েছে',
                        'pickup_counter': 'পিকআপ কাউন্টার',
                        'picked_up_at': 'সংগ্রহ করা হয়েছে',
                        'pickup_instructions': 'পিকআপ নির্দেশাবলী',
                        'driver': 'ড্রাইভার',
                        'driver_phone': 'ড্রাইভার ফোন',
                        'estimated_delivery': 'আনুমানিক ডেলিভারি',
                        'delivered_at': 'ডেলিভার করা হয়েছে',
                        'delivery_instructions': 'ডেলিভারি নির্দেশাবলী',
                        'request_assistance': 'সহায়তা অনুরোধ করুন',
                        'add_items': 'আইটেম যোগ করুন',
                        'update_pickup_time': 'পিকআপ সময় আপডেট করুন',
                        'notify_ready': 'প্রস্তুত হলে জানান',
                        'contact_driver': 'ড্রাইভারের সাথে যোগাযোগ করুন',
                        'track_delivery': 'ডেলিভারি ট্র্যাক করুন',
                        'update_address': 'ঠিকানা আপডেট করুন',
                        'order_timeline': 'অর্ডার টাইমলাইন',
                        'select_rating': 'রেটিং নির্বাচন করুন',
                        'select': 'নির্বাচন করুন'
                    }
                }
            };
            
            // DOM Elements
            const elements = {
                mainContent: document.getElementById('main-content'),
                views: document.querySelectorAll('.view'),
                navLinks: document.querySelectorAll('.nav-link'),
                branchesContainer: document.getElementById('branches-container'),
                menuItemsContainer: document.getElementById('menu-items-container'),
                cartContainer: document.getElementById('cart-container'),
                cartToggle: document.getElementById('cart-toggle'),
                cartFab: document.getElementById('cart-fab'),
                cartCounts: document.querySelectorAll('.cart-count'),
                itemDetailModal: document.getElementById('item-detail-modal'),
                serviceModal: document.getElementById('service-modal'),
                itemDetailContent: document.getElementById('item-detail-content'),
                addToCartDetailBtn: document.getElementById('add-to-cart-detail-btn'),
                serviceRequestBtn: document.getElementById('service-request-btn'),
                submitRequestBtn: document.getElementById('submit-request-btn'),
                requestType: document.getElementById('request-type'),
                otherRequestContainer: document.getElementById('other-request-container'),
                otherRequest: document.getElementById('other-request'),
                loadingOverlay: document.getElementById('loading-overlay'),
                menuSearch: document.getElementById('menu-search'),
                menuSearchClear: document.getElementById('menu-search-clear'),
                menuSearchFilterToggle: document.getElementById('menu-search-filter-toggle'),
                menuSearchFiltersPanel: document.getElementById('menu-search-filters-panel'),
                priceMin: document.getElementById('price-min'),
                priceMax: document.getElementById('price-max'),
                applyFiltersBtn: document.getElementById('apply-filters'),
                clearFiltersBtn: document.getElementById('clear-filters'),
                compactPromotions: document.getElementById('compact-promotions'),
                menuBranchName: document.getElementById('menu-branch-name'),
                cartBranchName: document.getElementById('cart-branch-name'),
                checkoutBranchName: document.getElementById('checkout-branch-name'),
                favoritesContainer: document.getElementById('favorites-container'),
                languageDropdown: document.getElementById('language-dropdown'),
                checkoutForm: document.getElementById('checkout-form'),
                orderTrackingContainer: document.getElementById('order-tracking-container'),
                orderHistoryContainer: document.getElementById('order-history-container'),
                promotionsContainer: document.getElementById('promotions-container'),
                promotionsGrid: document.getElementById('promotions-grid'),
                qrScannerBtn: document.getElementById('qr-scanner-btn'),
                qrScannerContainer: document.getElementById('qr-scanner-container'),
                qrScannerClose: document.getElementById('qr-scanner-close'),
                qrCodeInput: document.getElementById('qr-code-input'),
                qrCodeSubmit: document.getElementById('qr-code-submit'),
                footer: document.getElementById('footer'),
                footerContent: document.getElementById('footer-content'),
                footerRestaurantName: document.getElementById('footer-restaurant-name'),
                branchConflictModal: document.getElementById('branch-conflict-modal'),
                branchConflictMessage: document.getElementById('branch-conflict-message'),
                currentBranchName: document.getElementById('current-branch-name'),
                categoryTabsContainer: document.getElementById('category-tabs-container'),
                categoryTabs: document.getElementById('category-tabs'),
                menuContentArea: document.getElementById('menu-content-area'),
                newBranchName: document.getElementById('new-branch-name'),
                branchConflictCancelBtn: document.getElementById('branch-conflict-cancel-btn'),
                branchConflictConfirmBtn: document.getElementById('branch-conflict-confirm-btn')
            };
            
            // Initialize the application
            async function init() {
                setupEventListeners();
                loadUserData();
                
                // Synchronize cart state to ensure everything is properly loaded
                synchronizeCartState();
                
                // Synchronize favorites state to ensure everything is properly loaded
                synchronizeFavoritesState();
                
                // Detect language from URL BEFORE loading translations
                const detectedLanguage = detectLanguageFromUrl();
                if (detectedLanguage !== state.language) {
                    console.log('Setting language based on URL:', detectedLanguage); // Debug log
                    state.language = detectedLanguage;
                    saveUserData();
                    
                    // Update HTML lang attribute for proper language setting
                    document.documentElement.lang = detectedLanguage;
                    document.documentElement.dir = detectedLanguage === 'bn-BD' ? 'ltr' : 'ltr';
                }
                
                // Load translations from API FIRST before loading any data that requires translations
                await loadTranslationsFromAPI();
                
                // Update branch name displays after loading user data and translations
                updateBranchNameDisplays();
                
                // Load branches data BEFORE setting up router
                await loadBranches();
                
                // Load restaurant details for footer
                await loadRestaurantDetails();
                
                // Setup router AFTER all data is loaded and handle initial route immediately
                setupRouter();
                
                updateCartUI();
                
                // Initialize hero section enhancements
                heroEnhancements.init();
            }
            
            // Language detection from URL
            function detectLanguageFromUrl() {
                const hash = window.location.hash.substring(1);
                
                // Handle new URL format: /BranchName/page
                if (hash.startsWith('/')) {
                    const parts = hash.split('/').filter(part => part.length > 0);
                    
                    if (parts.length >= 2) {
                        let branchUrlName = parts[0];
                        
                        // Try to decode the branch URL name
                        try {
                            branchUrlName = decodeUrlName(branchUrlName);
                        } catch (e) {
                            // Ignore decoding errors
                        }
                        
                        // Check if the URL contains Bengali characters
                        // Bengali Unicode range: \u0980-\u09FF
                        if (/[\u0980-\u09FF]/.test(branchUrlName)) {
                            console.log('Detected Bengali characters in URL, setting language to bn-BD'); // Debug log
                            return 'bn-BD';
                        }
                    }
                }
                
                // Default to English if no Bengali characters found
                return 'en-US';
            }
            
            // URL helper functions
            function normalizeString(str) {
                // Normalize Unicode strings for consistent comparison
                // Special handling for Bengali characters to ensure proper normalization
                if (!str) return '';
                
                // First, decode if it's already encoded (for URLs coming from browser)
                try {
                    str = decodeUrlName(str);
                } catch (e) {
                    // If decoding fails, continue with original string
                }
                
                // Normalize Unicode and trim
                let normalized = str.normalize('NFC').trim();
                
                // Remove extra spaces and normalize spacing for Bengali text
                normalized = normalized.replace(/\s+/g, ' ');
                
                return normalized;
            }
            
            function getBranchUrlName(branch) {
                const displayName = getTranslation(branch.internal_name, branch.name_translation_key) || branch.internal_name || 'Branch';
                return normalizeString(displayName).replace(/\s+/g, ''); // Remove spaces
            }
            
            function encodeUrlName(name) {
                // Properly encode URL components while preserving Unicode characters
                return encodeURIComponent(name);
            }
            
            function decodeUrlName(encodedName) {
                // Decode URL components back to original string
                return decodeURIComponent(encodedName);
            }
            
            function findBranchByUrlName(urlName) {
                // Try to find branch by comparing URL names
                // Handle both encoded and decoded versions for Bengali characters
                const normalizedUrlName = normalizeString(urlName);
                
                console.log('Searching for branch with URL name:', urlName, 'normalized:', normalizedUrlName); // Debug log
                
                return state.branches.find(branch => {
                    const branchUrlName = getBranchUrlName(branch);
                    const normalizedBranchName = normalizeString(branchUrlName);
                    
                    console.log('Comparing:', {
                        urlName: normalizedUrlName,
                        branchName: normalizedBranchName,
                        exactMatch: normalizedBranchName === normalizedUrlName
                    }); // Debug log
                    
                    // Try exact match first
                    if (normalizedBranchName === normalizedUrlName) {
                        console.log('Found exact match for:', branchUrlName); // Debug log
                        return true;
                    }
                    
                    // Try decoded match (for URLs that were encoded by browser)
                    try {
                        const decodedUrlName = normalizeString(decodeUrlName(urlName));
                        if (normalizedBranchName === decodedUrlName) {
                            console.log('Found match via decoding:', decodedUrlName); // Debug log
                            return true;
                        }
                    } catch (e) {
                        // Ignore decoding errors
                    }
                    
                    // Try encoded match (for comparison with encoded URLs)
                    try {
                        const encodedBranchName = encodeUrlName(branchUrlName);
                        if (encodedBranchName === urlName) {
                            console.log('Found match via encoding:', encodedBranchName); // Debug log
                            return true;
                        }
                    } catch (e) {
                        // Ignore encoding errors
                    }
                    
                    // Special handling for Bengali: try comparing with and without spaces
                    // Sometimes Bengali URLs might have different spacing
                    const branchNameNoSpaces = normalizedBranchName.replace(/\s+/g, '');
                    const urlNameNoSpaces = normalizedUrlName.replace(/\s+/g, '');
                    
                    if (branchNameNoSpaces === urlNameNoSpaces) {
                        console.log('Found match via space removal:', branchNameNoSpaces); // Debug log
                        return true;
                    }
                    
                    // Try partial matching for Bengali characters (in case of normalization differences)
                    if (normalizedBranchName.includes(normalizedUrlName) || normalizedUrlName.includes(normalizedBranchName)) {
                        console.log('Found partial match between:', normalizedBranchName, 'and', normalizedUrlName); // Debug log
                        return true;
                    }
                    
                    return false;
                });
            }
            
            function createBranchUrl(branch, page) {
                const branchUrlName = getBranchUrlName(branch);
                console.log('Creating URL for branch:', {
                    branchName: branch.internal_name,
                    urlName: branchUrlName,
                    hasUnicode: /[\u0980-\u09FF\u0800-\uFFFF]/.test(branchUrlName) // Added Bengali range
                }); // Debug log
                
                // For URLs with Unicode characters, we should encode them
                // Bengali Unicode range: \u0980-\u09FF, Other Unicode: \u0800-\uFFFF
                if (/[\u0980-\u09FF\u0800-\uFFFF]/.test(branchUrlName)) {
                    // Contains Bengali or other Unicode characters
                    const encodedName = encodeUrlName(branchUrlName);
                    console.log('Encoded URL name:', encodedName); // Debug log
                    return `#/${encodedName}/${page}`;
                }
                return `#/${branchUrlName}/${page}`;
            }
            
            // Test function for URL handling (can be called from browser console)
            window.testUrlHandling = function() {
                console.log('=== URL Handling Test ===');
                console.log('Current branches:', state.branches);
                console.log('Current language:', state.language);
                
                state.branches.forEach(branch => {
                    const urlName = getBranchUrlName(branch);
                    const url = createBranchUrl(branch, 'menu');
                    const found = findBranchByUrlName(urlName);
                    
                    console.log('Branch test:', {
                        branchName: branch.internal_name,
                        urlName: urlName,
                        generatedUrl: url,
                        found: !!found,
                        translations: {
                            internal: branch.internal_name,
                            translated: getTranslation(branch.internal_name, branch.name_translation_key),
                            key: branch.name_translation_key
                        }
                    });
                });
            };
            
            function redirectToNewFormat() {
                const hash = window.location.hash.substring(1);
                
                // Check if it's a legacy format that needs redirection
                if (!hash.startsWith('/') && hash.includes('/')) {
                    const [route, param] = hash.split('/');
                    
                    // Handle legacy menu URLs with branch ID
                    if (route === 'menu' && param && !isNaN(param)) {
                        const branch = state.branches.find(b => b.branch_id == param);
                        if (branch) {
                            window.location.hash = createBranchUrl(branch, 'menu');
                            return true;
                        }
                    }
                }
                
                return false;
            }
            
            // Router setup for SPA navigation
            function setupRouter() {
                window.addEventListener('hashchange', handleRouteChange);
                // Handle initial route immediately
                handleRouteChange(true); // true indicates initial load
            }
            
            async function handleRouteChange(isInitialLoad = false) {
                // First, check if we need to redirect from legacy format
                if (redirectToNewFormat()) {
                    return; // Stop processing if redirection occurred
                }
                
                // Safety check: if branches are not loaded yet, wait and try again
                if (state.branches.length === 0) {
                    console.log('Branches not loaded yet, delaying route handling...');
                    setTimeout(() => handleRouteChange(isInitialLoad), 100);
                    return;
                }
                
                const hash = window.location.hash.substring(1);
                
                // Handle new URL format: /BranchName/page
                if (hash.startsWith('/')) {
                    const parts = hash.split('/').filter(part => part.length > 0);
                    
                    if (parts.length >= 2) {
                        let branchUrlName = parts[0];
                        const page = parts[1];
                        
                        console.log('Processing URL parts:', parts); // Debug log
                        console.log('Original branch URL name:', branchUrlName); // Debug log
                        
                        // Try to decode the branch URL name (for Bengali characters)
                        try {
                            const decodedName = decodeUrlName(branchUrlName);
                            console.log('Decoded branch URL name:', decodedName); // Debug log
                            branchUrlName = decodedName;
                        } catch (e) {
                            console.warn('Failed to decode branch URL name:', branchUrlName, e);
                        }
                        
                        // Additional normalization for Bengali text
                        branchUrlName = normalizeString(branchUrlName);
                        console.log('Normalized branch URL name:', branchUrlName); // Debug log
                        
                        console.log('Looking for branch with URL name:', branchUrlName); // Debug log
                        console.log('Available branches:', state.branches.map(b => ({
                            id: b.branch_id,
                            name: getBranchUrlName(b)
                        }))); // Debug log
                        
                        const branch = findBranchByUrlName(branchUrlName);
                        
                        if (branch) {
                            console.log('Found branch:', branch); // Debug log
                            // Ensure branch settings are loaded
                            const branchWithSettings = await ensureBranchSettings(branch);
                            state.currentBranch = branchWithSettings;
                            updateBranchNameDisplays();
                            updateCurrentCart();
                            updateCartUI();
                            
                            switch(page) {
                                case 'menu':
                                    // Check if this is an item detail URL: #/{branch-name}/menu/item/{branch_menu_id}
                                    if (parts.length >= 4 && parts[2] === 'item') {
                                        const branchMenuId = parts[3];
                                        loadItemById(branch.branch_id, branchMenuId);
                                    } else {
                                        loadMenu(branch.branch_id);
                                    }
                                    break;
                                case 'cart':
                                    showView('cart');
                                    renderCart();
                                    break;
                                case 'checkout':
                                    showView('checkout');
                                    renderCheckout();
                                    break;
                                case 'item':
                                    // Legacy support for old format: #/{branch-name}/item/{branch_menu_id}
                                    if (parts.length >= 3) {
                                        const branchMenuId = parts[2];
                                        loadItemById(branch.branch_id, branchMenuId);
                                    } else {
                                        showError('Item ID not provided');
                                        loadMenu(branch.branch_id);
                                    }
                                    break;
                                default:
                                    console.warn('Unknown page:', page);
                                    showView('home');
                            }
                            return;
                        } else {
                            console.error('Branch not found for URL name:', branchUrlName);
                            console.error('Available branch URL names:', state.branches.map(b => getBranchUrlName(b)));
                            showError('Branch not found');
                        }
                    }
                }
                
                // Handle legacy URL format for backward compatibility
                const [route, param] = hash.split('/');
                
                switch(route) {
                    case 'home':
                        showView('home');
                        break;
                    case 'menu':
                        if (param) {
                            // Ensure branches are loaded before loading menu
                            if (state.branches.length === 0) {
                                // If branches aren't loaded yet, load them first then proceed
                                loadBranches().then(() => {
                                    loadMenu(param);
                                }).catch(error => {
                                    console.error('Failed to load branches for menu:', error);
                                    showError('Failed to load branch data');
                                });
                            } else {
                                // Check if we already have menu data for this branch
                                const targetBranchId = parseInt(param, 10);
                                const hasCurrentMenuData = state.menuData && state.menuData.length > 0 && 
                                                          state.currentBranch && 
                                                          state.currentBranch.branch_id === targetBranchId;
                                
                                if (hasCurrentMenuData) {
                                    // We already have the menu data, just show the view
                                    showView('menu');
                                    renderMenuContentArea('all');
                                } else {
                                    // Load the menu data
                                    loadMenu(param);
                                }
                            }
                        } else if (state.currentBranch) {
                            // Check if we already have menu data for the current branch
                            const hasCurrentMenuData = state.menuData && state.menuData.length > 0;
                            
                            if (hasCurrentMenuData) {
                                // We already have the menu data, just show the view
                                showView('menu');
                                renderMenuContentArea('all');
                            } else {
                                // Load the menu data
                                loadMenu(state.currentBranch.branch_id);
                            }
                        } else {
                            showView('home');
                        }
                        break;
                    case 'cart':
                        showView('cart');
                        renderCart();
                        break;
                    case 'checkout':
                        showView('checkout');
                        renderCheckout();
                        break;
                    case 'order':
                        if (param) {
                            showView('order-tracking');
                            loadOrder(param);
                        } else {
                            showView('orders');
                            renderOrderHistory();
                        }
                        break;
                    case 'orders':
                        showView('orders');
                        renderOrderHistory();
                        break;
                    case 'favorites':
                        showView('favorites');
                        renderFavorites();
                        break;
                    default:
                        // Only show home view if there's no hash OR if it's not the initial load
                        if (!hash || !isInitialLoad) {
                            showView('home');
                            renderHome();
                        }
                        // If it's initial load with no hash, show home view after a short delay
                        else if (isInitialLoad && !hash) {
                            setTimeout(() => {
                                showView('home');
                                renderHome();
                            }, 100);
                        }
                }
            }
            
            function showView(viewName) {
                // Hide all views
                elements.views.forEach(view => {
                    view.classList.remove('active');
                });
                
                // Show the requested view
                const viewElement = document.getElementById(`${viewName}-view`);
                if (viewElement) {
                    viewElement.classList.add('active');
                }
                
                // Update active nav link
                elements.navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('data-view') === viewName) {
                        link.classList.add('active');
                    }
                });
                
                // Update mobile nav link
                const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
                mobileNavLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('data-view') === viewName) {
                        link.classList.add('active');
                    }
                });
                
                state.currentView = viewName;
            }
            
            // API Service
            const apiService = {
                async get(url, showGlobalLoading = true) {
                    try {
                        if (showGlobalLoading) {
                            showLoading();
                        }
                        const response = await fetch(`/api/${url}`);
                        if (!response.ok) {
                            throw new Error(`API error: ${response.status}`);
                        }
                        const data = await response.json();
                        if (showGlobalLoading) {
                            hideLoading();
                        }
                        return data;
                    } catch (error) {
                        if (showGlobalLoading) {
                            hideLoading();
                        }
                        console.error('API Error:', error);
                        showError('Failed to load data. Please try again.');
                        throw error;
                    }
                },
                
                async post(url, data, showGlobalLoading = true) {
                    try {
                        if (showGlobalLoading) {
                            showLoading();
                        }
                        const response = await fetch(`/api/${url}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(data)
                        });
                        if (!response.ok) {
                            throw new Error(`API error: ${response.status}`);
                        }
                        const result = await response.json();
                        if (showGlobalLoading) {
                            hideLoading();
                        }
                        return result;
                    } catch (error) {
                        if (showGlobalLoading) {
                            hideLoading();
                        }
                        console.error('API Error:', error);
                        showError('Failed to submit data. Please try again.');
                        throw error;
                    }
                },
                
                async delete(url, showGlobalLoading = true) {
                    try {
                        if (showGlobalLoading) {
                            showLoading();
                        }
                        const response = await fetch(`/api/${url}`, {
                            method: 'DELETE'
                        });
                        if (!response.ok) {
                            throw new Error(`API error: ${response.status}`);
                        }
                        const result = await response.json();
                        if (showGlobalLoading) {
                            hideLoading();
                        }
                        return result;
                    } catch (error) {
                        if (showGlobalLoading) {
                            hideLoading();
                        }
                        console.error('API Error:', error);
                        showError('Failed to delete data. Please try again.');
                        throw error;
                    }
                },
                
                // Specific API methods
                getBranches() {
                    return this.get('branches', false); // Don't show global loading for branches
                },
                
                getBranch(id) {
                    return this.get(`branches/${id}`, false); // Don't show global loading for branch details
                },
                
                getBranchMenu(branchId) {
                    return this.get(`branches/${branchId}/menu`, false); // Don't show global loading for menu
                },
                
                getBranchBanners(branchId) {
                    return this.get(`branches/${branchId}/banners`, false);
                },
                
                getBranchSettings(branchId) {
                    return this.get(`branches/${branchId}/settings`, false); // Don't show global loading for settings
                },
                
                getBranchTables(branchId) {
                    return this.get(`branches/${branchId}/tables`, false);
                },
                
                getCustomizations(branchMenuId) {
                    return this.get(`customizations/${branchMenuId}`, false);
                },
                
                createOrder(orderData) {
                    return this.post('orders', orderData, true); // Show loading overlay for order creation (user action)
                },
                
                createServiceRequest(requestData) {
                    return this.post('servicerequests', requestData, true); // Show loading overlay for service requests (user action)
                },
                
                getOrder(orderId) {
                    return this.get(`orders/${orderId}`, false); // Don't show global loading for order tracking (use skeleton instead)
                },
                
                getOrderItems(orderId) {
                    return this.get(`orders/${orderId}/items`, false); // Don't show global loading for order tracking (use skeleton instead)
                },
                
                cancelOrder(orderId) {
                    return this.delete(`orders/${orderId}`, true); // Show loading overlay for order cancellation (user action)
                },
                
                getPromotions(branchId) {
                    return branchId ? this.get(`promotions/${branchId}`, false) : this.get('promotions', false); // Don't show global loading for promotions
                },
                
                getTableByQr(qrHash) {
                    return this.get(`tables/qr/${qrHash}`, true); // Show loading overlay for QR scanning (user action)
                },
                
                getFeedback(filter) {
                    if (filter.type === 'branch') {
                        return this.get(`feedback/branch/${filter.id}`, false); // Don't show global loading for feedback data
                    } else if (filter.type === 'order') {
                        return this.get(`feedback/order/${filter.id}`, false); // Don't show global loading for feedback data
                    } else {
                        return this.get('feedback', false); // Don't show global loading for feedback data
                    }
                },
                
                submitFeedback(feedbackData) {
                    return this.post('feedback', feedbackData, true); // Show loading overlay for feedback submission (user action)
                },
                
                getTranslations(languageCode) {
                    return this.get(`translations/${languageCode}`, false); // Don't show global loading for translations
                },
                
                getRestaurant() {
                    return this.get('restaurant', false); // Don't show global loading for restaurant details
                }
            };
            
            // Data loading functions
            async function loadBranches() {
                try {
                    showToast(translate('loading_branches'));
                    // Show skeleton views first
                    renderBranchSkeletons();
                    
                    const branches = await apiService.getBranches();
                    state.branches = branches.data || branches;
                    renderHome();
                } catch (error) {
                    console.error('Failed to load branches:', error);
                }
            }
            
            // Helper function to update branch name displays
            function updateBranchNameDisplays() {
                if (!state.currentBranch) {
                    resetBranchNameDisplays();
                    return;
                }
                
                const branchDisplayName = getTranslation(state.currentBranch.internal_name, state.currentBranch.name_translation_key) || state.currentBranch.internal_name || 'Branch';
                
                // Update menu page
                if (elements.menuBranchName) {
                    elements.menuBranchName.textContent = `${translate('menu')} - ${branchDisplayName}`;
                }
                
                // Update cart page
                if (elements.cartBranchName) {
                    elements.cartBranchName.textContent = `${translate('your_cart')} - ${branchDisplayName}`;
                }
                
                // Update checkout page
                if (elements.checkoutBranchName) {
                    elements.checkoutBranchName.textContent = `${translate('checkout')} - ${branchDisplayName}`;
                }
            }
            
            // Helper function to reset branch name displays to default
            function resetBranchNameDisplays() {
                if (elements.menuBranchName) {
                    elements.menuBranchName.textContent = translate('menu');
                }
                
                if (elements.cartBranchName) {
                    elements.cartBranchName.textContent = translate('your_cart');
                }
                
                if (elements.checkoutBranchName) {
                    elements.checkoutBranchName.textContent = translate('checkout');
                }
            }
            
            async function loadMenu(branchId) {
                try {
                    showToast(translate('loading_menu'));
                    
                    // Show skeleton views immediately
                    showView('menu');
                    renderMenuItemSkeletons();
                    renderPromotionSkeletons();
                    renderCategoryTabsSkeletons();
                    renderMenuContentSkeletons();
                    
                    // Load featured branch cover section
                    loadFeaturedBranch();
                    
                    // Ensure translations are loaded before proceeding
                    if (!state.translations[state.language] || Object.keys(state.translations[state.language]).length === 0) {
                        await loadTranslationsFromAPI();
                    }
                    
                    // Check if we already have the branch data
                    let branch = state.branches.find(b => b.branch_id == branchId);
                    
                    if (!branch) {
                        branch = await apiService.getBranch(branchId);
                    }
                    
                    // Load branch settings
                    const settings = await apiService.getBranchSettings(branchId);
                    branch.settings = settings.data || settings;
                    
                    state.currentBranch = branch;
                    updateBranchNameDisplays();
                    
                    // Update cart to show current branch's cart
                    updateCurrentCart();
                    updateCartUI();
                    
                    const menuDataResponse = await apiService.getBranchMenu(branchId);
                    let menuData = menuDataResponse.data || menuDataResponse;


                    menuData.forEach(category => {
                      if (category.items && Array.isArray(category.items)) {
                       category.items.forEach(item => {
                        // We use parseInt to ensure the ID is a number, preventing future type issues.
                        item.branch_id = parseInt(branchId, 10);
                        });
                      }
                    });

                       state.menuData = menuData;
                    console.log('Menu data loaded:', state.menuData);
                    // Extract categories from menu data
                    state.categories = state.menuData.map(category => ({
                        id: category.category_id,
                        name: getTranslation(category.category_name, category.name_translation_key),
                        image: category.category_image
                    }));
                    console.log('Categories extracted:', state.categories);
                    
                    // Load promotions for this branch
                    try {
                        showToast(translate('loading_promotions'));
                        const promotions = await apiService.getPromotions(branchId);
                        state.promotions = promotions.data || promotions;
                        renderPromotions();
                    } catch (error) {
                        console.error('Failed to load promotions:', error);
                        elements.promotionsContainer.style.display = 'none';
                    }
                    
                    renderCategories();
                    renderMenuItems();
                    
                    // Debug: Check if elements exist
                    setTimeout(() => {
                        console.log('=== DEBUG INFO ===');
                        console.log('menu-content-area element:', document.getElementById('menu-content-area'));
                        console.log('category-tabs element:', document.getElementById('category-tabs'));
                        console.log('category-tabs-container element:', document.getElementById('category-tabs-container'));
                        console.log('state.menuData:', state.menuData);
                        console.log('state.categories:', state.categories);
                        console.log('=== END DEBUG ===');
                    }, 500);
                } catch (error) {
                    console.error('Failed to load menu:', error);
                }
            }
            
            async function loadOrder(orderId) {
                try {
                    showToast(translate('loading_order'));
                    
                    // Fetch both order details and order items
                    const [orderResponse, itemsResponse] = await Promise.all([
                        apiService.getOrder(orderId),
                        apiService.getOrderItems(orderId)
                    ]);
                    
                    const order = orderResponse.data || orderResponse;
                    const items = itemsResponse.data || itemsResponse || [];
                    
                    // Combine order and items data
                    const completeOrder = {
                        ...order,
                        items: items
                    };
                    
                    renderOrderTracking({ data: completeOrder });
                } catch (error) {
                    console.error('Failed to load order:', error);
                }
            }
            
            async function loadTranslationsFromAPI() {
                try {
                    const response = await apiService.getTranslations(state.language);
                    const apiTranslations = response.data || response;
                    
                    // Merge API translations with local translations
                    if (apiTranslations && typeof apiTranslations === 'object') {
                        state.translations[state.language] = {
                            ...state.translations[state.language],
                            ...apiTranslations
                        };
                    }
                } catch (error) {
                    console.error('Failed to load translations from API:', error);
                    // Fall back to local translations
                } finally {
                    // Always apply translations to update the UI
                    applyTranslations();
                }
            }
            
            async function loadBranchTables(branchId) {
                try {
                    showToast(translate('loading_tables'));
                    const tables = await apiService.getBranchTables(branchId);
                    return tables.data || tables;
                } catch (error) {
                    console.error('Failed to load branch tables:', error);
                    return [];
                }
            }
            
            // Translation helper functions
            function getTranslation(defaultText, translationKey) {
                if (translationKey && 
                    state.translations[state.language] && 
                    state.translations[state.language][translationKey]) {
                    return state.translations[state.language][translationKey];
                }
                return defaultText;
            }
            
            function translate(key) {
                return state.translations[state.language]?.[key] || key;
            }
            
            function applyTranslations() {
                // Update all elements with data-translate attributes
                document.querySelectorAll('[data-translate]').forEach(element => {
                    const key = element.getAttribute('data-translate');
                    element.textContent = translate(key);
                });
                
                // Update placeholders
                document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
                    const key = element.getAttribute('data-translate-placeholder');
                    element.placeholder = translate(key);
                });
                
                // Update title
                document.title = translate('app_name');
            }
            
            // Skeleton rendering functions
            function renderBranchSkeletons(count = 3) {
                elements.branchesContainer.innerHTML = '';
                
                for (let i = 0; i < count; i++) {
                    const skeletonCard = document.createElement('div');
                    skeletonCard.className = 'branch-card skeleton';
                    skeletonCard.innerHTML = `
                        <div class="branch-image-container">
                            <div class="skeleton-image"></div>
                        </div>
                        <div class="branch-content">
                            <div class="skeleton-text title"></div>
                            <div class="skeleton-text subtitle"></div>
                            <div class="skeleton-text"></div>
                            <div class="skeleton-text small"></div>
                        </div>
                    `;
                    elements.branchesContainer.appendChild(skeletonCard);
                }
            }
            
            function renderMenuItemSkeletons(count = 6) {
                elements.menuItemsContainer.innerHTML = '';
                
                for (let i = 0; i < count; i++) {
                    const skeletonCard = document.createElement('div');
                    skeletonCard.className = 'menu-item-card skeleton';
                    skeletonCard.innerHTML = `
                        <div class="menu-item-image-container">
                            <div class="skeleton-image"></div>
                        </div>
                        <div class="menu-item-content">
                            <div class="skeleton-text title"></div>
                            <div class="skeleton-text price"></div>
                            <div class="skeleton-text description"></div>
                        </div>
                    `;
                    elements.menuItemsContainer.appendChild(skeletonCard);
                }
            }
            
            function renderPromotionSkeletons(count = 2) {
                elements.promotionsGrid.innerHTML = '';
                
                for (let i = 0; i < count; i++) {
                    const skeletonCard = document.createElement('div');
                    skeletonCard.className = 'promotion-card skeleton';
                    skeletonCard.innerHTML = `
                        <div class="promotion-image"></div>
                        <div class="promotion-content">
                            <div class="skeleton-text title"></div>
                            <div class="skeleton-text description"></div>
                        </div>
                    `;
                    elements.promotionsGrid.appendChild(skeletonCard);
                }
            }
            
            function renderCategoryTabsSkeletons(count = 4) {
                const categoryTabs = document.getElementById('category-tabs');
                if (!categoryTabs) return;
                
                categoryTabs.innerHTML = '';
                
                for (let i = 0; i < count; i++) {
                    const skeletonTab = document.createElement('button');
                    skeletonTab.className = 'category-tab skeleton';
                    skeletonTab.innerHTML = `
                        <div class="skeleton-text tab-text"></div>
                        <div class="skeleton-badge"></div>
                    `;
                    categoryTabs.appendChild(skeletonTab);
                }
            }
            
            function renderMenuContentSkeletons(count = 4) {
                const contentArea = document.getElementById('menu-content-area');
                if (!contentArea) return;
                
                contentArea.innerHTML = '';
                
                const skeletonSection = document.createElement('div');
                skeletonSection.className = 'menu-section';
                skeletonSection.innerHTML = `
                    <div class="menu-section-header">
                        <div class="skeleton-text section-title"></div>
                    </div>
                    <div class="menu-section-items">
                        ${Array(count).fill('').map(() => `
                            <div class="menu-item-card skeleton">
                                <div class="menu-item-image-container">
                                    <div class="skeleton-image"></div>
                                </div>
                                <div class="menu-item-content">
                                    <div class="skeleton-text title"></div>
                                    <div class="skeleton-text price"></div>
                                    <div class="skeleton-text description"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                contentArea.appendChild(skeletonSection);
            }
            
            // Modal skeleton rendering functions
            function renderItemDetailSkeleton() {
                const modalContent = document.getElementById('item-detail-content');
                const modal = document.querySelector('#item-detail-modal .modal');
                if (!modalContent || !modal) return;
                
                // Add skeleton class to modal
                modal.classList.add('skeleton');
                
                modalContent.innerHTML = `
                    <div class="skeleton-row">
                        <div class="skeleton-col" style="flex: 1;">
                            <div class="skeleton-image"></div>
                        </div>
                        <div class="skeleton-col" style="flex: 1;">
                            <div class="skeleton-text large"></div>
                            <div class="skeleton-text medium"></div>
                            <div class="skeleton-text small"></div>
                            <div class="skeleton-text"></div>
                            <div class="skeleton-text medium"></div>
                        </div>
                    </div>
                    <div class="skeleton-form-group">
                        <div class="skeleton-text small"></div>
                        <div class="skeleton-select"></div>
                    </div>
                    <div class="skeleton-form-group">
                        <div class="skeleton-text small"></div>
                        <div class="skeleton-input"></div>
                    </div>
                    <div class="skeleton-row">
                        <div class="skeleton-button"></div>
                        <div class="skeleton-button"></div>
                    </div>
                `;
            }
            
            function renderServiceModalSkeleton() {
                const modalBody = document.querySelector('#service-modal .modal-body');
                const modal = document.querySelector('#service-modal .modal');
                if (!modalBody || !modal) return;
                
                // Add skeleton class to modal
                modal.classList.add('skeleton');
                
                modalBody.innerHTML = `
                    <div class="skeleton-form-group">
                        <div class="skeleton-text small"></div>
                        <div class="skeleton-select"></div>
                    </div>
                    <div class="skeleton-form-group">
                        <div class="skeleton-text small"></div>
                        <div class="skeleton-textarea"></div>
                    </div>
                    <div class="skeleton-form-group">
                        <div class="skeleton-text small"></div>
                        <div class="skeleton-input"></div>
                    </div>
                `;
            }
            
            function renderConfirmationModalSkeleton() {
                const modalBody = document.querySelector('#confirmation-modal .modal-body');
                const modal = document.querySelector('#confirmation-modal .modal');
                if (!modalBody || !modal) return;
                
                // Add skeleton class to modal
                modal.classList.add('skeleton');
                
                modalBody.innerHTML = `
                    <div class="skeleton-text medium"></div>
                    <div class="skeleton-text"></div>
                    <div class="skeleton-text small"></div>
                `;
            }
            
            function renderBranchConflictModalSkeleton() {
                const modalBody = document.querySelector('#branch-conflict-modal .modal-body');
                const modal = document.querySelector('#branch-conflict-modal .modal');
                if (!modalBody || !modal) return;
                
                // Add skeleton class to modal
                modal.classList.add('skeleton');
                
                modalBody.innerHTML = `
                    <div class="skeleton-text medium"></div>
                    <div class="skeleton-text"></div>
                    <div class="skeleton-text"></div>
                    <div class="skeleton-text small"></div>
                `;
            }
            
            // Page skeleton rendering functions
            function renderCartSkeleton() {
                const cartView = document.getElementById('cart-view');
                const cartContainer = document.getElementById('cart-container');
                if (!cartContainer || !cartView) return;
                
                // Add skeleton class to view
                cartView.classList.add('skeleton');
                
                cartContainer.innerHTML = `
                    <div class="page-header">
                        <div class="skeleton-page-title"></div>
                        <div class="skeleton-page-subtitle"></div>
                    </div>
                    <div class="skeleton-list-item">
                        <div class="skeleton-list-content">
                            <div class="skeleton-list-image"></div>
                            <div class="skeleton-list-details">
                                <div class="skeleton-list-title"></div>
                                <div class="skeleton-list-subtitle"></div>
                            </div>
                        </div>
                    </div>
                    <div class="skeleton-list-item">
                        <div class="skeleton-list-content">
                            <div class="skeleton-list-image"></div>
                            <div class="skeleton-list-details">
                                <div class="skeleton-list-title"></div>
                                <div class="skeleton-list-subtitle"></div>
                            </div>
                        </div>
                    </div>
                    <div class="skeleton-list-item">
                        <div class="skeleton-list-content">
                            <div class="skeleton-list-image"></div>
                            <div class="skeleton-list-details">
                                <div class="skeleton-list-title"></div>
                                <div class="skeleton-list-subtitle"></div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            function renderCheckoutSkeleton() {
                const checkoutView = document.getElementById('checkout-view');
                const checkoutForm = document.getElementById('checkout-form');
                if (!checkoutForm || !checkoutView) return;
                
                // Add skeleton class to view
                checkoutView.classList.add('skeleton');
                
                checkoutForm.innerHTML = `
                    <div class="page-header">
                        <div class="skeleton-page-title"></div>
                        <div class="skeleton-page-subtitle"></div>
                    </div>
                    <div class="skeleton-content-grid">
                        <div class="skeleton-content-card">
                            <div class="skeleton-text medium"></div>
                            <div class="skeleton-text"></div>
                            <div class="skeleton-text"></div>
                            <div class="skeleton-text small"></div>
                        </div>
                        <div class="skeleton-content-card">
                            <div class="skeleton-text medium"></div>
                            <div class="skeleton-text"></div>
                            <div class="skeleton-input"></div>
                            <div class="skeleton-input"></div>
                            <div class="skeleton-button"></div>
                        </div>
                    </div>
                `;
            }
            
            function renderOrderTrackingSkeleton() {
                const orderView = document.getElementById('order-tracking-view');
                const orderContainer = document.getElementById('order-tracking-container');
                if (!orderContainer || !orderView) return;
                
                // Add skeleton class to view
                orderView.classList.add('skeleton');
                
                orderContainer.innerHTML = `
                    <div class="order-tracking-container">
                        <!-- Order Type Header Skeleton -->
                        <div class="skeleton-order-type"></div>
                        
                        <!-- Status Progress Skeleton -->
                        <div class="skeleton-status-progress"></div>
                        
                        <!-- Order Details Skeleton -->
                        <div class="skeleton-order-details"></div>
                        
                        <!-- Order Items Skeleton -->
                        <div class="skeleton-order-details"></div>
                        
                        <!-- Order Summary Skeleton -->
                        <div class="skeleton-order-details" style="height: 150px;"></div>
                    </div>
                `;
            }
            
            function renderOrdersSkeleton() {
                const ordersView = document.getElementById('orders-view');
                const ordersContainer = document.getElementById('order-history-container');
                if (!ordersContainer || !ordersView) return;
                
                // Add skeleton class to view
                ordersView.classList.add('skeleton');
                
                ordersContainer.innerHTML = `
                    <div class="page-header">
                        <div class="skeleton-page-title"></div>
                        <div class="skeleton-page-subtitle"></div>
                    </div>
                    <div class="skeleton-list-item">
                        <div class="skeleton-list-content">
                            <div class="skeleton-list-image"></div>
                            <div class="skeleton-list-details">
                                <div class="skeleton-list-title"></div>
                                <div class="skeleton-list-subtitle"></div>
                            </div>
                        </div>
                    </div>
                    <div class="skeleton-list-item">
                        <div class="skeleton-list-content">
                            <div class="skeleton-list-image"></div>
                            <div class="skeleton-list-details">
                                <div class="skeleton-list-title"></div>
                                <div class="skeleton-list-subtitle"></div>
                            </div>
                        </div>
                    </div>
                    <div class="skeleton-list-item">
                        <div class="skeleton-list-content">
                            <div class="skeleton-list-image"></div>
                            <div class="skeleton-list-details">
                                <div class="skeleton-list-title"></div>
                                <div class="skeleton-list-subtitle"></div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            function renderFavoritesSkeleton() {
                const favoritesView = document.getElementById('favorites-view');
                const favoritesContainer = document.getElementById('favorites-container');
                if (!favoritesContainer || !favoritesView) return;
                
                // Add skeleton class to view
                favoritesView.classList.add('skeleton');
                
                favoritesContainer.innerHTML = `
                    <div class="page-header">
                        <div class="skeleton-page-title"></div>
                        <div class="skeleton-page-subtitle"></div>
                    </div>
                    <div class="skeleton-content-grid">
                        <div class="menu-item-card skeleton">
                            <div class="menu-item-image-container">
                                <div class="skeleton-image"></div>
                            </div>
                            <div class="menu-item-content">
                                <div class="skeleton-text title"></div>
                                <div class="skeleton-text price"></div>
                                <div class="skeleton-text description"></div>
                            </div>
                        </div>
                        <div class="menu-item-card skeleton">
                            <div class="menu-item-image-container">
                                <div class="skeleton-image"></div>
                            </div>
                            <div class="menu-item-content">
                                <div class="skeleton-text title"></div>
                                <div class="skeleton-text price"></div>
                                <div class="skeleton-text description"></div>
                            </div>
                        </div>
                        <div class="menu-item-card skeleton">
                            <div class="menu-item-image-container">
                                <div class="skeleton-image"></div>
                            </div>
                            <div class="menu-item-content">
                                <div class="skeleton-text title"></div>
                                <div class="skeleton-text price"></div>
                                <div class="skeleton-text description"></div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Rendering functions
            // Home page rendering with skeleton
            function renderHome() {
                // Show skeleton view immediately
                renderBranchSkeletons();
                
                // Small delay to ensure skeleton is visible
                setTimeout(() => {
                    renderBranches();
                    
                    // Remove skeleton class after content is loaded
                    document.getElementById('home-view').classList.remove('skeleton');
                }, 300); // Minimum 300ms delay to show skeleton
            }
            
            // Featured Branch Cover Section Functions
            async function loadFeaturedBranch() {
                try {
                    const container = document.getElementById('branch-cover-container');
                    const logoContainer = document.getElementById('featured-branch-logo-container');
                    
                    if (!container || !logoContainer) return;
                    
                    // Get the current branch if in menu view, otherwise get the first branch
                    let featuredBranch = null;
                    
                    if (state.currentView === 'menu' && state.currentBranch) {
                        // Use the current branch for menu view
                        featuredBranch = state.currentBranch;
                    } else if (state.branches && state.branches.length > 0) {
                        // Try to find a branch with both cover photo and logo
                        featuredBranch = state.branches.find(branch => 
                            branch.cover_photo_url && branch.logo_url
                        ) || state.branches[0];
                    }
                    
                    if (!featuredBranch) {
                        // If no branches loaded, try to fetch them
                        const response = await apiService.getBranches();
                        const branches = response.data || response;
                        state.branches = branches;
                        
                        if (branches && branches.length > 0) {
                            if (state.currentView === 'menu' && state.currentBranch) {
                                featuredBranch = branches.find(b => b.branch_id === state.currentBranch.branch_id) || branches[0];
                            } else {
                                featuredBranch = branches.find(branch => 
                                    branch.cover_photo_url && branch.logo_url
                                ) || branches[0];
                            }
                        }
                    }
                    
                    if (featuredBranch) {
                        await displayFeaturedBranch(featuredBranch);
                    } else {
                        // Show fallback content if no branches available
                        showFallbackFeaturedBranch();
                    }
                    
                } catch (error) {
                    console.error('Failed to load featured branch:', error);
                    showFallbackFeaturedBranch();
                }
            }
            
            async function displayFeaturedBranch(branch) {
                const container = document.getElementById('branch-cover-container');
                const coverImage = document.getElementById('featured-branch-cover');
                const logoContainer = document.getElementById('featured-branch-logo-container');
                const logoImg = document.getElementById('featured-branch-logo-img');
                const branchName = document.getElementById('featured-branch-name');
                const branchDescription = document.getElementById('featured-branch-description');
                
                if (!container || !coverImage || !logoContainer || !logoImg || !branchName || !branchDescription) {
                    return;
                }
                
                // Remove skeleton classes
                container.classList.remove('skeleton');
                logoContainer.classList.remove('skeleton');
                
                // Set cover image with fallback
                const coverUrl = branch.cover_photo_url || 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80';
                coverImage.style.backgroundImage = `url('${coverUrl}')`;
                
                // Set logo with fallback
                const logoUrl = branch.logo_url || 'https://ui-avatars.com/api/?name=Luna+Dine&background=06C167&color=fff&size=80';
                logoImg.src = logoUrl;
                logoImg.alt = `${branch.internal_name || 'Luna Dine'} Logo`;
                
                // Handle logo loading errors
                logoImg.onerror = () => {
                    logoImg.src = 'https://ui-avatars.com/api/?name=Luna+Dine&background=06C167&color=fff&size=80';
                };
                
                // Set branch name
                const displayName = branch.name_translation_key ? 
                    translate(branch.name_translation_key) : 
                    branch.internal_name || 'Luna Dine';
                branchName.innerHTML = displayName;
                
                // Set branch description
                const description = branch.address ? 
                    `Located at ${branch.address}. Discover our signature dishes and exceptional service.` :
                    'Discover our signature dishes and exceptional service.';
                branchDescription.innerHTML = description;
                
                // Add click interaction to view branch details
                container.style.cursor = 'pointer';
                container.addEventListener('click', () => {
                    if (branch.branch_id) {
                        // Navigate to menu with this branch
                        state.currentBranch = branch;
                        navigateToView('menu');
                        updateBranchNameDisplays();
                    }
                });
            }
            
            function showFallbackFeaturedBranch() {
                const container = document.getElementById('branch-cover-container');
                const coverImage = document.getElementById('featured-branch-cover');
                const logoContainer = document.getElementById('featured-branch-logo-container');
                const logoImg = document.getElementById('featured-branch-logo-img');
                const branchName = document.getElementById('featured-branch-name');
                const branchDescription = document.getElementById('featured-branch-description');
                
                if (!container || !coverImage || !logoContainer || !logoImg || !branchName || !branchDescription) {
                    return;
                }
                
                // Remove skeleton classes
                container.classList.remove('skeleton');
                logoContainer.classList.remove('skeleton');
                
                // Set fallback cover image
                coverImage.style.backgroundImage = `url('https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80')`;
                
                // Set fallback logo
                logoImg.src = 'https://ui-avatars.com/api/?name=Luna+Dine&background=06C167&color=fff&size=80';
                logoImg.alt = 'Luna Dine Logo';
                
                // Set fallback content
                branchName.innerHTML = 'Luna Dine';
                branchDescription.innerHTML = 'Experience culinary excellence under the moonlight. Discover our signature dishes and exceptional service.';
            }
            
            async function renderBranches() {
                elements.branchesContainer.innerHTML = '';
                
                for (const branch of state.branches) {
                    // Use branch logo instead of banners
                    const logoUrl = branch.logo_url || branch.cover_photo_url || '/images/branch-default.jpg';
                    
                    // Generate branch status
                    const branchStatus = getBranchStatus(branch);
                    const statusClass = `status-${branchStatus.status}`;
                    
                    // Generate random stats for demo (in real app, these would come from API)
                    const popularDishes = Math.floor(Math.random() * 8) + 3; // 3-10 dishes
                    const avgRating = (Math.random() * 1.5 + 3.5).toFixed(1); // 3.5-5.0
                    const deliveryTime = Math.floor(Math.random() * 20) + 15; // 15-35 min
                    const distance = (Math.random() * 5 + 0.5).toFixed(1); // 0.5-5.5 km
                    
                    const branchCard = document.createElement('div');
                    branchCard.className = 'branch-card';
                    branchCard.innerHTML = `
                        <div class="branch-image-container">
                            <img src="${logoUrl}" alt="${branch.internal_name}" class="branch-image">
                            <div class="branch-status-badge ${statusClass}">${branchStatus.label}</div>
                        </div>
                        <div class="branch-content">
                            <div class="branch-header">
                                <h3 class="branch-name">${getTranslation(branch.internal_name, branch.name_translation_key)}</h3>
                                <div class="branch-rating">
                                    <i class="fas fa-star"></i>
                                    <span>${avgRating}</span>
                                </div>
                            </div>
                            <p class="branch-address">${branch.address}</p>
                            <div class="branch-stats">
                                <div class="branch-stat">
                                    <i class="fas fa-clock"></i>
                                    <span>${branchStatus.displayTime || `${deliveryTime} min`}</span>
                                </div>
                                <div class="branch-stat">
                                    <i class="fas fa-truck"></i>
                                    <span>${deliveryTime} min</span>
                                </div>
                            </div>
                            <button class="btn" data-branch-id="${branch.branch_id}">${translate('view_menu')}</button>
                        </div>
                    `;
                    
                    // Add click event to the button
                    const button = branchCard.querySelector('button');
                    button.addEventListener('click', () => {
                        window.location.hash = createBranchUrl(branch, 'menu');
                    });
                    
                    elements.branchesContainer.appendChild(branchCard);
                }
            }
            
            // Helper function to determine branch status
            function getBranchStatus(branch) {
                const now = new Date();
                const currentHour = now.getHours();
                const currentDay = now.getDay();
                
                // Mock operating hours (in real app, these would come from branch data)
                const operatingHours = {
                    monday: { open: 8, close: 22 },
                    tuesday: { open: 8, close: 22 },
                    wednesday: { open: 8, close: 22 },
                    thursday: { open: 8, close: 22 },
                    friday: { open: 8, close: 23 },
                    saturday: { open: 9, close: 23 },
                    sunday: { open: 9, close: 21 }
                };
                
                const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
                const todayHours = operatingHours[days[currentDay]];
                
                if (!todayHours) {
                    return {
                        status: 'closed',
                        label: 'Closed',
                        description: 'Currently closed. Please check our operating hours.',
                        displayTime: 'Closed Today'
                    };
                }
                
                if (currentHour < todayHours.open) {
                    return {
                        status: 'closed',
                        label: 'Closed',
                        description: `Opens at ${todayHours.open}:00 AM`,
                        displayTime: `Opens at ${todayHours.open}:00`
                    };
                }
                
                if (currentHour >= todayHours.close - 1 && currentHour < todayHours.close) {
                    return {
                        status: 'closing-soon',
                        label: 'Closing Soon',
                        description: `Closing at ${todayHours.close > 12 ? todayHours.close - 12 : todayHours.close}:00 ${todayHours.close > 12 ? 'PM' : 'AM'}`,
                        displayTime: `Closes ${todayHours.close > 12 ? todayHours.close - 12 : todayHours.close}:00 ${todayHours.close > 12 ? 'PM' : 'AM'}`
                    };
                }
                
                if (currentHour >= todayHours.close) {
                    // Check tomorrow's hours for opening time
                    const tomorrowIndex = (currentDay + 1) % 7;
                    const tomorrowHours = operatingHours[days[tomorrowIndex]];
                    
                    if (tomorrowHours) {
                        return {
                            status: 'closed',
                            label: 'Closed',
                            description: 'Currently closed. Please visit us tomorrow.',
                            displayTime: `Opens ${tomorrowHours.open}:00`
                        };
                    } else {
                        return {
                            status: 'closed',
                            label: 'Closed',
                            description: 'Currently closed. Please check our operating hours.',
                            displayTime: 'Closed Tomorrow'
                        };
                    }
                }
                
                // Random busy status for demo (in real app, this would be based on actual data)
                const isBusy = Math.random() > 0.7; // 30% chance of being busy
                
                if (isBusy) {
                    return {
                        status: 'busy',
                        label: 'Busy',
                        description: 'Currently experiencing high order volume. Delivery may take longer.',
                        displayTime: null // Will show delivery time instead
                    };
                }
                
                return {
                    status: 'open',
                    label: 'Open Now',
                    description: 'Currently open and ready to serve you!',
                    displayTime: null // Will show delivery time instead
                };
            }
            
    
            
            // ===== NEW TABBED LAYOUT FUNCTIONS =====
            
            // Debug function to manually trigger rendering
            window.debugRenderMenu = function() {
                console.log('Manual debug render triggered');
                console.log('state.menuData:', state.menuData);
                console.log('state.categories:', state.categories);
                
                if (state.menuData && state.menuData.length > 0) {
                    renderCategoryTabs();
                    renderMenuContentArea('all');
                    setupStickyTabs();
                    console.log('Manual render completed');
                } else {
                    console.error('No menu data available for rendering');
                }
            };
            
            function renderCategoryTabs() {
                console.log('renderCategoryTabs called');
                console.log('state.categories:', state.categories);
                console.log('state.menuData:', state.menuData);
                
                const categoryTabs = document.getElementById('category-tabs');
                if (!categoryTabs) {
                    console.error('category-tabs element not found');
                    return;
                }
                
                categoryTabs.innerHTML = '';
                
                // Add "All Items" tab
                const allTab = createCategoryTab({
                    id: 'all',
                    name: translate('all_items') || 'All Items',
                    icon: 'fas fa-th-large',
                    count: state.menuData ? state.menuData.reduce((total, cat) => total + (cat.items ? cat.items.length : 0), 0) : 0
                }, true);
                categoryTabs.appendChild(allTab);
                
                // Add category tabs
                state.categories.forEach(category => {
                    const categoryData = state.menuData ? state.menuData.find(cat => cat.category_id === category.id) : null;
                    const itemCount = categoryData && categoryData.items ? categoryData.items.length : 0;
                    
                    const tab = createCategoryTab({
                        id: category.id,
                        name: category.name,
                        icon: category.icon || 'fas fa-utensils',
                        count: itemCount,
                        isNew: category.is_new || false
                    });
                    categoryTabs.appendChild(tab);
                });
                
                console.log('Category tabs rendered');
                // Setup tab scrolling
                setupTabScrolling();
            }
            
            function createCategoryTab(category, isActive = false) {
                const tab = document.createElement('button');
                tab.className = `category-tab ${isActive ? 'active' : ''} ${category.isNew ? 'new' : ''}`;
                tab.setAttribute('data-category-id', category.id);
                
                const icon = category.icon ? `<i class="${category.icon} category-icon"></i>` : '';
                const count = category.count > 0 ? `<span class="item-count">${category.count}</span>` : '';
                const text = `<span class="tab-text">${category.name}</span>`;
                
                tab.innerHTML = `${icon}${text}${count}`;
                
                tab.addEventListener('click', () => {
                    selectCategoryTab(category.id);
                });
                
                return tab;
            }
            
            function selectCategoryTab(categoryId) {
                // Update active tab
                const tabs = document.querySelectorAll('.category-tab');
                tabs.forEach(tab => {
                    if (tab.getAttribute('data-category-id') === categoryId) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });
                
                // Filter and render menu content
                renderMenuContentArea(categoryId);
            }
            
            function renderMenuContentArea(categoryId = 'all') {
                console.log('renderMenuContentArea called with categoryId:', categoryId);
                console.log('state.menuData:', state.menuData);
                console.log('state.categories:', state.categories);
                
                const contentArea = document.getElementById('menu-content-area');
                if (!contentArea) {
                    console.error('menu-content-area element not found');
                    return;
                }
                
                // Show skeleton briefly during category switching
                contentArea.innerHTML = '';
                contentArea.style.display = 'block';
                renderMenuContentSkeletons(3);
                
                // Use setTimeout to allow skeleton to render before processing data
                setTimeout(() => {
                    let categoriesToShow = [];
                    
                    if (categoryId === 'all') {
                        categoriesToShow = state.menuData || [];
                        console.log('Showing all categories:', categoriesToShow.length);
                    } else {
                        const categoryData = state.menuData ? state.menuData.find(cat => cat.category_id == categoryId) : null;
                        if (categoryData) {
                            categoriesToShow = [categoryData];
                            console.log('Showing single category:', categoryData.category_name);
                        }
                    }
                    
                    if (categoriesToShow.length === 0) {
                        console.log('No categories to show');
                        contentArea.innerHTML = `
                            <div class="menu-section-empty">
                                <i class="fas fa-utensils"></i>
                                <h3>${translate('no_items_found') || 'No items found'}</h3>
                                <p>${translate('try_different_category') || 'Try selecting a different category'}</p>
                                <button class="btn" onclick="selectCategoryTab('all')">${translate('view_all_items') || 'View All Items'}</button>
                            </div>
                        `;
                        return;
                    }
                    
                    console.log('Rendering', categoriesToShow.length, 'categories');
                    contentArea.innerHTML = ''; // Clear skeletons
                    categoriesToShow.forEach(category => {
                        const section = createMenuSection(category);
                        contentArea.appendChild(section);
                    });
                }, 100); // Small delay to show skeleton transition
            }
            
            function createMenuSection(category) {
                const section = document.createElement('div');
                section.className = 'menu-section';
                section.id = `category-${category.category_id}`;
                
                const itemCount = category.items ? category.items.length : 0;
                const subtitle = itemCount > 0 ? `${itemCount} ${itemCount === 1 ? 'item' : 'items'}` : '';
                
                section.innerHTML = `
                    <div class="menu-section-header">
                        <div>
                            <h3 class="menu-section-title">
                                <i class="fas fa-utensils section-icon"></i>
                                ${getTranslation(category.category_name, category.name_translation_key)}
                            </h3>
                            ${subtitle ? `<p class="menu-section-subtitle">${subtitle}</p>` : ''}
                        </div>
                    </div>
                    <div class="menu-section-items" id="section-items-${category.category_id}">
                        <!-- Items will be rendered here -->
                    </div>
                `;
                
                // Add items to the section
                const itemsContainer = section.querySelector(`#section-items-${category.category_id}`);
                if (itemsContainer && category.items) {
                    category.items.forEach(item => {
                        const itemCard = createMenuItemCard(item);
                        itemsContainer.appendChild(itemCard);
                    });
                }
                
                return section;
            }
            
            // Update menu cards quantity controllers after rendering
            setTimeout(() => {
                updateMenuCardsQuantityControllers();
            }, 100);
            
            function createMenuItemCard(item) {
                console.log('createMenuItemCard called with item:', {
                    item_name: item.item_name,
                    branch_menu_id: item.branch_menu_id,
                    price: item.price
                });
                
                const isFavorite = state.favorites.some(fav => fav.branch_menu_id === item.branch_menu_id);
                const quantity = getItemQuantityInCart(item.branch_menu_id);
                
                console.log('createMenuItemCard - quantity in cart:', quantity);
                
                const itemCard = document.createElement('div');
                itemCard.className = 'menu-item-card';
                itemCard.setAttribute('data-branch-menu-id', item.branch_menu_id);
                itemCard.innerHTML = `
                    <div class="menu-item-image-container">
                        <img src="${item.image_url || '/images/food-default.jpg'}" alt="${item.item_name}" class="menu-item-image">
                        ${item.is_featured ? '<span class="menu-item-badge">Featured</span>' : ''}
                    </div>
                    <div class="menu-item-content">
                        <div class="menu-item-header">
                            <h4 class="menu-item-name">${getTranslation(item.item_name, item.name_translation_key)}</h4>
                            <div class="menu-item-price">${formatPrice(item.price)}</div>
                        </div>
                        <p class="menu-item-desc">${getTranslation(item.item_description, item.description_translation_key) || translate('delicious_menu_item')}</p>
                        <div class="menu-item-footer">
                            <div class="prep-time-with-favorite">
                                <span class="prep-time"><i class="fas fa-clock"></i> ${item.preparation_time_minutes || 15} ${translate('mins')}</span>
                                <button class="btn-favorite ${isFavorite ? 'active' : ''}" data-item-id="${item.branch_menu_id}">
                                    <i class="fas fa-heart"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    ${createQuantityControllerHTML(item, quantity)}
                `;
                
                console.log('createMenuItemCard - quantity controller HTML:', createQuantityControllerHTML(item, quantity));
                
                // Add click event to show item detail modal (but not when clicking on quantity controller)
                itemCard.addEventListener('click', (e) => {
                    console.log('Menu item card clicked:', item.item_name);
                    console.log('Event target:', e.target);
                    console.log('Closest quantity controller:', e.target.closest('.menu-item-quantity-controller'));
                    console.log('Closest favorite button:', e.target.closest('.btn-favorite'));
                    
                    // Don't open modal if clicking on quantity controller or favorite button
                    if (e.target.closest('.menu-item-quantity-controller') || e.target.closest('.btn-favorite')) {
                        console.log('Click prevented due to quantity controller or favorite button');
                        return;
                    }
                    console.log('Calling showItemDetailModal for:', item.item_name);
                    showItemDetailModal(item);
                });
                
                // Add favorite toggle event
                const favoriteBtn = itemCard.querySelector('.btn-favorite');
                favoriteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleFavorite(item);
                    favoriteBtn.classList.toggle('active');
                });
                
                // Setup quantity controller events
                setupQuantityControllerEvents(itemCard, item);
                
                return itemCard;
            }
            
            function setupStickyTabs() {
                const tabsContainer = document.getElementById('category-tabs-container');
                if (!tabsContainer) return;
                
                const header = document.querySelector('.header');
                const headerHeight = header ? header.offsetHeight : 64;
                
                const handleScroll = () => {
                    const scrollPosition = window.pageYOffset;
                    
                    if (scrollPosition > headerHeight) {
                        tabsContainer.classList.add('sticky');
                        tabsContainer.style.top = `${headerHeight}px`;
                    } else {
                        tabsContainer.classList.remove('sticky');
                        tabsContainer.style.top = '80px';
                    }
                };
                
                window.addEventListener('scroll', handleScroll);
                handleScroll(); // Initial call
            }
            
            function setupTabScrolling() {
                const tabsContainer = document.getElementById('category-tabs');
                const tabsWrapper = document.querySelector('.category-tabs-wrapper');
                
                if (!tabsContainer || !tabsWrapper) return;
                
                const updateScrollIndicators = () => {
                    const isAtStart = tabsContainer.scrollLeft <= 0;
                    const isAtEnd = tabsContainer.scrollLeft >= tabsContainer.scrollWidth - tabsContainer.clientWidth - 1; // -1 for rounding
                    
                    // Add/remove classes to show/hide scroll indicators
                    tabsWrapper.classList.toggle('no-scroll-left', isAtStart);
                    tabsWrapper.classList.toggle('no-scroll-right', isAtEnd);
                    
                    // Add scroll hint animation if there's more content to scroll
                    const canScroll = !isAtStart || !isAtEnd;
                    tabsContainer.classList.toggle('scroll-hint', canScroll);
                };
                
                // Add touch/mouse wheel support for better UX
                let isDown = false;
                let startX;
                let scrollLeft;
                
                // Mouse events for desktop
                tabsContainer.addEventListener('mousedown', (e) => {
                    isDown = true;
                    startX = e.pageX - tabsContainer.offsetLeft;
                    scrollLeft = tabsContainer.scrollLeft;
                    tabsContainer.style.cursor = 'grabbing';
                    tabsContainer.classList.remove('scroll-hint');
                });
                
                tabsContainer.addEventListener('mouseleave', () => {
                    isDown = false;
                    tabsContainer.style.cursor = 'grab';
                });
                
                tabsContainer.addEventListener('mouseup', () => {
                    isDown = false;
                    tabsContainer.style.cursor = 'grab';
                    updateScrollIndicators();
                });
                
                tabsContainer.addEventListener('mousemove', (e) => {
                    if (!isDown) return;
                    e.preventDefault();
                    const x = e.pageX - tabsContainer.offsetLeft;
                    const walk = (x - startX) * 2; // Scroll speed
                    tabsContainer.scrollLeft = scrollLeft - walk;
                });
                
                // Touch events for mobile
                let touchStartX = 0;
                let touchScrollLeft = 0;
                
                tabsContainer.addEventListener('touchstart', (e) => {
                    touchStartX = e.touches[0].clientX;
                    touchScrollLeft = tabsContainer.scrollLeft;
                    tabsContainer.classList.remove('scroll-hint');
                }, { passive: true });
                
                tabsContainer.addEventListener('touchmove', (e) => {
                    const touchX = e.touches[0].clientX;
                    const walk = (touchStartX - touchX) * 2; // Scroll speed
                    tabsContainer.scrollLeft = touchScrollLeft + walk;
                }, { passive: true });
                
                tabsContainer.addEventListener('touchend', updateScrollIndicators, { passive: true });
                
                // Wheel event for desktop scrolling
                tabsContainer.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    tabsContainer.scrollLeft += e.deltaY * 0.5; // Adjust scroll speed
                    updateScrollIndicators();
                }, { passive: false });
                
                // Keyboard navigation
                tabsContainer.addEventListener('keydown', (e) => {
                    if (!['ArrowLeft', 'ArrowRight'].includes(e.key)) return;
                    
                    e.preventDefault();
                    const scrollAmount = 150;
                    
                    if (e.key === 'ArrowLeft') {
                        tabsContainer.scrollLeft -= scrollAmount;
                    } else {
                        tabsContainer.scrollLeft += scrollAmount;
                    }
                    
                    updateScrollIndicators();
                });
                
                // Make tabs container focusable for keyboard navigation
                tabsContainer.setAttribute('tabindex', '0');
                tabsContainer.setAttribute('role', 'tablist');
                
                // Update indicators on scroll and resize
                tabsContainer.addEventListener('scroll', updateScrollIndicators);
                window.addEventListener('resize', updateScrollIndicators);
                
                // Initial call
                updateScrollIndicators();
                
                // Set initial cursor style
                tabsContainer.style.cursor = 'grab';
            }
            
            // Update the existing renderCategories function to only render tabs
            function renderCategories() {
                console.log('renderCategories called');
                console.log('state.categories:', state.categories);
                
                // Skip rendering original sidebar categories since we removed the sidebar
                // Only render new category tabs
                renderCategoryTabs();
            }
            
            // Update the existing renderMenuItems function to also render content area
            function renderMenuItems() {
                console.log('renderMenuItems called');
                console.log('state.menuData:', state.menuData);
                
                // Render original menu items (for fallback)
                elements.menuItemsContainer.innerHTML = '';
                
                state.menuData.forEach(category => {
                    const categorySection = document.createElement('div');
                    categorySection.id = `category-${category.category_id}`;
                    categorySection.innerHTML = `
                        <h3>${getTranslation('Category', category.category_name)}</h3>
                    `;
                    
                    const itemsGrid = document.createElement('div');
                    itemsGrid.className = 'menu-items-grid';
                    
                    category.items.forEach(item => {
                        const isFavorite = state.favorites.some(fav => fav.branch_menu_id === item.branch_menu_id);
                        const quantity = getItemQuantityInCart(item.branch_menu_id);
                        
                        const itemCard = document.createElement('div');
                        itemCard.className = 'menu-item-card';
                        itemCard.setAttribute('data-branch-menu-id', item.branch_menu_id);
                        itemCard.innerHTML = `
                            <div class="menu-item-image-container">
                                <img src="${item.image_url || '/images/food-default.jpg'}" alt="${item.item_name}" class="menu-item-image">
                                ${item.is_featured ? '<span class="menu-item-badge">Featured</span>' : ''}
                            </div>
                            <div class="menu-item-content">
                                <div class="menu-item-header">
                                    <h4 class="menu-item-name">${getTranslation(item.item_name, item.name_translation_key)}</h4>
                                    <div class="menu-item-price">${formatPrice(item.price)}</div>
                                </div>
                                <p class="menu-item-desc">${getTranslation(item.item_description, item.description_translation_key) || translate('delicious_menu_item')}</p>
                                <div class="menu-item-footer">
                                    <div class="prep-time-with-favorite">
                                        <span class="prep-time"><i class="fas fa-clock"></i> ${item.preparation_time_minutes || 15} ${translate('mins')}</span>
                                        <button class="btn-favorite ${isFavorite ? 'active' : ''}" data-item-id="${item.branch_menu_id}">
                                            <i class="fas fa-heart"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            ${createQuantityControllerHTML(item, quantity)}
                        `;
                        
                        // Add click event to show item detail modal (but not when clicking on quantity controller)
                        itemCard.addEventListener('click', (e) => {
                            console.log('Menu item card clicked (renderMenuContentArea):', item.item_name);
                            console.log('Event target:', e.target);
                            console.log('Closest quantity controller:', e.target.closest('.menu-item-quantity-controller'));
                            console.log('Closest favorite button:', e.target.closest('.btn-favorite'));
                            
                            // Don't open modal if clicking on quantity controller or favorite button
                            if (e.target.closest('.menu-item-quantity-controller') || e.target.closest('.btn-favorite')) {
                                console.log('Click prevented due to quantity controller or favorite button');
                                return;
                            }
                            console.log('Calling showItemDetailModal for:', item.item_name);
                            showItemDetailModal(item);
                        });
                        
                        // Add favorite toggle event
                        const favoriteBtn = itemCard.querySelector('.btn-favorite');
                        favoriteBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            toggleFavorite(item);
                            favoriteBtn.classList.toggle('active');
                        });
                        
                        // Setup quantity controller events
                        setupQuantityControllerEvents(itemCard, item);
                        
                        itemsGrid.appendChild(itemCard);
                    });
                    
                    categorySection.appendChild(itemsGrid);
                    elements.menuItemsContainer.appendChild(categorySection);
                });
                
                // Render new content area
                setTimeout(() => {
                    renderMenuContentArea('all');
                }, 100);
                
                // Setup sticky tabs
                setTimeout(() => {
                    setupStickyTabs();
                }, 200);
            }
            
            function renderPromotions() {
                console.log('renderPromotions called');
                console.log('state.promotions:', state.promotions);
                
                if (!state.promotions || state.promotions.length === 0) {
                    if (elements.compactPromotions) {
                        elements.compactPromotions.innerHTML = `
                            <div class="compact-promotions-empty">
                                <i class="fas fa-tag"></i>
                                <p>No special offers available at the moment</p>
                            </div>
                        `;
                    }
                    if (elements.promotionsContainer) {
                        elements.promotionsContainer.style.display = 'none';
                    }
                    return;
                }
                
                // Render compact promotions
                if (elements.compactPromotions) {
                    elements.compactPromotions.innerHTML = `
                        <div class="compact-promotions-slider" id="compact-promotions-slider">
                            <!-- Promotions will be dynamically loaded here -->
                        </div>
                        <button class="compact-promotions-nav prev hidden" id="compact-promotions-prev">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="compact-promotions-nav next hidden" id="compact-promotions-next">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    `;
                    
                    const slider = document.getElementById('compact-promotions-slider');
                    if (slider) {
                        state.promotions.forEach(promo => {
                            const promoCard = createCompactPromotionCard(promo);
                            slider.appendChild(promoCard);
                        });
                    }
                    
                    // Setup navigation buttons
                    setupCompactPromotionsNavigation();
                }
                
                // Keep original promotions container for fallback (hidden)
                if (elements.promotionsContainer) {
                    elements.promotionsContainer.style.display = 'none';
                }
            }
            
            function createCompactPromotionCard(promo) {
                const card = document.createElement('div');
                card.className = 'compact-promotion-card';
                
                const isValid = new Date(promo.end_date) > new Date();
                const validityText = isValid ? 'Valid until ' + new Date(promo.end_date).toLocaleDateString() : 'Expired';
                const validityIcon = isValid ? 'fas fa-clock' : 'fas fa-times-circle';
                
                const promoTitle = getTranslation('Special Offer', promo.description_translation_key);
                const promoDescription = promo.type === 'PERCENTAGE' 
                    ? `${promo.value}% off` 
                    : `${formatPrice(promo.value)} off`;
                
                card.innerHTML = `
                    <div class="compact-promotion-header">
                        <div class="compact-promotion-title">
                            <i class="fas fa-tag promo-icon"></i>
                            ${promoTitle}
                        </div>
                        ${isValid ? '<span class="compact-promotion-badge">Active</span>' : '<span class="compact-promotion-badge">Expired</span>'}
                    </div>
                    <div class="compact-promotion-description">
                        ${promoDescription}${promo.min_order_value ? ` • Min: ${formatPrice(promo.min_order_value)}` : ''}
                    </div>
                    <div class="compact-promotion-footer">
                        <div class="compact-promotion-code">${promo.code || 'PROMO'}</div>
                        <div class="compact-promotion-validity">
                            <i class="${validityIcon} validity-icon"></i>
                            ${isValid ? new Date(promo.end_date).toLocaleDateString() : 'Expired'}
                        </div>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    // Copy promo code to clipboard
                    const promoCode = promo.code || 'PROMO';
                    navigator.clipboard.writeText(promoCode).then(() => {
                        showToast(`Promo code "${promoCode}" copied to clipboard!`);
                    }).catch(() => {
                        showToast(`Promo code: ${promoCode}`);
                    });
                });
                
                return card;
            }
            
            function setupCompactPromotionsNavigation() {
                const slider = document.getElementById('compact-promotions-slider');
                const prevBtn = document.getElementById('compact-promotions-prev');
                const nextBtn = document.getElementById('compact-promotions-next');
                
                if (!slider || !prevBtn || !nextBtn) return;
                
                const updateNavButtons = () => {
                    const isAtStart = slider.scrollLeft <= 0;
                    const isAtEnd = slider.scrollLeft >= slider.scrollWidth - slider.clientWidth;
                    
                    prevBtn.classList.toggle('hidden', isAtStart);
                    nextBtn.classList.toggle('hidden', isAtEnd);
                };
                
                prevBtn.addEventListener('click', () => {
                    slider.scrollBy({
                        left: -300,
                        behavior: 'smooth'
                    });
                });
                
                nextBtn.addEventListener('click', () => {
                    slider.scrollBy({
                        left: 300,
                        behavior: 'smooth'
                    });
                });
                
                slider.addEventListener('scroll', updateNavButtons);
                window.addEventListener('resize', updateNavButtons);
                
                updateNavButtons(); // Initial call
            }
            
            function renderCart() {
                // Show skeleton view immediately
                renderCartSkeleton();
                
                // Update cart page title with branch name
                updateBranchNameDisplays();
                
                // Update current cart to ensure we're showing the right branch's cart
                updateCurrentCart();
                
                // Small delay to ensure skeleton is visible
                setTimeout(() => {
                    if (state.cart.length === 0) {
                        const browseMenuUrl = state.currentBranch ? 
                            createBranchUrl(state.currentBranch, 'menu') : 
                            '#menu';
                        
                        elements.cartContainer.innerHTML = `
                            <div class="empty-cart">
                                <i class="fas fa-shopping-cart"></i>
                                <h3>${translate('empty_cart')}</h3>
                                <p>${translate('add_some_delicious_items')}</p>
                                <a href="${browseMenuUrl}" class="btn">${translate('browse_menu')}</a>
                            </div>
                        `;
                    } else {
                        const cartItems = document.createElement('div');
                        cartItems.className = 'cart-items';
                        
                        let subtotal = 0;
                        
                        state.cart.forEach((item, index) => {
                            const itemTotal = item.price * item.quantity;
                            subtotal += itemTotal;
                            
                            const cartItem = document.createElement('div');
                            cartItem.className = 'cart-item';
                            cartItem.setAttribute('data-branch-menu-id', item.branch_menu_id);
                            cartItem.setAttribute('data-cart-index', index);
                    
                    const customizationText = formatCustomizations(item.customizations);
                    const hasCustomizations = customizationText && customizationText.trim() !== '';
                    
                    cartItem.innerHTML = `
                        <img src="${item.image_url || '/images/food-default.jpg'}" alt="${item.name}" class="cart-item-image">
                        <div class="cart-item-details">
                            <h4 class="cart-item-name">${getTranslation(item.name, item.name_translation_key)}</h4>
                            ${hasCustomizations ? `<p class="cart-item-customizations">${customizationText}</p>` : ''}
                        </div>
                        <div class="cart-item-actions">
                            <div class="quantity-control">
                                <button class="quantity-btn" data-action="decrease" data-index="${index}">-</button>
                                <input type="text" class="quantity-input" value="${item.quantity}" readonly>
                                <button class="quantity-btn" data-action="increase" data-index="${index}">+</button>
                            </div>
                            <button class="btn-remove" data-index="${index}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="cart-item-price-section">
                            ${hasCustomizations ? `
                            <div class="cart-item-price-breakdown">
                                <div class="price-breakdown">${formatDetailedPrice(item)}</div>
                            </div>
                            ` : ''}
                            <div class="cart-item-price-total">
                                <div class="price-total">${formatPrice(item.price)} × ${item.quantity} = ${formatPrice(itemTotal)}</div>
                            </div>
                        </div>
                    `;
                    
                    cartItems.appendChild(cartItem);
                });
                
                elements.cartContainer.appendChild(cartItems);
                
                // Calculate totals using branch settings
                const settings = state.currentBranch?.settings || {};
                const serviceChargePercentage = parseFloat(settings.service_charge_percentage) || 0;
                const vatPercentage = parseFloat(settings.vat_percentage) || 0;
                
                const serviceCharge = subtotal * (serviceChargePercentage / 100);
                const tax = (subtotal + serviceCharge) * (vatPercentage / 100);
                
                // Calculate discount if promo is applied
                const discountAmount = state.appliedPromo ? calculateDiscountAmount(subtotal, state.appliedPromo) : 0;
                const total = subtotal + serviceCharge + tax - discountAmount;
                
                // Add promo code section before cart summary
                const promoSection = document.createElement('div');
                promoSection.className = 'promo-code-section';
                promoSection.innerHTML = `
                    <h4>${translate('promo_code')}</h4>
                    <div id="promo-code-container">
                        <div class="promo-code-input-group">
                            <input type="text" class="promo-code-input" id="promo-code-input" placeholder="${translate('promo_code')}" maxlength="20">
                            <button class="apply-promo-btn" id="apply-promo-btn">${translate('apply_promo')}</button>
                        </div>
                        <div id="promo-status"></div>
                    </div>
                `;
                
                elements.cartContainer.appendChild(promoSection);
                
                const cartSummary = document.createElement('div');
                cartSummary.className = 'cart-summary';
                cartSummary.innerHTML = `
                    <div class="summary-row">
                        <span>${translate('subtotal')}:</span>
                        <span>${formatPrice(subtotal)}</span>
                    </div>
                    ${serviceCharge > 0 ? `
                    <div class="summary-row">
                        <span>${translate('service_charge')} (${serviceChargePercentage}%):</span>
                        <span>${formatPrice(serviceCharge)}</span>
                    </div>
                    ` : ''}
                    ${tax > 0 ? `
                    <div class="summary-row">
                        <span>${translate('tax')} (${vatPercentage}%):</span>
                        <span>${formatPrice(tax)}</span>
                    </div>
                    ` : ''}
                    ${state.appliedPromo ? `
                    <div class="summary-row discount-row">
                        <span>${translate('discount')} (${state.appliedPromo.code}):</span>
                        <span>-${formatPrice(discountAmount)}</span>
                    </div>
                    ` : ''}
                    <div class="summary-row summary-total">
                        <span>${translate('total')}:</span>
                        <span>${formatPrice(total)}</span>
                    </div>
                    <button class="btn" id="checkout-btn">${translate('proceed_to_checkout')}</button>
                `;
                
                elements.cartContainer.appendChild(cartSummary);
                
                // Attach event listeners using our robust function
                attachCartEventListeners();
                
                // Add promo code functionality
                setTimeout(() => {
                    setupPromoCodeFunctionality();
                }, 100);
                    }
                    
                    // Remove skeleton class after content is loaded
                    document.getElementById('cart-view').classList.remove('skeleton');
                    
                    // Final check to ensure all event listeners are properly attached
                    setTimeout(() => {
                        attachCartEventListeners();
                    }, 100);
                }, 300); // Minimum 300ms delay to show skeleton
            }
            
            async function renderCheckout() {
                // Show skeleton view immediately
                renderCheckoutSkeleton();
                
                // Update checkout page title with branch name
                updateBranchNameDisplays();
                
                // Small delay to ensure skeleton is visible
                setTimeout(async () => {
                    elements.checkoutForm.innerHTML = `
                        <div class="order-type-selector">
                            <div class="order-type-btn active" data-type="dine-in">
                                <div class="order-type-icon">
                                    <i class="fas fa-utensils"></i>
                                </div>
                                <div>${translate('dine_in')}</div>
                            </div>
                            <div class="order-type-btn" data-type="takeaway">
                                <div class="order-type-icon">
                                    <i class="fas fa-box"></i>
                                </div>
                                <div>${translate('takeaway')}</div>
                            </div>
                            <div class="order-type-btn" data-type="delivery">
                                <div class="order-type-icon">
                                    <i class="fas fa-truck"></i>
                                </div>
                                <div>${translate('delivery')}</div>
                            </div>
                        </div>
                        
                        <div id="checkout-details">
                            <!-- Dynamic content based on order type -->
                        </div>
                    `;
                    
                    // Set up order type selection
                    document.querySelectorAll('.order-type-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            document.querySelectorAll('.order-type-btn').forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                            renderCheckoutDetails(btn.getAttribute('data-type'));
                            // Refresh order summary to update delivery charge
                            setTimeout(() => {
                                renderCheckoutOrderSummary();
                            }, 100);
                        });
                    });
                    
                    // Render initial checkout details
                    await renderCheckoutDetails('dine-in');
                    
                    // Remove skeleton class after content is loaded
                    document.getElementById('checkout-view').classList.remove('skeleton');
                }, 300); // Minimum 300ms delay to show skeleton
            }
            
            async function renderCheckoutDetails(orderType) {
                const detailsContainer = document.getElementById('checkout-details');
                
                if (!state.currentBranch) {
                    detailsContainer.innerHTML = `
                        <div class="error-message">
                            <p>${translate('please_select_branch')}</p>
                        </div>
                    `;
                    return;
                }
                
                switch(orderType) {
                    case 'dine-in':
                        // Load branch tables
                        const tables = await loadBranchTables(state.currentBranch.branch_id);
                        const tableOptions = tables.map(table => 
                            `<option value="${table.table_id}">${translate('table')} ${table.table_identifier}</option>`
                        ).join('');
                        
                        detailsContainer.innerHTML = `
                            <h3>${translate('dine_in')} ${translate('details')}</h3>
                            <div class="form-group">
                                <label class="form-label">${translate('table_number')}</label>
                                <select class="form-select" id="table-number">
                                    <option value="">${translate('select_table')}</option>
                                    ${tableOptions}
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">${translate('guests_count')}</label>
                                <input type="number" class="form-input" id="guests-count" min="1" value="1">
                            </div>
                        `;
                        break;
                        
                    case 'takeaway':
                        detailsContainer.innerHTML = `
                            <h3>${translate('takeaway')} ${translate('details')}</h3>
                            <div class="form-group">
                                <label class="form-label">${translate('pickup_time')}</label>
                                <input type="time" class="form-input" id="pickup-time-input">
                                <input type="hidden" id="pickup-time" name="pickup-time">
                                <div class="pickup-time-display" id="pickup-time-display"></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">${translate('your_name')}</label>
                                <input type="text" class="form-input" id="customer-name" value="${state.userInfo?.name || ''}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">${translate('phone_number')}</label>
                                <input type="tel" class="form-input" id="customer-phone" value="${state.userInfo?.phone || ''}">
                            </div>
                        `;
                        break;
                        
                    case 'delivery':
                        detailsContainer.innerHTML = `
                            <h3>${translate('delivery')} ${translate('details')}</h3>
                            <div class="form-group">
                                <label class="form-label">${translate('delivery_address')}</label>
                                <textarea class="form-textarea" id="delivery-address">${state.userInfo?.address || ''}</textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">${translate('your_name')}</label>
                                <input type="text" class="form-input" id="customer-name" value="${state.userInfo?.name || ''}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">${translate('phone_number')}</label>
                                <input type="tel" class="form-input" id="customer-phone" value="${state.userInfo?.phone || ''}">
                            </div>
                        `;
                        break;
                }
                
                // Add customer info fields common to all order types
                detailsContainer.innerHTML += `
                    <h3>${translate('payment')} ${translate('information')}</h3>
                    
                    <div class="form-group">
                        <label class="form-label">${translate('payment_method')}</label>
                        <select class="form-select" id="payment-method">
                            <option value="cash">${translate('cash')}</option>
                            <option value="card">${translate('card')}</option>
                            <option value="mobile">${translate('mobile_payment')}</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">${translate('special_instructions')}</label>
                        <textarea class="form-textarea" id="special-instructions" placeholder="${translate('any_requests')}"></textarea>
                    </div>
                `;
                
                // Setup pickup time functionality if it's takeaway order
                if (orderType === 'takeaway') {
                    setTimeout(() => {
                        setupPickupTime();
                    }, 100);
                }
                
                // Add promo code functionality
                setTimeout(() => {
                    setupPromoCodeFunctionality();
                }, 100);
                
                // Render order summary
                renderCheckoutOrderSummary();
            }
            
            function setupPromoCodeFunctionality() {
                console.log('setupPromoCodeFunctionality called');
                
                const promoInput = document.getElementById('promo-code-input');
                const applyBtn = document.getElementById('apply-promo-btn');
                const promoStatus = document.getElementById('promo-status');
                
                console.log('Elements found in setup:', {
                    promoInput: !!promoInput,
                    applyBtn: !!applyBtn,
                    promoStatus: !!promoStatus
                });
                
                if (!promoInput || !applyBtn || !promoStatus) {
                    console.error('Required elements not found in setup');
                    return;
                }
                
                // Update promo code section based on current state
                updatePromoCodeSection();
                
                // Add event listener for apply button
                applyBtn.addEventListener('click', applyPromoCode);
                console.log('Event listener added to apply button');
                
                // Add event listener for Enter key on input
                promoInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        console.log('Enter key pressed, applying promo code');
                        applyPromoCode();
                    }
                });
                console.log('Event listener added to promo input');
            }
            
            function updatePromoCodeSection() {
                const promoContainer = document.getElementById('promo-code-container');
                const promoStatus = document.getElementById('promo-status');
                
                if (!promoContainer || !promoStatus) return;
                
                if (state.appliedPromo) {
                    // Show applied promo info
                    promoContainer.innerHTML = `
                        <div class="applied-promo-info">
                            <span>
                                <strong>${translate('promo_code')}:</strong> 
                                <span class="applied-promo-code">${state.appliedPromo.code}</span>
                                (${state.appliedPromo.type === 'PERCENTAGE' ? state.appliedPromo.value + '%' : formatPrice(state.appliedPromo.value)})
                            </span>
                            <button class="remove-promo-btn" id="remove-promo-btn">${translate('remove')}</button>
                        </div>
                    `;
                    promoStatus.innerHTML = `<div class="promo-code-status success">${translate('promo_applied')}</div>`;
                    
                    // Add event listener to remove button
                    const removeBtn = document.getElementById('remove-promo-btn');
                    if (removeBtn) {
                        removeBtn.addEventListener('click', removePromoCode);
                    }
                } else {
                    // Show input form
                    promoContainer.innerHTML = `
                        <div class="promo-code-input-group">
                            <input type="text" class="promo-code-input" id="promo-code-input" placeholder="${translate('promo_code')}" maxlength="20">
                            <button class="apply-promo-btn" id="apply-promo-btn">${translate('apply_promo')}</button>
                        </div>
                    `;
                    promoStatus.innerHTML = '';
                    
                    // Re-attach event listeners
                    const newPromoInput = document.getElementById('promo-code-input');
                    const newApplyBtn = document.getElementById('apply-promo-btn');
                    
                    if (newPromoInput && newApplyBtn) {
                        newApplyBtn.addEventListener('click', applyPromoCode);
                        newPromoInput.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') {
                                applyPromoCode();
                            }
                        });
                    }
                }
            }
            
            async function applyPromoCode() {
                console.log('applyPromoCode function called');
                
                const promoInput = document.getElementById('promo-code-input');
                const applyBtn = document.getElementById('apply-promo-btn');
                const promoStatus = document.getElementById('promo-status');
                
                console.log('Elements found:', {
                    promoInput: !!promoInput,
                    applyBtn: !!applyBtn,
                    promoStatus: !!promoStatus
                });
                
                if (!promoInput || !applyBtn) {
                    console.error('Required elements not found');
                    return;
                }
                
                const promoCode = promoInput.value.trim().toUpperCase();
                console.log('Promo code entered:', promoCode);
                
                if (!promoCode) {
                    console.log('No promo code entered');
                    const errorMsg = translate('promo_invalid');
                    if (promoStatus) showPromoStatus('error', errorMsg);
                    showError(errorMsg);
                    return;
                }
                
                // Disable button during processing
                applyBtn.disabled = true;
                applyBtn.textContent = '...';
                
                try {
                    console.log('Starting promo code validation...');
                    
                    // Get promotions for current branch
                    if (!state.currentBranch) {
                        console.log('No current branch selected');
                        const errorMsg = translate('please_select_branch');
                        if (promoStatus) showPromoStatus('error', errorMsg);
                        showError(errorMsg);
                        return;
                    }
                    
                    console.log('Current branch:', state.currentBranch);
                    console.log('Fetching promotions for branch:', state.currentBranch.branch_id);
                    
                    const promotions = await apiService.getPromotions(state.currentBranch.branch_id);
                    const promoList = promotions.data || promotions;
                    
                    console.log('Promotions received:', promoList);
                    
                    // Find the promo code
                    const promo = promoList.find(p => 
                        p.code === promoCode && 
                        p.is_active && 
                        (!p.start_date || new Date(p.start_date) <= new Date()) &&
                        (!p.end_date || new Date(p.end_date) >= new Date()) &&
                        (!p.usage_limit || p.usage_count < p.usage_limit)
                    );
                    
                    console.log('Found promo:', promo);
                    
                    if (!promo) {
                        console.log('Promo not found or invalid');
                        
                        // Check specific reasons for failure
                        const inactivePromo = promoList.find(p => p.code === promoCode && !p.is_active);
                        if (inactivePromo) {
                            const errorMsg = translate('promo_invalid');
                            if (promoStatus) showPromoStatus('error', errorMsg);
                            showError(errorMsg);
                            return;
                        }
                        
                        const expiredPromo = promoList.find(p => p.code === promoCode && p.end_date && new Date(p.end_date) < new Date());
                        if (expiredPromo) {
                            const errorMsg = translate('promo_expired');
                            if (promoStatus) showPromoStatus('error', errorMsg);
                            showError(errorMsg);
                            return;
                        }
                        
                        const notStartedPromo = promoList.find(p => p.code === promoCode && p.start_date && new Date(p.start_date) > new Date());
                        if (notStartedPromo) {
                            const errorMsg = translate('promo_not_active');
                            if (promoStatus) showPromoStatus('error', errorMsg);
                            showError(errorMsg);
                            return;
                        }
                        
                        const usageLimitExceeded = promoList.find(p => p.code === promoCode && p.usage_limit && p.usage_count >= p.usage_limit);
                        if (usageLimitExceeded) {
                            const errorMsg = translate('promo_usage_limit');
                            if (promoStatus) showPromoStatus('error', errorMsg);
                            showError(errorMsg);
                            return;
                        }
                        
                        // If none of the specific reasons match, it's an invalid code
                        const errorMsg = translate('promo_invalid');
                        if (promoStatus) showPromoStatus('error', errorMsg);
                        showError(errorMsg);
                        return;
                    }
                    
                    // Check minimum order value
                    const cartSubtotal = calculateCartSubtotal();
                    console.log('Cart subtotal:', cartSubtotal, 'Min order value:', promo.min_order_value);
                    
                    if (promo.min_order_value && cartSubtotal < promo.min_order_value) {
                        console.log('Minimum order value not met');
                        const errorMsg = `${translate('min_order_not_met')} (${formatPrice(promo.min_order_value)})`;
                        if (promoStatus) showPromoStatus('error', errorMsg);
                        showError(errorMsg);
                        return;
                    }
                    
                    // Calculate discount
                    let discountAmount = 0;
                    if (promo.type === 'PERCENTAGE') {
                        discountAmount = (cartSubtotal * promo.value) / 100;
                        if (promo.max_discount_amount && discountAmount > promo.max_discount_amount) {
                            discountAmount = promo.max_discount_amount;
                            console.log('Discount amount limited by max discount:', discountAmount);
                        }
                    } else if (promo.type === 'FIXED_AMOUNT') {
                        discountAmount = promo.value;
                    }
                    
                    console.log('Discount calculated:', discountAmount);
                    
                    // Apply the promo
                    state.appliedPromo = {
                        code: promo.code,
                        type: promo.type,
                        value: promo.value,
                        discount_amount: discountAmount,
                        promo_id: promo.promo_id
                    };
                    
                    console.log('Promo applied:', state.appliedPromo);
                    
                    const successMsg = translate('promo_applied');
                    if (promoStatus) showPromoStatus('success', successMsg);
                    updatePromoCodeSection();
                    
                    // Update order summary if it exists
                    updateOrderSummary();
                    
                    // Also update cart summary if we're on cart page
                    if (state.currentView === 'cart') {
                        updateCartSummaryUI();
                    }
                    
                    // Show success toast as fallback
                    showToast(`Promo code "${promoCode}" applied successfully!`);
                    
                } catch (error) {
                    console.error('Error applying promo code:', error);
                    const errorMsg = translate('promo_invalid');
                    if (promoStatus) showPromoStatus('error', errorMsg);
                    showError(errorMsg);
                } finally {
                    // Re-enable button
                    applyBtn.disabled = false;
                    applyBtn.textContent = translate('apply_promo');
                }
            }
            
            function removePromoCode() {
                state.appliedPromo = null;
                updatePromoCodeSection();
                updateOrderSummary();
                // Also update cart summary if we're on cart page
                if (state.currentView === 'cart') {
                    updateCartSummaryUI();
                }
            }
            
            function showPromoStatus(type, message) {
                const promoStatus = document.getElementById('promo-status');
                if (!promoStatus) return;
                
                promoStatus.innerHTML = `<div class="promo-code-status ${type}">${message}</div>`;
            }
            
            function calculateCartSubtotal() {
                return state.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            }
            
            function calculateDiscountAmount(subtotal, promo) {
                let discountAmount = 0;
                if (promo.type === 'PERCENTAGE') {
                    discountAmount = (subtotal * promo.value) / 100;
                    if (promo.max_discount_amount && discountAmount > promo.max_discount_amount) {
                        discountAmount = promo.max_discount_amount;
                    }
                } else if (promo.type === 'FIXED_AMOUNT') {
                    discountAmount = promo.value;
                }
                return discountAmount;
            }
            
            function calculateDeliveryCharge(deliveryConfig, subtotal) {
                if (!deliveryConfig) return 0;
                
                // Parse config if it's a string
                const config = typeof deliveryConfig === 'string' ? JSON.parse(deliveryConfig) : deliveryConfig;
                
                // Check for minimum order free delivery
                if (config.minimum_order_free && subtotal >= config.minimum_order_free) {
                    return 0; // Free delivery for orders above minimum
                }
                
                // Calculate based on fee type
                switch (config.type) {
                    case 'fixed':
                        return config.amount || 0;
                    
                    case 'percentage':
                        if (config.percentage_based && config.percentage_based.rate) {
                            return Math.round((subtotal * config.percentage_based.rate) / 100);
                        }
                        return 0;
                    
                    case 'distance':
                        // For distance-based, return base amount (distance calculation would require geolocation)
                        if (config.distance_based && config.distance_based.base_amount) {
                            return config.distance_based.base_amount;
                        }
                        return config.amount || 0;
                    
                    default:
                        return config.amount || 50; // Default fallback
                }
            }
            
            function updateOrderSummary() {
                // This function will be called to update the order summary with discount
                // The order summary is rendered in the placeOrder function, so we just need
                // to ensure it reflects the current state including promo discount
                if (state.currentView === 'checkout') {
                    // Re-render checkout details to update order summary
                    const activeOrderType = document.querySelector('.order-type-btn.active');
                    if (activeOrderType) {
                        renderCheckoutDetails(activeOrderType.getAttribute('data-type'));
                    }
                    // Also update the checkout order summary
                    renderCheckoutOrderSummary();
                }
            }
            
            function renderCheckoutOrderSummary() {
                const orderSummaryContainer = document.getElementById('checkout-order-summary');
                if (!orderSummaryContainer) return;
                
                if (state.cart.length === 0) {
                    orderSummaryContainer.innerHTML = '';
                    return;
                }
                
                // Calculate order totals
                const subtotal = calculateCartSubtotal();
                const serviceChargePercentage = parseFloat(state.currentBranch?.settings?.service_charge_percentage) || 0;
                const vatPercentage = parseFloat(state.currentBranch?.settings?.vat_percentage) || 0;
                
                const serviceCharge = subtotal * (serviceChargePercentage / 100);
                const taxableAmount = subtotal + serviceCharge;
                const vat = taxableAmount * (vatPercentage / 100);
                
                // Calculate discount
                let discountAmount = 0;
                if (state.appliedPromo) {
                    discountAmount = state.appliedPromo.discount_amount;
                }
                
                // Calculate delivery charge if order type is delivery
                let deliveryCharge = 0;
                const activeOrderType = document.querySelector('.order-type-btn.active');
                if (activeOrderType && activeOrderType.getAttribute('data-type') === 'delivery') {
                    const deliveryFeeConfig = state.currentBranch?.settings?.delivery_fee_config;
                    if (deliveryFeeConfig) {
                        try {
                            deliveryCharge = calculateDeliveryCharge(deliveryFeeConfig, subtotal);
                        } catch (e) {
                            console.error('Error calculating delivery charge:', e);
                            deliveryCharge = 0;
                        }
                    } else {
                        deliveryCharge = 50; // Default delivery charge
                    }
                }
                
                // Calculate final total
                const total = subtotal + serviceCharge + vat + deliveryCharge - discountAmount;
                
                orderSummaryContainer.innerHTML = `
                    <h3>${translate('order_summary')}</h3>
                    <div class="summary-row">
                        <span>${translate('subtotal')}:</span>
                        <span>${formatPrice(subtotal)}</span>
                    </div>
                    ${serviceCharge > 0 ? `
                    <div class="summary-row">
                        <span>${translate('service_charge')}${serviceChargePercentage > 0 ? ` (${serviceChargePercentage}%)` : ''}:</span>
                        <span>${formatPrice(serviceCharge)}</span>
                    </div>
                    ` : ''}
                    ${vat > 0 ? `
                    <div class="summary-row">
                        <span>${translate('tax')}${vatPercentage > 0 ? ` (${vatPercentage}%)` : ''}:</span>
                        <span>${formatPrice(vat)}</span>
                    </div>
                    ` : ''}
                    ${deliveryCharge > 0 ? `
                    <div class="summary-row">
                        <span>${translate('delivery_charge')}:</span>
                        <span>${formatPrice(deliveryCharge)}</span>
                    </div>
                    ` : ''}
                    ${state.appliedPromo ? `
                    <div class="summary-row discount-row">
                        <span>${translate('discount')} (${state.appliedPromo.code}):</span>
                        <span>-${formatPrice(discountAmount)}</span>
                    </div>
                    ` : ''}
                    <div class="summary-row summary-total">
                        <span>${translate('total')}:</span>
                        <span>${formatPrice(total)}</span>
                    </div>
                    <div class="checkout-actions">
                        <button class="btn" id="place-order-btn">${translate('place_order')}</button>
                    </div>
                `;
                
                // Set up place order button event listener
                const placeOrderBtn = document.getElementById('place-order-btn');
                if (placeOrderBtn) {
                    placeOrderBtn.addEventListener('click', placeOrder);
                }
            }
            
            // Helper functions to get charge percentages from order data
            function getServiceChargePercentage(orderData) {
                // Try to get from applied_rates_snapshot first
                if (orderData.applied_rates_snapshot) {
                    try {
                        const rates = typeof orderData.applied_rates_snapshot === 'string' 
                            ? JSON.parse(orderData.applied_rates_snapshot) 
                            : orderData.applied_rates_snapshot;
                        if (rates.service_charge_percentage) {
                            return ` (${rates.service_charge_percentage}%)`;
                        }
                    } catch (e) {
                        console.warn('Failed to parse applied_rates_snapshot:', e);
                    }
                }
                
                // Fall back to current branch settings
                if (state.currentBranch?.settings?.service_charge_percentage) {
                    return ` (${state.currentBranch.settings.service_charge_percentage}%)`;
                }
                
                // Try to calculate from amount if available
                if (orderData.service_charge_amount && orderData.items_subtotal && orderData.items_subtotal > 0) {
                    const calculatedPercentage = (orderData.service_charge_amount / orderData.items_subtotal) * 100;
                    if (calculatedPercentage > 0) {
                        return ` (${calculatedPercentage.toFixed(2)}%)`;
                    }
                }
                
                return '';
            }

            function getVatPercentage(orderData) {
                // Try to get from applied_rates_snapshot first
                if (orderData.applied_rates_snapshot) {
                    try {
                        const rates = typeof orderData.applied_rates_snapshot === 'string' 
                            ? JSON.parse(orderData.applied_rates_snapshot) 
                            : orderData.applied_rates_snapshot;
                        if (rates.vat_percentage) {
                            return ` (${rates.vat_percentage}%)`;
                        }
                    } catch (e) {
                        console.warn('Failed to parse applied_rates_snapshot:', e);
                    }
                }
                
                // Fall back to current branch settings
                if (state.currentBranch?.settings?.vat_percentage) {
                    return ` (${state.currentBranch.settings.vat_percentage}%)`;
                }
                
                // Try to calculate from amount if available
                if (orderData.vat_amount && orderData.items_subtotal && orderData.service_charge_amount !== undefined) {
                    const taxableAmount = orderData.items_subtotal + (orderData.service_charge_amount || 0);
                    if (taxableAmount > 0) {
                        const calculatedPercentage = (orderData.vat_amount / taxableAmount) * 100;
                        if (calculatedPercentage > 0) {
                            return ` (${calculatedPercentage.toFixed(2)}%)`;
                        }
                    }
                }
                
                return '';
            }

            function renderOrderTracking(order) {
                // Show skeleton view immediately
                renderOrderTrackingSkeleton();
                
                // Small delay to ensure skeleton is visible
                setTimeout(() => {
                    if (!order || !order.data) {
                        elements.orderTrackingContainer.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-receipt"></i>
                                <h3>${translate('order_not_found')}</h3>
                                <p>${translate('order_not_found_message')}</p>
                                <a href="#orders" class="btn">${translate('view_order_history')}</a>
                            </div>
                        `;
                        document.getElementById('order-tracking-view').classList.remove('skeleton');
                        return;
                    }

                    const orderData = order.data;
                    
                    // Define order type-specific status flows
                    const statusFlows = {
                        'dine-in': [
                            { status: 'pending', icon: 'fas fa-clock', label: 'pending' },
                            { status: 'confirmed', icon: 'fas fa-check-circle', label: 'confirmed' },
                            { status: 'preparing', icon: 'fas fa-utensils', label: 'preparing' },
                            { status: 'ready', icon: 'fas fa-bell', label: 'ready' },
                            { status: 'served', icon: 'fas fa-concierge-bell', label: 'served' },
                            { status: 'completed', icon: 'fas fa-check-double', label: 'completed' }
                        ],
                        'takeaway': [
                            { status: 'pending', icon: 'fas fa-clock', label: 'pending' },
                            { status: 'confirmed', icon: 'fas fa-check-circle', label: 'confirmed' },
                            { status: 'preparing', icon: 'fas fa-utensils', label: 'preparing' },
                            { status: 'ready_for_pickup', icon: 'fas fa-box', label: 'ready_for_pickup' },
                            { status: 'picked_up', icon: 'fas fa-hand-holding', label: 'picked_up' },
                            { status: 'completed', icon: 'fas fa-check-double', label: 'completed' }
                        ],
                        'delivery': [
                            { status: 'pending', icon: 'fas fa-clock', label: 'pending' },
                            { status: 'confirmed', icon: 'fas fa-check-circle', label: 'confirmed' },
                            { status: 'preparing', icon: 'fas fa-utensils', label: 'preparing' },
                            { status: 'ready_for_delivery', icon: 'fas fa-motorcycle', label: 'ready_for_delivery' },
                            { status: 'out_for_delivery', icon: 'fas fa-truck', label: 'out_for_delivery' },
                            { status: 'delivered', icon: 'fas fa-home', label: 'delivered' },
                            { status: 'completed', icon: 'fas fa-check-double', label: 'completed' }
                        ]
                    };

                    const currentStatusFlow = statusFlows[orderData.order_type] || statusFlows['dine-in'];
                    const currentStepIndex = currentStatusFlow.findIndex(step => step.status === orderData.status);

                    // Get order type specific information
                    const orderTypeInfo = getOrderTypeInfo(orderData);

                    elements.orderTrackingContainer.innerHTML = `
                        <div class="order-tracking-container">
                            <!-- Order Type Header -->
                            <div class="order-type-header">
                                <div class="order-type-icon ${orderData.order_type}">
                                    ${orderTypeInfo.icon}
                                </div>
                                <div class="order-type-info">
                                    <h3>${translate('order')} <span class="order-number">#${orderData.order_uid}</span></h3>
                                    <p>${orderTypeInfo.typeDescription} • ${orderTypeInfo.statusDescription}</p>
                                </div>
                                <div class="status-badge ${orderData.status}">
                                    ${translate(orderData.status)}
                                </div>
                            </div>

                            <!-- Status Progress -->
                            <div class="order-status">
                                <div class="status-progress ${orderData.order_type}">
                                    ${currentStatusFlow.map((step, index) => {
                                        const isCompleted = index < currentStepIndex;
                                        const isActive = index === currentStepIndex;
                                        return `
                                            <div class="status-step ${orderData.order_type} ${isCompleted ? 'completed' : ''} ${isActive ? 'active' : ''}">
                                                <div class="status-step-icon">
                                                    ${isCompleted ? '<i class="fas fa-check"></i>' : `<i class="${step.icon}"></i>`}
                                                </div>
                                                <div class="step-label">${translate(step.label)}</div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>

                            <!-- Status Description -->
                            <div class="status-description">
                                <h4><i class="fas fa-info-circle"></i> ${translate('current_status')}</h4>
                                <p>${orderTypeInfo.detailedStatus}</p>
                                ${orderTypeInfo.estimatedTime ? `<p><strong>${translate('estimated_time')}:</strong> ${orderTypeInfo.estimatedTime}</p>` : ''}
                            </div>

                            <!-- Order Details -->
                            <div class="order-details">
                                <h4><i class="fas fa-receipt"></i> ${translate('order_details')}</h4>
                                <div class="order-details-grid">
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('order_type')}</div>
                                        <div class="detail-value">${orderTypeInfo.icon} ${translate(orderData.order_type)}</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('status')}</div>
                                        <div class="detail-value">
                                            <span class="status-badge ${orderData.status}">${translate(orderData.status)}</span>
                                        </div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('placed_at')}</div>
                                        <div class="detail-value">${new Date(orderData.created_at).toLocaleString()}</div>
                                    </div>
                                    ${orderData.branch_name ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('branch')}</div>
                                        <div class="detail-value">${getTranslation(orderData.branch_name, orderData.branch_name_translation_key) || orderData.branch_name}</div>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>

                            <!-- Order Type Specific Information -->
                            ${renderOrderTypeSpecificInfo(orderData)}

                            <!-- Order Items -->
                            <div class="order-details">
                                <h4><i class="fas fa-list"></i> ${translate('order_items')}</h4>
                                <div class="order-items-list">
                                    ${orderData.items && orderData.items.length > 0 ? orderData.items.map(item => {
                                        const customizationText = formatCustomizations(item.customizations);
                                        const hasCustomizations = customizationText && customizationText.trim() !== '';
                                        
                                        return `
                                            <div class="order-item-card">
                                                <div class="order-item-image">
                                                    <img src="${item.image_url || '/images/food-default.jpg'}" alt="${getTranslation(item.name, item.name_translation_key)}">
                                                </div>
                                                <div class="order-item-content">
                                                    <div class="order-item-header">
                                                        <h5 class="order-item-name">${getTranslation(item.name, item.name_translation_key)}</h5>
                                                        <div class="order-item-quantity">
                                                            <span class="quantity-badge">×${item.quantity}</span>
                                                        </div>
                                                    </div>
                                                    ${hasCustomizations ? `
                                                    <div class="order-item-customizations">
                                                        <i class="fas fa-cog"></i>
                                                        <span>${customizationText}</span>
                                                    </div>
                                                    ` : ''}
                                                    <div class="order-item-footer">
                                                        <div class="order-item-price">
                                                            ${formatPrice(item.price_at_order)} × ${item.quantity} = ${formatPrice(item.item_total)}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('') : '<p class="no-items">No items found</p>'}
                                </div>
                            </div>

                            <!-- Order Summary -->
                            <div class="order-details">
                                <h4><i class="fas fa-calculator"></i> ${translate('order_summary')}</h4>
                                <div class="order-summary">
                                    <div class="summary-row">
                                        <span>${translate('subtotal')}:</span>
                                        <span>${formatPrice(orderData.items_subtotal)}</span>
                                    </div>
                                    ${orderData.promo_id && orderData.discount_amount > 0 ? `
                                    <div class="summary-row discount-row">
                                        <span>${translate('discount')} ${orderData.promo_code ? `(${orderData.promo_code})` : ''}:</span>
                                        <span>-${formatPrice(orderData.discount_amount)}</span>
                                    </div>
                                    ` : ''}
                                    ${orderData.service_charge_amount ? `
                                    <div class="summary-row">
                                        <span>${translate('service_charge')}${getServiceChargePercentage(orderData)}:</span>
                                        <span>${formatPrice(orderData.service_charge_amount)}</span>
                                    </div>
                                    ` : ''}
                                    ${orderData.vat_amount ? `
                                    <div class="summary-row">
                                        <span>${translate('tax')}${getVatPercentage(orderData)}:</span>
                                        <span>${formatPrice(orderData.vat_amount)}</span>
                                    </div>
                                    ` : ''}
                                    ${orderData.delivery_charge_amount ? `
                                    <div class="summary-row">
                                        <span>${translate('delivery_charge')}:</span>
                                        <span>${formatPrice(orderData.delivery_charge_amount)}</span>
                                    </div>
                                    ` : ''}
                                    <div class="summary-row summary-total">
                                        <span>${translate('total')}:</span>
                                        <span>${formatPrice(orderData.final_amount)}</span>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="action-buttons">
                                        ${renderActionButtons(orderData)}
                                    </div>
                                </div>
                            </div>

                            <!-- Timeline -->
                            ${renderTimeline(orderData)}
                        </div>
                    `;
                    
                    // Add event listeners for action buttons
                    addActionButtonEventListeners(orderData);
                    
                    // Add feedback section for completed orders
                    if (orderData.status === 'completed') {
                        addFeedbackSection(orderData);
                    }
                    
                    document.getElementById('order-tracking-view').classList.remove('skeleton');
                }, 300);
            }

            // Helper function to get order type specific information
            function getOrderTypeInfo(orderData) {
                const typeInfo = {
                    'dine-in': {
                        icon: '🍽️',
                        typeDescription: 'Dine-in Experience',
                        statusDescription: getOrderStatusDescription(orderData, 'dine-in'),
                        detailedStatus: getDetailedStatusDescription(orderData, 'dine-in'),
                        estimatedTime: getEstimatedTime(orderData, 'dine-in')
                    },
                    'takeaway': {
                        icon: '🥤',
                        typeDescription: 'Takeaway Order',
                        statusDescription: getOrderStatusDescription(orderData, 'takeaway'),
                        detailedStatus: getDetailedStatusDescription(orderData, 'takeaway'),
                        estimatedTime: getEstimatedTime(orderData, 'takeaway')
                    },
                    'delivery': {
                        icon: '🚗',
                        typeDescription: 'Home Delivery',
                        statusDescription: getOrderStatusDescription(orderData, 'delivery'),
                        detailedStatus: getDetailedStatusDescription(orderData, 'delivery'),
                        estimatedTime: getEstimatedTime(orderData, 'delivery')
                    }
                };
                
                return typeInfo[orderData.order_type] || typeInfo['dine-in'];
            }

            // Helper function to get order status description
            function getOrderStatusDescription(orderData, orderType) {
                const statusDescriptions = {
                    'dine-in': {
                        'pending': 'Order received, awaiting confirmation',
                        'confirmed': 'Order confirmed, kitchen preparing',
                        'preparing': 'Chef is preparing your meal',
                        'ready': 'Food ready, server will deliver to table',
                        'served': `Enjoy your meal at table ${orderData.table_identifier || 'your table'}`,
                        'completed': 'Thank you for dining with us'
                    },
                    'takeaway': {
                        'pending': 'Order received, awaiting confirmation',
                        'confirmed': 'Order confirmed, preparing for pickup',
                        'preparing': 'Chef is preparing your order',
                        'ready_for_pickup': 'Order ready for pickup',
                        'picked_up': 'Order collected, enjoy your meal',
                        'completed': 'Pickup completed, thank you'
                    },
                    'delivery': {
                        'pending': 'Order received, awaiting confirmation',
                        'confirmed': 'Order confirmed, preparing for delivery',
                        'preparing': 'Chef is preparing your meal',
                        'ready_for_delivery': 'Order ready, awaiting driver pickup',
                        'out_for_delivery': 'Driver is on the way to your location',
                        'delivered': 'Order delivered, enjoy your meal',
                        'completed': 'Delivery completed, thank you'
                    }
                };
                
                return statusDescriptions[orderType][orderData.status] || 'Status updated';
            }

            // Helper function to get detailed status description
            function getDetailedStatusDescription(orderData, orderType) {
                const baseDescription = getOrderStatusDescription(orderData, orderType);
                
                switch (orderType) {
                    case 'dine-in':
                        if (orderData.status === 'preparing' && orderData.table_identifier) {
                            return `${baseDescription}. Your table ${orderData.table_identifier} is being prepared.`;
                        }
                        if (orderData.status === 'ready' && orderData.server_id) {
                            return `${baseDescription}. Your server will bring the food shortly.`;
                        }
                        break;
                    case 'takeaway':
                        if (orderData.status === 'ready_for_pickup' && orderData.pickup_counter) {
                            return `${baseDescription}. Please proceed to counter ${orderData.pickup_counter}.`;
                        }
                        if (orderData.pickup_time) {
                            return `${baseDescription}. Pickup time: ${new Date(orderData.pickup_time).toLocaleString()}`;
                        }
                        break;
                    case 'delivery':
                        if (orderData.status === 'out_for_delivery' && orderData.driver_name) {
                            return `${baseDescription}. Driver: ${orderData.driver_name}. Contact: ${orderData.driver_phone || 'N/A'}`;
                        }
                        if (orderData.estimated_delivery_time) {
                            return `${baseDescription}. Estimated delivery: ${new Date(orderData.estimated_delivery_time).toLocaleString()}`;
                        }
                        break;
                }
                
                return baseDescription;
            }

            // Helper function to get estimated time
            function getEstimatedTime(orderData, orderType) {
                switch (orderType) {
                    case 'dine-in':
                        if (orderData.status === 'preparing') return '15-20 minutes';
                        if (orderData.status === 'ready') return 'Being served now';
                        break;
                    case 'takeaway':
                        if (orderData.pickup_time) {
                            return new Date(orderData.pickup_time).toLocaleString();
                        }
                        if (orderData.status === 'preparing') return '15-20 minutes';
                        if (orderData.status === 'ready_for_pickup') return 'Ready for pickup';
                        break;
                    case 'delivery':
                        if (orderData.estimated_delivery_time) {
                            return new Date(orderData.estimated_delivery_time).toLocaleString();
                        }
                        if (orderData.status === 'preparing') return '20-30 minutes';
                        if (orderData.status === 'out_for_delivery') return 'On the way';
                        break;
                }
                return null;
            }

            // Helper function to render order type specific information
            function renderOrderTypeSpecificInfo(orderData) {
                switch (orderData.order_type) {
                    case 'dine-in':
                        return `
                            <div class="order-type-specific">
                                <h4><i class="fas fa-utensils"></i> Dine-in Details</h4>
                                <div class="specific-info-grid">
                                    ${orderData.table_identifier ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('table_number')}</div>
                                        <div class="detail-value">${orderData.table_identifier}</div>
                                    </div>
                                    ` : ''}
                                    ${orderData.server_id ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('server')}</div>
                                        <div class="detail-value">${orderData.server_name || 'Assigned'}</div>
                                    </div>
                                    ` : ''}
                                    ${orderData.dining_duration_minutes ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('dining_duration')}</div>
                                        <div class="detail-value">${orderData.dining_duration_minutes} minutes</div>
                                    </div>
                                    ` : ''}
                                    ${orderData.served_at ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('served_at')}</div>
                                        <div class="detail-value">${new Date(orderData.served_at).toLocaleString()}</div>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    case 'takeaway':
                        return `
                            <div class="order-type-specific">
                                <h4><i class="fas fa-shopping-bag"></i> Pickup Details</h4>
                                <div class="specific-info-grid">
                                    ${orderData.pickup_time ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('pickup_time')}</div>
                                        <div class="detail-value">${new Date(orderData.pickup_time).toLocaleString()}</div>
                                    </div>
                                    ` : ''}
                                    ${orderData.pickup_counter ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('pickup_counter')}</div>
                                        <div class="detail-value">Counter ${orderData.pickup_counter}</div>
                                    </div>
                                    ` : ''}
                                    ${orderData.actual_pickup_time ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('picked_up_at')}</div>
                                        <div class="detail-value">${new Date(orderData.actual_pickup_time).toLocaleString()}</div>
                                    </div>
                                    ` : ''}
                                    ${orderData.pickup_instructions ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('pickup_instructions')}</div>
                                        <div class="detail-value">${orderData.pickup_instructions}</div>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    case 'delivery':
                        return `
                            <div class="order-type-specific">
                                <h4><i class="fas fa-truck"></i> Delivery Details</h4>
                                <div class="specific-info-grid">
                                    ${orderData.delivery_address ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('delivery_address')}</div>
                                        <div class="detail-value">${orderData.delivery_address}</div>
                                    </div>
                                    ` : ''}
                                    ${orderData.driver_name ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('driver')}</div>
                                        <div class="detail-value">${orderData.driver_name}</div>
                                    </div>
                                    ` : ''}
                                    ${orderData.driver_phone ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('driver_phone')}</div>
                                        <div class="detail-value">${orderData.driver_phone}</div>
                                    </div>
                                    ` : ''}
                                    ${orderData.estimated_delivery_time ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('estimated_delivery')}</div>
                                        <div class="detail-value">${new Date(orderData.estimated_delivery_time).toLocaleString()}</div>
                                    </div>
                                    ` : ''}
                                    ${orderData.actual_delivery_time ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('delivered_at')}</div>
                                        <div class="detail-value">${new Date(orderData.actual_delivery_time).toLocaleString()}</div>
                                    </div>
                                    ` : ''}
                                    ${orderData.delivery_instructions ? `
                                    <div class="detail-item">
                                        <div class="detail-label">${translate('delivery_instructions')}</div>
                                        <div class="detail-value">${orderData.delivery_instructions}</div>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    default:
                        return '';
                }
            }

            // Helper function to render action buttons
            function renderActionButtons(orderData) {
                const buttons = [];
                
                // Common buttons for all order types
                if (orderData.status === 'pending') {
                    buttons.push(`<button class="action-btn danger" id="cancel-order-btn"><i class="fas fa-times"></i> ${translate('cancel_order')}</button>`);
                }
                
                // Order type specific buttons
                switch (orderData.order_type) {
                    case 'dine-in':
                        if (orderData.status === 'confirmed' || orderData.status === 'preparing') {
                            buttons.push(`<button class="action-btn" id="request-assistance-btn"><i class="fas fa-bell"></i> ${translate('request_assistance')}</button>`);
                        }
                        if (orderData.status === 'served') {
                            buttons.push(`<button class="action-btn" id="request-bill-btn"><i class="fas fa-receipt"></i> ${translate('request_bill')}</button>`);
                            buttons.push(`<button class="action-btn" id="add-items-btn"><i class="fas fa-plus"></i> ${translate('add_items')}</button>`);
                        }
                        break;
                    case 'takeaway':
                        if (orderData.status === 'confirmed' && !orderData.pickup_time) {
                            buttons.push(`<button class="action-btn" id="update-pickup-time-btn"><i class="fas fa-clock"></i> ${translate('update_pickup_time')}</button>`);
                        }
                        if (orderData.status === 'ready_for_pickup') {
                            buttons.push(`<button class="action-btn primary" id="notify-ready-btn"><i class="fas fa-bell"></i> ${translate('notify_ready')}</button>`);
                        }
                        break;
                    case 'delivery':
                        if (orderData.status === 'out_for_delivery') {
                            buttons.push(`<button class="action-btn" id="contact-driver-btn"><i class="fas fa-phone"></i> ${translate('contact_driver')}</button>`);
                            buttons.push(`<button class="action-btn" id="track-delivery-btn"><i class="fas fa-map-marker-alt"></i> ${translate('track_delivery')}</button>`);
                        }
                        if (orderData.status === 'confirmed' && orderData.delivery_address) {
                            buttons.push(`<button class="action-btn" id="update-address-btn"><i class="fas fa-edit"></i> ${translate('update_address')}</button>`);
                        }
                        break;
                }
                
                return buttons.join('');
            }

            // Helper function to render timeline
            function renderTimeline(orderData) {
                const timelineEvents = [];
                
                // Add order placed event
                timelineEvents.push({
                    time: orderData.created_at,
                    text: 'Order placed successfully',
                    completed: true
                });
                
                // Add status change events based on available timestamps
                if (orderData.confirmed_at) {
                    timelineEvents.push({
                        time: orderData.confirmed_at,
                        text: 'Order confirmed by restaurant',
                        completed: true
                    });
                }
                
                if (orderData.preparation_started_at) {
                    timelineEvents.push({
                        time: orderData.preparation_started_at,
                        text: 'Preparation started',
                        completed: true
                    });
                }
                
                if (orderData.preparation_completed_at) {
                    timelineEvents.push({
                        time: orderData.preparation_completed_at,
                        text: 'Preparation completed',
                        completed: true
                    });
                }
                
                // Add order type specific events
                switch (orderData.order_type) {
                    case 'dine-in':
                        if (orderData.served_at) {
                            timelineEvents.push({
                                time: orderData.served_at,
                                text: `Food served to table ${orderData.table_identifier || 'your table'}`,
                                completed: true
                            });
                        }
                        break;
                    case 'takeaway':
                        if (orderData.ready_for_pickup || orderData.ready_at) {
                            timelineEvents.push({
                                time: orderData.ready_for_pickup || orderData.ready_at,
                                text: 'Order ready for pickup',
                                completed: true
                            });
                        }
                        if (orderData.picked_up_at) {
                            timelineEvents.push({
                                time: orderData.picked_up_at,
                                text: 'Order collected by customer',
                                completed: true
                            });
                        }
                        break;
                    case 'delivery':
                        if (orderData.ready_for_delivery || orderData.ready_at) {
                            timelineEvents.push({
                                time: orderData.ready_for_delivery || orderData.ready_at,
                                text: 'Order ready for delivery',
                                completed: true
                            });
                        }
                        if (orderData.out_for_delivery_at) {
                            timelineEvents.push({
                                time: orderData.out_for_delivery_at,
                                text: 'Driver out for delivery',
                                completed: true
                            });
                        }
                        if (orderData.delivered_at) {
                            timelineEvents.push({
                                time: orderData.delivered_at,
                                text: 'Order delivered successfully',
                                completed: true
                            });
                        }
                        break;
                }
                
                if (timelineEvents.length > 1) {
                    return `
                        <div class="order-details">
                            <h4><i class="fas fa-history"></i> ${translate('order_timeline')}</h4>
                            <div class="timeline">
                                ${timelineEvents.map(event => `
                                    <div class="timeline-item ${event.completed ? 'completed' : ''}">
                                        <div class="timeline-content">
                                            <div class="timeline-time">${new Date(event.time).toLocaleString()}</div>
                                            <div class="timeline-text">${event.text}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                return '';
            }

            // Helper function to add action button event listeners
            function addActionButtonEventListeners(orderData) {
                // Cancel order button
                const cancelBtn = document.getElementById('cancel-order-btn');
                if (cancelBtn) {
                    cancelBtn.addEventListener('click', () => {
                        cancelOrder(orderData.order_uid);
                    });
                }
                
                // Request assistance button (dine-in)
                const assistanceBtn = document.getElementById('request-assistance-btn');
                if (assistanceBtn) {
                    assistanceBtn.addEventListener('click', () => {
                        showToast('Assistance requested. Server will be with you shortly.');
                    });
                }
                
                // Request bill button (dine-in)
                const billBtn = document.getElementById('request-bill-btn');
                if (billBtn) {
                    billBtn.addEventListener('click', () => {
                        showToast('Bill requested. Please wait for your server.');
                    });
                }
                
                // Add items button (dine-in)
                const addItemsBtn = document.getElementById('add-items-btn');
                if (addItemsBtn) {
                    addItemsBtn.addEventListener('click', () => {
                        window.location.hash = '#menu';
                    });
                }
                
                // Update pickup time button (takeaway)
                const updatePickupBtn = document.getElementById('update-pickup-time-btn');
                if (updatePickupBtn) {
                    updatePickupBtn.addEventListener('click', () => {
                        showToast('Pickup time update feature coming soon.');
                    });
                }
                
                // Notify ready button (takeaway)
                const notifyReadyBtn = document.getElementById('notify-ready-btn');
                if (notifyReadyBtn) {
                    notifyReadyBtn.addEventListener('click', () => {
                        showToast('Notification sent. Order is ready for pickup.');
                    });
                }
                
                // Contact driver button (delivery)
                const contactDriverBtn = document.getElementById('contact-driver-btn');
                if (contactDriverBtn) {
                    contactDriverBtn.addEventListener('click', () => {
                        if (orderData.driver_phone) {
                            showToast(`Driver contact: ${orderData.driver_phone}`);
                        } else {
                            showToast('Driver contact information not available.');
                        }
                    });
                }
                
                // Track delivery button (delivery)
                const trackDeliveryBtn = document.getElementById('track-delivery-btn');
                if (trackDeliveryBtn) {
                    trackDeliveryBtn.addEventListener('click', () => {
                        showToast('Real-time delivery tracking feature coming soon.');
                    });
                }
                
                // Update address button (delivery)
                const updateAddressBtn = document.getElementById('update-address-btn');
                if (updateAddressBtn) {
                    updateAddressBtn.addEventListener('click', () => {
                        showToast('Address update feature coming soon.');
                    });
                }
            }

            // Helper function to add feedback section
            function addFeedbackSection(orderData) {
                const feedbackSection = document.createElement('div');
                feedbackSection.className = 'order-details';
                feedbackSection.innerHTML = `
                    <h4><i class="fas fa-star"></i> ${translate('rate_your_experience')}</h4>
                    <div class="rating-stars">
                        ${[1,2,3,4,5].map(i => 
                            `<i class="far fa-star" data-rating="${i}"></i>`
                        ).join('')}
                    </div>
                    <div class="form-group">
                        <label class="form-label">${translate('service_quality')}</label>
                        <select class="form-select" id="service-quality-rating">
                            <option value="">${translate('select_rating')}</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">${translate('food_quality')}</label>
                        <select class="form-select" id="food-quality-rating">
                            <option value="">${translate('select_rating')}</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">${translate('ambiance')}</label>
                        <select class="form-select" id="ambiance-rating">
                            <option value="">${translate('select_rating')}</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">${translate('value_for_money')}</label>
                        <select class="form-select" id="value-rating">
                            <option value="">${translate('select_rating')}</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">${translate('would_recommend')}</label>
                        <select class="form-select" id="recommend-select">
                            <option value="">${translate('select')}</option>
                            <option value="1">${translate('yes')}</option>
                            <option value="0">${translate('no')}</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">${translate('feedback_text')}</label>
                        <textarea class="form-textarea" id="feedback-text" 
                                  placeholder="${translate('share_your_experience')}"></textarea>
                    </div>
                    <button class="btn" id="submit-feedback">${translate('submit_feedback')}</button>
                `;
                
                elements.orderTrackingContainer.appendChild(feedbackSection);
                
                // Add event listeners
                feedbackSection.querySelectorAll('.rating-stars i').forEach(star => {
                    star.addEventListener('click', function() {
                        const rating = parseInt(this.getAttribute('data-rating'));
                        feedbackSection.querySelectorAll('.rating-stars i').forEach((s, index) => {
                            s.classList.toggle('fas', index < rating);
                            s.classList.toggle('far', index >= rating);
                        });
                        state.currentRating = rating;
                    });
                });
                
                document.getElementById('submit-feedback').addEventListener('click', async () => {
                    if (!state.currentRating) {
                        showError(translate('please_select_rating'));
                        return;
                    }
                    
                    try {
                        await apiService.submitFeedback({
                            branch_id: state.currentBranch.branch_id,
                            order_id: orderData.order_uid,
                            rating: state.currentRating,
                            service_quality_rating: document.getElementById('service-quality-rating').value || null,
                            food_quality_rating: document.getElementById('food-quality-rating').value || null,
                            ambiance_rating: document.getElementById('ambiance-rating').value || null,
                            value_for_money_rating: document.getElementById('value-rating').value || null,
                            would_recommend: document.getElementById('recommend-select').value === '1' ? 1 : 0,
                            feedback_text: document.getElementById('feedback-text').value
                        });
                        showToast(translate('feedback_submitted'));
                        feedbackSection.remove();
                    } catch (error) {
                        console.error('Failed to submit feedback:', error);
                        showError(translate('feedback_submission_failed'));
                    }
                });
            }
            
            function renderOrderHistory() {
                // Show skeleton view immediately
                renderOrdersSkeleton();
                
                // Small delay to ensure skeleton is visible
                setTimeout(() => {
                    if (state.orderHistory.length === 0) {
                        const browseMenuUrl = state.currentBranch ? 
                            createBranchUrl(state.currentBranch, 'menu') : 
                            '#menu';
                        
                        elements.orderHistoryContainer.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-receipt"></i>
                                <h3>${translate('no_orders')}</h3>
                                <p>${translate('no_orders_message')}</p>
                                <a href="${browseMenuUrl}" class="btn">${translate('browse_menu')}</a>
                            </div>
                        `;
                        // Remove skeleton class after content is loaded
                        document.getElementById('orders-view').classList.remove('skeleton');
                        return;
                    }

                const orderHistoryList = document.createElement('div');
                orderHistoryList.className = 'order-history-list';
                
                state.orderHistory.forEach(order => {
                    const orderCard = document.createElement('div');
                    orderCard.className = 'order-history-card';
                    orderCard.innerHTML = `
                        <div class="order-history-header">
                            <h3>${translate('order')} #${order.order_uid}</h3>
                            <span class="order-date">${new Date(order.date).toLocaleDateString()}</span>
                        </div>
                        <div class="order-history-details">
                            <div class="order-status">
                                <span class="status-badge ${order.status}">${translate(order.status)}</span>
                            </div>
                            <div class="order-total">
                                ${formatPrice(order.total)}
                            </div>
                        </div>
                        <div class="order-history-actions">
                            <button class="btn btn-outline view-order-btn" data-order-id="${order.order_uid}">
                                ${translate('view_details')}
                            </button>
                            ${order.status === 'pending' ? `
                            <button class="btn cancel-order-btn" data-order-id="${order.order_uid}">
                                ${translate('cancel_order')}
                            </button>
                            ` : ''}
                        </div>
                    `;
                    
                    orderHistoryList.appendChild(orderCard);
                });
                
                elements.orderHistoryContainer.appendChild(orderHistoryList);

                // Add event listeners
                document.querySelectorAll('.view-order-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const orderId = e.target.getAttribute('data-order-id');
                        window.location.hash = `order/${orderId}`;
                    });
                });

                document.querySelectorAll('.cancel-order-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const orderId = e.target.getAttribute('data-order-id');
                        cancelOrder(orderId);
                    });
                });
                
                // Remove skeleton class after content is loaded
                document.getElementById('orders-view').classList.remove('skeleton');
                }, 300); // Minimum 300ms delay to show skeleton
            }
            
            function renderFavorites() {
                // Show skeleton view immediately
                renderFavoritesSkeleton();
                
                // Small delay to ensure skeleton is visible
                setTimeout(() => {
                    if (state.favorites.length === 0) {
                        const browseMenuUrl = state.currentBranch ? 
                            createBranchUrl(state.currentBranch, 'menu') : 
                            '#menu';
                        
                        elements.favoritesContainer.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-heart"></i>
                                <h3>${translate('empty_favorites')}</h3>
                                <p>${translate('start_adding_favorites')}</p>
                                <a href="${browseMenuUrl}" class="btn">${translate('browse_menu')}</a>
                            </div>
                        `;
                        // Remove skeleton class after content is loaded
                        document.getElementById('favorites-view').classList.remove('skeleton');
                        return;
                    }

                    const favoritesGrid = document.createElement('div');
                    favoritesGrid.className = 'menu-items-grid';
                    
                    state.favorites.forEach((item, index) => {
                        const quantity = getItemQuantityInCart(item.branch_menu_id);
                        
                        const itemCard = document.createElement('div');
                        itemCard.className = 'menu-item-card';
                        itemCard.setAttribute('data-branch-menu-id', item.branch_menu_id);
                        itemCard.setAttribute('data-favorite-index', index);
                        itemCard.innerHTML = `
                            <div class="menu-item-image-container">
                                <img src="${item.image_url || '/images/food-default.jpg'}" alt="${item.item_name}" class="menu-item-image">
                                ${item.is_featured ? '<span class="menu-item-badge">Featured</span>' : ''}
                            </div>
                            <div class="menu-item-content">
                                <div class="menu-item-header">
                                    <h4 class="menu-item-name">${getTranslation(item.item_name, item.name_translation_key)}</h4>
                                    <div class="menu-item-price">${formatPrice(item.price)}</div>
                                </div>
                                <p class="item-desc">${getTranslation(item.item_description, item.description_translation_key) || translate('delicious_menu_item')}</p>
                                <div class="menu-item-footer">
                                    <div class="prep-time-with-favorite">
                                        <span class="prep-time"><i class="fas fa-clock"></i> ${item.preparation_time_minutes || 15} ${translate('mins')}</span>
                                        <button class="btn-favorite active" data-item-id="${item.branch_menu_id}">
                                            <i class="fas fa-heart"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        favoritesGrid.appendChild(itemCard);
                        
                        // Attach event listeners after the element is added to DOM
                        setTimeout(() => {
                            attachFavoriteItemEventListeners(itemCard, item, index);
                            // Note: Removed setupQuantityControllerEvents for favorites page
                        }, 0);
                    });
                    
                    elements.favoritesContainer.innerHTML = ''; // Clear any existing content
                    elements.favoritesContainer.appendChild(favoritesGrid);
                    
                    // Remove skeleton class after content is loaded
                    document.getElementById('favorites-view').classList.remove('skeleton');
                }, 300); // Minimum 300ms delay to show skeleton
            }
            
            // Item Detail Route Handler
            async function loadItemById(branchId, branchMenuId) {
                try {
                    // Check if we already have menu data for this branch
                    let menuData = state.menuData;
                    let needsMenuLoad = !menuData || menuData.length === 0;
                    
                    // If we don't have menu data or it's for a different branch, load it
                    if (needsMenuLoad || (state.currentBranch && state.currentBranch.branch_id != branchId)) {
                        // Show loading state and skeleton views if we need to load data
                        if (needsMenuLoad) {
                            showView('menu');
                            renderMenuItemSkeletons();
                            renderPromotionSkeletons();
                            renderCategoryTabsSkeletons();
                            renderMenuContentSkeletons();
                            
                            // Load featured branch cover section
                            loadFeaturedBranch();
                            
                            // Ensure translations are loaded before proceeding
                            if (!state.translations[state.language] || Object.keys(state.translations[state.language]).length === 0) {
                                await loadTranslationsFromAPI();
                            }
                        }
                        
                        // Load menu data for the branch
                        const menuDataResponse = await apiService.getBranchMenu(branchId);
                        menuData = menuDataResponse.data || menuDataResponse;
                        
                        // Store menu data in state
                        state.menuData = menuData;
                        
                        // Ensure all items have the correct branch_id set (consistent with loadMenu function)
                        menuData.forEach(category => {
                          if (category.items && Array.isArray(category.items)) {
                           category.items.forEach(item => {
                            // We use parseInt to ensure the ID is a number, preventing future type issues.
                            item.branch_id = parseInt(branchId, 10);
                           });
                          }
                        });
                        
                        // Extract categories from menu data (like loadMenu does)
                        state.categories = state.menuData.map(category => ({
                            id: category.category_id,
                            name: getTranslation(category.category_name, category.name_translation_key),
                            image: category.category_image
                        }));
                        console.log('Categories extracted:', state.categories);
                        
                        // Load promotions for this branch (like loadMenu does)
                        try {
                            console.log('Loading promotions for branch:', branchId);
                            const promotions = await apiService.getPromotions(branchId);
                            state.promotions = promotions.data || promotions;
                            renderPromotions();
                            console.log('Promotions loaded and rendered:', state.promotions);
                        } catch (error) {
                            console.error('Failed to load promotions:', error);
                            elements.promotionsContainer.style.display = 'none';
                        }
                        
                        // Render categories (like loadMenu does)
                        renderCategories();
                        console.log('Categories rendered');
                        
                        // Render menu items (like loadMenu does) - this is crucial for menu cards
                        renderMenuItems();
                        console.log('Menu items rendered');
                    }
                    
                    // Find the specific item in the menu data
                    let targetItem = null;
                    for (const category of menuData) {
                        if (category.items && Array.isArray(category.items)) {
                            const item = category.items.find(item => item.branch_menu_id == branchMenuId);
                            if (item) {
                                targetItem = item;
                                break;
                            }
                        }
                    }
                    
                    if (targetItem) {
                        // Double-check that the target item has the correct branch_id set
                        targetItem.branch_id = parseInt(branchId, 10);
                        
                        // Set current branch (only if different from current)
                        const itemBranch = state.branches.find(branch => branch.branch_id == branchId);
                        if (itemBranch && (!state.currentBranch || state.currentBranch.branch_id != branchId)) {
                            const branchWithSettings = await ensureBranchSettings(itemBranch);
                            state.currentBranch = branchWithSettings;
                            updateBranchNameDisplays();
                            updateCurrentCart();
                            updateCartUI();
                        }
                        
                        // Only render menu if it wasn't already visible or if menu content is not rendered
                        if (state.currentView !== 'menu') {
                            showView('menu');
                            renderMenuContentArea('all');
                        } else {
                            // Check if menu content is actually rendered
                            const menuContentArea = document.getElementById('menu-content-area');
                            const menuItemsContainer = document.getElementById('menu-items-container');
                            
                            // If menu content area is empty or not properly rendered, render it
                            if (!menuContentArea || menuContentArea.children.length === 0) {
                                console.log('Menu content area is empty, rendering menu content');
                                renderMenuContentArea('all');
                            } else if (!menuItemsContainer || menuItemsContainer.children.length === 0) {
                                console.log('Menu items container is empty, rendering menu items');
                                renderMenuItems();
                            } else {
                                console.log('Menu content already rendered, skipping re-render');
                            }
                        }
                        
                        // Ensure menu items are rendered (backup call)
                        setTimeout(() => {
                            const menuItemsContainer = document.getElementById('menu-items-container');
                            if (!menuItemsContainer || menuItemsContainer.children.length === 0) {
                                console.log('Backup: Menu items still not rendered, calling renderMenuItems');
                                renderMenuItems();
                            }
                        }, 200);
                        
                        // Then show the item detail modal
                        await showItemDetailModal(targetItem);
                        
                        return true;
                    } else {
                        showError('Item not found');
                        showView('menu');
                        if (state.currentBranch) {
                            loadMenu(state.currentBranch.branch_id);
                        }
                        return false;
                    }
                } catch (error) {
                    console.error('Failed to load item:', error);
                    showError('Failed to load item details');
                    showView('menu');
                    if (state.currentBranch) {
                        loadMenu(state.currentBranch.branch_id);
                    }
                    return false;
                }
            }
            
            // Create URL for item detail
            function createItemUrl(branch, branchMenuId) {
                const branchUrlName = getBranchUrlName(branch);
                
                // For URLs with Unicode characters, we should encode them
                if (/[\u0980-\u09FF\u0800-\uFFFF]/.test(branchUrlName)) {
                    const encodedName = encodeUrlName(branchUrlName);
                    return `#/${encodedName}/menu/item/${branchMenuId}`;
                }
                
                return `#/${branchUrlName}/menu/item/${branchMenuId}`;
            }
            
            // Update URL to reflect current item modal
            function updateUrlForItem(item) {
                if (item && item.branch_id && state.currentBranch) {
                    const newUrl = createItemUrl(state.currentBranch, item.branch_menu_id);
                    if (window.location.hash !== newUrl) {
                        // Use replaceState instead of hash to avoid triggering hashchange event
                        history.replaceState(null, '', newUrl);
                    }
                }
            }
            
            // Item Detail Modal
            async function showItemDetailModal(item) {
                console.log('showItemDetailModal called with item:', item);
                console.log('Item properties:', {
                    item_name: item.item_name,
                    name: item.name,
                    price: item.price,
                    image_url: item.image_url,
                    branch_menu_id: item.branch_menu_id,
                    branch_id: item.branch_id
                });
                
                // Ensure item has all required properties, try to find them if missing
                if (!item.item_name && item.name) {
                    item.item_name = item.name;
                }
                if (!item.item_description && item.description) {
                    item.item_description = item.description;
                }
                if (!item.preparation_time_minutes && item.preparation_time) {
                    item.preparation_time_minutes = item.preparation_time;
                }
                
                // If still missing critical properties, try to find complete item from menu data
                if (!item.item_name || !item.branch_id) {
                    console.log('Item missing critical properties, searching menu data...');
                    if (state.menuData && Array.isArray(state.menuData) && item.branch_menu_id) {
                        for (const category of state.menuData) {
                            if (category.items && Array.isArray(category.items)) {
                                const foundItem = category.items.find(menuItem => 
                                    parseInt(menuItem.branch_menu_id) === parseInt(item.branch_menu_id)
                                );
                                if (foundItem) {
                                    console.log('Found complete item, merging properties:', foundItem);
                                    // Merge the found item properties with the current item
                                    Object.assign(item, foundItem);
                                    break;
                                }
                            }
                        }
                    }
                }
                
                // Final fallback for missing properties
                item.item_name = item.item_name || 'Unknown Item';
                item.item_description = item.item_description || '';
                item.price = item.price || 0;
                item.image_url = item.image_url || '/images/food-default.jpg';
                item.preparation_time_minutes = item.preparation_time_minutes || 15;
                item.calories = item.calories || 250;
                
                console.log('Final item object after normalization:', item);
                
                state.currentItem = item;
                state.currentQuantity = 1;
                state.currentCustomizations = {};
                
                // Show skeleton view immediately
                showModal('item-detail-modal');
                renderItemDetailSkeleton();
                
                // Set the current branch based on the item's branch_id
                if (item.branch_id) {
                    const itemBranch = state.branches.find(branch => branch.branch_id === item.branch_id);
                    if (itemBranch) {
                        // Ensure branch settings are loaded
                        const branchWithSettings = await ensureBranchSettings(itemBranch);
                        state.currentBranch = branchWithSettings;
                        console.log('Set current branch from item:', branchWithSettings.internal_name);
                        
                        // Update branch name displays to reflect the new current branch
                        updateBranchNameDisplays();
                        updateCurrentCart();
                        updateCartUI();
                        
                        // Update URL to reflect the current item (for bookmarking/sharing)
                        updateUrlForItem(item);
                    } else {
                        console.warn('Branch not found for item branch_id:', item.branch_id);
                    }
                } else {
                    console.warn('Item does not have branch_id:', item);
                }
                
                // Load customizations for this item
                try {
                    const customizations = await apiService.getCustomizations(item.branch_menu_id);
                    state.itemCustomizations = customizations.data || customizations;
                    
                    // Render the actual content
                    const modal = document.querySelector('#item-detail-modal .modal');
                    if (modal) {
                        modal.classList.remove('skeleton');
                    }
                    
                    elements.itemDetailContent.innerHTML = `
                    <div class="item-detail-container">
                        <div class="item-image-section">
                            <img src="${item.image_url || '/images/food-default.jpg'}" alt="${item.item_name}" class="item-detail-image">
                            ${item.is_featured ? '<span class="item-badge">Featured</span>' : ''}
                        </div>
                        
                        <div class="item-info-section">
                            <div class="item-header">
                                <h2 class="item-name">${getTranslation(item.item_name, item.name_translation_key)}</h2>
                                <div class="item-price">${formatPrice(item.price)}</div>
                            </div>
                            
                            <p class="item-description">${getTranslation(item.item_description, item.description_translation_key) || translate('delicious_menu_item_description')}</p>
                            
                            <div class="item-meta">
                                <span><i class="fas fa-clock"></i> ${item.preparation_time_minutes || 15} ${translate('mins')}</span>
                                <span><i class="fas fa-fire"></i> ${item.calories || 250} cal</span>
                            </div>
                        </div>
                        
                        <div id="customization-section">
                            <!-- Customization options will be loaded here -->
                        </div>
                        
                        <div class="quantity-selector">
                            <span class="quantity-label">${translate('quantity')}:</span>
                            <div class="quantity-controls">
                                <button id="quantity-decrease">-</button>
                                <input type="number" id="quantity-input" value="1" min="1" max="99">
                                <button id="quantity-increase">+</button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Load customizations
                loadCustomizations(item.branch_menu_id);
                
                // Setup quantity controls
                setupQuantityControls();
                } catch (error) {
                    console.error('Failed to load item details:', error);
                    
                    // Remove skeleton class and show error
                    const modal = document.querySelector('#item-detail-modal .modal');
                    if (modal) {
                        modal.classList.remove('skeleton');
                    }
                    
                    elements.itemDetailContent.innerHTML = `
                        <div class="error-message">
                            <p>${translate('failed_to_load_item_details')}</p>
                        </div>
                    `;
                }
            }
            
            async function loadCustomizations(branchMenuId) {
                try {
                    const response = await apiService.getCustomizations(branchMenuId);
                    
                    // The API returns data in a wrapper format with 'data' field
                    const customizations = response.data || response;
                    console.log('Loaded customizations:', customizations);
                    
                    renderCustomizationOptions(customizations);
                } catch (error) {
                    console.error('Failed to load customizations:', error);
                    // Hide customization section if no customizations available
                    document.getElementById('customization-section').style.display = 'none';
                }
            }
            
            function renderCustomizationOptions(customizations) {
                const customizationSection = document.getElementById('customization-section');
                
                if (!customizations.groups || customizations.groups.length === 0) {
                    console.log('No customization groups found, hiding section');
                    customizationSection.style.display = 'none';
                    return;
                }
                
                customizationSection.innerHTML = '';
                
                customizations.groups.forEach(group => {
                    const groupElement = document.createElement('div');
                    groupElement.className = 'customization-group';
                    groupElement.innerHTML = `
                        <h4 class="customization-group-title">${group.name && typeof group.name === 'object' ? (group.name[state.language] || group.name['en-US'] || 'Customization') : getTranslation(group.name, group.name_translation_key)}</h4>
                        <div class="customization-options-list" data-group-id="${group.id}" data-group-type="${group.type}">
                            <!-- Options will be added here -->
                        </div>
                    `;
                    
                    const optionsList = groupElement.querySelector('.customization-options-list');
                    
                    group.options.forEach(option => {
                        const optionElement = document.createElement('div');
                        optionElement.className = 'customization-option';
                        optionElement.setAttribute('data-option-id', option.id);
                        optionElement.setAttribute('data-price-adjustment', option.price_adjustment || 0);
                        
                        const inputType = group.type === 'radio' ? 'radio' : 'checkbox';
                        const inputName = group.type === 'radio' ? `group-${group.id}` : `option-${option.id}`;
                        
                        optionElement.innerHTML = `
                            <div class="customization-option-label">
                                <input type="${inputType}" name="${inputName}" value="${option.id}">
                                <span>${option.name && typeof option.name === 'object' ? (option.name[state.language] || option.name['en-US'] || 'Option') : getTranslation(option.name, option.name_translation_key)}</span>
                            </div>
                            <span class="customization-price">${option.price_adjustment > 0 ? `+${formatPrice(option.price_adjustment)}` : translate('free')}</span>
                        `;
                        
                        optionElement.addEventListener('click', handleCustomizationOptionClick);
                        
                        optionsList.appendChild(optionElement);
                    });
                    
                    customizationSection.appendChild(groupElement);
                });
                
                customizationSection.style.display = 'block';
            }
            
            function handleCustomizationOptionClick(e) {
                const option = e.currentTarget;
                const input = option.querySelector('input');
                const groupType = option.closest('.customization-options-list').getAttribute('data-group-type');
                const groupId = option.closest('.customization-options-list').getAttribute('data-group-id');
                const optionId = option.getAttribute('data-option-id');
                const priceAdjustment = parseFloat(option.getAttribute('data-price-adjustment')) || 0;
                
                if (groupType === 'radio') {
                    // For radio buttons, clear all other options in the group
                    option.closest('.customization-options-list').querySelectorAll('.customization-option').forEach(opt => {
                        opt.classList.remove('selected');
                        opt.querySelector('input').checked = false;
                    });
                    
                    // Select this option
                    option.classList.add('selected');
                    input.checked = true;
                    state.currentCustomizations[groupId] = {
                        optionId: optionId,
                        priceAdjustment: priceAdjustment
                    };
                } else {
                    // For checkboxes, toggle the option
                    input.checked = !input.checked;
                    option.classList.toggle('selected');
                    
                    if (!state.currentCustomizations[groupId]) {
                        state.currentCustomizations[groupId] = [];
                    }
                    
                    if (input.checked) {
                        state.currentCustomizations[groupId].push({
                            optionId: optionId,
                            priceAdjustment: priceAdjustment
                        });
                    } else {
                        state.currentCustomizations[groupId] = state.currentCustomizations[groupId].filter(
                            opt => opt.optionId !== optionId
                        );
                    }
                }
                
                updateItemPrice();
            }
            
            function updateItemPrice() {
                const basePrice = state.currentItem.price;
                let totalPrice = basePrice;
                
                // Add customization prices
                Object.values(state.currentCustomizations).forEach(group => {
                    if (Array.isArray(group)) {
                        group.forEach(option => {
                            totalPrice += option.priceAdjustment;
                        });
                    } else {
                        totalPrice += group.priceAdjustment;
                    }
                });
                
                // Update price display
                const priceElement = document.querySelector('.item-price');
                if (priceElement) {
                    priceElement.textContent = formatPrice(totalPrice);
                }
            }
            
            function setupQuantityControls() {
                const decreaseBtn = document.getElementById('quantity-decrease');
                const increaseBtn = document.getElementById('quantity-increase');
                const quantityInput = document.getElementById('quantity-input');
                
                if (decreaseBtn) {
                    decreaseBtn.addEventListener('click', () => {
                        if (state.currentQuantity > 1) {
                            state.currentQuantity--;
                            quantityInput.value = state.currentQuantity;
                        }
                    });
                }
                
                if (increaseBtn) {
                    increaseBtn.addEventListener('click', () => {
                        if (state.currentQuantity < 99) {
                            state.currentQuantity++;
                            quantityInput.value = state.currentQuantity;
                        }
                    });
                }
                
                if (quantityInput) {
                    quantityInput.addEventListener('change', (e) => {
                        const value = parseInt(e.target.value);
                        if (value >= 1 && value <= 99) {
                            state.currentQuantity = value;
                        } else {
                            e.target.value = state.currentQuantity;
                        }
                    });
                }
            }
            
            // ===== MENU CARD QUANTITY CONTROLLER FUNCTIONS =====
            
            /**
             * Check if an item has customizations available
             * @param {number} branchMenuId - The branch menu item ID
             * @returns {Promise<boolean>} - True if item has customizations
             */
            async function hasItemCustomizations(branchMenuId) {
                try {
                    const response = await apiService.getCustomizations(branchMenuId);
                    const customizations = response.data || response;
                    return customizations.groups && customizations.groups.length > 0;
                } catch (error) {
                    console.error('Failed to check customizations:', error);
                    return false;
                }
            }
            
            /**
             * Get the quantity of an item in the current cart
             * @param {number} branchMenuId - The branch menu item ID
             * @returns {number} - Quantity of item in cart (0 if not found)
             */
            function getItemQuantityInCart(branchMenuId) {
                const currentCart = getCurrentBranchCart();
                const cartItem = currentCart.find(item => item.branch_menu_id === branchMenuId);
                return cartItem ? cartItem.quantity : 0;
            }
            
            /**
             * Check if an item is already in the current cart
             * @param {number} branchMenuId - The branch menu item ID
             * @returns {boolean} - True if item is in cart
             */
            function isItemInCart(branchMenuId) {
                return getItemQuantityInCart(branchMenuId) > 0;
            }
            
            /**
             * Add item to cart directly (without customizations)
             * @param {Object} item - The menu item to add
             * @param {number} quantity - The quantity to add
             */
            function addItemToCartDirectly(item, quantity = 1) {
                if (!state.currentBranch) {
                    showError(translate('please_select_branch'));
                    return;
                }
                
                // Check for branch conflict
                const hasConflict = checkBranchConflict(item);
                
                if (hasConflict) {
                    // Show branch conflict modal
                    showBranchConflictModal(item, () => {
                        performDirectAddToCart(item, quantity);
                    });
                    return;
                }
                
                // No conflict, proceed with direct add
                performDirectAddToCart(item, quantity);
            }
            
            /**
             * Perform the actual direct add to cart operation
             * @param {Object} item - The menu item to add
             * @param {number} quantity - The quantity to add
             */
            function performDirectAddToCart(item, quantity) {
                const currentCart = getCurrentBranchCart();
                
                // Check if item already exists in cart
                const existingIndex = currentCart.findIndex(cartItem => 
                    cartItem.branch_menu_id === item.branch_menu_id && 
                    Object.keys(cartItem.customizations || {}).length === 0
                );
                
                if (existingIndex >= 0) {
                    // Update quantity if already exists
                    currentCart[existingIndex].quantity += quantity;
                } else {
                    // Add new item to cart
                    const cartItem = {
                        branch_menu_id: item.branch_menu_id,
                        item_id: item.item_id,
                        name: item.item_name,
                        name_translation_key: item.name_translation_key,
                        price: item.price,
                        base_price: item.price,
                        image_url: item.image_url,
                        customizations: {},
                        quantity: quantity,
                        branch_id: state.currentBranch.branch_id,
                        branch_name: state.currentBranch.internal_name
                    };
                    
                    currentCart.push(cartItem);
                }
                
                saveCart();
                updateCurrentCart();
                updateCartUI();
                showToast(translate('item_added'));
                
                // Update all menu cards to reflect new cart state
                updateMenuCardsQuantityControllers();
            }
            
            /**
             * Update item quantity in cart
             * @param {number} branchMenuId - The branch menu item ID
             * @param {number} newQuantity - The new quantity
             */
            function updateItemQuantityInCart(branchMenuId, newQuantity) {
                if (newQuantity <= 0) {
                    removeItemFromCart(branchMenuId);
                    return;
                }
                
                const currentCart = getCurrentBranchCart();
                const cartItem = currentCart.find(item => item.branch_menu_id === branchMenuId);
                
                if (cartItem) {
                    cartItem.quantity = newQuantity;
                    saveCart();
                    updateCurrentCart();
                    updateCartUI();
                    // Update the menu cards quantity controllers to reflect the new quantity
                    updateMenuCardsQuantityControllers();
                }
            }
            
            /**
             * Remove item from cart
             * @param {number} branchMenuId - The branch menu item ID
             */
            function removeItemFromCart(branchMenuId) {
                const currentCart = getCurrentBranchCart();
                const itemIndex = currentCart.findIndex(item => item.branch_menu_id === branchMenuId);
                
                if (itemIndex >= 0) {
                    currentCart.splice(itemIndex, 1);
                    saveCart();
                    updateCurrentCart();
                    updateCartUI();
                    // Update the menu cards quantity controllers to reflect the item removal
                    updateMenuCardsQuantityControllers();
                }
            }
            
            /**
             * Create quantity controller HTML for menu card
             * @param {Object} item - The menu item
             * @param {number} quantity - Current quantity in cart
             * @returns {string} - HTML string for quantity controller
             */
            function createQuantityControllerHTML(item, quantity) {
                console.log('createQuantityControllerHTML called with:', { item, quantity });
                
                if (quantity === 0) {
                    const html = `
                        <div class="menu-item-quantity-controller">
                            <button class="btn-add-to-cart-menu" data-item-id="${item.branch_menu_id}" title="Add to cart">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    `;
                    console.log('createQuantityControllerHTML - returning + button:', html);
                    return html;
                } else {
                    const html = `
                        <div class="menu-item-quantity-controller">
                            <div class="quantity-controls-menu" data-item-id="${item.branch_menu_id}">
                                <button class="quantity-decrease" data-item-id="${item.branch_menu_id}" title="Decrease quantity">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <div class="quantity-separator"></div>
                                <input type="number" class="quantity-input" value="${quantity}" min="1" max="99" readonly data-item-id="${item.branch_menu_id}">
                                <div class="quantity-separator"></div>
                                <button class="quantity-increase" data-item-id="${item.branch_menu_id}" title="Increase quantity">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    console.log('createQuantityControllerHTML - returning quantity controls:', html);
                    return html;
                }
            }
            
            /**
             * Setup event listeners for quantity controller
             * @param {HTMLElement} menuCard - The menu card element
             * @param {Object} item - The menu item
             */
            function setupQuantityControllerEvents(menuCard, item) {
                const controller = menuCard.querySelector('.menu-item-quantity-controller');
                if (!controller) return;
                
                // Add to cart button
                const addBtn = controller.querySelector('.btn-add-to-cart-menu');
                if (addBtn) {
                    addBtn.addEventListener('click', async (e) => {
                        e.stopPropagation();
                        
                        // Check if item has customizations
                        const hasCustomizations = await hasItemCustomizations(item.branch_menu_id);
                        
                        if (hasCustomizations) {
                            // Open item detail modal for customization
                            showItemDetailModal(item);
                        } else {
                            // Add directly to cart
                            addItemToCartDirectly(item, 1);
                        }
                    });
                }
                
                // Quantity decrease button
                const decreaseBtn = controller.querySelector('.quantity-decrease');
                if (decreaseBtn) {
                    decreaseBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const currentQuantity = getItemQuantityInCart(item.branch_menu_id);
                        updateItemQuantityInCart(item.branch_menu_id, currentQuantity - 1);
                    });
                }
                
                // Quantity increase button
                const increaseBtn = controller.querySelector('.quantity-increase');
                if (increaseBtn) {
                    increaseBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const currentQuantity = getItemQuantityInCart(item.branch_menu_id);
                        updateItemQuantityInCart(item.branch_menu_id, currentQuantity + 1);
                    });
                }
            }
            
            /**
             * Update all menu cards quantity controllers
             */
            function updateMenuCardsQuantityControllers() {
                console.log('updateMenuCardsQuantityControllers called');
                const menuCards = document.querySelectorAll('.menu-item-card');
                console.log('Found menu cards:', menuCards.length);
                
                menuCards.forEach(card => {
                    const itemId = parseInt(card.getAttribute('data-branch-menu-id'));
                    if (itemId) {
                        const quantity = getItemQuantityInCart(itemId);
                        const controller = card.querySelector('.menu-item-quantity-controller');
                        if (controller) {
                            console.log('Updating controller for item:', itemId, 'quantity:', quantity);
                            
                            // Find the complete item object from menu data instead of creating a minimal one
                            let completeItem = null;
                            
                            // Search through all categories and items to find the complete item
                            if (state.menuData && Array.isArray(state.menuData)) {
                                for (const category of state.menuData) {
                                    if (category.items && Array.isArray(category.items)) {
                                        const foundItem = category.items.find(item => 
                                            parseInt(item.branch_menu_id) === itemId
                                        );
                                        if (foundItem) {
                                            completeItem = foundItem;
                                            break;
                                        }
                                    }
                                }
                            }
                            
                            // If we found the complete item, use it; otherwise try to create a better fallback
                            let itemToUse;
                            if (completeItem) {
                                itemToUse = completeItem;
                            } else {
                                // Try to get basic info from the cart item if available
                                const cartItem = getCurrentBranchCart().find(item => 
                                    parseInt(item.branch_menu_id) === itemId
                                );
                                
                                if (cartItem) {
                                    itemToUse = {
                                        branch_menu_id: itemId,
                                        item_name: cartItem.name || 'Unknown Item',
                                        price: cartItem.price || 0,
                                        image_url: cartItem.image_url || '/images/food-default.jpg',
                                        branch_id: cartItem.branch_id || state.currentBranch?.branch_id
                                    };
                                } else {
                                    // Last resort minimal object
                                    itemToUse = { 
                                        branch_menu_id: itemId,
                                        item_name: 'Unknown Item',
                                        price: 0,
                                        image_url: '/images/food-default.jpg',
                                        branch_id: state.currentBranch?.branch_id
                                    };
                                }
                            }
                            
                            console.log('updateMenuCardsQuantityControllers - using item:', {
                                itemId,
                                hasCompleteItem: !!completeItem,
                                itemName: itemToUse.item_name,
                                hasBranchId: !!itemToUse.branch_id,
                                itemToUse: itemToUse
                            });
                            
                            const newHTML = createQuantityControllerHTML(itemToUse, quantity);
                            console.log('New quantity controller HTML:', newHTML);
                            
                            controller.innerHTML = newHTML;
                            setupQuantityControllerEvents(card, itemToUse);
                        } else {
                            console.log('No controller found for item:', itemId);
                        }
                    }
                });
            }
            
            // QR Scanner functionality
            function showQRScanner() {
                elements.qrScannerContainer.classList.add('active');
                elements.qrCodeInput.value = '';
                elements.qrCodeInput.focus();
            }
            
            function hideQRScanner() {
                elements.qrScannerContainer.classList.remove('active');
            }
            
            async function processQRCode(qrCode) {
                try {
                    showLoading();
                    const table = await apiService.getTableByQr(qrCode);
                    
                    if (!table || !table.data) {
                        throw new Error('Table not found');
                    }
                    
                    // Set current table and branch
                    state.currentTable = table.data;
                    
                    // If we don't have the branch data yet, load it
                    if (!state.currentBranch || state.currentBranch.branch_id !== table.data.branch_id) {
                        const branch = await apiService.getBranch(table.data.branch_id);
                        state.currentBranch = branch.data || branch;
                        updateBranchNameDisplays();
                        
                        // Update cart to show current branch's cart
                        updateCurrentCart();
                        updateCartUI();
                    }
                    
                    hideLoading();
                    hideQRScanner();
                    showToast(translate('table_selected').replace('{table}', table.data.table_identifier));
                    
                    // If we're on the menu page, refresh it with the new branch
                    if (state.currentView === 'menu') {
                        loadMenu(state.currentBranch.branch_id);
                    } else if (state.currentView === 'cart') {
                        renderCart();
                    } else if (state.currentView === 'checkout') {
                        renderCheckout();
                    }
                } catch (error) {
                    hideLoading();
                    console.error('Failed to process QR code:', error);
                    showError(translate('invalid_qr_code'));
                }
            }
            
            // Cart management
            function getBranchCart(branchId) {
                if (!state.branchCarts[branchId]) {
                    state.branchCarts[branchId] = [];
                }
                return state.branchCarts[branchId];
            }
            
            function getCurrentBranchCart() {
                if (!state.currentBranch) {
                    return [];
                }
                return getBranchCart(state.currentBranch.branch_id);
            }
            
            function updateCurrentCart() {
                state.cart = getCurrentBranchCart();
            }
            
            function addToCart() {
                if (!state.currentItem) {
                    showError('No item selected');
                    return;
                }
                
                if (!state.currentBranch) {
                    showError(translate('please_select_branch'));
                    return;
                }
                
                // Check for branch conflict
                const hasConflict = checkBranchConflict(state.currentItem);
                
                if (hasConflict) {
                    // Show branch conflict modal instead of adding directly
                    showBranchConflictModal(state.currentItem, () => {
                        // This callback will be executed if user confirms
                        performAddToCart();
                    });
                    return;
                }
                
                // No conflict, proceed with normal add to cart
                performAddToCart();
            }
            
            function performAddToCart() {
                if (!state.currentItem || !state.currentBranch) {
                    showError('Invalid item or branch');
                    return;
                }
                
                console.log('Adding to cart - current customizations:', state.currentCustomizations);
                console.log('Adding to cart - current item:', state.currentItem);
                
                // Calculate total price with customizations
                let totalPrice = state.currentItem.price;
                Object.values(state.currentCustomizations).forEach(group => {
                    if (Array.isArray(group)) {
                        group.forEach(option => {
                            totalPrice += option.priceAdjustment;
                        });
                    } else {
                        totalPrice += group.priceAdjustment;
                    }
                });
                
                // Get current branch cart
                const currentCart = getCurrentBranchCart();
                
                // Check if item already exists in cart with same customizations
                const existingIndex = currentCart.findIndex(cartItem => 
                    cartItem.branch_menu_id === state.currentItem.branch_menu_id && 
                    JSON.stringify(cartItem.customizations) === JSON.stringify(state.currentCustomizations)
                );
                
                if (existingIndex >= 0) {
                    // Update quantity if already exists
                    currentCart[existingIndex].quantity += state.currentQuantity;
                } else {
                    // Add new item to cart
                    const cartItem = {
                        branch_menu_id: state.currentItem.branch_menu_id,
                        item_id: state.currentItem.item_id,
                        name: state.currentItem.item_name,
                        name_translation_key: state.currentItem.name_translation_key,
                        price: totalPrice,
                        base_price: state.currentItem.price,
                        image_url: state.currentItem.image_url,
                        customizations: state.currentCustomizations,
                        quantity: state.currentQuantity,
                        branch_id: state.currentBranch.branch_id,
                        branch_name: state.currentBranch.internal_name
                    };
                    
                    console.log('Adding cart item:', cartItem);
                    currentCart.push(cartItem);
                }
                
                saveCart();
                updateCurrentCart();
                updateCartUI();
                hideModal('item-detail-modal');
                
                // Update all menu cards to reflect new cart state
                updateMenuCardsQuantityControllers();
                
                // Update URL to go back to menu after adding to cart
                // Use replaceState to avoid triggering router navigation
                if (state.currentBranch) {
                    const menuUrl = createBranchUrl(state.currentBranch, 'menu');
                    if (window.location.hash !== menuUrl) {
                        // Use replaceState instead of hash assignment to avoid router trigger
                        history.replaceState(null, null, menuUrl);
                    }
                }
                
                showToast(translate('item_added'));
            }
            
            function updateCartItemQuantity(index, change) {
                const item = state.cart[index];
                if (!item) return;
                
                item.quantity += change;
                
                if (item.quantity <= 0) {
                    removeCartItemByIndex(index);
                } else {
                    saveCart();
                    updateCurrentCart();
                    updateCartUI();
                    
                    // Update only the specific cart item UI instead of re-rendering everything
                    updateCartItemUI(index);
                    
                    // Re-attach event listeners for quantity controls to ensure they work correctly
                    attachCartEventListeners();
                }
            }
            
            function removeCartItem(index) {
                const item = state.cart[index];
                if (!item) return;
                
                const branchId = item.branch_id;
                const branchMenuId = item.branch_menu_id;
                const customizations = item.customizations;
                
                // Remove from main cart (after capturing item info for DOM removal)
                state.cart.splice(index, 1);
                
                // Update branch cart
                const branchCart = getBranchCart(branchId);
                const branchCartIndex = branchCart.findIndex(cartItem => 
                    cartItem.branch_menu_id === branchMenuId && 
                    JSON.stringify(cartItem.customizations) === JSON.stringify(customizations)
                );
                
                if (branchCartIndex >= 0) {
                    branchCart.splice(branchCartIndex, 1);
                }
                
                saveCart();
                updateCurrentCart();
                updateCartUI();
                
                // Remove the specific cart item from DOM using the captured item info
                removeCartItemFromDOM(item, index);
                
                // After removal, update indices of remaining items and re-attach event listeners
                setTimeout(() => {
                    updateCartItemIndices();
                    attachCartEventListeners();
                }, 350); // Wait for DOM removal animation to complete
            }
            
            function removeCartItemByIndex(index) {
                removeCartItem(index);
            }
            
            // Helper function to update specific cart item UI without full re-render
            function updateCartItemUI(index) {
                if (state.currentView !== 'cart') return;
                
                const cartItem = state.cart[index];
                if (!cartItem) return;
                
                // Find the cart item element by data attributes (more reliable than index)
                const itemElement = document.querySelector(`[data-branch-menu-id="${cartItem.branch_menu_id}"][data-cart-index="${index}"]`);
                if (!itemElement) return;
                
                // Update quantity display
                const quantityInput = itemElement.querySelector('.quantity-input');
                if (quantityInput) {
                    quantityInput.value = cartItem.quantity;
                }
                
                // Update price display
                const priceTotal = itemElement.querySelector('.price-total');
                if (priceTotal) {
                    priceTotal.textContent = `${formatPrice(cartItem.price)} × ${cartItem.quantity} = ${formatPrice(cartItem.price * cartItem.quantity)}`;
                }
                
                // Update cart summary
                updateCartSummaryUI();
            }
            
            // Helper function to update cart item indices after removal
            function updateCartItemIndices() {
                if (state.currentView !== 'cart') return;
                
                const cartItems = document.querySelectorAll('.cart-item');
                cartItems.forEach((itemElement, newIndex) => {
                    itemElement.setAttribute('data-cart-index', newIndex);
                    
                    // Update data-index attributes on all buttons within this item
                    const buttons = itemElement.querySelectorAll('[data-index]');
                    buttons.forEach(button => {
                        button.setAttribute('data-index', newIndex);
                    });
                });
            }
            
            // Helper function to attach event listeners to cart controls
            function attachCartEventListeners() {
                if (state.currentView !== 'cart') return;
                
                // Remove existing event listeners to prevent duplicates
                document.querySelectorAll('[data-action="decrease"]').forEach(btn => {
                    btn.replaceWith(btn.cloneNode(true));
                });
                
                document.querySelectorAll('[data-action="increase"]').forEach(btn => {
                    btn.replaceWith(btn.cloneNode(true));
                });
                
                document.querySelectorAll('.btn-remove').forEach(btn => {
                    btn.replaceWith(btn.cloneNode(true));
                });
                
                // Add fresh event listeners
                document.querySelectorAll('[data-action="decrease"]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.target.getAttribute('data-index'));
                        updateCartItemQuantity(index, -1);
                    });
                });
                
                document.querySelectorAll('[data-action="increase"]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.target.getAttribute('data-index'));
                        updateCartItemQuantity(index, 1);
                    });
                });
                
                document.querySelectorAll('.btn-remove').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.target.closest('.btn-remove').getAttribute('data-index'));
                        removeCartItem(index);
                    });
                });
                
                // Re-attach checkout button listener
                const checkoutBtn = document.getElementById('checkout-btn');
                if (checkoutBtn) {
                    checkoutBtn.replaceWith(checkoutBtn.cloneNode(true));
                    document.getElementById('checkout-btn').addEventListener('click', () => {
                        if (state.currentBranch) {
                            window.location.hash = createBranchUrl(state.currentBranch, 'checkout');
                        } else {
                            window.location.hash = 'checkout';
                        }
                    });
                }
            }
            
            // Helper function to remove specific cart item from DOM without full re-render
            function removeCartItemFromDOM(item, index) {
                if (state.currentView !== 'cart') return;
                
                // Find the cart item element by data attributes using the passed item info
                const itemElement = document.querySelector(`[data-branch-menu-id="${item.branch_menu_id}"][data-cart-index="${index}"]`);
                if (!itemElement) return;
                
                // Add fade out animation
                itemElement.style.transition = 'opacity 0.3s ease-out';
                itemElement.style.opacity = '0';
                
                // Remove element after animation
                setTimeout(() => {
                    itemElement.remove();
                    
                    // Update cart summary
                    updateCartSummaryUI();
                    
                    // Show empty cart message if no items left
                    if (state.cart.length === 0) {
                        showEmptyCartMessage();
                    } else {
                        // Re-attach event listeners for remaining items
                        attachCartEventListeners();
                    }
                }, 300);
            }
            
            // Helper function to update cart summary without full re-render
            function updateCartSummaryUI() {
                if (state.currentView !== 'cart') return;
                
                const cartSummary = document.querySelector('.cart-summary');
                if (!cartSummary) return;
                
                // Recalculate totals
                let subtotal = 0;
                state.cart.forEach(item => {
                    subtotal += item.price * item.quantity;
                });
                
                const settings = state.currentBranch?.settings || {};
                const serviceChargePercentage = parseFloat(settings.service_charge_percentage) || 0;
                const vatPercentage = parseFloat(settings.vat_percentage) || 0;
                
                const serviceCharge = subtotal * (serviceChargePercentage / 100);
                const tax = (subtotal + serviceCharge) * (vatPercentage / 100);
                
                // Calculate discount if promo is applied
                const discountAmount = state.appliedPromo ? calculateDiscountAmount(subtotal, state.appliedPromo) : 0;
                const total = subtotal + serviceCharge + tax - discountAmount;
                
                // Update summary HTML
                cartSummary.innerHTML = `
                    <div class="summary-row">
                        <span>${translate('subtotal')}:</span>
                        <span>${formatPrice(subtotal)}</span>
                    </div>
                    ${serviceCharge > 0 ? `
                    <div class="summary-row">
                        <span>${translate('service_charge')} (${serviceChargePercentage}%):</span>
                        <span>${formatPrice(serviceCharge)}</span>
                    </div>
                    ` : ''}
                    ${tax > 0 ? `
                    <div class="summary-row">
                        <span>${translate('tax')} (${vatPercentage}%):</span>
                        <span>${formatPrice(tax)}</span>
                    </div>
                    ` : ''}
                    ${state.appliedPromo ? `
                    <div class="summary-row discount-row">
                        <span>${translate('discount')} (${state.appliedPromo.code}):</span>
                        <span>-${formatPrice(discountAmount)}</span>
                    </div>
                    ` : ''}
                    <div class="summary-row summary-total">
                        <span>${translate('total')}:</span>
                        <span>${formatPrice(total)}</span>
                    </div>
                    <button class="btn" id="checkout-btn">${translate('proceed_to_checkout')}</button>
                `;
                
                // Re-attach checkout button event listener
                const checkoutBtn = document.getElementById('checkout-btn');
                if (checkoutBtn) {
                    checkoutBtn.addEventListener('click', () => {
                        if (state.currentBranch) {
                            window.location.hash = createBranchUrl(state.currentBranch, 'checkout');
                        } else {
                            window.location.hash = 'checkout';
                        }
                    });
                }
            }
            
            // Helper function to show empty cart message
            function showEmptyCartMessage() {
                if (state.currentView !== 'cart') return;
                
                const cartContainer = document.getElementById('cart-container');
                if (!cartContainer) return;
                
                const browseMenuUrl = state.currentBranch ? 
                    createBranchUrl(state.currentBranch, 'menu') : 
                    '#menu';
                
                cartContainer.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>${translate('empty_cart')}</h3>
                        <p>${translate('add_some_delicious_items')}</p>
                        <a href="${browseMenuUrl}" class="btn">${translate('browse_menu')}</a>
                    </div>
                `;
            }
            
            // Helper function to refresh cart view completely (if needed)
            function refreshCartView() {
                if (state.currentView !== 'cart') return;
                
                // Show skeleton briefly for better UX
                renderCartSkeleton();
                
                setTimeout(() => {
                    renderCart();
                }, 100);
            }
            
            // Enhanced cart state synchronization
            function synchronizeCartState() {
                // Ensure cart is properly loaded from localStorage
                loadCart();
                
                // Ensure current cart is updated based on current branch
                updateCurrentCart();
                
                // Update cart UI
                updateCartUI();
                
                // If we're currently on cart view, refresh it
                if (state.currentView === 'cart') {
                    refreshCartView();
                }
            }
            
            // Helper function to ensure branch settings are loaded
            async function ensureBranchSettings(branch) {
                if (!branch.settings) {
                    try {
                        const settings = await apiService.getBranchSettings(branch.branch_id);
                        branch.settings = settings.data || settings;
                        console.log('Loaded branch settings for:', branch.internal_name);
                    } catch (error) {
                        console.error('Failed to load branch settings:', error);
                        // Set default settings if loading fails
                        branch.settings = {
                            vat_percentage: 0,
                            service_charge_percentage: 0
                        };
                    }
                }
                return branch;
            }
            
            async function addFavoriteItemToCart(item) {
                if (!item.branch_id) {
                    showError(translate('item_branch_not_available'));
                    return;
                }
                
                // Find the branch for this item
                const itemBranch = state.branches.find(branch => branch.branch_id === item.branch_id);
                if (!itemBranch) {
                    showError(translate('branch_not_found'));
                    return;
                }
                
                // Ensure branch settings are loaded
                const branchWithSettings = await ensureBranchSettings(itemBranch);
                
                // Set current item and branch
                state.currentItem = item;
                state.currentBranch = branchWithSettings;
                state.currentQuantity = 1;
                state.currentCustomizations = {};
                
                // Update branch name displays and cart UI
                updateBranchNameDisplays();
                updateCurrentCart();
                updateCartUI();
                
                // Check for branch conflict
                const hasConflict = checkBranchConflict(item);
                
                if (hasConflict) {
                    // Show branch conflict modal
                    showBranchConflictModal(item, () => {
                        // This callback will be executed if user confirms
                        performAddToCart();
                    });
                    return;
                }
                
                // No conflict, proceed with normal add to cart
                performAddToCart();
            }
            
            function saveCart() {
                localStorage.setItem('lunaDineBranchCarts', JSON.stringify(state.branchCarts));
                localStorage.setItem('lunaDineCart', JSON.stringify(state.cart));
            }
            
            function loadCart() {
                const branchCartsData = localStorage.getItem('lunaDineBranchCarts');
                if (branchCartsData) {
                    state.branchCarts = JSON.parse(branchCartsData);
                }
                
                const cartData = localStorage.getItem('lunaDineCart');
                if (cartData) {
                    state.cart = JSON.parse(cartData);
                }
                
                // Ensure current cart is synchronized
                updateCurrentCart();
            }
            
            function updateCartUI() {
                const totalItems = state.cart.reduce((total, item) => total + item.quantity, 0);
                
                elements.cartCounts.forEach(element => {
                    element.textContent = totalItems;
                });
            }
            
            // Favorites management
            function toggleFavorite(item) {
                const index = state.favorites.findIndex(fav => fav.branch_menu_id === item.branch_menu_id);
                
                if (index >= 0) {
                    // Remove from favorites
                    const removedItem = state.favorites[index];
                    state.favorites.splice(index, 1);
                    
                    // Remove from DOM without full re-render if we're on favorites page
                    if (state.currentView === 'favorites') {
                        removeFavoriteFromDOM(removedItem, index);
                    }
                } else {
                    // Add to favorites
                    const itemWithBranch = { ...item };
                    
                    // If item doesn't have branch_id, try to get it from current branch
                    if (!itemWithBranch.branch_id && state.currentBranch) {
                        itemWithBranch.branch_id = state.currentBranch.branch_id;
                    }
                    
                    // If still no branch_id, try to find it from branches array
                    if (!itemWithBranch.branch_id && state.branches.length > 0) {
                        // Assume the item belongs to the first available branch
                        // This is a fallback - ideally items should have branch_id
                        itemWithBranch.branch_id = state.branches[0].branch_id;
                    }
                    
                    state.favorites.push(itemWithBranch);
                    
                    // If we're on favorites page, add to DOM without full re-render
                    if (state.currentView === 'favorites') {
                        addFavoriteToDOM(itemWithBranch, state.favorites.length - 1);
                    }
                }
                
                saveFavorites();
            }
            
            function saveFavorites() {
                localStorage.setItem('lunaDineFavorites', JSON.stringify(state.favorites));
            }
            
            function loadFavorites() {
                const favoritesData = localStorage.getItem('lunaDineFavorites');
                if (favoritesData) {
                    state.favorites = JSON.parse(favoritesData);
                    
                    // Ensure all loaded favorites have branch_id
                    state.favorites = state.favorites.map(fav => {
                        if (!fav.branch_id) {
                            // Try to get branch_id from current branch
                            if (state.currentBranch) {
                                fav.branch_id = state.currentBranch.branch_id;
                            }
                            // If still no branch_id, try to find it from branches array
                            else if (state.branches.length > 0) {
                                fav.branch_id = state.branches[0].branch_id;
                            }
                        }
                        return fav;
                    });
                    
                    // Save the updated favorites back to localStorage
                    saveFavorites();
                }
            }
            
            // Helper function to remove favorite item from DOM without full re-render
            function removeFavoriteFromDOM(item, index) {
                if (state.currentView !== 'favorites') return;
                
                // Find the favorite item element by data attributes
                const itemElement = document.querySelector(`[data-branch-menu-id="${item.branch_menu_id}"][data-favorite-index="${index}"]`);
                if (!itemElement) return;
                
                // Add fade out animation
                itemElement.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
                itemElement.style.opacity = '0';
                itemElement.style.transform = 'scale(0.9)';
                
                // Remove element after animation
                setTimeout(() => {
                    itemElement.remove();
                    
                    // Update remaining indices
                    updateFavoriteIndices();
                    
                    // Show empty state if no favorites left
                    if (state.favorites.length === 0) {
                        showEmptyFavoritesMessage();
                    }
                }, 300);
            }
            
            // Helper function to add favorite item to DOM without full re-render
            function addFavoriteToDOM(item, index) {
                if (state.currentView !== 'favorites') return;
                
                const favoritesGrid = document.querySelector('.menu-items-grid');
                if (!favoritesGrid) return;
                
                // Create the favorite item card
                const itemCard = document.createElement('div');
                itemCard.className = 'menu-item-card';
                itemCard.setAttribute('data-branch-menu-id', item.branch_menu_id);
                itemCard.setAttribute('data-favorite-index', index);
                
                const isFeatured = item.is_featured || false;
                const quantity = getItemQuantityInCart(item.branch_menu_id);
                
                itemCard.innerHTML = `
                    <div class="menu-item-image-container">
                        <img src="${item.image_url || '/images/food-default.jpg'}" alt="${item.item_name}" class="menu-item-image">
                        ${isFeatured ? '<span class="menu-item-badge">Featured</span>' : ''}
                    </div>
                    <div class="menu-item-content">
                        <div class="menu-item-header">
                            <h4 class="menu-item-name">${getTranslation(item.item_name, item.name_translation_key)}</h4>
                            <div class="menu-item-price">${formatPrice(item.price)}</div>
                        </div>
                        <p class="item-desc">${getTranslation(item.item_description, item.description_translation_key) || translate('delicious_menu_item')}</p>
                        <div class="menu-item-footer">
                            <div class="prep-time-with-favorite">
                                <span class="prep-time"><i class="fas fa-clock"></i> ${item.preparation_time_minutes || 15} ${translate('mins')}</span>
                                <button class="btn-favorite active" data-item-id="${item.branch_menu_id}">
                                    <i class="fas fa-heart"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add fade in animation
                itemCard.style.opacity = '0';
                itemCard.style.transform = 'scale(0.9)';
                itemCard.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
                
                favoritesGrid.appendChild(itemCard);
                
                // Trigger animation
                setTimeout(() => {
                    itemCard.style.opacity = '1';
                    itemCard.style.transform = 'scale(1)';
                }, 10);
                
                // Attach event listeners
                attachFavoriteItemEventListeners(itemCard, item, index);
                // Note: Removed setupQuantityControllerEvents for favorites page
            }
            
            // Helper function to update favorite item indices after removal
            function updateFavoriteIndices() {
                if (state.currentView !== 'favorites') return;
                
                const favoriteItems = document.querySelectorAll('.menu-item-card[data-favorite-index]');
                favoriteItems.forEach((itemElement, newIndex) => {
                    itemElement.setAttribute('data-favorite-index', newIndex);
                    
                    // Update data-index attributes on buttons within this item
                    const buttons = itemElement.querySelectorAll('[data-index]');
                    buttons.forEach(button => {
                        button.setAttribute('data-index', newIndex);
                    });
                });
            }
            
            // Helper function to attach event listeners to favorite item
            function attachFavoriteItemEventListeners(itemElement, item, index) {
                // Item click event (show details)
                itemElement.addEventListener('click', (e) => {
                    // Don't trigger if clicking on buttons
                    if (e.target.closest('.menu-item-actions') || e.target.closest('.item-actions')) return;
                    
                    showItemDetailModal(item);
                });
                
                // Favorite button event
                const favoriteBtn = itemElement.querySelector('.btn-favorite');
                if (favoriteBtn) {
                    favoriteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleFavorite(item);
                    });
                }
                
                // Add to cart button event
                const addToCartBtn = itemElement.querySelector('.btn-add-to-cart');
                if (addToCartBtn) {
                    addToCartBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        addFavoriteItemToCart(item);
                    });
                }
            }
            
            // Helper function to show empty favorites message
            function showEmptyFavoritesMessage() {
                if (state.currentView !== 'favorites') return;
                
                const favoritesContainer = document.getElementById('favorites-container');
                if (!favoritesContainer) return;
                
                const browseMenuUrl = state.currentBranch ? 
                    createBranchUrl(state.currentBranch, 'menu') : 
                    '#menu';
                
                favoritesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-heart"></i>
                        <h3>${translate('empty_favorites')}</h3>
                        <p>${translate('start_adding_favorites')}</p>
                        <a href="${browseMenuUrl}" class="btn">${translate('browse_menu')}</a>
                    </div>
                `;
            }
            
            // Helper function to refresh favorites view completely (if needed)
            function refreshFavoritesView() {
                if (state.currentView !== 'favorites') return;
                
                // Show skeleton briefly for better UX
                renderFavoritesSkeleton();
                
                setTimeout(() => {
                    renderFavorites();
                }, 100);
            }
            
            // Enhanced favorites state synchronization
            function synchronizeFavoritesState() {
                // Ensure favorites are properly loaded from localStorage
                loadFavorites();
                
                // If we're currently on favorites view, refresh it
                if (state.currentView === 'favorites') {
                    refreshFavoritesView();
                }
            }
            
            // User data management
            function saveUserData() {
                const userData = {
                    favorites: state.favorites,
                    orderHistory: state.orderHistory,
                    userInfo: state.userInfo,
                    language: state.language
                };
                
                localStorage.setItem('lunaDineUser', JSON.stringify(userData));
            }
            
            function loadUserData() {
                const userData = localStorage.getItem('lunaDineUser');
                
                if (userData) {
                    const parsedData = JSON.parse(userData);
                    state.favorites = parsedData.favorites || [];
                    state.orderHistory = parsedData.orderHistory || [];
                    state.userInfo = parsedData.userInfo || null;
                    state.language = parsedData.language || 'en-US';
                }
                
                loadCart();
                loadFavorites();
            }
            
            // Modal management
            function hideModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            }
            
            // Enhanced showModal function with history management
            function showModal(modalId) {
                console.log('showModal called with:', modalId);
                const modalElement = document.getElementById(modalId);
                if (!modalElement) {
                    console.error('Modal element not found:', modalId);
                    return;
                }
                console.log('Modal element found:', modalElement);
                console.log('Modal current classes:', modalElement.className);
                
                modalElement.classList.add('active');
                console.log('Modal classes after adding active:', modalElement.className);
                
                // Push history state to enable back button functionality
                // This creates a history entry that the back button can return to
                const currentState = history.state || {};
                history.pushState(
                    { ...currentState, modalOpen: true, modalId: modalId }, 
                    '', 
                    window.location.hash
                );
                console.log('History state pushed for modal:', modalId);
            }
            
            // Setup modal event listeners after DOM is loaded
            document.addEventListener('DOMContentLoaded', function() {
                // Close modal when clicking outside the modal content
                document.querySelectorAll('.modal-overlay').forEach(overlay => {
                    overlay.addEventListener('click', (e) => {
                        // Only close if clicking directly on the overlay (not on modal content)
                        if (e.target === overlay) {
                            const modalId = overlay.id;
                            hideModal(modalId);
                            
                            // Only update URL for item detail modal if it's different from current menu URL
                            // This prevents unnecessary URL changes that might trigger re-renders
                            if (modalId === 'item-detail-modal' && state.currentBranch) {
                                const currentHash = window.location.hash;
                                const menuUrl = createBranchUrl(state.currentBranch, 'menu');
                                
                                // Only update URL if we're not already on the menu page
                                if (!currentHash.includes('/menu') && currentHash !== menuUrl) {
                                    // Use replaceState instead of hash assignment to avoid router trigger
                                    history.replaceState(null, null, menuUrl);
                                }
                            }
                        }
                    });
                });
            });
            
            // Handle browser back button to close modals (moved outside DOMContentLoaded for better mobile support)
            window.addEventListener('popstate', (e) => {
                console.log('popstate event fired', e);
                console.log('Current URL:', window.location.hash);
                console.log('History state:', e.state);
                
                // Check if we're closing a modal (history state indicates modal was open)
                const wasModalOpen = e.state && e.state.modalOpen;
                const activeModals = document.querySelectorAll('.modal-overlay.active');
                console.log('Active modals found:', activeModals.length);
                console.log('Was modal open in history:', wasModalOpen);
                
                if (activeModals.length > 0 || wasModalOpen) {
                    console.log('Closing modals due to back button');
                    // Close all active modals without updating URL
                    // The back button should just close the modal, not navigate
                    activeModals.forEach(modal => {
                        const modalId = modal.id;
                        console.log('Closing modal:', modalId);
                        hideModal(modalId);
                    });
                    
                    // Prevent the default back navigation since we handled the modal closing
                    e.preventDefault();
                    console.log('Prevented default navigation');
                } else {
                    console.log('No active modals and no modal in history, allowing default navigation');
                }
            });
            
            // Override the existing hashchange handler to prevent re-render when closing modals
            const originalHandleRouteChange = handleRouteChange;
            handleRouteChange = function(isInitialLoad = false) {
                console.log('handleRouteChange called, isInitialLoad:', isInitialLoad);
                console.log('Current hash:', window.location.hash);
                
                // Check if we're closing a modal (has modal in history state)
                const historyState = history.state || {};
                const wasModalOpen = historyState.modalOpen;
                const activeModals = document.querySelectorAll('.modal-overlay.active');
                
                console.log('Active modals:', activeModals.length);
                console.log('Was modal open in history:', wasModalOpen);
                
                // If we just closed a modal, don't re-render the page
                if (wasModalOpen && activeModals.length === 0) {
                    console.log('Modal just closed, preventing route change to avoid re-render');
                    // Clear the modal state from history
                    history.replaceState({}, '', window.location.hash);
                    return; // Don't proceed with route change
                }
                
                // Otherwise, proceed with normal route handling
                console.log('Proceeding with normal route handling');
                return originalHandleRouteChange.call(this, isInitialLoad);
            };
            
            // Confirmation modal management
            let confirmationCallback = null;
            
            function showConfirmationModal(message, onConfirm) {
                const messageElement = document.getElementById('confirmation-message');
                const modal = document.getElementById('confirmation-modal');
                
                if (messageElement && modal) {
                    messageElement.textContent = message;
                    confirmationCallback = onConfirm;
                    showModal('confirmation-modal');
                }
            }
            
            function handleConfirmationConfirm() {
                if (confirmationCallback) {
                    confirmationCallback();
                    confirmationCallback = null;
                }
                hideModal('confirmation-modal');
            }
            
            function handleConfirmationCancel() {
                confirmationCallback = null;
                hideModal('confirmation-modal');
            }
            
            // Service requests
            function submitServiceRequest() {
                if (!state.currentBranch) {
                    showError(translate('please_select_branch'));
                    return;
                }
                
                const requestData = {
                    branch_id: state.currentBranch.branch_id,
                    table_id: state.currentTable?.table_id || 1,
                    request_type: elements.requestType.value
                };
                
                if (elements.requestType.value === 'OTHER') {
                    requestData.notes = elements.otherRequest.value;
                }
                
                apiService.createServiceRequest(requestData)
                    .then(() => {
                        hideModal('service-modal');
                        showToast(translate('service_request_submitted'));
                    })
                    .catch(error => {
                        console.error('Failed to submit service request:', error);
                    });
            }
            
            // Auto-select first available branch if none is selected
            async function ensureBranchSelected() {
                if (state.currentBranch) {
                    return true;
                }
                
                try {
                    const branches = await apiService.getBranches();
                    const availableBranches = branches.data || branches;
                    
                    if (availableBranches && availableBranches.length > 0) {
                        state.currentBranch = availableBranches[0];
                        console.log('Auto-selected branch:', state.currentBranch);
                        return true;
                    }
                } catch (error) {
                    console.error('Failed to auto-select branch:', error);
                }
                
                return false;
            }
            
            // Validate customizations against API before placing order
            async function validateCustomizationsWithAPI(cartItems) {
                const validationResults = [];
                
                for (const item of cartItems) {
                    if (item.customizations && Object.keys(item.customizations).length > 0) {
                        try {
                            console.log(`Validating customizations for item ${item.branch_menu_id}`);
                            
                            // Get the available customization options from API
                            const response = await apiService.getCustomizations(item.branch_menu_id);
                            const availableOptions = response.data || response;
                            console.log(`Available options for item ${item.branch_menu_id}:`, availableOptions);
                            
                            // Transform our customizations to API format
                            const transformedCustomizations = transformCustomizationsForAPI(item.customizations, item.branch_menu_id);
                            console.log(`Transformed customizations for item ${item.branch_menu_id}:`, transformedCustomizations);
                            
                            // Validate each transformed customization
                            for (const customization of transformedCustomizations) {
                                console.log(`Validating customization:`, customization);
                                
                                // Find the group in available options
                                const group = availableOptions.groups?.find(g => g.id === customization.group_id);
                                if (!group) {
                                    validationResults.push({
                                        item_id: item.branch_menu_id,
                                        error: `Group ${customization.group_id} not found in available options`
                                    });
                                    continue;
                                }
                                
                                // Validate selected options exist in the group
                                for (const optionId of customization.selected_options) {
                                    const optionExists = group.options?.some(opt => opt.id === optionId);
                                    if (!optionExists) {
                                        validationResults.push({
                                            item_id: item.branch_menu_id,
                                            error: `Option ${optionId} not found in group ${customization.group_id}`
                                        });
                                    }
                                }
                                
                                // Validate group type constraints
                                if (group.type === 'radio' && customization.selected_options.length > 1) {
                                    validationResults.push({
                                        item_id: item.branch_menu_id,
                                        error: `Radio group ${customization.group_id} cannot have multiple selections`
                                    });
                                }
                                
                                if (group.required && customization.selected_options.length === 0) {
                                    validationResults.push({
                                        item_id: item.branch_menu_id,
                                        error: `Required group ${customization.group_id} has no selections`
                                    });
                                }
                            }
                            
                        } catch (error) {
                            validationResults.push({
                                item_id: item.branch_menu_id,
                                error: `Failed to validate customizations: ${error.message}`
                            });
                        }
                    }
                }
                
                return validationResults;
            }
            
            // Transform customizations from frontend format to API format
            function transformCustomizationsForAPI(customizations, branchMenuId) {
                if (!customizations || typeof customizations !== 'object') {
                    console.log('No customizations to transform');
                    return [];
                }
                
                console.log('Transforming customizations for branch_menu_id', branchMenuId, ':', customizations);
                
                const apiCustomizations = [];
                
                Object.entries(customizations).forEach(([groupId, groupData]) => {
                    if (Array.isArray(groupData)) {
                        // Checkbox group - multiple selections
                        if (groupData.length > 0) {
                            apiCustomizations.push({
                                group_id: groupId,
                                selected_options: groupData.map(option => option.optionId)
                            });
                            console.log(`Added checkbox group ${groupId}:`, groupData.map(option => option.optionId));
                        }
                    } else if (groupData && groupData.optionId) {
                        // Radio group - single selection
                        apiCustomizations.push({
                            group_id: groupId,
                            selected_options: [groupData.optionId]
                        });
                        console.log(`Added radio group ${groupId}:`, [groupData.optionId]);
                    }
                });
                
                console.log('Transformed API customizations:', apiCustomizations);
                return apiCustomizations;
            }
            
            // Validate checkout fields based on order type
            function validateCheckoutFields() {
                const orderType = document.querySelector('.order-type-btn.active');
                if (!orderType) {
                    return { valid: false, message: 'Please select an order type' };
                }
                
                const type = orderType.getAttribute('data-type');
                const missingFields = [];
                
                switch(type) {
                    case 'dine-in':
                        const tableNumber = document.getElementById('table-number');
                        if (!tableNumber || !tableNumber.value) {
                            missingFields.push('Table Number');
                        }
                        break;
                        
                    case 'takeaway':
                        const customerName = document.getElementById('customer-name');
                        const customerPhone = document.getElementById('customer-phone');
                        const pickupTime = document.getElementById('pickup-time'); // Hidden field
                        
                        if (!customerName || !customerName.value.trim()) {
                            missingFields.push('Customer Name');
                        }
                        if (!customerPhone || !customerPhone.value.trim()) {
                            missingFields.push('Phone Number');
                        }
                        if (!pickupTime || !pickupTime.value) {
                            missingFields.push('Pickup Time');
                        }
                        break;
                        
                    case 'delivery':
                        const deliveryCustomerName = document.getElementById('customer-name');
                        const deliveryCustomerPhone = document.getElementById('customer-phone');
                        const deliveryAddress = document.getElementById('delivery-address');
                        
                        if (!deliveryCustomerName || !deliveryCustomerName.value.trim()) {
                            missingFields.push('Customer Name');
                        }
                        if (!deliveryCustomerPhone || !deliveryCustomerPhone.value.trim()) {
                            missingFields.push('Phone Number');
                        }
                        if (!deliveryAddress || !deliveryAddress.value.trim()) {
                            missingFields.push('Delivery Address');
                        }
                        break;
                }
                
                // Validate payment method (required for all order types)
                const paymentMethod = document.getElementById('payment-method');
                if (!paymentMethod || !paymentMethod.value) {
                    missingFields.push('Payment Method');
                }
                
                if (missingFields.length > 0) {
                    const fieldList = missingFields.join(', ');
                    return { 
                        valid: false, 
                        message: `Please fill in the following required fields: ${fieldList}` 
                    };
                }
                
                return { valid: true };
            }
            
            // Setup pickup time functionality
            function setupPickupTime() {
                const timeInput = document.getElementById('pickup-time-input');
                const hiddenInput = document.getElementById('pickup-time');
                const display = document.getElementById('pickup-time-display');
                
                if (timeInput) {
                    // Set minimum time to current time
                    const now = new Date();
                    const currentHour = now.getHours().toString().padStart(2, '0');
                    const currentMinute = now.getMinutes().toString().padStart(2, '0');
                    const minTime = `${currentHour}:${currentMinute}`;
                    timeInput.min = minTime;
                    
                    // Add click event to ensure time picker appears
                    timeInput.addEventListener('click', function() {
                        // Force the time picker to show
                        this.showPicker();
                    });
                    
                    // Add input event to validate time selection
                    timeInput.addEventListener('input', function() {
                        validateAndUpdateTime(this);
                    });
                    
                    // Add change event for final validation
                    timeInput.addEventListener('change', function() {
                        validateAndUpdateTime(this);
                    });
                    
                    // Function to validate and update time
                    function validateAndUpdateTime(input) {
                        const selectedTime = input.value;
                        if (selectedTime) {
                            // Validate that selected time is not in the past
                            const now = new Date();
                            const selectedDateTime = new Date();
                            const [hours, minutes] = selectedTime.split(':');
                            selectedDateTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                            
                            if (selectedDateTime <= now) {
                                // If selected time is in the past or now, reset to minimum time
                                input.value = minTime;
                                const today = new Date();
                                const dateStr = today.toISOString().split('T')[0];
                                const datetimeStr = `${dateStr}T${minTime}`;
                                hiddenInput.value = datetimeStr;
                                
                                // Show user-friendly display
                                const dateObj = new Date(datetimeStr);
                                updateTimeDisplay(dateObj);
                                
                                // Show warning message
                                showTimeWarning();
                            } else {
                                // Valid future time selected
                                const today = new Date();
                                const dateStr = today.toISOString().split('T')[0];
                                const datetimeStr = `${dateStr}T${selectedTime}`;
                                hiddenInput.value = datetimeStr;
                                
                                // Show user-friendly display
                                const dateObj = new Date(datetimeStr);
                                updateTimeDisplay(dateObj);
                            }
                        } else {
                            hiddenInput.value = '';
                            display.textContent = '';
                        }
                    }
                    
                    // Function to update time display
                    function updateTimeDisplay(dateObj) {
                        const options = { 
                            weekday: 'short', 
                            year: 'numeric', 
                            month: 'short', 
                            day: 'numeric',
                            hour: '2-digit', 
                            minute: '2-digit'
                        };
                        display.textContent = `📅 Pickup: ${dateObj.toLocaleDateString('en-US', options)}`;
                        display.style.color = 'var(--uber-green)';
                        display.style.fontWeight = '600';
                        display.style.marginTop = 'var(--spacing-4)';
                        display.style.fontSize = 'var(--font-size-14)';
                    }
                    
                    // Function to show time warning
                    function showTimeWarning() {
                        const warning = document.createElement('div');
                        warning.textContent = '⚠️ Please select a future time for pickup';
                        warning.style.color = 'var(--uber-red)';
                        warning.style.fontSize = 'var(--font-size-12)';
                        warning.style.marginTop = 'var(--spacing-4)';
                        warning.style.fontWeight = '500';
                        
                        // Remove any existing warning
                        const existingWarning = display.parentNode.querySelector('.time-warning');
                        if (existingWarning) {
                            existingWarning.remove();
                        }
                        
                        // Add new warning
                        warning.className = 'time-warning';
                        display.parentNode.insertBefore(warning, display.nextSibling);
                        
                        // Remove warning after 3 seconds
                        setTimeout(() => {
                            if (warning.parentNode) {
                                warning.remove();
                            }
                        }, 3000);
                    }
                    
                    // Add placeholder text to guide user
                    timeInput.placeholder = 'Select pickup time';
                    timeInput.style.cursor = 'pointer';
                    
                    // Add focus event to enhance UX
                    timeInput.addEventListener('focus', function() {
                        this.style.borderColor = 'var(--uber-green)';
                        this.style.boxShadow = '0 0 0 3px rgba(6, 193, 103, 0.1)';
                    });
                    
                    timeInput.addEventListener('blur', function() {
                        this.style.borderColor = '';
                        this.style.boxShadow = '';
                    });
                }
            }
            
            // Order placement
            async function placeOrder() {
                // Validate required fields based on order type
                const validation = validateCheckoutFields();
                if (!validation.valid) {
                    showError(validation.message);
                    return;
                }
                
                // Ensure we have a branch selected
                const hasBranch = await ensureBranchSelected();
                if (!hasBranch) {
                    showError('No available branches. Please contact support.');
                    return;
                }
                
                if (state.cart.length === 0) {
                    showError('Your cart is empty');
                    return;
                }
                
                const orderType = document.querySelector('.order-type-btn.active').getAttribute('data-type');
                
                const orderData = {
                    branch_id: state.currentBranch.branch_id,
                    order_type: orderType,
                    items: state.cart.map(item => ({
                        item_id: item.item_id,
                        quantity: item.quantity,
                        customizations: transformCustomizationsForAPI(item.customizations, item.branch_menu_id)
                    }))
                };
                
                // Add order type specific data
                switch(orderType) {
                    case 'dine-in':
                        const tableNumber = document.getElementById('table-number');
                        orderData.table_id = tableNumber ? tableNumber.value : null;
                        const guestsCount = document.getElementById('guests-count');
                        orderData.guests_count = guestsCount ? parseInt(guestsCount.value) : 1;
                        break;
                    case 'takeaway':
                        const customerName = document.getElementById('customer-name');
                        orderData.customer_name = customerName ? customerName.value : '';
                        const customerPhone = document.getElementById('customer-phone');
                        orderData.customer_phone = customerPhone ? customerPhone.value : '';
                        const pickupTime = document.getElementById('pickup-time'); // Hidden field
                        orderData.pickup_time = pickupTime ? pickupTime.value : '';
                        break;
                    case 'delivery':
                        const deliveryCustomerName = document.getElementById('customer-name');
                        orderData.customer_name = deliveryCustomerName ? deliveryCustomerName.value : '';
                        const deliveryCustomerPhone = document.getElementById('customer-phone');
                        orderData.customer_phone = deliveryCustomerPhone ? deliveryCustomerPhone.value : '';
                        const deliveryAddress = document.getElementById('delivery-address');
                        orderData.delivery_address = deliveryAddress ? deliveryAddress.value : '';
                        
                        // Calculate delivery charge
                        const deliveryFeeConfig = state.currentBranch?.settings?.delivery_fee_config;
                        const subtotal = calculateCartSubtotal();
                        if (deliveryFeeConfig) {
                            try {
                                orderData.delivery_charge_amount = calculateDeliveryCharge(deliveryFeeConfig, subtotal);
                            } catch (e) {
                                console.error('Error calculating delivery charge:', e);
                                orderData.delivery_charge_amount = 0;
                            }
                        } else {
                            // Fallback: Default delivery charge if no config found
                            orderData.delivery_charge_amount = 50; // Default amount
                        }
                        break;
                }
                
                // Add payment method
                const paymentMethod = document.getElementById('payment-method');
                orderData.payment_method = paymentMethod ? paymentMethod.value : 'cash';
                
                // Add special instructions
                const specialInstructions = document.getElementById('special-instructions');
                orderData.special_instructions = specialInstructions ? specialInstructions.value : '';
                
                // Add promo code if applied
                if (state.appliedPromo) {
                    orderData.promo_id = state.appliedPromo.promo_id;
                    orderData.discount_amount = state.appliedPromo.discount_amount;
                }
                
                // Save customer info for future orders
                state.userInfo = {
                    name: document.getElementById('customer-name')?.value || '',
                    phone: document.getElementById('customer-phone')?.value || '',
                    address: document.getElementById('delivery-address')?.value || ''
                };
                
                saveUserData();
                
                // Validate customizations before placing order
                console.log('Validating customizations for cart items...');
                const validationErrors = await validateCustomizationsWithAPI(state.cart);
                
                if (validationErrors.length > 0) {
                    console.error('Customization validation errors:', validationErrors);
                    const errorMessage = validationErrors.map(error => error.error).join(', ');
                    showError('Invalid customizations: ' + errorMessage);
                    return;
                }
                
                console.log('Customization validation passed');
                console.log('Placing order with data:', orderData);
                
                apiService.createOrder(orderData)
                    .then(response => {
                        console.log('Order response:', response);
                        
                        // Only clear cart on successful order
                        if (response && response.data) {
                            // Clear current branch cart
                            if (state.currentBranch) {
                                state.branchCarts[state.currentBranch.branch_id] = [];
                                state.cart = [];
                                saveCart();
                                updateCurrentCart();
                                updateCartUI();
                            }
                            
                            // Clear applied promo code
                            state.appliedPromo = null;
                            
                            // Save to order history
                            state.orderHistory.push({
                                order_uid: response.data.order_uid,
                                date: new Date(),
                                items: orderData.items,
                                total: response.data.final_amount || 0,
                                status: 'pending'
                            });
                            
                            saveUserData();
                            
                            // Show success message
                            showToast(translate('order_placed_success'));
                            
                            // Redirect to order tracking
                            setTimeout(() => {
                                window.location.hash = `order/${response.data.order_uid}`;
                            }, 1500);
                        } else {
                            // Handle error case - don't clear cart
                            console.error('Invalid order response:', response);
                            showError('Failed to place order. Invalid response from server.');
                        }
                    })
                    .catch(error => {
                        console.error('Failed to place order:', error);
                        console.error('Error details:', error.message);
                        showError(translate('order_failed') + ': ' + (error.message || 'Unknown error'));
                    });
            }
            
            // Order cancellation
            async function cancelOrder(orderId) {
                // Show confirmation modal instead of alert
                showConfirmationModal(
                    translate('confirm_cancel_order'),
                    () => {
                        // This function will be called when user confirms
                        performOrderCancellation(orderId);
                    }
                );
            }
            
            // Function to actually perform the order cancellation
            async function performOrderCancellation(orderId) {
                try {
                    showLoading();
                    const response = await apiService.cancelOrder(orderId);
                    hideLoading();
                    showToast(translate('order_cancelled_success'));
                    
                    // Update order in history
                    const orderIndex = state.orderHistory.findIndex(order => order.order_uid === orderId);
                    if (orderIndex !== -1) {
                        state.orderHistory[orderIndex].status = 'cancelled';
                        saveUserData();
                        renderOrderHistory();
                    }
                    
                    // Redirect to order history after cancellation
                    setTimeout(() => {
                        window.location.hash = '#orders';
                    }, 1500);
                } catch (error) {
                    hideLoading();
                    console.error('Failed to cancel order:', error);
                    showError(translate('cancel_order_failed'));
                }
            }
            
            // Utility functions
            function formatPrice(price) {
                return new Intl.NumberFormat('en-BD', {
                    style: 'currency',
                    currency: 'BDT'
                }).format(price);
            }
            
            function formatCustomizations(customizations) {
                if (!customizations || typeof customizations !== 'object' || Object.keys(customizations).length === 0) {
                    return '';
                }
                
                // Check if customizations is in API format (array of objects) or frontend format (object with groups)
                let customizationData;
                if (Array.isArray(customizations)) {
                    // API format: [{group_id: "x", selected_options: ["a", "b"]}]
                    customizationData = {};
                    
                    customizations.forEach(group => {
                        if (group.group_id && group.selected_options && Array.isArray(group.selected_options)) {
                            if (group.selected_options.length === 1) {
                                // Single selection (radio) - store as object
                                customizationData[group.group_id] = {
                                    optionId: group.selected_options[0]
                                };
                            } else {
                                // Multiple selections (checkbox) - store as array
                                customizationData[group.group_id] = group.selected_options.map(optionId => ({
                                    optionId: optionId
                                }));
                            }
                        }
                    });
                } else {
                    // Frontend format: {groupId: {optionId: "x"} or [{optionId: "x"}, {optionId: "y"}]}
                    customizationData = customizations;
                }
                
                const customizationTexts = [];
                
                Object.entries(customizationData).forEach(([groupId, groupData]) => {
                    if (Array.isArray(groupData)) {
                        // Checkbox group - multiple selections
                        if (groupData.length > 0) {
                            const optionNames = groupData.map(option => {
                                // Try to get a readable name from the option
                                if (option.optionId) {
                                    return option.optionId.charAt(0).toUpperCase() + option.optionId.slice(1).replace(/_/g, ' ');
                                }
                                return '';
                            }).filter(name => name);
                            
                            if (optionNames.length > 0) {
                                customizationTexts.push(optionNames.join(', '));
                            }
                        }
                    } else if (groupData && groupData.optionId) {
                        // Radio group - single selection
                        const optionName = groupData.optionId.charAt(0).toUpperCase() + groupData.optionId.slice(1).replace(/_/g, ' ');
                        customizationTexts.push(optionName);
                    }
                });
                
                return customizationTexts.length > 0 ? customizationTexts.join(', ') : '';
            }
            
            function formatDetailedPrice(item) {
                if (!item.customizations || typeof item.customizations !== 'object' || Object.keys(item.customizations).length === 0) {
                    return formatPrice(item.price);
                }
                
                let customizationPrice = 0;
                const customizationDetails = [];
                
                Object.entries(item.customizations).forEach(([groupId, groupData]) => {
                    if (Array.isArray(groupData)) {
                        // Checkbox group - multiple selections
                        groupData.forEach(option => {
                            if (option.priceAdjustment && option.priceAdjustment > 0) {
                                customizationPrice += option.priceAdjustment;
                                customizationDetails.push(`+${formatPrice(option.priceAdjustment)} (${option.optionId.charAt(0).toUpperCase() + option.optionId.slice(1).replace(/_/g, ' ')})`);
                            }
                        });
                    } else if (groupData && groupData.priceAdjustment && groupData.priceAdjustment > 0) {
                        // Radio group - single selection
                        customizationPrice += groupData.priceAdjustment;
                        customizationDetails.push(`+${formatPrice(groupData.priceAdjustment)} (${groupData.optionId.charAt(0).toUpperCase() + groupData.optionId.slice(1).replace(/_/g, ' ')})`);
                    }
                });
                
                if (customizationPrice === 0) {
                    return formatPrice(item.price);
                }
                
                const basePrice = item.base_price || (item.price - customizationPrice);
                return `${formatPrice(basePrice)} ${customizationDetails.join(' ')} = ${formatPrice(item.price)}`;
            }
            
            function showLoading() {
                elements.loadingOverlay.classList.add('active');
            }
            
            function hideLoading() {
                elements.loadingOverlay.classList.remove('active');
            }
            
            function showError(message) {
                // Create error toast
                const toast = document.createElement('div');
                toast.className = 'toast error';
                toast.innerHTML = `
                    <i class="fas fa-exclamation-circle"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(toast);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
            
            function showToast(message) {
                // Create success toast
                const toast = document.createElement('div');
                toast.className = 'toast success';
                toast.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(toast);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
            
            // Event handling
            function setupEventListeners() {
                // Navigation
                elements.navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const viewName = link.getAttribute('data-view');
                        
                        // Handle branch-specific URLs for menu, cart, and checkout
                        if (viewName === 'menu' && state.currentBranch) {
                            window.location.hash = createBranchUrl(state.currentBranch, 'menu');
                        } else if (viewName === 'cart' && state.currentBranch) {
                            window.location.hash = createBranchUrl(state.currentBranch, 'cart');
                        } else {
                            window.location.hash = link.getAttribute('href').substring(1);
                        }
                    });
                });
                
                // Cart toggle
                elements.cartToggle.addEventListener('click', () => {
                    if (state.currentBranch) {
                        window.location.hash = createBranchUrl(state.currentBranch, 'cart');
                    } else {
                        window.location.hash = 'cart';
                    }
                });
                
                elements.cartFab.addEventListener('click', () => {
                    if (state.currentBranch) {
                        window.location.hash = createBranchUrl(state.currentBranch, 'cart');
                    } else {
                        window.location.hash = 'cart';
                    }
                });
                
                // QR Scanner
                elements.qrScannerBtn.addEventListener('click', showQRScanner);
                elements.qrScannerClose.addEventListener('click', hideQRScanner);
                elements.qrCodeSubmit.addEventListener('click', () => {
                    const qrCode = elements.qrCodeInput.value.trim();
                    if (qrCode) {
                        processQRCode(qrCode);
                    }
                });
                
                elements.qrCodeInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const qrCode = elements.qrCodeInput.value.trim();
                        if (qrCode) {
                            processQRCode(qrCode);
                        }
                    }
                });
                
                // Service request
                elements.serviceRequestBtn.addEventListener('click', () => {
                    showModal('service-modal');
                    renderServiceModalSkeleton();
                });
                
                elements.submitRequestBtn.addEventListener('click', submitServiceRequest);
                
                // Modal close buttons
                document.querySelectorAll('.modal-close').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const modalId = btn.getAttribute('data-modal');
                        hideModal(modalId);
                        
                        // If closing item detail modal, update URL to go back to menu
                        // Use replaceState to avoid triggering router navigation
                        if (modalId === 'item-detail-modal' && state.currentBranch) {
                            const menuUrl = createBranchUrl(state.currentBranch, 'menu');
                            if (window.location.hash !== menuUrl) {
                                // Use replaceState instead of hash assignment to avoid router trigger
                                history.replaceState(null, null, menuUrl);
                            }
                        }
                    });
                });
                
                // Confirmation modal buttons
                const confirmBtn = document.getElementById('confirmation-confirm-btn');
                const cancelBtn = document.getElementById('confirmation-cancel-btn');
                
                if (confirmBtn) {
                    confirmBtn.addEventListener('click', handleConfirmationConfirm);
                }
                
                if (cancelBtn) {
                    cancelBtn.addEventListener('click', handleConfirmationCancel);
                }
                
                // Add to cart button in item detail modal
                elements.addToCartDetailBtn.addEventListener('click', addToCart);
                
                // Request type change
                elements.requestType.addEventListener('change', () => {
                    if (elements.requestType.value === 'OTHER') {
                        elements.otherRequestContainer.style.display = 'block';
                    } else {
                        elements.otherRequestContainer.style.display = 'none';
                    }
                });
                
                // Language toggle
                const languageToggle = document.getElementById('language-toggle');
                const languageDropdown = document.getElementById('language-dropdown');
                
                languageToggle.addEventListener('click', () => {
                    languageDropdown.classList.toggle('show');
                });
                
                // Language selection
                document.querySelectorAll('.language-option').forEach(option => {
                    option.addEventListener('click', async () => {
                        const lang = option.getAttribute('data-lang');
                        console.log('Language changed to:', lang); // Debug log
                        state.language = lang;
                        saveUserData();
                        
                        // Update HTML lang attribute for proper language setting
                        document.documentElement.lang = lang;
                        document.documentElement.dir = lang === 'bn-BD' ? 'ltr' : 'ltr';
                        
                        // Load translations from API
                        await loadTranslationsFromAPI();
                        
                        // Re-render footer with new language
                        renderFooter();
                        
                        // Debug: Check branch translations
                        console.log('Branch translations after language change:');
                        state.branches.forEach(branch => {
                            const translatedName = getTranslation(branch.internal_name, branch.name_translation_key);
                            const urlName = getBranchUrlName(branch);
                            console.log({
                                branchId: branch.branch_id,
                                internalName: branch.internal_name,
                                translationKey: branch.name_translation_key,
                                translatedName: translatedName,
                                urlName: urlName
                            });
                        });
                        
                        languageDropdown.classList.remove('show');
                        
                        // Update active language option
                        document.querySelectorAll('.language-option').forEach(opt => {
                            opt.classList.remove('active');
                        });
                        option.classList.add('active');
                        
                        showToast(translate('language_changed'));
                        
                        // Update branch name displays with new language
                        updateBranchNameDisplays();
                        
                        // Refresh current view with new language and update URL
                        switch (state.currentView) {
                            case 'home':
                                renderHome();
                                break;
                            case 'menu':
                                if (state.currentBranch) {
                                    // Update URL to reflect new language branch name
                                    window.location.hash = createBranchUrl(state.currentBranch, 'menu');
                                    loadMenu(state.currentBranch.branch_id);
                                }
                                break;
                            case 'cart':
                                if (state.currentBranch) {
                                    // Update URL to reflect new language branch name
                                    window.location.hash = createBranchUrl(state.currentBranch, 'cart');
                                }
                                renderCart();
                                break;
                            case 'checkout':
                                if (state.currentBranch) {
                                    // Update URL to reflect new language branch name
                                    window.location.hash = createBranchUrl(state.currentBranch, 'checkout');
                                }
                                renderCheckout();
                                break;
                            case 'orders':
                                renderOrderHistory();
                                break;
                            case 'order-tracking':
                                // Re-render the current order if available
                                const currentOrderId = window.location.hash.split('/')[1];
                                if (currentOrderId) {
                                    loadOrder(currentOrderId);
                                }
                                break;
                            case 'favorites':
                                renderFavorites();
                                break;
                        }
                    });
                });
                
                // Close language dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!languageToggle.contains(e.target) && !languageDropdown.contains(e.target)) {
                        languageDropdown.classList.remove('show');
                    }
                });
                
                // Menu search
                if (elements.menuSearch) {
                    elements.menuSearch.addEventListener('input', utils.debounce((e) => {
                        const searchTerm = e.target.value;
                        updateSearchClearButton(searchTerm);
                        filterMenuItems(searchTerm);
                    }, 300));
                    
                    // Show/hide clear button based on input
                    elements.menuSearch.addEventListener('input', (e) => {
                        updateSearchClearButton(e.target.value);
                    });
                }
                
                // Search clear button
                if (elements.menuSearchClear) {
                    elements.menuSearchClear.addEventListener('click', () => {
                        elements.menuSearch.value = '';
                        updateSearchClearButton('');
                        filterMenuItems('');
                        elements.menuSearch.focus();
                    });
                }
                
                // Advanced search filters functionality
                if (elements.menuSearchFilterToggle && elements.menuSearchFiltersPanel) {
                    // Toggle filters panel
                    elements.menuSearchFilterToggle.addEventListener('click', () => {
                        const isActive = elements.menuSearchFiltersPanel.classList.contains('active');
                        if (isActive) {
                            elements.menuSearchFiltersPanel.classList.remove('active');
                            elements.menuSearchFilterToggle.classList.remove('active');
                        } else {
                            elements.menuSearchFiltersPanel.classList.add('active');
                            elements.menuSearchFilterToggle.classList.add('active');
                        }
                    });
                    
                    // Close filters panel when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!elements.menuSearchFilterToggle.contains(e.target) && 
                            !elements.menuSearchFiltersPanel.contains(e.target)) {
                            elements.menuSearchFiltersPanel.classList.remove('active');
                            elements.menuSearchFilterToggle.classList.remove('active');
                        }
                    });
                    
                    // Price range preset buttons (BDT context)
                    const pricePresets = document.querySelectorAll('.price-preset');
                    pricePresets.forEach(preset => {
                        preset.addEventListener('click', () => {
                            const min = parseInt(preset.getAttribute('data-min'));
                            const max = parseInt(preset.getAttribute('data-max'));
                            
                            if (elements.priceMin) elements.priceMin.value = min === 0 ? '' : min;
                            if (elements.priceMax) elements.priceMax.value = max === 9999 ? '' : max;
                            
                            // Update active state
                            pricePresets.forEach(p => p.classList.remove('active'));
                            preset.classList.add('active');
                        });
                    });
                    
                    // Rating filter options
                    const ratingOptions = document.querySelectorAll('.rating-option');
                    ratingOptions.forEach(option => {
                        option.addEventListener('click', () => {
                            // Update active state
                            ratingOptions.forEach(o => o.classList.remove('active'));
                            option.classList.add('active');
                        });
                    });
                    
                    // Spice level filter options
                    const spiceOptions = document.querySelectorAll('.spice-option');
                    spiceOptions.forEach(option => {
                        option.addEventListener('click', () => {
                            // Update active state
                            spiceOptions.forEach(o => o.classList.remove('active'));
                            option.classList.add('active');
                        });
                    });
                    
                    // Apply filters button
                    if (elements.applyFiltersBtn) {
                        elements.applyFiltersBtn.addEventListener('click', () => {
                            applyAdvancedFilters();
                            elements.menuSearchFiltersPanel.classList.remove('active');
                            elements.menuSearchFilterToggle.classList.remove('active');
                        });
                    }
                    
                    // Clear filters button
                    if (elements.clearFiltersBtn) {
                        elements.clearFiltersBtn.addEventListener('click', () => {
                            clearAllFilters();
                            elements.menuSearchFiltersPanel.classList.remove('active');
                            elements.menuSearchFilterToggle.classList.remove('active');
                        });
                    }
                }
                
                // Branch conflict modal buttons
                if (elements.branchConflictCancelBtn) {
                    elements.branchConflictCancelBtn.addEventListener('click', () => {
                        resolveBranchConflict(false);
                    });
                }
                
                if (elements.branchConflictConfirmBtn) {
                    elements.branchConflictConfirmBtn.addEventListener('click', () => {
                        resolveBranchConflict(true);
                    });
                }
                
                // Modal close buttons for branch conflict modal
                const branchConflictCloseBtns = document.querySelectorAll('[data-modal="branch-conflict-modal"]');
                branchConflictCloseBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        resolveBranchConflict(false);
                    });
                });
                
                // Mobile menu functionality
                const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
                const mobileMenu = document.getElementById('mobile-menu');
                const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
                const mobileMenuClose = document.getElementById('mobile-menu-close');
                
                // Toggle mobile menu
                mobileMenuToggle.addEventListener('click', () => {
                    mobileMenu.classList.toggle('active');
                    mobileMenuOverlay.classList.toggle('active');
                    mobileMenuToggle.classList.toggle('active');
                    document.body.style.overflow = mobileMenu.classList.contains('active') ? 'hidden' : '';
                });
                
                // Close mobile menu
                mobileMenuClose.addEventListener('click', closeMobileMenu);
                mobileMenuOverlay.addEventListener('click', closeMobileMenu);
                
                function closeMobileMenu() {
                    mobileMenu.classList.remove('active');
                    mobileMenuOverlay.classList.remove('active');
                    mobileMenuToggle.classList.remove('active');
                    document.body.style.overflow = '';
                }
                
                // Mobile header actions
                const mobileFavoritesToggle = document.getElementById('mobile-favorites-toggle');
                const mobileOrdersToggle = document.getElementById('mobile-orders-toggle');
                
                if (mobileFavoritesToggle) {
                    mobileFavoritesToggle.addEventListener('click', () => {
                        window.location.hash = 'favorites';
                        closeMobileMenu();
                    });
                }
                
                if (mobileOrdersToggle) {
                    mobileOrdersToggle.addEventListener('click', () => {
                        window.location.hash = 'orders';
                        closeMobileMenu();
                    });
                }
                
                // Mobile navigation links
                const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
                mobileNavLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const viewName = link.getAttribute('data-view');
                        
                        // Handle branch-specific URLs for menu, cart, and checkout
                        if (viewName === 'menu' && state.currentBranch) {
                            window.location.hash = createBranchUrl(state.currentBranch, 'menu');
                        } else if (viewName === 'cart' && state.currentBranch) {
                            window.location.hash = createBranchUrl(state.currentBranch, 'cart');
                        } else {
                            window.location.hash = link.getAttribute('href').substring(1);
                        }
                        
                        // Close mobile menu after navigation
                        closeMobileMenu();
                    });
                });
                
                // Mobile language selection
                const mobileLanguageOptions = document.querySelectorAll('.mobile-language-option');
                mobileLanguageOptions.forEach(option => {
                    option.addEventListener('click', async () => {
                        const lang = option.getAttribute('data-lang');
                        console.log('Mobile language changed to:', lang); // Debug log
                        state.language = lang;
                        saveUserData();
                        
                        // Update HTML lang attribute for proper language setting
                        document.documentElement.lang = lang;
                        document.documentElement.dir = lang === 'bn-BD' ? 'ltr' : 'ltr';
                        
                        // Load translations from API
                        await loadTranslationsFromAPI();
                        
                        // Re-render footer with new language
                        renderFooter();
                        
                        // Update active language option for both desktop and mobile
                        document.querySelectorAll('.language-option, .mobile-language-option').forEach(opt => {
                            opt.classList.remove('active');
                        });
                        option.classList.add('active');
                        
                        // Also update desktop language option
                        const desktopOption = document.querySelector(`.language-option[data-lang="${lang}"]`);
                        if (desktopOption) {
                            desktopOption.classList.add('active');
                        }
                        
                        showToast(translate('language_changed'));
                        
                        // Update branch name displays with new language
                        updateBranchNameDisplays();
                        
                        // Refresh current view with new language and update URL
                        switch (state.currentView) {
                            case 'home':
                                renderHome();
                                break;
                            case 'menu':
                                if (state.currentBranch) {
                                    window.location.hash = createBranchUrl(state.currentBranch, 'menu');
                                    loadMenu(state.currentBranch.branch_id);
                                }
                                break;
                            case 'cart':
                                if (state.currentBranch) {
                                    window.location.hash = createBranchUrl(state.currentBranch, 'cart');
                                }
                                renderCart();
                                break;
                            case 'checkout':
                                if (state.currentBranch) {
                                    window.location.hash = createBranchUrl(state.currentBranch, 'checkout');
                                }
                                renderCheckout();
                                break;
                            case 'orders':
                                renderOrderHistory();
                                break;
                            case 'order-tracking':
                                const currentOrderId = window.location.hash.split('/')[1];
                                if (currentOrderId) {
                                    loadOrder(currentOrderId);
                                }
                                break;
                            case 'favorites':
                                renderFavorites();
                                break;
                        }
                        
                        // Close mobile menu after language change
                        closeMobileMenu();
                    });
                });
                
                // Close mobile menu on window resize if switching to desktop
                window.addEventListener('resize', () => {
                    if (window.innerWidth > 768 && mobileMenu.classList.contains('active')) {
                        closeMobileMenu();
                    }
                });
            }
            
            // Search and filter
            function updateSearchClearButton(searchTerm) {
                if (elements.menuSearchClear) {
                    if (searchTerm.trim()) {
                        elements.menuSearchClear.classList.add('visible');
                    } else {
                        elements.menuSearchClear.classList.remove('visible');
                    }
                }
            }
            
            // Advanced filter state
            let advancedFilters = {
                priceMin: null,
                priceMax: null,
                rating: null,
                spice: null,
                dietary: []
            };
            
            // Apply advanced filters
            function applyAdvancedFilters() {
                // Get price range values (in BDT)
                const priceMin = elements.priceMin ? parseFloat(elements.priceMin.value) || null : null;
                const priceMax = elements.priceMax ? parseFloat(elements.priceMax.value) || null : null;
                
                // Get rating filter
                const activeRating = document.querySelector('.rating-option.active');
                const rating = activeRating ? parseInt(activeRating.getAttribute('data-rating')) : null;
                
                // Get spice level filter
                const activeSpice = document.querySelector('.spice-option.active');
                const spice = activeSpice ? parseInt(activeSpice.getAttribute('data-spice')) : null;
                
                // Get dietary preferences
                const dietaryCheckboxes = document.querySelectorAll('.dietary-option input[type="checkbox"]:checked');
                const dietary = Array.from(dietaryCheckboxes).map(cb => cb.value);
                
                // Update filter state
                advancedFilters = {
                    priceMin: priceMin,
                    priceMax: priceMax,
                    rating: rating,
                    spice: spice,
                    dietary: dietary
                };
                
                // Apply filters with current search term
                const searchTerm = elements.menuSearch ? elements.menuSearch.value : '';
                filterMenuItems(searchTerm);
                
                // Show active filters display
                displayActiveFilters();
            }
            
            // Clear all filters
            function clearAllFilters() {
                // Reset filter state
                advancedFilters = {
                    priceMin: null,
                    priceMax: null,
                    rating: null,
                    spice: null,
                    dietary: []
                };
                
                // Clear form inputs
                if (elements.priceMin) elements.priceMin.value = '';
                if (elements.priceMax) elements.priceMax.value = '';
                
                // Clear active states
                document.querySelectorAll('.rating-option.active').forEach(option => {
                    option.classList.remove('active');
                });
                document.querySelectorAll('.spice-option.active').forEach(option => {
                    option.classList.remove('active');
                });
                document.querySelectorAll('.price-preset.active').forEach(preset => {
                    preset.classList.remove('active');
                });
                document.querySelectorAll('.dietary-option input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // Clear active filters display
                const activeFiltersContainer = document.querySelector('.active-filters');
                if (activeFiltersContainer) {
                    activeFiltersContainer.innerHTML = '';
                }
                
                // Re-apply search without filters
                const searchTerm = elements.menuSearch ? elements.menuSearch.value : '';
                filterMenuItems(searchTerm);
            }
            
            // Display active filters as pills
            function displayActiveFilters() {
                const activeFiltersContainer = document.querySelector('.active-filters');
                if (!activeFiltersContainer) return;
                
                activeFiltersContainer.innerHTML = '';
                
                // Price range filter (show in BDT)
                if (advancedFilters.priceMin !== null || advancedFilters.priceMax !== null) {
                    const priceText = `৳${advancedFilters.priceMin || 0} - ৳${advancedFilters.priceMax || '∞'}`;
                    addFilterPill('Price: ' + priceText, 'price');
                }
                
                // Rating filter
                if (advancedFilters.rating !== null && advancedFilters.rating > 0) {
                    addFilterPill(`${advancedFilters.rating}+ Stars`, 'rating');
                }
                
                // Spice level filter
                if (advancedFilters.spice !== null && advancedFilters.spice > 0) {
                    const spiceLevels = ['', 'Mild', 'Medium', 'Hot', 'Extra Hot'];
                    addFilterPill(spiceLevels[advancedFilters.spice], 'spice');
                }
                
                // Dietary filters (use short labels)
                advancedFilters.dietary.forEach(diet => {
                    const shortLabels = {
                        'vegetarian': 'Veg',
                        'vegan': 'Vegan', 
                        'gluten-free': 'GF',
                        'dairy-free': 'DF'
                    };
                    addFilterPill(shortLabels[diet] || diet, 'dietary-' + diet);
                });
            }
            
            // Add individual filter pill
            function addFilterPill(text, type) {
                const activeFiltersContainer = document.querySelector('.active-filters');
                if (!activeFiltersContainer) return;
                
                const pill = document.createElement('div');
                pill.className = 'active-filter-pill';
                pill.innerHTML = `
                    <span>${text}</span>
                    <button onclick="removeFilter('${type}')">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                activeFiltersContainer.appendChild(pill);
            }
            
            // Remove individual filter
            function removeFilter(type) {
                if (type.startsWith('dietary-')) {
                    const diet = type.replace('dietary-', '');
                    advancedFilters.dietary = advancedFilters.dietary.filter(d => d !== diet);
                    // Uncheck checkbox
                    const checkbox = document.querySelector(`.dietary-option input[value="${diet}"]`);
                    if (checkbox) checkbox.checked = false;
                } else {
                    switch (type) {
                        case 'price':
                            advancedFilters.priceMin = null;
                            advancedFilters.priceMax = null;
                            if (elements.priceMin) elements.priceMin.value = '';
                            if (elements.priceMax) elements.priceMax.value = '';
                            document.querySelectorAll('.price-preset.active').forEach(p => p.classList.remove('active'));
                            break;
                        case 'rating':
                            advancedFilters.rating = null;
                            document.querySelectorAll('.rating-option.active').forEach(o => o.classList.remove('active'));
                            break;
                        case 'spice':
                            advancedFilters.spice = null;
                            document.querySelectorAll('.spice-option.active').forEach(o => o.classList.remove('active'));
                            break;
                    }
                }
                
                // Re-apply filters
                const searchTerm = elements.menuSearch ? elements.menuSearch.value : '';
                filterMenuItems(searchTerm);
                displayActiveFilters();
            }
            
            // Check if any filters are currently active
            function hasActiveFilters() {
                return advancedFilters.priceMin !== null ||
                       advancedFilters.priceMax !== null ||
                       (advancedFilters.rating !== null && advancedFilters.rating > 0) ||
                       (advancedFilters.spice !== null && advancedFilters.spice > 0) ||
                       advancedFilters.dietary.length > 0;
            }
            
            function filterMenuItems(searchTerm) {
                console.log('filterMenuItems called with:', searchTerm);
                const term = searchTerm.toLowerCase().trim();
                
                // Get all menu items from all categories
                const allItems = [];
                state.menuData.forEach(category => {
                    if (category.items) {
                        category.items.forEach(item => {
                            allItems.push({
                                ...item,
                                categoryName: getTranslation(category.category_name, category.name_translation_key)
                            });
                        });
                    }
                });
                
                // If no search term and no filters, show all items and reset to current category
                if (!term && !hasActiveFilters()) {
                    selectCategoryTab('all');
                    return;
                }
                
                // Filter items based on search term and advanced filters
                const filteredItems = allItems.filter(item => {
                    // Search term filtering
                    let matchesSearch = true;
                    if (term) {
                        const itemName = getTranslation(item.item_name, item.name_translation_key).toLowerCase();
                        const itemDesc = getTranslation(item.item_description, item.description_translation_key).toLowerCase();
                        const categoryName = item.categoryName.toLowerCase();
                        
                        matchesSearch = itemName.includes(term) || itemDesc.includes(term) || categoryName.includes(term);
                    }
                    
                    // Price range filtering
                    let matchesPrice = true;
                    if (advancedFilters.priceMin !== null && item.price < advancedFilters.priceMin) {
                        matchesPrice = false;
                    }
                    if (advancedFilters.priceMax !== null && item.price > advancedFilters.priceMax) {
                        matchesPrice = false;
                    }
                    
                    // Rating filtering (assuming items have a rating property)
                    let matchesRating = true;
                    if (advancedFilters.rating !== null && advancedFilters.rating > 0) {
                        const itemRating = item.rating || 0; // Default to 0 if no rating
                        matchesRating = itemRating >= advancedFilters.rating;
                    }
                    
                    // Spice level filtering (assuming items have a spice_level property)
                    let matchesSpice = true;
                    if (advancedFilters.spice !== null && advancedFilters.spice > 0) {
                        const itemSpice = item.spice_level || 0; // Default to 0 if no spice level
                        matchesSpice = itemSpice >= advancedFilters.spice;
                    }
                    
                    // Dietary preferences filtering (assuming items have dietary_tags array)
                    let matchesDietary = true;
                    if (advancedFilters.dietary.length > 0) {
                        const itemDietary = item.dietary_tags || [];
                        matchesDietary = advancedFilters.dietary.every(diet => itemDietary.includes(diet));
                    }
                    
                    return matchesSearch && matchesPrice && matchesRating && matchesSpice && matchesDietary;
                });
                
                console.log('Filtered items:', filteredItems.length);
                
                // Show filtered results in the content area
                const contentArea = document.getElementById('menu-content-area');
                if (!contentArea) return;
                
                contentArea.innerHTML = '';
                
                if (filteredItems.length === 0) {
                    contentArea.innerHTML = `
                        <div class="menu-section-empty">
                            <i class="fas fa-search"></i>
                            <h3>No items found</h3>
                            <p>No menu items match your search for "${searchTerm}"</p>
                            <button class="btn" onclick="document.getElementById('menu-search').value = ''; filterMenuItems('');">Clear Search</button>
                        </div>
                    `;
                    return;
                }
                
                // Group filtered items by category
                const groupedItems = {};
                filteredItems.forEach(item => {
                    if (!groupedItems[item.categoryName]) {
                        groupedItems[item.categoryName] = [];
                    }
                    groupedItems[item.categoryName].push(item);
                });
                
                // Create a search results section
                const searchSection = document.createElement('div');
                searchSection.className = 'menu-section';
                searchSection.innerHTML = `
                    <div class="menu-section-header">
                        <div>
                            <h3 class="menu-section-title">
                                <i class="fas fa-search section-icon"></i>
                                Search Results
                            </h3>
                            <p class="menu-section-subtitle">${filteredItems.length} item${filteredItems.length === 1 ? '' : 's'} found for "${searchTerm}"</p>
                        </div>
                    </div>
                `;
                
                const itemsGrid = document.createElement('div');
                itemsGrid.className = 'menu-section-items';
                
                // Add all filtered items
                filteredItems.forEach(item => {
                    const itemCard = createMenuItemCard(item);
                    itemsGrid.appendChild(itemCard);
                });
                
                searchSection.appendChild(itemsGrid);
                contentArea.appendChild(searchSection);
                
                // Highlight the active search state in tabs
                const tabs = document.querySelectorAll('.category-tab');
                tabs.forEach(tab => tab.classList.remove('active'));
            }
            
            // Restaurant details management
            async function loadRestaurantDetails() {
                try {
                    console.log('Loading restaurant details...'); // Debug log
                    const response = await apiService.getRestaurant();
                    state.restaurantDetails = response.data || response;
                    renderFooter();
                } catch (error) {
                    console.error('Failed to load restaurant details:', error);
                    // Use default values if API fails
                    renderFooter();
                }
            }
            
            function renderFooter() {
                // Safety check: ensure footer elements exist
                if (!elements.footerContent || !elements.footerRestaurantName) {
                    console.warn('Footer elements not found, skipping footer render');
                    return;
                }
                
                const restaurant = state.restaurantDetails || {};
                
                // Update footer restaurant name
                elements.footerRestaurantName.textContent = restaurant.name || 'Luna Dine';
                
                // Generate footer HTML
                const footerHTML = `
                    <!-- About Section -->
                    <div class="footer-section">
                        <h3>${translate('about_us')}</h3>
                        <p>${restaurant.description || translate('footer_default_description')}</p>
                        <p>${restaurant.tagline || translate('footer_default_tagline')}</p>
                        <div class="social-links">
                            ${restaurant.social_media_links ? Object.entries(restaurant.social_media_links).map(([platform, url]) => `
                                <a href="${url}" target="_blank" rel="noopener noreferrer" aria-label="${platform}">
                                    <i class="fab fa-${platform}"></i>
                                </a>
                            `).join('') : `
                                <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
                                    <i class="fab fa-facebook"></i>
                                </a>
                                <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
                                    <i class="fab fa-instagram"></i>
                                </a>
                                <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Twitter">
                                    <i class="fab fa-twitter"></i>
                                </a>
                            `}
                        </div>
                    </div>
                    
                    <!-- Contact Section -->
                    <div class="footer-section">
                        <h3>${translate('contact_us')}</h3>
                        <p><i class="fas fa-map-marker-alt"></i> ${restaurant.address || translate('footer_default_address')}</p>
                        <p><i class="fas fa-phone"></i> ${restaurant.support_phone || translate('footer_default_phone')}</p>
                        <p><i class="fas fa-envelope"></i> ${restaurant.support_email || translate('footer_default_email')}</p>
                        ${restaurant.website_url ? `<p><i class="fas fa-globe"></i> <a href="${restaurant.website_url}" target="_blank" rel="noopener noreferrer">${restaurant.website_url}</a></p>` : ''}
                    </div>
                    
                    <!-- Business Hours Section -->
                    <div class="footer-section">
                        <h3>${translate('business_hours')}</h3>
                        <div class="business-hours">
                            ${restaurant.business_hours ? Object.entries(restaurant.business_hours).map(([day, hours]) => `
                                <div class="day">
                                    <span class="day-name">${translate(day.toLowerCase())}</span>
                                    <span class="hours">${hours}</span>
                                </div>
                            `).join('') : `
                                <div class="day">
                                    <span class="day-name">${translate('monday')}</span>
                                    <span class="hours">11:00-23:00</span>
                                </div>
                                <div class="day">
                                    <span class="day-name">${translate('tuesday')}</span>
                                    <span class="hours">11:00-23:00</span>
                                </div>
                                <div class="day">
                                    <span class="day-name">${translate('wednesday')}</span>
                                    <span class="hours">11:00-23:00</span>
                                </div>
                                <div class="day">
                                    <span class="day-name">${translate('thursday')}</span>
                                    <span class="hours">11:00-23:00</span>
                                </div>
                                <div class="day">
                                    <span class="day-name">${translate('friday')}</span>
                                    <span class="hours">11:00-23:00</span>
                                </div>
                                <div class="day">
                                    <span class="day-name">${translate('saturday')}</span>
                                    <span class="hours">11:00-00:00</span>
                                </div>
                                <div class="day">
                                    <span class="day-name">${translate('sunday')}</span>
                                    <span class="hours">11:00-23:00</span>
                                </div>
                            `}
                        </div>
                    </div>
                    
                    <!-- Quick Links Section -->
                    <div class="footer-section">
                        <h3>${translate('quick_links')}</h3>
                        <ul>
                            <li><a href="#home" data-view="home">${translate('nav_home')}</a></li>
                            <li><a href="#menu" data-view="menu">${translate('nav_menu')}</a></li>
                            <li><a href="#favorites" data-view="favorites">${translate('nav_favorites')}</a></li>
                            <li><a href="#orders" data-view="orders">${translate('nav_orders')}</a></li>
                            <li><a href="#" id="privacy-policy">${translate('privacy_policy')}</a></li>
                            <li><a href="#" id="terms-service">${translate('terms_of_service')}</a></li>
                        </ul>
                    </div>
                `;
                
                // Update footer content
                elements.footerContent.innerHTML = footerHTML;
                
                // Add click event listeners to footer links
                const footerLinks = elements.footerContent.querySelectorAll('a[data-view]');
                footerLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const view = link.getAttribute('data-view');
                        showView(view);
                        window.scrollTo(0, 0);
                    });
                });
            }
            
            // Branch conflict management functions
            function checkBranchConflict(item) {
                console.log('checkBranchConflict called with item:', item);
                
                // Check if cart has items from a different branch
                if (state.cart.length === 0) {
                    console.log('Cart is empty, no branch conflict');
                    return false; // No conflict if cart is empty
                }
                
                const currentCartBranch = state.cart[0].branch_id;
                const newItemBranch = item.branch_id;
                
                console.log('Branch conflict check:', {
                    currentCartBranch,
                    newItemBranch,
                    hasBranchId: !!item.branch_id,
                    itemName: item.item_name || item.name || 'unknown'
                });
                
                // If item doesn't have branch_id, try to find it from menu data
                if (!newItemBranch && item.branch_menu_id) {
                    console.log('Item missing branch_id, searching menu data...');
                    if (state.menuData && Array.isArray(state.menuData)) {
                        for (const category of state.menuData) {
                            if (category.items && Array.isArray(category.items)) {
                                const foundItem = category.items.find(menuItem => 
                                    parseInt(menuItem.branch_menu_id) === parseInt(item.branch_menu_id)
                                );
                                if (foundItem && foundItem.branch_id) {
                                    console.log('Found complete item with branch_id:', foundItem.branch_id);
                                    // Update the item object with the missing branch_id
                                    item.branch_id = foundItem.branch_id;
                                    return currentCartBranch != foundItem.branch_id;
                                }
                            }
                        }
                    }
                }
                
                const hasConflict = currentCartBranch != newItemBranch;
                console.log('Branch conflict result:', hasConflict);
                
                return hasConflict;
            }
            
            function showBranchConflictModal(item, callback) {
                if (!elements.branchConflictModal) {
                    console.error('Branch conflict modal not found');
                    return;
                }
                
                // Store the pending item and callback
                state.pendingCartItem = {
                    item: item,
                    callback: callback
                };
                
                // Get branch names for display
                const currentCartBranch = state.cart[0].branch_id;
                const currentBranch = state.branches.find(b => b.branch_id === currentCartBranch);
                const newBranch = state.branches.find(b => b.branch_id === item.branch_id);
                
                // Update modal content
                if (elements.currentBranchName) {
                    elements.currentBranchName.textContent = getTranslation(currentBranch?.internal_name, currentBranch?.name_translation_key) || 'Unknown Branch';
                }
                
                if (elements.newBranchName) {
                    elements.newBranchName.textContent = getTranslation(newBranch?.internal_name, newBranch?.name_translation_key) || 'Unknown Branch';
                }
                
                // Show the modal
                elements.branchConflictModal.classList.add('active');
            }
            
            function resolveBranchConflict(confirmed) {
                if (!elements.branchConflictModal) {
                    console.error('Branch conflict modal not found');
                    return;
                }
                
                // Hide the modal
                elements.branchConflictModal.classList.remove('active');
                
                if (confirmed && state.pendingCartItem) {
                    // Clear ALL branch carts and main cart
                    state.cart = [];
                    state.currentCart = [];
                    state.branchCarts = {}; // Clear all branch-specific carts
                    updateCartUI();
                    
                    // Execute the callback (add the item)
                    if (state.pendingCartItem.callback) {
                        state.pendingCartItem.callback();
                    }
                }
                
                // Clear the pending item
                state.pendingCartItem = null;
            }
            
            // Hero Section Enhancements
            const heroEnhancements = {
                // Dynamic content for taglines and featured dishes
                taglines: [
                    "Taste the Moonlight Magic",
                    "Culinary Excellence Under Stars",
                    "Where Tradition Meets Innovation",
                    "Dine Under the Moonlight",
                    "Exceptional Flavors Await"
                ],
                
                featuredDishes: [
                    "Chef's Special: Grilled Salmon with Herbs",
                    "Today's Special: Truffle Mushroom Risotto",
                    "Signature Dish: Moonlight Pasta",
                    "House Favorite: Herb-Crusted Lamb",
                    "Daily Special: Seasonal Vegetable Tart"
                ],
                
                currentTaglineIndex: 0,
                currentDishIndex: 0,
                
                init() {
                    this.startDynamicContentRotation();
                    this.animateSocialProof();
                },
                
                startDynamicContentRotation() {
                    const taglineElement = document.getElementById('dynamic-tagline');
                    const dishElement = document.getElementById('featured-dish');
                    
                    if (!taglineElement || !dishElement) return;
                    
                    // Rotate taglines every 7 seconds
                    setInterval(() => {
                        this.currentTaglineIndex = (this.currentTaglineIndex + 1) % this.taglines.length;
                        this.animateTextChange(taglineElement, this.taglines[this.currentTaglineIndex]);
                    }, 7000);
                    
                    // Rotate featured dishes every 7 seconds with offset
                    setInterval(() => {
                        this.currentDishIndex = (this.currentDishIndex + 1) % this.featuredDishes.length;
                        this.animateTextChange(dishElement, this.featuredDishes[this.currentDishIndex]);
                    }, 7000);
                },
                
                animateTextChange(element, newText) {
                    // Fade out
                    element.style.opacity = '0';
                    element.style.transform = 'translateY(10px)';
                    
                    setTimeout(() => {
                        element.textContent = newText;
                        // Fade in
                        element.style.opacity = '1';
                        element.style.transform = 'translateY(0)';
                    }, 300);
                },
                
                animateSocialProof() {
                    const socialProofItems = document.querySelectorAll('.social-proof-item');
                    
                    if (!socialProofItems.length) return;
                    
                    // Animate numbers on scroll into view
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                this.animateNumber(entry.target.querySelector('.social-proof-number'));
                                observer.unobserve(entry.target);
                            }
                        });
                    });
                    
                    socialProofItems.forEach(item => observer.observe(item));
                },
                
                animateNumber(element) {
                    if (!element) return;
                    
                    const finalText = element.textContent;
                    const isPercentage = finalText.includes('.');
                    const isPlus = finalText.includes('+');
                    const numericValue = parseFloat(finalText.replace(/[^\d.]/g, ''));
                    
                    if (isNaN(numericValue)) return;
                    
                    let currentValue = 0;
                    const increment = numericValue / 50;
                    const timer = setInterval(() => {
                        currentValue += increment;
                        if (currentValue >= numericValue) {
                            currentValue = numericValue;
                            clearInterval(timer);
                        }
                        
                        let displayValue = Math.floor(currentValue);
                        if (isPercentage) {
                            displayValue = (currentValue).toFixed(1);
                        }
                        
                        element.textContent = displayValue + (isPlus ? '+' : '');
                    }, 30);
                }
            };
            
            // Utility functions object
            const utils = {
                debounce(func, wait) {
                    let timeout;
                    return function executedFunction(...args) {
                        const later = () => {
                            clearTimeout(timeout);
                            func(...args);
                        };
                        clearTimeout(timeout);
                        timeout = setTimeout(later, wait);
                    };
                }
            };
            
            // Public methods
            return {
                init
            };
        })();
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', LunaDineApp.init);
    </script>
</body>
</html>
